<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deutsch Rad C1</title>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#07070f; --s1:#0e0e1a; --s2:#141422; --s3:#1c1c2e;
  --border:rgba(255,255,255,.07); --text:#dde0f0;
  --dim:#6a6a90; --dim2:#9090b8; --gold:#e0c46a;
  --past:#d94f3a; --present:#3ad9a0; --future:#3a8fd9;
  --special:#c97ae0; --syntax:#e07a40; --nebensatz:#4ae0c0; --c1color:#ff6090;
  --ca1:#3ad9a0; --ca2:#22c478; --cb1:#3a8fd9; --cb2:#a060e0; --cc1:#ff4080;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--text);
  font-family:'DM Mono',monospace;display:flex;flex-direction:column}

/* NAV */
nav{
  height:44px;padding:0 20px;flex-shrink:0;z-index:100;
  display:flex;align-items:center;gap:16px;
  border-bottom:1px solid var(--border);background:rgba(7,7,15,.97)
}
.logo{
  font-family:'EB Garamond',serif;font-size:1.2rem;font-weight:700;
  letter-spacing:.08em;white-space:nowrap;
  background:linear-gradient(120deg,var(--ca1),var(--cb1),var(--cc1));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent
}
/* size slider */
.slider-wrap{display:flex;align-items:center;gap:8px;flex-shrink:0}
.slider-wrap label{font-size:.5rem;color:var(--dim);letter-spacing:.08em;
  text-transform:uppercase;white-space:nowrap}
#szSlider{
  -webkit-appearance:none;appearance:none;
  width:100px;height:3px;border-radius:2px;
  background:linear-gradient(to right,var(--gold) 0%,var(--gold) var(--pct,40%),var(--s3) var(--pct,40%));
  outline:none;cursor:pointer;border:none
}
#szSlider::-webkit-slider-thumb{
  -webkit-appearance:none;width:14px;height:14px;border-radius:50%;
  background:var(--gold);border:2px solid var(--bg);cursor:pointer
}
#szSlider::-moz-range-thumb{
  width:14px;height:14px;border-radius:50%;
  background:var(--gold);border:2px solid var(--bg);cursor:pointer
}
.slider-val{font-size:.5rem;color:var(--dim2);min-width:28px;text-align:right}
/* score */
.nav-r{display:flex;gap:14px;align-items:center;margin-left:auto;flex-shrink:0}
.ns{text-align:center}
.ns-n{font-family:'EB Garamond',serif;font-size:1.1rem;line-height:1}
.ns-l{font-size:.44rem;color:var(--dim);text-transform:uppercase;letter-spacing:.1em}

/* APP */
.app{flex:1;display:flex;overflow:hidden;min-height:0}

/* WHEEL SIDE */
.wheel-side{
  flex-shrink:0;display:flex;flex-direction:column;align-items:center;
  border-right:1px solid var(--border);background:var(--s1);
  position:relative;overflow:hidden;
  transition:width .15s;
}
.wheel-side::before{
  content:'';position:absolute;inset:0;pointer-events:none;
  background:radial-gradient(ellipse at 50% 50%,rgba(58,137,217,.06) 0%,transparent 70%)
}

/* level badges */
.lv-badges{
  display:flex;gap:5px;padding:8px 14px 5px;
  flex-wrap:wrap;justify-content:center;flex-shrink:0;z-index:2
}
.lvb{
  padding:3px 9px;border-radius:20px;font-size:.56rem;font-weight:700;
  border:1.5px solid var(--lc,#666);color:var(--lc,#666);background:transparent;
  cursor:pointer;transition:all .15s;letter-spacing:.04em
}
.lvb:hover,.lvb.on{background:var(--lc,#666);color:#07070f}

/* scrollable canvas area */
.wheel-scroll{
  flex:1;overflow:auto;display:flex;align-items:center;justify-content:center;
  padding:6px;min-height:0;
  scrollbar-width:thin;scrollbar-color:var(--s3) transparent
}
.wheel-scroll::-webkit-scrollbar{width:4px;height:4px}
.wheel-scroll::-webkit-scrollbar-thumb{background:var(--s3);border-radius:2px}
#wc{display:block;flex-shrink:0}

/* foot */
.wheel-foot{
  padding:4px 12px 8px;display:flex;flex-direction:column;
  align-items:center;gap:4px;flex-shrink:0;z-index:2
}
.bc{display:flex;align-items:center;gap:3px;flex-wrap:wrap;min-height:16px;
  font-size:.55rem;color:var(--dim);justify-content:center}
.bc-item{cursor:pointer;padding:2px 5px;border-radius:3px;transition:all .13s}
.bc-item:hover{color:var(--text);background:var(--s2)}
.bc-sep{opacity:.3}
.btn-back{
  font-family:'DM Mono',monospace;font-size:.55rem;letter-spacing:.07em;
  text-transform:uppercase;padding:4px 12px;background:transparent;
  border:1px solid var(--border);color:var(--dim);cursor:pointer;
  border-radius:20px;transition:all .17s
}
.btn-back:hover{border-color:var(--dim2);color:var(--text)}

/* INFO SIDE */
.info-side{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}
.ip-head{padding:16px 26px 12px;border-bottom:1px solid var(--border);flex-shrink:0}
.ip-tag{font-size:.5rem;letter-spacing:.14em;text-transform:uppercase;color:var(--dim);margin-bottom:4px}
.ip-title{font-family:'EB Garamond',serif;font-size:1.8rem;font-weight:700;line-height:1.1}
.ip-sub{font-size:.62rem;color:var(--dim);margin-top:3px;font-style:italic}
.ip-body{flex:1;overflow-y:auto;padding:16px 26px}
.ip-body::-webkit-scrollbar{width:3px}
.ip-body::-webkit-scrollbar-thumb{background:var(--s3)}

/* placeholder */
.ph{padding:6px 0}
.ph-ico{font-size:2rem;opacity:.08;margin-bottom:10px}
.ph p{font-size:.63rem;color:var(--dim2);line-height:1.9}
.ph-lv-row{display:flex;flex-wrap:wrap;gap:7px;margin-top:12px}
.ph-lv{padding:4px 12px;border-radius:20px;font-size:.58rem;font-weight:700;
  border:1.5px solid var(--lc);color:var(--lc)}

/* cards */
@keyframes fadeUp{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.card{background:var(--s2);border-radius:7px;padding:11px 15px;margin-bottom:9px;
  border-left:3px solid transparent;animation:fadeUp .22s ease}
.card.past{border-color:var(--past)}.card.present{border-color:var(--present)}
.card.future{border-color:var(--future)}.card.special{border-color:var(--special)}
.card.gold{border-color:var(--gold)}.card.syntax{border-color:var(--syntax)}
.card.nebensatz{border-color:var(--nebensatz)}.card.c1color{border-color:var(--cc1)}
.card h4{font-size:.52rem;letter-spacing:.1em;text-transform:uppercase;
  color:var(--dim);margin-bottom:7px}
.formula{font-family:'EB Garamond',serif;font-size:.97rem;color:var(--gold);
  line-height:1.5;padding:7px 10px;background:rgba(224,196,106,.05);
  border-radius:4px;margin-bottom:7px}
.rule-text{font-size:.66rem;color:var(--dim2);line-height:1.7}
.gram-table{width:100%;border-collapse:collapse;font-size:.63rem}
.gram-table th{padding:5px 8px;border-bottom:1px solid var(--border);
  color:var(--dim);font-weight:500;text-align:left}
.gram-table td{padding:4px 8px;border-bottom:1px solid rgba(255,255,255,.03)}
.gram-table td.hl{color:var(--gold);font-weight:500}
.gram-table td.de{font-family:'EB Garamond',serif;font-size:.75rem}
.tabs{display:flex;margin-bottom:12px;border-bottom:1px solid var(--border)}
.tab{padding:6px 14px;font-size:.56rem;letter-spacing:.08em;text-transform:uppercase;
  color:var(--dim);cursor:pointer;border-bottom:2px solid transparent;
  margin-bottom:-1px;transition:all .15s}
.tab:hover{color:var(--text)}.tab.active{color:var(--text);border-bottom-color:var(--gold)}
.tab-content{display:none;animation:fadeUp .2s ease}.tab-content.active{display:block}
.sent-block{font-family:'EB Garamond',serif;font-size:.86rem;line-height:1.5;
  margin-bottom:5px;padding:7px 11px;background:var(--s3);border-radius:5px}
.sent-de{color:#eef}.sent-ru{font-size:.61rem;color:var(--dim2);margin-top:2px}
.sent-note{font-size:.52rem;color:var(--gold);opacity:.85;margin-top:2px}
.analysis-row{display:flex;flex-wrap:wrap;gap:3px;margin-top:5px}
.analysis-chip{display:flex;flex-direction:column;align-items:center;
  background:rgba(255,255,255,.04);border-radius:4px;padding:2px 6px;gap:1px}
.analysis-chip .w{font-size:.64rem;color:#dde0f0}
.analysis-chip .r{font-size:.4rem;color:var(--gold);text-transform:uppercase}
.ex-q{font-family:'EB Garamond',serif;font-size:.86rem;color:#eef;
  line-height:1.6;margin-bottom:9px}
.blank{color:var(--gold);border-bottom:1px solid var(--gold);padding:0 3px}
.ex-inp{width:100%;padding:7px 11px;background:var(--s1);
  border:1px solid var(--border);border-radius:5px;color:var(--text);
  font-family:'DM Mono',monospace;font-size:.76rem;margin-bottom:7px;
  transition:border-color .16s}
.ex-inp:focus{outline:none;border-color:rgba(255,255,255,.24)}
.ex-inp.ok{border-color:var(--present);background:rgba(58,217,160,.06)}
.ex-inp.bad{border-color:var(--past);background:rgba(217,79,58,.06)}
.ex-btns{display:flex;gap:5px;margin-bottom:7px}
.btn-check{flex:2;padding:7px;background:var(--s3);
  border:1px solid rgba(255,255,255,.12);border-radius:5px;
  color:var(--text);cursor:pointer;font-family:'DM Mono',monospace;
  font-size:.58rem;font-weight:500;transition:all .13s}
.btn-check:hover{border-color:rgba(255,255,255,.28)}
.btn-next{flex:1;padding:7px;background:transparent;border:1px solid var(--border);
  border-radius:5px;color:var(--dim);cursor:pointer;
  font-family:'DM Mono',monospace;font-size:.58rem;transition:all .13s}
.btn-next:hover{border-color:var(--dim2);color:var(--text)}
.ex-fb{font-size:.64rem;line-height:1.6;padding:6px 9px;border-radius:5px}
.ex-fb.ok{background:rgba(58,217,160,.08);border:1px solid rgba(58,217,160,.3);color:var(--present)}
.ex-fb.bad{background:rgba(217,79,58,.08);border:1px solid rgba(217,79,58,.3);color:#ff8070}
.ex-progress{display:flex;gap:3px;margin-bottom:9px;flex-wrap:wrap}
.ep-dot{width:8px;height:8px;border-radius:50%;background:var(--s3);
  border:1px solid var(--border)}
.ep-dot.ok{background:var(--present);border-color:var(--present)}
.ep-dot.bad{background:var(--past);border-color:var(--past)}
.ep-dot.cur{background:var(--gold);border-color:var(--gold);width:18px;border-radius:4px}
</style>
</head>
<body>
<nav>
  <div class="logo">Deutsch Rad</div>

  <div class="slider-wrap">
    <label for="szSlider">⊙ размер</label>
    <input type="range" id="szSlider" min="180" max="760" value="360" step="10">
    <span class="slider-val" id="szVal">360</span>
  </div>

  <div class="nav-r">
    <div class="ns">
      <div class="ns-n" id="sc-ok" style="color:var(--present)">0</div>
      <div class="ns-l">верно</div>
    </div>
    <div class="ns">
      <div class="ns-n" id="sc-bad" style="color:var(--past)">0</div>
      <div class="ns-l">ошибок</div>
    </div>
  </div>
</nav>

<div class="app">
  <div class="wheel-side" id="wSide">
    <div class="lv-badges">
      <span class="lvb" style="--lc:var(--ca1)" data-lv="a1">A1</span>
      <span class="lvb" style="--lc:var(--ca2)" data-lv="a2">A2</span>
      <span class="lvb" style="--lc:var(--cb1)" data-lv="b1">B1</span>
      <span class="lvb" style="--lc:var(--cb2)" data-lv="b2">B2</span>
      <span class="lvb" style="--lc:var(--cc1)" data-lv="c1">C1</span>
    </div>
    <div class="wheel-scroll"><canvas id="wc"></canvas></div>
    <div class="wheel-foot">
      <div class="bc" id="bc"></div>
      <button class="btn-back" id="btnBack" style="display:none">← Назад</button>
    </div>
  </div>

  <div class="info-side">
    <div class="ip-head">
      <div class="ip-tag" id="ipTag">Выберите уровень</div>
      <div class="ip-title" id="ipTitle">Deutsch Rad C1</div>
      <div class="ip-sub" id="ipSub">Колесо немецкой грамматики A1 → C1</div>
    </div>
    <div class="ip-body" id="ipBody">
      <div class="ph">
        <div class="ph-ico">⊙</div>
        <p>Нажмите уровень — колесо покажет разделы.<br>
           Каждый раздел раскрывается глубже.<br>
           Правило · таблица · AI-примеры · упражнения</p>
        <div class="ph-lv-row">
          <span class="ph-lv" style="--lc:var(--ca1)">A1 — Начальный</span>
          <span class="ph-lv" style="--lc:var(--ca2)">A2 — Элементарный</span>
          <span class="ph-lv" style="--lc:var(--cb1)">B1 — Средний</span>
          <span class="ph-lv" style="--lc:var(--cb2)">B2 — Выше среднего</span>
          <span class="ph-lv" style="--lc:var(--cc1)">C1 — Продвинутый</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const Z = {
  PAST:'past', PRESENT:'present', FUTURE:'future', SPECIAL:'special',
  SYNTAX:'syntax', NEB:'nebensatz', C1:'c1color'
};

// 12 корневых сегментов — полное покрытие до C1
const ROOT_SEGS = [
  { id:'prasens',     label:'Präsens',       sub:'Настоящее',      color:'#3ad9a0', zone:Z.PRESENT },
  { id:'futur1',      label:'Futur I+II',    sub:'Будущее',        color:'#3a8fd9', zone:Z.FUTURE  },
  { id:'perfekt',     label:'Perfekt',       sub:'Прошедшее (речь)',color:'#d94f3a', zone:Z.PAST   },
  { id:'prateritum',  label:'Präteritum',    sub:'Нарратив',       color:'#b03020', zone:Z.PAST   },
  { id:'plusquamp',   label:'Plusquamperf.', sub:'Давнопрошедшее', color:'#7a1a10', zone:Z.PAST   },
  { id:'konjunktiv',  label:'Konjunktiv',    sub:'Сослагательное', color:'#c97ae0', zone:Z.SPECIAL},
  { id:'imperativ',   label:'Imperativ',     sub:'Повелительное',  color:'#e08c3a', zone:Z.SPECIAL},
  { id:'satzbau',     label:'Satzbau',       sub:'Синтаксис',      color:'#e07a40', zone:Z.SYNTAX },
  { id:'verblehre',   label:'Verblehre',     sub:'Глаголы',        color:'#e0c46a', zone:Z.PRESENT},
  { id:'nomenlehre',  label:'Nomen+Adj.',    sub:'Сущ. и прилаг.', color:'#c97ae0', zone:Z.SPECIAL},
  { id:'nebensatz',   label:'Nebensätze',    sub:'Придаточные',    color:'#4ae0c0', zone:Z.NEB    },
  { id:'c1strukt',    label:'C1-Strukt.',    sub:'Уровень C1',     color:'#ff6090', zone:Z.C1     },
];

// Дочерние узлы — части речи / типы предложений
const CHILDREN = {
  prasens: [
    { id:'pra_aussage',  label:'Aussagesatz',  sub:'Утвердительное' },
    { id:'pra_frage_j',  label:'Ja/Nein-Frage',sub:'Общий вопрос'  },
    { id:'pra_frage_w',  label:'W-Frage',      sub:'Специальный'   },
    { id:'pra_neg',      label:'Negation',     sub:'Отрицание'     },
    { id:'pra_verb',     label:'Verb',         sub:'Спряжение'     },
    { id:'pra_nomen',    label:'Nomen',        sub:'Падежи'        },
    { id:'pra_adj',      label:'Adjektiv',     sub:'Склонение'     },
    { id:'pra_prap',     label:'Präposition',  sub:'Предлоги'      },
  ],
  futur1: [
    { id:'fut1_aussage', label:'Futur I',      sub:'Утвердительное' },
    { id:'fut1_frage',   label:'Frage',        sub:'Вопрос'        },
    { id:'fut1_neg',     label:'Negation F1',  sub:'Отрицание'     },
    { id:'fut1_werden',  label:'werden',       sub:'Спряжение'     },
    { id:'fut2_aussage', label:'Futur II',     sub:'Утвердительное'},
    { id:'fut2_neg',     label:'Negation F2',  sub:'Отрицание FII' },
  ],
  perfekt: [
    { id:'pf_aussage',   label:'Aussagesatz',  sub:'Утвердительное' },
    { id:'pf_frage',     label:'Frage',        sub:'Вопрос'        },
    { id:'pf_neg',       label:'Negation',     sub:'Отрицание'     },
    { id:'pf_haben',     label:'haben',        sub:'haben-Verben'  },
    { id:'pf_sein',      label:'sein',         sub:'sein-Verben'   },
    { id:'pf_part2',     label:'Partizip II',  sub:'Образование'   },
  ],
  prateritum: [
    { id:'prat_aussage', label:'Aussagesatz',  sub:'Утвердительное' },
    { id:'prat_frage',   label:'Frage',        sub:'Вопрос'        },
    { id:'prat_neg',     label:'Negation',     sub:'Отрицание'     },
    { id:'prat_schwach', label:'Schwache V.',  sub:'Слабые'        },
    { id:'prat_stark',   label:'Starke V.',    sub:'Сильные'       },
    { id:'prat_modal',   label:'Modalverben',  sub:'Модальные'     },
  ],
  plusquamp: [
    { id:'plq_aussage',  label:'Aussagesatz',  sub:'Утвердительное' },
    { id:'plq_neg',      label:'Negation',     sub:'Отрицание'     },
  ],
  konjunktiv: [
    { id:'konj2',        label:'Konj. II',     sub:'Нереальное'    },
    { id:'konj2_wurd',   label:'würde+Inf',    sub:'Описательная'  },
    { id:'konj1',        label:'Konj. I',      sub:'Косв. речь'    },
    { id:'konj_irrealis', label:'Irrealis',    sub:'Условие'       },
  ],
  imperativ: [
    { id:'imp_du',       label:'du-Form',      sub:'Ты'            },
    { id:'imp_ihr',      label:'ihr-Form',     sub:'Вы (мн.)'      },
    { id:'imp_sie',      label:'Sie-Form',     sub:'Вы (вежл.)'    },
    { id:'imp_neg',      label:'Negation',     sub:'Запрет'        },
  ],
  // Level 3 — Aussagesatz Präsens
  pra_aussage: [
    { id:'pra_aus_wort',  label:'Wortstellung', sub:'Порядок слов' },
    { id:'pra_aus_subj',  label:'Subjekt',      sub:'Подлежащее'   },
    { id:'pra_aus_verb',  label:'Verb (Pos.2)', sub:'Глагол'       },
    { id:'pra_aus_obj_a', label:'Akk.-Objekt',  sub:'Вин. падеж'   },
    { id:'pra_aus_obj_d', label:'Dat.-Objekt',  sub:'Дат. падеж'   },
    { id:'pra_aus_adv',   label:'Adverb',       sub:'Обстоятельство'},
  ],
  // Level 3 — Perfekt детали
  pf_haben: [
    { id:'pf_haben_trans',  label:'Transitiv',   sub:'Переходные'   },
    { id:'pf_haben_refl',   label:'Reflexiv',    sub:'Возвратные'   },
    { id:'pf_haben_modal',  label:'Modalverben', sub:'Модальные'    },
  ],
  // Level 3 — Verb детали
  pra_verb: [
    { id:'verb_schwach',  label:'Schwache V.',  sub:'Слабые'       },
    { id:'verb_stark',    label:'Starke V.',    sub:'Сильные'      },
    { id:'verb_modal',    label:'Modalverben',  sub:'Модальные'    },
    { id:'verb_trenn',    label:'Trennbare V.', sub:'Отделяемые'   },
    { id:'verb_refl',     label:'Reflexive V.', sub:'Возвратные'   },
  ],
  // Level 3 — Nomen детали
  pra_nomen: [
    { id:'nom_genus',     label:'Genus',        sub:'Род'          },
    { id:'nom_plural',    label:'Plural',       sub:'Мн. число'    },
    { id:'nom_kasus',     label:'4 Kasus',      sub:'Все падежи'   },
    { id:'nom_gen',       label:'Genitiv',      sub:'Родит. падеж' },
  ],
  // ── NEW ROOT CHILDREN ──────────────────────────────────────────
  satzbau: [
    { id:'sb_v2',         label:'V2-Prinzip',   sub:'Глагол на P2' },
    { id:'sb_klammer',    label:'Satzklammer',  sub:'Рамка'        },
    { id:'sb_mittelfeld', label:'Mittelfeld',   sub:'Серед. поле'  },
    { id:'sb_tekamolo',   label:'TeKaMoLo',     sub:'Порядок обст.'},
    { id:'sb_inversion',  label:'Inversion',    sub:'Инверсия'     },
    { id:'sb_fragesatz',  label:'Fragesätze',   sub:'Вопросы'      },
    { id:'sb_negation',   label:'Negation',     sub:'Отрицание'    },
    { id:'sb_valenz',     label:'Valenz',       sub:'Управление'   },
  ],
  verblehre: [
    { id:'vl_schwach',    label:'Schwache V.',  sub:'Слабые'       },
    { id:'vl_stark',      label:'Starke V.',    sub:'Сильные'      },
    { id:'vl_modal',      label:'Modalverben',  sub:'Модальные'    },
    { id:'vl_trenn',      label:'Trennbare',    sub:'Отделяемые'   },
    { id:'vl_refl',       label:'Reflexive',    sub:'Возвратные'   },
    { id:'vl_untrenn',    label:'Untrennbare',  sub:'Неотделяемые' },
    { id:'vl_passiv',     label:'Passiv',       sub:'Страд. залог' },
    { id:'vl_praepobj',   label:'Präp.Objekte', sub:'Управление'   },
  ],
  nomenlehre: [
    { id:'nl_genus',      label:'Genus',        sub:'Род'          },
    { id:'nl_plural',     label:'Plural',       sub:'Мн. число'    },
    { id:'nl_kasus4',     label:'4 Kasus',      sub:'Падежи'       },
    { id:'nl_adj_dekl',   label:'Adj.Deklination',sub:'Прилаг.'    },
    { id:'nl_adj_komp',   label:'Komparation',  sub:'Степени'      },
    { id:'nl_pronomen',   label:'Pronomen',     sub:'Местоимения'  },
    { id:'nl_praep',      label:'Präpositionen',sub:'Предлоги'     },
    { id:'nl_nominalis',  label:'Nominalisierung',sub:'Номинализ.'  },
  ],
  nebensatz: [
    { id:'ns_dass',       label:'dass-Satz',    sub:'что...'       },
    { id:'ns_weil',       label:'weil / da',    sub:'потому что'   },
    { id:'ns_wenn_als',   label:'wenn / als',   sub:'когда'        },
    { id:'ns_ob',         label:'ob-Satz',      sub:'ли...'        },
    { id:'ns_relativ',    label:'Relativsatz',  sub:'Относит.'     },
    { id:'ns_infinitiv',  label:'Infinitivsatz',sub:'um/ohne/statt zu'},
    { id:'ns_konzessiv',  label:'obwohl/trotzdem',sub:'Уступит.'   },
    { id:'ns_temporal',   label:'Temporalsatz', sub:'Временные'    },
    { id:'ns_konditional',label:'wenn/falls',   sub:'Условные'     },
    { id:'ns_kausal',     label:'Kausalsatz',   sub:'Причинные'    },
    { id:'ns_konsekutiv', label:'sodass',       sub:'Следственные' },
    { id:'ns_final',      label:'damit/um zu',  sub:'Целевые'      },
  ],
  c1strukt: [
    { id:'c1_partizip',   label:'Partizipialsatz',sub:'Прич. оборот'},
    { id:'c1_erw_adj',    label:'Erw.Adj.Attr.',sub:'Расш. опред.' },
    { id:'c1_fvg',        label:'Funktionsverbgef.',sub:'ФГС'      },
    { id:'c1_doppelkonj', label:'Doppelkonjunkt.',sub:'Двойн. союзы'},
    { id:'c1_passiv_adv', label:'Passiv-Ersatz', sub:'Замены пасс.'},
    { id:'c1_konj2',      label:'Konjunktiv II', sub:'Сослагат.'   },
    { id:'c1_konj1',      label:'Konjunktiv I',  sub:'Косв. речь'  },
    { id:'c1_modalsubj',  label:'Subj.Modalität',sub:'Субъ. модаль.'},
    { id:'c1_stil',       label:'Stilmittel',    sub:'Стилистика'  },
  ],
  // Level 3 expansions
  vl_modal: [
    { id:'vm_bedeutung',  label:'Bedeutungen',  sub:'Значения'     },
    { id:'vm_praesens',   label:'Präsens/Prät.',sub:'Спряжение'    },
    { id:'vm_konjunktiv', label:'Konj.II',      sub:'Сослагат.'    },
    { id:'vm_subjektiv',  label:'Subj.Gebrauch',sub:'Субъ. употр.' },
  ],
  vl_passiv: [
    { id:'pas_vorgang',   label:'Vorgangspassiv',sub:'werden-Pass.'},
    { id:'pas_zustand',   label:'Zustandspassiv',sub:'sein-Pass.'  },
    { id:'pas_modal',     label:'Passiv+Modal',  sub:'С модальными'},
    { id:'pas_zeiten',    label:'Alle Zeiten',   sub:'Все времена' },
  ],
  nl_adj_dekl: [
    { id:'adj_schwach',   label:'Schwach',      sub:'После def.Art.'},
    { id:'adj_stark',     label:'Stark',        sub:'Без артикля'  },
    { id:'adj_gemischt',  label:'Gemischt',     sub:'После indef.' },
    { id:'adj_praedik',   label:'Prädikativ',   sub:'Сказуемостн.' },
  ],
  nl_praep: [
    { id:'pr_akk_dat',    label:'Akk+Dat Präp.',sub:'Akk/Dat'      },
    { id:'pr_wechsel',    label:'Wechselpräp.', sub:'2 падежа'     },
    { id:'pr_gen_praep',  label:'Gen.-Präp.',   sub:'Родит. падеж' },
    { id:'pr_temporal',   label:'Temporale P.', sub:'Время'        },
  ],
  ns_relativ: [
    { id:'rel_nom_akk',   label:'Nom./Akk.',    sub:'der/den...'   },
    { id:'rel_dat_gen',   label:'Dat./Gen.',    sub:'dem/dessen...' },
    { id:'rel_praep',     label:'mit Präp.',    sub:'mit dem...'   },
    { id:'rel_wo',        label:'wo/worüber',   sub:'Lokale/Pronom.'},
  ],
  c1_konj2: [
    { id:'k2_formen',     label:'Formen',       sub:'Bildung'      },
    { id:'k2_irrealis',   label:'Irrealis',     sub:'Нереальн. усл.'},
    { id:'k2_hoeflich',   label:'Höflichkeit',  sub:'Вежливость'   },
    { id:'k2_vergangen',  label:'Vergangenheit',sub:'Прошедшее'    },
  ],
};

// ═══════════════════════════════════════════════════════════════════
// CONTENT — правила, примеры, таблицы, упражнения
// ═══════════════════════════════════════════════════════════════════

const CONTENT = {};

// Helpers
const ex = (q, a, h) => ({q, a, h});
const sent = (de, parts, ru) => ({de, parts, ru});
// parts: [{word, role}]  role: S/V/Oa/Od/Adj/Adv/P/N

function partChip(word, role) {
  const cls = {S:'chip-s',V:'chip-v',Oa:'chip-o',Od:'chip-o',Adj:'chip-a',Adv:'chip-ad',P:'chip-p',N:'chip-n',Aux:'chip-v'};
  const label = {S:'Subjekt',V:'Verb',Oa:'Akk.',Od:'Dat.',Adj:'Adj.',Adv:'Adverb',P:'Präp.',N:'Neg.',Aux:'Aux.'};
  return `<span class="part-chip ${cls[role]||''}">${word} <em>${label[role]||role}</em></span>`;
}

// ── PRÄSENS root ───────────────────────────────────────────────────
CONTENT['prasens'] = {
  zone:'present', tag:'Zeitform', title:'Präsens',
  sub:'Настоящее время — всё уровни',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'Subjekt + Verb₂ + (Objekt) + (Adverb/Präp.)',
    text: `Präsens — базовое время немецкого. Глагол всегда стоит на <strong>2-й позиции</strong> (V2-правило).
Используется для: постоянных фактов, привычек, действий сейчас, а также вместо будущего с временны́м маркером.
<br><br>
Спряжение: <em>ich -e / du -st / er -t / wir -en / ihr -t / sie -en</em>.
Сильные глаголы меняют корневую гласную в 2-3 лице: <em>e→ie/i, a→ä</em>.`,
    table: {
      head: ['Person','Endung','lernen','fahren','lesen'],
      rows: [
        ['ich','-e','lerne','fahre','lese'],
        ['du','-st','lernst','fährst','liest'],
        ['er/sie','-t','lernt','fährt','liest'],
        ['wir','-en','lernen','fahren','lesen'],
        ['ihr','-t','lernt','fahrt','lest'],
        ['sie/Sie','-en','lernen','fahren','lesen'],
      ]
    }
  },
  examples: [
    sent('Ich lerne jeden Tag Deutsch.',
      [{w:'Ich',r:'S'},{w:'lerne',r:'V'},{w:'jeden Tag',r:'Adv'},{w:'Deutsch',r:'Oa'}],
      'Я каждый день учу немецкий.'),
    sent('Er fährt morgen nach Berlin.',
      [{w:'Er',r:'S'},{w:'fährt',r:'V'},{w:'morgen',r:'Adv'},{w:'nach',r:'P'},{w:'Berlin',r:'Oa'}],
      'Он едет завтра в Берлин.'),
    sent('Die Studentin liest ein interessantes Buch.',
      [{w:'Die Studentin',r:'S'},{w:'liest',r:'V'},{w:'ein interessantes Buch',r:'Oa'}],
      'Студентка читает интересную книгу.'),
  ],
  exercises: [
    ex('Ich ___ (lernen) jeden Tag.','lerne','ich → -e'),
    ex('Er ___ (fahren) nach München.','fährt','fahren: a→ä, 3.Pers. -t'),
    ex('Du ___ (lesen) ein Buch.','liest','lesen: e→ie'),
    ex('Wir ___ (arbeiten) viel.','arbeiten','wir → основа (arbeiten)'),
    ex('Ihr ___ (spielen) Fußball.','spielt','ihr → -t'),
  ]
};

// ── PRÄSENS → Aussagesatz ─────────────────────────────────────────
CONTENT['pra_aussage'] = {
  zone:'present', tag:'Satztyp', title:'Aussagesatz',
  sub:'Утвердительное предложение — Präsens',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: '[X] + Verb₂ + Subjekt? + ... + [Ende: Inf./Part./Präfix]',
    text: `В немецком предложении глагол <em>всегда на 2-й позиции</em>.
Позиция 1 может быть занята субъектом, обстоятельством, дополнением — но глагол неизменно второй.
<br><br>
Порядок в "рамке": <strong>Subjekt</strong> → <strong>Verb (P2)</strong> → дополнения (Dat. перед Akk.) → обстоятельства (TeKaMoLo) → [конец рамки].
<br><br>
<strong>TeKaMoLo</strong>: Temporal → Kausal → Modal → Lokal.`,
    table: {
      head: ['Pos.1','Pos.2 (Verb)','Mittelfeld','Satzklammer'],
      rows: [
        ['Ich','lerne','jeden Tag','–'],
        ['Jeden Tag','lerne','ich','–'],
        ['Er','hat','heute viel','gearbeitet'],
        ['Morgen','wird','er nach Berlin','fahren'],
      ]
    }
  },
  examples: [
    sent('Ich trinke morgens Kaffee.',
      [{w:'Ich',r:'S'},{w:'trinke',r:'V'},{w:'morgens',r:'Adv'},{w:'Kaffee',r:'Oa'}],
      'Я пью по утрам кофе.'),
    sent('Morgens trinke ich Kaffee.',
      [{w:'Morgens',r:'Adv'},{w:'trinke',r:'V'},{w:'ich',r:'S'},{w:'Kaffee',r:'Oa'}],
      'По утрам я пью кофе. (инверсия)'),
    sent('Sie gibt dem Kind ein Buch.',
      [{w:'Sie',r:'S'},{w:'gibt',r:'V'},{w:'dem Kind',r:'Od'},{w:'ein Buch',r:'Oa'}],
      'Она даёт ребёнку книгу. (Dat. перед Akk.)'),
    sent('Er wohnt seit drei Jahren in Berlin.',
      [{w:'Er',r:'S'},{w:'wohnt',r:'V'},{w:'seit drei Jahren',r:'Adv'},{w:'in Berlin',r:'Adv'}],
      'Он живёт в Берлине три года.'),
  ],
  exercises: [
    ex('[Jeden Tag] ___ ich Deutsch. (lernen)','lerne','инверсия: Verb P2, ich P3'),
    ex('Sie ___ dem Mann das Buch. (geben)','gibt','Dat. dem Mann, Akk. das Buch'),
    ex('[In Berlin] ___ er seit 2020. (wohnen)','wohnt','er → -t'),
    ex('Wir ___ heute ins Kino. (gehen)','gehen','wir → -en'),
    ex('[Gestern] ___ er früh aufgestanden. → Er ___ gestern früh aufgestanden.','ist / ist','Perfekt: Aux. P2, Part.II am Ende'),
  ]
};

// ── PRÄSENS → Wortstellung (Level 3) ─────────────────────────────
CONTENT['pra_aus_wort'] = {
  zone:'present', tag:'Struktur', title:'Wortstellung',
  sub:'Порядок слов в немецком предложении',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'P1 + V₂ + (S) + Dat.Obj. + Akk.Obj. + TeKaMoLo + [Klammer]',
    text: `<strong>V2-правило:</strong> конечный глагол (инфинитив, Part.II) уходит в конец — образуется <em>Satzklammer</em> (скобка).
<br><br>
<strong>Mittelfeld — порядок элементов:</strong><br>
① Dat.-Objekt перед Akk.-Objekt (при существительных)<br>
② Но: если один местоимение — оно идёт первым<br>
③ TeKaMoLo: Zeit → Kausal → Modalität → Lokal<br><br>
<strong>Инверсия:</strong> любой элемент, вынесенный на P1, вызывает инверсию субъекта.`,
    table: {
      head:['Правило','Пример','Перевод'],
      rows:[
        ['Subj. на P1','Ich lerne Deutsch.','Я учу немецкий.'],
        ['Adv. на P1','Heute lerne ich Deutsch.','Сегодня я учу немецкий.'],
        ['Dat. → Akk.','Er gibt dem Freund das Buch.','Он даёт другу книгу.'],
        ['Pron. 1-м','Er gibt es ihm.','Он даёт его ему.'],
        ['TeKaMoLo','Er fährt morgens gern mit dem Bus nach Hause.','Он с удовольствием ездит на автобусе домой.'],
      ]
    }
  },
  examples: [
    sent('Er kauft seiner Mutter heute Blumen.',
      [{w:'Er',r:'S'},{w:'kauft',r:'V'},{w:'seiner Mutter',r:'Od'},{w:'heute',r:'Adv'},{w:'Blumen',r:'Oa'}],
      'Он покупает своей маме сегодня цветы.'),
    sent('Heute kauft er seiner Mutter Blumen.',
      [{w:'Heute',r:'Adv'},{w:'kauft',r:'V'},{w:'er',r:'S'},{w:'seiner Mutter',r:'Od'},{w:'Blumen',r:'Oa'}],
      'Сегодня он покупает своей маме цветы. (инверсия)'),
    sent('Er fährt morgens schnell mit dem Rad zur Arbeit.',
      [{w:'Er',r:'S'},{w:'fährt',r:'V'},{w:'morgens',r:'Adv'},{w:'schnell',r:'Adv'},{w:'mit dem Rad',r:'Adv'},{w:'zur Arbeit',r:'Adv'}],
      'Он быстро ездит на работу на велосипеде по утрам. (T-M-L)'),
  ],
  exercises: [
    ex('___ lerne ich Deutsch. (Heute/Ich heute)','Heute','Adv. на P1 → инверсия'),
    ex('Er gibt ___ das Buch. (dem Freund / den Freund)','dem Freund','гlagen Dat. → dem'),
    ex('Ich fahre ___ zur Arbeit. (schnell, morgens) → правильный порядок','morgens schnell','T(morgens) → M(schnell)'),
  ]
};

// ── PRÄSENS → Ja/Nein-Frage ───────────────────────────────────────
CONTENT['pra_frage_j'] = {
  zone:'present', tag:'Satztyp', title:'Ja/Nein-Frage',
  sub:'Общий вопрос — да/нет',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'Verb₁ + Subjekt + ... + ?',
    text: `Общий вопрос: глагол выносится на <strong>1-ю позицию</strong>.
Субъект идёт следом (P2). Структура остальных элементов сохраняется.
<br><br>
Ответы: <em>Ja, ... / Nein, ... / Doch!</em> (doch = "нет, всё-таки да" — опровержение отрицания).`,
    table: {
      head:['Тип','Структура','Пример'],
      rows:[
        ['Positiv','V + S + ...?','Lernst du Deutsch?'],
        ['Mit Objekt','V + S + Obj. + ...?','Kaufst du das Buch?'],
        ['Verneinung','V + S + nicht + ...?','Lernst du nicht?'],
        ['Antwort +','Ja, ich lerne.','–'],
        ['Antwort –','Nein, ich lerne nicht.','–'],
        ['Doch!','Doch, ich lerne!','(опровержение "nicht")'],
      ]
    }
  },
  examples: [
    sent('Lernst du Deutsch?',
      [{w:'Lernst',r:'V'},{w:'du',r:'S'},{w:'Deutsch?',r:'Oa'}],
      'Ты учишь немецкий?'),
    sent('Hat er Zeit?',
      [{w:'Hat',r:'V'},{w:'er',r:'S'},{w:'Zeit?',r:'Oa'}],
      'У него есть время?'),
    sent('Fährst du morgen nach Berlin?',
      [{w:'Fährst',r:'V'},{w:'du',r:'S'},{w:'morgen',r:'Adv'},{w:'nach Berlin?',r:'Adv'}],
      'Ты едешь завтра в Берлин?'),
  ],
  exercises: [
    ex('___ du Deutsch? (Lernst/Lerne/Lernt)','Lernst','V1, du-форма'),
    ex('___ er heute arbeiten? (Muss/Musst/Müssen)','Muss','er → muss'),
    ex('___ ihr das Buch gelesen? (Habt/Haben/Hat)','Habt','ihr → habt'),
    ex('___ sie (она) schon gegangen? (Ist/Hat/Sind)','Ist','gehen → sein-Verb'),
  ]
};

// ── PRÄSENS → W-Frage ─────────────────────────────────────────────
CONTENT['pra_frage_w'] = {
  zone:'present', tag:'Satztyp', title:'W-Frage',
  sub:'Специальный вопрос',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'W-Wort + Verb₂ + Subjekt + ... + ?',
    text: `W-Fragewörter занимают P1. Глагол → P2. Субъект → P3.
<br><br>
W-Wörter: <em>wer (кто), was (что), wen (кого), wem (кому), wessen (чей), wo (где), wohin (куда), woher (откуда), wann (когда), wie (как), wie viel (сколько), warum (почему), wozu (зачем), welch- (который).</em>`,
    table: {
      head:['W-Wort','Падеж','Пример'],
      rows:[
        ['wer','Nom.','Wer kommt heute?'],
        ['wen','Akk.','Wen siehst du?'],
        ['wem','Dat.','Wem gibst du das Buch?'],
        ['wessen','Gen.','Wessen Buch ist das?'],
        ['was','Nom./Akk.','Was machst du?'],
        ['wo/wohin','–','Wo wohnst du? / Wohin fährst du?'],
        ['wann','–','Wann kommst du?'],
        ['warum','–','Warum lernst du Deutsch?'],
      ]
    }
  },
  examples: [
    sent('Warum lernst du Deutsch?',
      [{w:'Warum',r:'Adv'},{w:'lernst',r:'V'},{w:'du',r:'S'},{w:'Deutsch?',r:'Oa'}],
      'Почему ты учишь немецкий?'),
    sent('Wem gibst du das Buch?',
      [{w:'Wem',r:'Od'},{w:'gibst',r:'V'},{w:'du',r:'S'},{w:'das Buch?',r:'Oa'}],
      'Кому ты даёшь книгу?'),
    sent('Wohin fährst du im Sommer?',
      [{w:'Wohin',r:'Adv'},{w:'fährst',r:'V'},{w:'du',r:'S'},{w:'im Sommer?',r:'Adv'}],
      'Куда ты едешь летом?'),
  ],
  exercises: [
    ex('___ machst du? (Was/Wer/Wen)','Was','что = Was (Akk.)'),
    ex('___ wohnst du? (Wo/Wohin/Wann)','Wo','где = Wo'),
    ex('___ gibst du das Buch? (Wem/Wen/Wer)','Wem','кому = Wem (Dat.)'),
    ex('___ kommt heute? (Wer/Wen/Wem)','Wer','кто (Nom.) = Wer'),
    ex('___ lernst du Deutsch? (Warum/Woher/Wohin)','Warum','почему = Warum'),
  ]
};

// ── PRÄSENS → Negation ────────────────────────────────────────────
CONTENT['pra_neg'] = {
  zone:'present', tag:'Satztyp', title:'Negation',
  sub:'Отрицание — nicht и kein',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'nicht (Verb/Adj/Adv) | kein- (Nomen ohne Artikel)',
    text: `<strong>nicht</strong> — отрицает глагол, прилагательное, наречие, предложный оборот.
Стоит: перед отрицаемым прилагательным/наречием; <em>в конце</em> перед Satzklammer; перед предложной группой.
<br><br>
<strong>kein-</strong> = nicht + ein — отрицает существительные с неопределённым или нулевым артиклем.
Склоняется как ein-: kein / keine / kein / keinen / keinem / keiner...
<br><br>
Wichtig: отрицательный вопрос → <strong>Doch!</strong> (не Ja/Nein).`,
    table: {
      head:['Тип отрицания','Правило','Пример'],
      rows:[
        ['Глагол','nicht в конце','Ich lerne nicht.'],
        ['Прилагательное','nicht vor Adj.','Er ist nicht müde.'],
        ['Naречие','nicht vor Adv.','Ich komme nicht heute.'],
        ['Prep.-Phrase','nicht vor Präp.','Er wohnt nicht in Berlin.'],
        ['Kein (Nom.m)','kein','Das ist kein Problem.'],
        ['Kein (Nom.f)','keine','Ich habe keine Zeit.'],
        ['Kein (Akk.m)','keinen','Ich sehe keinen Mann.'],
      ]
    }
  },
  examples: [
    sent('Ich arbeite heute nicht.',
      [{w:'Ich',r:'S'},{w:'arbeite',r:'V'},{w:'heute',r:'Adv'},{w:'nicht.',r:'N'}],
      'Я сегодня не работаю.'),
    sent('Er ist nicht müde.',
      [{w:'Er',r:'S'},{w:'ist',r:'V'},{w:'nicht',r:'N'},{w:'müde.',r:'Adj'}],
      'Он не усталый.'),
    sent('Ich habe keine Zeit.',
      [{w:'Ich',r:'S'},{w:'habe',r:'V'},{w:'keine',r:'N'},{w:'Zeit.',r:'Oa'}],
      'У меня нет времени.'),
    sent('Er wohnt nicht in Berlin.',
      [{w:'Er',r:'S'},{w:'wohnt',r:'V'},{w:'nicht',r:'N'},{w:'in Berlin.',r:'Adv'}],
      'Он живёт не в Берлине.'),
  ],
  exercises: [
    ex('Ich lerne ___. (nicht/kein)','nicht','глагол → nicht'),
    ex('Ich habe ___ Auto. (kein/nicht)','kein','Nomen (Auto, n) → kein'),
    ex('Er ist ___ müde. (nicht/kein)','nicht','Adjektiv → nicht'),
    ex('Ich sehe ___ Mann. (keinen/kein/nicht)','keinen','Mann (m, Akk.) → keinen'),
    ex('Sie wohnt ___ in München. (kein/nicht)','nicht','Präp.-Gruppe → nicht'),
  ]
};

// ── PRÄSENS → Verb Konjugation ────────────────────────────────────
CONTENT['pra_verb'] = {
  zone:'present', tag:'Wortart', title:'Verb — Konjugation',
  sub:'Спряжение глаголов в Präsens',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'Stamm + Endung | Starke Verben: Ablaut e→ie/i, a→ä, au→äu',
    text: `<strong>Регулярные (schwache):</strong> основа + стандартные окончания.
Особенности: основа на <em>-d/-t/-m/-n</em> добавляет -e- перед окончанием (<em>arbeit-e-t, öffn-e-st</em>).
<br><br>
<strong>Сильные (starke):</strong> изменение корневой гласной во 2-м и 3-м лице единственного числа.
<br><br>
<strong>Unregelmäßige:</strong> sein, haben, werden — полностью нестандартное спряжение.`,
    table: {
      head:['Person','schwach (lernen)','stark e→ie (lesen)','stark a→ä (fahren)','sein','haben','werden'],
      rows:[
        ['ich','lerne','lese','fahre','bin','habe','werde'],
        ['du','lernst','liest','fährst','bist','hast','wirst'],
        ['er/sie/es','lernt','liest','fährt','ist','hat','wird'],
        ['wir','lernen','lesen','fahren','sind','haben','werden'],
        ['ihr','lernt','lest','fahrt','seid','habt','werdet'],
        ['sie/Sie','lernen','lesen','fahren','sind','haben','werden'],
      ]
    }
  },
  examples: [
    sent('Du liest sehr schnell.',
      [{w:'Du',r:'S'},{w:'liest',r:'V'},{w:'sehr schnell.',r:'Adv'}],
      'Ты читаешь очень быстро. (e→ie)'),
    sent('Er fährt jeden Tag mit dem Bus.',
      [{w:'Er',r:'S'},{w:'fährt',r:'V'},{w:'jeden Tag',r:'Adv'},{w:'mit dem Bus.',r:'Adv'}],
      'Он ездит на автобусе каждый день. (a→ä)'),
    sent('Sie ist sehr müde.',
      [{w:'Sie',r:'S'},{w:'ist',r:'V'},{w:'sehr müde.',r:'Adj'}],
      'Она очень усталая. (sein)'),
  ],
  exercises: [
    ex('du ___ (lesen)','liest','e→ie во 2/3 л.'),
    ex('er ___ (schlafen)','schläft','a→ä в 3 л.'),
    ex('du ___ (sprechen)','sprichst','e→i во 2 л.'),
    ex('du ___ (haben)','hast','unregelmäßig'),
    ex('ihr ___ (sein)','seid','unregelmäßig'),
    ex('ich ___ (werden)','werde','werde/wirst/wird...'),
  ]
};

// ── PRÄSENS → Nomen / Kasus ───────────────────────────────────────
CONTENT['pra_nomen'] = {
  zone:'present', tag:'Wortart', title:'Nomen — Kasus',
  sub:'Существительные и падежи',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'Nom.(wer?) · Gen.(wessen?) · Dat.(wem?) · Akk.(wen/was?)',
    text: `Немецкий имеет <strong>4 падежа</strong>. Артикль и прилагательное изменяются.
<br><br>
<strong>Артикли по падежам:</strong>`,
    table: {
      head:['Kasus','m','f','n','Pl.'],
      rows:[
        ['Nom.','der/ein','die/eine','das/ein','die/–'],
        ['Gen.','des/eines','der/einer','des/eines','der/–'],
        ['Dat.','dem/einem','der/einer','dem/einem','den/–'],
        ['Akk.','den/einen','die/eine','das/ein','die/–'],
      ]
    }
  },
  examples: [
    sent('Der Mann kauft ein Buch.',
      [{w:'Der Mann',r:'S'},{w:'kauft',r:'V'},{w:'ein Buch.',r:'Oa'}],
      'Мужчина покупает книгу. (Nom. + Akk.)'),
    sent('Er gibt der Frau das Buch.',
      [{w:'Er',r:'S'},{w:'gibt',r:'V'},{w:'der Frau',r:'Od'},{w:'das Buch.',r:'Oa'}],
      'Он даёт женщине книгу. (Dat. + Akk.)'),
    sent('Das Buch des Mannes ist interessant.',
      [{w:'Das Buch',r:'S'},{w:'des Mannes',r:'Adj'},{w:'ist',r:'V'},{w:'interessant.',r:'Adj'}],
      'Книга мужчины интересная. (Genitiv)'),
  ],
  exercises: [
    ex('___ Mann (Nom.) kauft ___ Buch (Akk.,n).','Der / ein','Nom.m=der, Akk.n=ein'),
    ex('Er gibt ___ Frau (Dat.) das Buch.','der','Dat.f = der'),
    ex('Ich sehe ___ Hund (Akk.,m).','den','Akk.m = den'),
    ex('Das ist ___ Problem (Akk.,n).','kein','kein (Negation, n Akk.)'),
    ex('Das Auto ___ Mannes (Gen.) ist rot.','des','Gen.m = des'),
  ]
};

// ── PRÄSENS → Adjektiv Deklination ────────────────────────────────
CONTENT['pra_adj'] = {
  zone:'present', tag:'Wortart', title:'Adjektiv — Deklination',
  sub:'Склонение прилагательных',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'nach best.Art: -e/-en | nach unbest.Art: gemischt | ohne Art: stark',
    text: `Три типа склонения:
<br><strong>1. Starke Deklination</strong> (без артикля) — окончание несёт падежный сигнал.
<br><strong>2. Schwache Deklination</strong> (после определённого артикля) — только -e и -en.
<br><strong>3. Gemischte Deklination</strong> (после неопределённого артикля / kein / Possessivartikeln).`,
    table: {
      head:['Kasus','m (schwach)','f (schwach)','n (schwach)','Pl. (schwach)'],
      rows:[
        ['Nom.','der alt-e Mann','die alt-e Frau','das alt-e Kind','die alt-en Leute'],
        ['Gen.','des alt-en Mannes','der alt-en Frau','des alt-en Kindes','der alt-en Leute'],
        ['Dat.','dem alt-en Mann','der alt-en Frau','dem alt-en Kind','den alt-en Leuten'],
        ['Akk.','den alt-en Mann','die alt-e Frau','das alt-e Kind','die alt-en Leute'],
      ]
    }
  },
  examples: [
    sent('Der alte Mann liest ein interessantes Buch.',
      [{w:'Der alte Mann',r:'S'},{w:'liest',r:'V'},{w:'ein interessantes Buch.',r:'Oa'}],
      'Старый мужчина читает интересную книгу.'),
    sent('Ich sehe eine schöne Frau.',
      [{w:'Ich',r:'S'},{w:'sehe',r:'V'},{w:'eine schöne Frau.',r:'Oa'}],
      'Я вижу красивую женщину. (Akk., gemischt)'),
    sent('Er wohnt in einem kleinen Haus.',
      [{w:'Er',r:'S'},{w:'wohnt',r:'V'},{w:'in einem kleinen Haus.',r:'Adv'}],
      'Он живёт в маленьком доме. (Dat.n, gemischt)'),
  ],
  exercises: [
    ex('der alt___ Mann (Nom., schwach)','e','-e после best.Art Nom.m'),
    ex('einen klein___ Hund (Akk.m, gemischt)','en','-en nach unbest.Art Akk.m'),
    ex('mit dem schön___ Auto (Dat.n, schwach)','en','-en Dat., schwach'),
    ex('ein alt___ Kind (Nom.n, gemischt)','es','-es nach unbest.Art Nom.n'),
    ex('ohne Art.: gut___ Wein (Nom.m, stark)','er','-er stark Nom.m'),
  ]
};

// ── PRÄSENS → Präpositionen ───────────────────────────────────────
CONTENT['pra_prap'] = {
  zone:'present', tag:'Wortart', title:'Präpositionen',
  sub:'Предлоги и управляемые падежи',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'Akk.: durch, für, gegen, ohne, um, bis, entlang\nDat.: aus, bei, mit, nach, seit, von, zu, gegenüber\nAkk./Dat.: an, auf, hinter, in, neben, über, unter, vor, zwischen',
    text: `<strong>Двойные предлоги (Wechselpräpositionen)</strong>: an, auf, hinter, in, neben, über, unter, vor, zwischen.
<br>→ <strong>Dativ</strong> = место/состояние (<em>wo?</em>): Ich sitze <em>auf dem</em> Stuhl.
<br>→ <strong>Akkusativ</strong> = движение/направление (<em>wohin?</em>): Ich setze mich <em>auf den</em> Stuhl.`,
    table: {
      head:['Präp.','Kasus','Beispiel'],
      rows:[
        ['mit','Dat.','mit dem Auto fahren'],
        ['in + Dat.','Wo?','im (=in dem) Zimmer sein'],
        ['in + Akk.','Wohin?','ins (=in das) Zimmer gehen'],
        ['für','Akk.','Das ist für dich.'],
        ['aus','Dat.','Ich komme aus der Schweiz.'],
        ['auf + Dat.','Wo?','auf dem Tisch liegen'],
        ['auf + Akk.','Wohin?','auf den Tisch legen'],
        ['seit','Dat.','seit drei Jahren'],
        ['wegen','Gen.','wegen des Wetters'],
      ]
    }
  },
  examples: [
    sent('Er fährt mit dem Bus zur Schule.',
      [{w:'Er',r:'S'},{w:'fährt',r:'V'},{w:'mit dem Bus',r:'Adv'},{w:'zur Schule.',r:'Adv'}],
      'Он едет на автобусе в школу.'),
    sent('Das Buch liegt auf dem Tisch.',
      [{w:'Das Buch',r:'S'},{w:'liegt',r:'V'},{w:'auf dem Tisch.',r:'Adv'}],
      'Книга лежит на столе. (Dat. = wo?)'),
    sent('Sie legt das Buch auf den Tisch.',
      [{w:'Sie',r:'S'},{w:'legt',r:'V'},{w:'das Buch',r:'Oa'},{w:'auf den Tisch.',r:'Adv'}],
      'Она кладёт книгу на стол. (Akk. = wohin?)'),
  ],
  exercises: [
    ex('Das Buch liegt auf ___ Tisch. (dem/den)','dem','liegen = Wo? → Dat.'),
    ex('Er legt das Buch auf ___ Tisch. (dem/den)','den','legen = Wohin? → Akk.'),
    ex('Ich fahre ___ (mit/für/aus) dem Auto.','mit','mit + Dat.'),
    ex('Er kommt ___ (aus/seit/für) Deutschland.','aus','Herkunft: aus + Dat.'),
    ex('Ich lerne Deutsch ___ (seit/für/bis) drei Jahren.','seit','seit + Dat. (период)'),
  ]
};

// ── FUTUR I ───────────────────────────────────────────────────────
CONTENT['futur1'] = {
  zone:'future', tag:'Zeitform', title:'Futur I',
  sub:'Будущее время I',
  tabs: ['Правило','Примеры','Упражнения'],
  rule: {
    formula: 'werden (P2) + ... + Infinitiv (Ende)',
    text: `Futur I = werden + Infinitiv. "werden" конъюгируется, инфинитив — в конце (Satzklammer).
<br><br>Часто в разговоре вместо Futur I используют <strong>Präsens + Zeitangabe</strong> (morgen, nächste Woche).
<br><br>Futur I также выражает <strong>предположение</strong>: <em>Er wird müde sein.</em>`,
    table: {
      head:['Person','werden'],
      rows:[
        ['ich','werde'],['du','wirst'],['er/sie/es','wird'],
        ['wir','werden'],['ihr','werdet'],['sie/Sie','werden'],
      ]
    }
  },
  examples: [
    sent('Ich werde morgen Deutsch lernen.',
      [{w:'Ich',r:'S'},{w:'werde',r:'Aux'},{w:'morgen',r:'Adv'},{w:'Deutsch',r:'Oa'},{w:'lernen.',r:'V'}],
      'Я буду завтра учить немецкий.'),
    sent('Er wird wahrscheinlich müde sein.',
      [{w:'Er',r:'S'},{w:'wird',r:'Aux'},{w:'wahrscheinlich',r:'Adv'},{w:'müde',r:'Adj'},{w:'sein.',r:'V'}],
      'Он, вероятно, устал. (предположение)'),
  ],
  exercises: [
    ex('Ich ___ morgen lernen. (werden konj.)','werde','ich → werde'),
    ex('Er ___ nach Berlin fahren.','wird','er → wird'),
    ex('Wir ___ das schaffen.','werden','wir → werden'),
    ex('___ du morgen kommen? (Futur I Frage)','Wirst','Frage: Wirst du ...?'),
  ]
};

// ── FUTUR I → Aussage, Frage, Neg ─────────────────────────────────
CONTENT['fut1_aussage'] = {
  zone:'future', tag:'Satztyp', title:'Futur I — Aussagesatz',
  sub:'Утвердительные предложения',
  tabs: ['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + werden(P2) + ... + Infinitiv',
    text:'werden на P2, инфинитив в конце. При инверсии werden P1, субъект P3.',
    table:{head:['P1','P2','Mitte','Ende'],rows:[
      ['Ich','werde','morgen','lernen.'],
      ['Morgen','werde','ich','lernen.'],
      ['Er','wird','viel Geld','verdienen.'],
    ]}
  },
  examples:[
    sent('Ich werde nächstes Jahr nach Deutschland fahren.',
      [{w:'Ich',r:'S'},{w:'werde',r:'Aux'},{w:'nächstes Jahr',r:'Adv'},{w:'nach Deutschland',r:'Adv'},{w:'fahren.',r:'V'}],
      'Я поеду в Германию в следующем году.'),
  ],
  exercises:[
    ex('Morgen ___ ich Deutsch lernen. (werden)','werde','инверсия, ich → werde'),
    ex('Er ___ das Examen bestehen.','wird','er → wird'),
  ]
};

CONTENT['fut1_frage'] = {
  zone:'future', tag:'Satztyp', title:'Futur I — Frage',
  sub:'Вопросы в будущем',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Wirst/Wird... + S + ... + Inf.? | W-Wort + wird + S + ... + Inf.?',
    text:'werden на P1 (Ja/Nein-Frage) или W-Wort на P1, werden на P2.',
    table:{head:['Тип','Пример'],rows:[
      ['Ja/Nein','Wirst du morgen kommen?'],
      ['W-Frage','Wann wirst du kommen?'],
      ['W-Frage','Was wirst du machen?'],
    ]}
  },
  examples:[
    sent('Wirst du morgen kommen?',
      [{w:'Wirst',r:'Aux'},{w:'du',r:'S'},{w:'morgen',r:'Adv'},{w:'kommen?',r:'V'}],
      'Ты придёшь завтра?'),
    sent('Was wirst du nächstes Jahr machen?',
      [{w:'Was',r:'Oa'},{w:'wirst',r:'Aux'},{w:'du',r:'S'},{w:'nächstes Jahr',r:'Adv'},{w:'machen?',r:'V'}],
      'Что ты будешь делать в следующем году?'),
  ],
  exercises:[
    ex('___ du morgen kommen? (Wirst/Wird/Werden)','Wirst','du → wirst'),
    ex('Wann ___ er das machen?','wird','er → wird'),
  ]
};

CONTENT['fut1_neg'] = {
  zone:'future', tag:'Satztyp', title:'Futur I — Negation',
  sub:'Отрицание в будущем',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + werden + ... + nicht + Infinitiv',
    text:'nicht стоит перед инфинитивом в конце. kein- перед отрицаемым существительным.',
    table:{head:['Правило','Пример'],rows:[
      ['nicht vor Inf.','Ich werde morgen nicht kommen.'],
      ['kein im Mittelfeld','Er wird kein Buch kaufen.'],
    ]}
  },
  examples:[
    sent('Ich werde morgen nicht arbeiten.',
      [{w:'Ich',r:'S'},{w:'werde',r:'Aux'},{w:'morgen',r:'Adv'},{w:'nicht',r:'N'},{w:'arbeiten.',r:'V'}],
      'Я завтра не буду работать.'),
  ],
  exercises:[
    ex('Ich werde morgen ___ kommen. (nicht/kein)','nicht','глагол → nicht'),
    ex('Er wird ___ Auto kaufen. (kein/nicht)','kein','Auto (n) → kein'),
  ]
};

// ── FUTUR II ──────────────────────────────────────────────────────
CONTENT['futur2'] = {
  zone:'future', tag:'Zeitform', title:'Futur II',
  sub:'Будущее завершённое / предположение о прошлом',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'werden + Partizip II + haben/sein',
    text:`Futur II выражает: 1) действие, завершённое к моменту в будущем; 2) предположение о прошлом.
<br><em>haben/sein</em> — в зависимости от глагола (те же правила, что в Perfekt).`,
    table:{head:['Person','Beispiel'],rows:[
      ['ich','Ich werde das Buch gelesen haben.'],
      ['er','Er wird angekommen sein.'],
      ['wir','Wir werden alles erledigt haben.'],
    ]}
  },
  examples:[
    sent('Er wird das Buch bis morgen gelesen haben.',
      [{w:'Er',r:'S'},{w:'wird',r:'Aux'},{w:'das Buch',r:'Oa'},{w:'bis morgen',r:'Adv'},{w:'gelesen',r:'V'},{w:'haben.',r:'Aux'}],
      'Он к завтрашнему дню прочитает книгу.'),
    sent('Sie wird schon gegangen sein.',
      [{w:'Sie',r:'S'},{w:'wird',r:'Aux'},{w:'schon',r:'Adv'},{w:'gegangen',r:'V'},{w:'sein.',r:'Aux'}],
      'Она, должно быть, уже ушла.'),
  ],
  exercises:[
    ex('Ich werde das erledigt ___.','haben','erledigen → haben-Verb'),
    ex('Er wird angekommen ___.','sein','ankommen → sein-Verb'),
  ]
};

// ── PERFEKT ───────────────────────────────────────────────────────
CONTENT['perfekt'] = {
  zone:'past', tag:'Zeitform', title:'Perfekt',
  sub:'Прошедшее время (разговор)',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'haben/sein (P2) + ... + Partizip II (Ende)',
    text:`Perfekt — основное прошедшее в <em>устной речи</em>.
<br><br>
<strong>haben</strong>: большинство глаголов (транзитивные, рефлексивные).
<strong>sein</strong>: движение (gehen, fahren, fliegen...), смена состояния (aufwachen, sterben, werden), bleiben, sein.
<br><br>
<strong>Partizip II:</strong> schwach → ge+Stamm+t; stark → ge+Ablaut+en; trennbar → Stamm+ge+...; nicht-trennbar → без ge-.`,
    table:{head:['Person','haben','sein'],rows:[
      ['ich','habe','bin'],['du','hast','bist'],['er/sie','hat','ist'],
      ['wir','haben','sind'],['ihr','habt','seid'],['sie/Sie','haben','sind'],
    ]}
  },
  examples:[
    sent('Ich habe heute viel gelernt.',
      [{w:'Ich',r:'S'},{w:'habe',r:'Aux'},{w:'heute',r:'Adv'},{w:'viel',r:'Adv'},{w:'gelernt.',r:'V'}],
      'Я сегодня много учился.'),
    sent('Er ist nach Berlin gefahren.',
      [{w:'Er',r:'S'},{w:'ist',r:'Aux'},{w:'nach Berlin',r:'Adv'},{w:'gefahren.',r:'V'}],
      'Он поехал в Берлин.'),
    sent('Sie hat ein Buch geschrieben.',
      [{w:'Sie',r:'S'},{w:'hat',r:'Aux'},{w:'ein Buch',r:'Oa'},{w:'geschrieben.',r:'V'}],
      'Она написала книгу.'),
  ],
  exercises:[
    ex('Ich ___ heute viel gelernt. (habe/bin)','habe','lernen → haben'),
    ex('Er ___ nach Berlin gefahren. (hat/ist)','ist','fahren → sein'),
    ex('Sie ___ ein Buch geschrieben. (hat/ist)','hat','schreiben → haben'),
    ex('Wir ___ aufgewacht. (haben/sind)','sind','aufwachen → sein'),
    ex('Das Kind ___ eingeschlafen. (hat/ist)','ist','einschlafen → sein'),
  ]
};

CONTENT['pf_aussage'] = {
  zone:'past', tag:'Satztyp', title:'Perfekt — Aussagesatz',
  sub:'Утвердительное в Perfekt',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + Aux.(P2) + ... + Part.II',
    text:'haben/sein на P2, Partizip II — строго в конце. При инверсии: вынесенный элемент P1, aux. P2.',
    table:{head:['P1','P2','Mitte','Ende'],rows:[
      ['Ich','habe','heute','gelernt.'],
      ['Heute','habe','ich','gelernt.'],
      ['Er','ist','nach Berlin','gefahren.'],
    ]}
  },
  examples:[
    sent('Gestern hat er viel gearbeitet.',
      [{w:'Gestern',r:'Adv'},{w:'hat',r:'Aux'},{w:'er',r:'S'},{w:'viel',r:'Adv'},{w:'gearbeitet.',r:'V'}],
      'Вчера он много работал. (инверсия)'),
  ],
  exercises:[
    ex('Gestern ___ ich Deutsch gelernt. (habe/bin)','habe','lernen → haben'),
    ex('Sie ___ letzte Woche nach Paris geflogen.','ist','fliegen → sein'),
  ]
};

CONTENT['pf_frage'] = {
  zone:'past', tag:'Satztyp', title:'Perfekt — Frage',
  sub:'Вопросы в Perfekt',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Hast/Bist + S + ... + Part.II? | W + hast/bist + S + ... + Part.II?',
    text:'Вспомогательный глагол на P1 (Ja/Nein) или P2 (W-Frage).',
    table:{head:['Тип','Пример'],rows:[
      ['Ja/Nein','Hast du das Buch gelesen?'],
      ['Ja/Nein (sein)','Bist du nach Berlin gefahren?'],
      ['W-Frage','Was hast du gemacht?'],
      ['W-Frage','Wohin bist du gefahren?'],
    ]}
  },
  examples:[
    sent('Hast du das Buch gelesen?',
      [{w:'Hast',r:'Aux'},{w:'du',r:'S'},{w:'das Buch',r:'Oa'},{w:'gelesen?',r:'V'}],
      'Ты прочитал книгу?'),
  ],
  exercises:[
    ex('___ du das gemacht? (Hast/Bist/Habe)','Hast','du → hast'),
    ex('___ sie nach Paris geflogen? (Hat/Ist/Sind)','Ist','fliegen → sein, sie (она) → ist'),
    ex('Was ___ du gestern gemacht?','hast','W-Frage: Was + hast + du'),
  ]
};

CONTENT['pf_neg'] = {
  zone:'past', tag:'Satztyp', title:'Perfekt — Negation',
  sub:'Отрицание в Perfekt',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Aux. + ... + nicht + Part.II | kein im Mittelfeld',
    text:'nicht стоит непосредственно перед Partizip II. kein- — перед существительным.',
    table:{head:['Правило','Пример'],rows:[
      ['nicht vor Part.II','Ich habe das nicht gemacht.'],
      ['kein Obj.','Er hat kein Buch gekauft.'],
    ]}
  },
  examples:[
    sent('Ich habe das Buch nicht gelesen.',
      [{w:'Ich',r:'S'},{w:'habe',r:'Aux'},{w:'das Buch',r:'Oa'},{w:'nicht',r:'N'},{w:'gelesen.',r:'V'}],
      'Я не читал эту книгу.'),
  ],
  exercises:[
    ex('Ich habe das ___ gemacht. (nicht/kein)','nicht','глагол → nicht'),
    ex('Er hat ___ Buch gekauft. (kein/nicht)','kein','Buch (n) → kein'),
  ]
};

CONTENT['pf_haben'] = {
  zone:'past', tag:'Struktur', title:'haben-Verben',
  sub:'Какие глаголы берут haben',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'haben + Part.II',
    text:`С <strong>haben</strong>: транзитивные (с Akk.); рефлексивные (sich freuen...); модальные; большинство остальных.
<br><br>Список частых: kaufen, machen, essen, trinken, lesen, schreiben, sehen, hören, schlafen, arbeiten, studieren, sprechen, verstehen, helfen, nehmen, geben, finden.`,
    table:{head:['Infinitiv','Partizip II','Beispiel'],rows:[
      ['kaufen','gekauft','Ich habe ein Buch gekauft.'],
      ['essen','gegessen','Er hat Pizza gegessen.'],
      ['schreiben','geschrieben','Sie hat einen Brief geschrieben.'],
      ['lesen','gelesen','Wir haben das Buch gelesen.'],
      ['sehen','gesehen','Ich habe den Film gesehen.'],
      ['nehmen','genommen','Er hat das Geld genommen.'],
    ]}
  },
  examples:[
    sent('Ich habe gestern einen Film gesehen.',
      [{w:'Ich',r:'S'},{w:'habe',r:'Aux'},{w:'gestern',r:'Adv'},{w:'einen Film',r:'Oa'},{w:'gesehen.',r:'V'}],
      'Я вчера посмотрел фильм.'),
  ],
  exercises:[
    ex('Ich ___ das Buch gelesen. (habe/bin)','habe','lesen → haben'),
    ex('Er ___ viel gearbeitet.','hat','arbeiten → haben'),
    ex('Part.II von kaufen?','gekauft','ge+kauf+t'),
    ex('Part.II von nehmen?','genommen','ge+nomm+en (stark)'),
  ]
};

CONTENT['pf_sein'] = {
  zone:'past', tag:'Struktur', title:'sein-Verben',
  sub:'Какие глаголы берут sein',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'sein + Part.II',
    text:`С <strong>sein</strong>: 1) <em>Движение с целью/направлением</em>: gehen, fahren, fliegen, laufen, schwimmen, reisen, kommen, steigen...
<br>2) <em>Смена состояния</em>: aufwachen, einschlafen, aufstehen, sterben, werden, wachsen, passieren...
<br>3) <em>bleiben, sein</em> (быть, оставаться).`,
    table:{head:['Infinitiv','Partizip II','Aux.'],rows:[
      ['gehen','gegangen','sein'],
      ['fahren','gefahren','sein'],
      ['fliegen','geflogen','sein'],
      ['kommen','gekommen','sein'],
      ['aufwachen','aufgewacht','sein'],
      ['bleiben','geblieben','sein'],
      ['sein','gewesen','sein'],
      ['werden','geworden','sein'],
    ]}
  },
  examples:[
    sent('Er ist gestern nach Hause gegangen.',
      [{w:'Er',r:'S'},{w:'ist',r:'Aux'},{w:'gestern',r:'Adv'},{w:'nach Hause',r:'Adv'},{w:'gegangen.',r:'V'}],
      'Он вчера пошёл домой.'),
    sent('Sie ist früh aufgewacht.',
      [{w:'Sie',r:'S'},{w:'ist',r:'Aux'},{w:'früh',r:'Adv'},{w:'aufgewacht.',r:'V'}],
      'Она рано проснулась.'),
  ],
  exercises:[
    ex('Er ___ nach Berlin geflogen.','ist','fliegen → sein'),
    ex('Sie ___ um 7 Uhr aufgestanden.','ist','aufstehen → sein'),
    ex('Wir ___ zwei Stunden geblieben.','sind','bleiben → sein'),
    ex('Das ___ gestern passiert.','ist','passieren → sein'),
  ]
};

CONTENT['pf_part2'] = {
  zone:'past', tag:'Struktur', title:'Partizip II — Bildung',
  sub:'Образование Partizip II',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'schwach: ge+Stamm+t | stark: ge+Ablaut+en | trennbar: P+ge+Stamm | nicht-trennbar: Stamm+t/en',
    text:`<strong>Schwache Verben</strong>: ge- + Stamm + -t (lernen→gelernt).
<br><strong>Starke Verben</strong>: ge- + veränderte Basis + -en (schreiben→geschrieben).
<br><strong>Trennbare</strong>: ge- вставляется между приставкой и основой (aufmachen→aufgemacht).
<br><strong>Nicht-trennbare</strong> (be-, ver-, er-, ge-, ent-, emp-, miss-): без ge- (besuchen→besucht, verstehen→verstanden).
<br><strong>-ieren</strong>: без ge-, +(i)ert (studieren→studiert).`,
    table:{head:['Тип','Regel','Beispiele'],rows:[
      ['Schwach','ge+Stamm+t','lernen→gelernt, kaufen→gekauft, arbeiten→gearbeitet'],
      ['Stark e→ie','ge+...+en','schreiben→geschrieben, treiben→getrieben'],
      ['Stark a→u','ge+...+en','fahren→gefahren, tragen→getragen'],
      ['Stark i→u','ge+...+en','finden→gefunden, singen→gesungen'],
      ['Trennbar','P+ge+t/en','aufmachen→aufgemacht, einkaufen→eingekauft'],
      ['Nicht-trennb.','ohne ge-','besuchen→besucht, verstehen→verstanden'],
      ['-ieren','ohne ge-+iert','studieren→studiert, fotografieren→fotografiert'],
    ]}
  },
  examples:[
    sent('Er hat die Tür aufgemacht.',
      [{w:'Er',r:'S'},{w:'hat',r:'Aux'},{w:'die Tür',r:'Oa'},{w:'aufgemacht.',r:'V'}],
      'Он открыл дверь. (trennbar: auf+ge+mach+t)'),
    sent('Sie hat Medizin studiert.',
      [{w:'Sie',r:'S'},{w:'hat',r:'Aux'},{w:'Medizin',r:'Oa'},{w:'studiert.',r:'V'}],
      'Она изучала медицину. (-ieren: studiert)'),
  ],
  exercises:[
    ex('machen → Part.II','gemacht','ge+mach+t'),
    ex('fahren → Part.II','gefahren','ge+fahr+en (stark)'),
    ex('aufmachen → Part.II','aufgemacht','auf+ge+mach+t'),
    ex('besuchen → Part.II','besucht','nicht-trennbar: ohne ge-'),
    ex('studieren → Part.II','studiert','-ieren: ohne ge-'),
    ex('verstehen → Part.II','verstanden','nicht-trennbar, stark'),
  ]
};

// ── PRÄTERITUM ────────────────────────────────────────────────────
CONTENT['prateritum'] = {
  zone:'past', tag:'Zeitform', title:'Präteritum',
  sub:'Нарративное прошедшее (письмо/рассказ)',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'schwach: Stamm+te | stark: Ablaut-Stamm (ohne Endung in 1/3 Sg.)',
    text:`Präteritum используется в <em>письменной речи</em> (газеты, романы, рассказы). 
<br>В разговоре: только sein/haben/Modalverben.
<br><br><strong>Schwach:</strong> Stamm + -te (-test/-te/-ten/-tet/-ten).
<br><strong>Stark:</strong> новая Ablaut-основа, ich/er без окончания.`,
    table:{head:['Person','schwach (lernen)','stark (fahren)','sein','haben','können'],rows:[
      ['ich','lernte','fuhr','war','hatte','konnte'],
      ['du','lerntest','fuhrst','warst','hattest','konntest'],
      ['er/sie','lernte','fuhr','war','hatte','konnte'],
      ['wir','lernten','fuhren','waren','hatten','konnten'],
      ['ihr','lerntet','fuhrt','wart','hattet','konntet'],
      ['sie/Sie','lernten','fuhren','waren','hatten','konnten'],
    ]}
  },
  examples:[
    sent('Er arbeitete jeden Tag bis spät.',
      [{w:'Er',r:'S'},{w:'arbeitete',r:'V'},{w:'jeden Tag',r:'Adv'},{w:'bis spät.',r:'Adv'}],
      'Он работал каждый день допоздна.'),
    sent('Als Kind wohnte sie in München.',
      [{w:'Als Kind',r:'Adv'},{w:'wohnte',r:'V'},{w:'sie',r:'S'},{w:'in München.',r:'Adv'}],
      'В детстве она жила в Мюнхене.'),
    sent('Er fuhr nach Berlin und besuchte seine Eltern.',
      [{w:'Er',r:'S'},{w:'fuhr',r:'V'},{w:'nach Berlin',r:'Adv'},{w:'und',r:''},{w:'besuchte',r:'V'},{w:'seine Eltern.',r:'Oa'}],
      'Он поехал в Берлин и навестил родителей.'),
  ],
  exercises:[
    ex('Er ___ viel. (arbeiten → Prät.)','arbeitete','schwach: Stamm+te'),
    ex('Ich ___ müde. (sein → Prät.)','war','sein → war'),
    ex('Wir ___ keine Zeit. (haben → Prät.)','hatten','haben → hatten'),
    ex('Er ___ nach Berlin. (fahren → Prät.)','fuhr','stark: fahr→fuhr'),
    ex('Ich ___ das nicht. (können → Prät.)','konnte','können → konnte'),
    ex('Sie ___ ein Buch. (schreiben → Prät.)','schrieb','stark: schreib→schrieb'),
  ]
};

CONTENT['prat_schwach'] = {
  zone:'past', tag:'Struktur', title:'Schwache Verben',
  sub:'Слабые глаголы в Präteritum',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Stamm + te + Personalendung',
    text:`ich lern<strong>te</strong> / du lern<strong>test</strong> / er lern<strong>te</strong> / wir lern<strong>ten</strong> / ihr lern<strong>tet</strong> / sie lern<strong>ten</strong>
<br><br>Особенность: если основа на <em>-d/-t</em>, вставляется -e-: arbeit<strong>ete</strong>.`,
    table:{head:['Infinitiv','Stamm','ich-Form','er-Form'],rows:[
      ['lernen','lern-','lernte','lernte'],
      ['kaufen','kauf-','kaufte','kaufte'],
      ['arbeiten','arbeit-','arbeitete','arbeitete'],
      ['wohnen','wohn-','wohnte','wohnte'],
      ['spielen','spiel-','spielte','spielte'],
    ]}
  },
  examples:[
    sent('Sie wohnten früher in Hamburg.',
      [{w:'Sie',r:'S'},{w:'wohnten',r:'V'},{w:'früher',r:'Adv'},{w:'in Hamburg.',r:'Adv'}],
      'Раньше они жили в Гамбурге.'),
  ],
  exercises:[
    ex('spielen → ich-Form Prät.','spielte','spiel+te'),
    ex('arbeiten → er-Form Prät.','arbeitete','arbeit+e+te (d/t-основа)'),
    ex('kaufen → wir-Form Prät.','kauften','kauf+ten'),
  ]
};

CONTENT['prat_stark'] = {
  zone:'past', tag:'Struktur', title:'Starke Verben',
  sub:'Сильные глаголы в Präteritum',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Ablaut-Stamm (ich/er без Endung; du +st; wir/sie +en; ihr +t)',
    text:'Сильные глаголы меняют корневую гласную (Ablaut). ich и er/sie/es — без окончания.',
    table:{head:['Infinitiv','Präteritum-Stamm','ich/er','du','wir'],rows:[
      ['fahren','fuhr-','fuhr','fuhrst','fuhren'],
      ['gehen','ging-','ging','gingst','gingen'],
      ['schreiben','schrieb-','schrieb','schriebst','schrieben'],
      ['finden','fand-','fand','fandst','fanden'],
      ['singen','sang-','sang','sangst','sangen'],
      ['geben','gab-','gab','gabst','gaben'],
      ['sehen','sah-','sah','sahst','sahen'],
      ['kommen','kam-','kam','kamst','kamen'],
    ]}
  },
  examples:[
    sent('Er kam spät nach Hause.',
      [{w:'Er',r:'S'},{w:'kam',r:'V'},{w:'spät',r:'Adv'},{w:'nach Hause.',r:'Adv'}],
      'Он пришёл домой поздно. (kommen → kam)'),
    sent('Sie schrieb einen langen Brief.',
      [{w:'Sie',r:'S'},{w:'schrieb',r:'V'},{w:'einen langen Brief.',r:'Oa'}],
      'Она написала длинное письмо.'),
  ],
  exercises:[
    ex('gehen → ich Prät.','ging','ging'),
    ex('sehen → er Prät.','sah','sah'),
    ex('kommen → wir Prät.','kamen','kamen'),
    ex('geben → du Prät.','gabst','gab+st'),
  ]
};

CONTENT['prat_modal'] = {
  zone:'past', tag:'Struktur', title:'Modalverben — Präteritum',
  sub:'Модальные глаголы в прошедшем',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Modalstamm (ohne Umlaut) + te + Endung',
    text:'Модальные теряют умлаут и спрягаются как слабые. Я/он — без окончания.',
    table:{head:['Infinitiv','ich/er Prät.','du Prät.','wir Prät.'],rows:[
      ['können','konnte','konntest','konnten'],
      ['müssen','musste','musstest','mussten'],
      ['dürfen','durfte','durftest','durften'],
      ['wollen','wollte','wolltest','wollten'],
      ['sollen','sollte','solltest','sollten'],
      ['mögen','mochte','mochtest','mochten'],
    ]}
  },
  examples:[
    sent('Er konnte nicht schlafen.',
      [{w:'Er',r:'S'},{w:'konnte',r:'V'},{w:'nicht',r:'N'},{w:'schlafen.',r:'V'}],
      'Он не мог спать.'),
    sent('Wir mussten früh aufstehen.',
      [{w:'Wir',r:'S'},{w:'mussten',r:'V'},{w:'früh',r:'Adv'},{w:'aufstehen.',r:'V'}],
      'Нам нужно было рано вставать.'),
  ],
  exercises:[
    ex('können → ich Prät.','konnte','konnte (kein Umlaut)'),
    ex('müssen → wir Prät.','mussten','mussten'),
    ex('dürfen → er Prät.','durfte','durfte'),
    ex('wollen → sie Prät.','wollten','wollten'),
  ]
};

// ── PLUSQUAMPERFEKT ───────────────────────────────────────────────
CONTENT['plusquamp'] = {
  zone:'past', tag:'Zeitform', title:'Plusquamperfekt',
  sub:'Давнопрошедшее — до Präteritum',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'hatte/war (konj.) + ... + Partizip II',
    text:`Plusquamperfekt = Perfekt, но aux. в Präteritum (hatte/war).
<br>Используется для действия, <em>предшествующего</em> другому прошедшему. Часто с nachdem/bevor/als.`,
    table:{head:['Person','haben-Verb (lernen)','sein-Verb (gehen)'],rows:[
      ['ich','hatte gelernt','war gegangen'],
      ['du','hattest gelernt','warst gegangen'],
      ['er/sie','hatte gelernt','war gegangen'],
      ['wir','hatten gelernt','waren gegangen'],
    ]}
  },
  examples:[
    sent('Nachdem er gegessen hatte, las er ein Buch.',
      [{w:'Nachdem',r:'P'},{w:'er',r:'S'},{w:'gegessen',r:'V'},{w:'hatte,',r:'Aux'},{w:'las',r:'V'},{w:'er',r:'S'},{w:'ein Buch.',r:'Oa'}],
      'После того как он поел, он читал книгу.'),
    sent('Als ich ankam, war sie schon gegangen.',
      [{w:'Als ich ankam,',r:'Adv'},{w:'war',r:'Aux'},{w:'sie',r:'S'},{w:'schon',r:'Adv'},{w:'gegangen.',r:'V'}],
      'Когда я пришёл, она уже ушла.'),
  ],
  exercises:[
    ex('Als ich ankam, ___ sie schon gegangen. (war/hatte)','war','gehen → sein → war'),
    ex('Er ___ gerade gegessen, als sie anrief. (hatte/war)','hatte','essen → haben → hatte'),
    ex('Nachdem wir ___ gelernt hatten... (hatten/waren)','hatten','lernen → haben → hatten'),
  ]
};

// ── KONJUNKTIV ────────────────────────────────────────────────────
CONTENT['konjunktiv'] = {
  zone:'special', tag:'Modus', title:'Konjunktiv',
  sub:'Сослагательное наклонение',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Konj.II: Präteritum-Stamm+Umlaut+e | Konj.I: Präsens-Stamm+e',
    text:`<strong>Konjunktiv II</strong> — нереальные условия, вежливые просьбы, предположения.
<br>Образование: а) прямая форма (hätte/wäre/könnte...); б) описательная: würde+Infinitiv.
<br><br><strong>Konjunktiv I</strong> — косвенная речь. Образование: основа инфинитива + -e-окончания.`,
    table:{head:['','haben','sein','können','dürfen','müssen'],rows:[
      ['Konj.II ich','hätte','wäre','könnte','dürfte','müsste'],
      ['Konj.II er','hätte','wäre','könnte','dürfte','müsste'],
      ['Konj.I er','habe','sei','könne','dürfe','müsse'],
    ]}
  },
  examples:[
    sent('Wenn ich Zeit hätte, würde ich kommen.',
      [{w:'Wenn ich Zeit',r:'S'},{w:'hätte,',r:'V'},{w:'würde',r:'Aux'},{w:'ich',r:'S'},{w:'kommen.',r:'V'}],
      'Если бы у меня было время, я бы пришёл.'),
    sent('Könntest du mir bitte helfen?',
      [{w:'Könntest',r:'V'},{w:'du',r:'S'},{w:'mir',r:'Od'},{w:'bitte',r:'Adv'},{w:'helfen?',r:'V'}],
      'Не мог бы ты мне помочь? (вежливость)'),
    sent('Er sagt, er habe keine Zeit. (Konj.I)',
      [{w:'Er',r:'S'},{w:'sagt,',r:'V'},{w:'er',r:'S'},{w:'habe',r:'V'},{w:'keine Zeit.',r:'Oa'}],
      'Он говорит, что у него нет времени.'),
  ],
  exercises:[
    ex('Wenn ich Geld ___, würde ich reisen. (haben → Konj.II)','hätte','haben → hätte'),
    ex('___ du mir helfen? (können → Konj.II, höflich)','Könntest','können → könntest'),
    ex('Er sagt, er ___ keine Zeit. (haben → Konj.I)','habe','Konj.I: habe'),
    ex('Ich ___ gern kommen. (mögen → Konj.II)','möchte','mögen → möchte'),
  ]
};

CONTENT['konj2'] = {
  zone:'special', tag:'Modus', title:'Konjunktiv II — direkte Form',
  sub:'Прямая форма Konjunktiv II',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Präteritum-Stamm + Umlaut (a→ä, u→ü, o→ö) + e-Endungen',
    text:'Прямая форма: hätte, wäre, könnte, dürfte, müsste, sollte, wollte. Остальные глаголы — через würde+Infinitiv.',
    table:{head:['Infinitiv','Prät.','Konj.II ich/er','du'],rows:[
      ['haben','hatte','hätte','hättest'],
      ['sein','war','wäre','wärst'],
      ['können','konnte','könnte','könntest'],
      ['müssen','musste','müsste','müsstest'],
      ['dürfen','durfte','dürfte','dürftest'],
      ['sollen','sollte','sollte','solltest'],
      ['wollen','wollte','wollte','wolltest'],
    ]}
  },
  examples:[
    sent('Das wäre toll!',
      [{w:'Das',r:'S'},{w:'wäre',r:'V'},{w:'toll!',r:'Adj'}],
      'Это было бы здорово!'),
    sent('Ich hätte gern einen Kaffee.',
      [{w:'Ich',r:'S'},{w:'hätte',r:'V'},{w:'gern',r:'Adv'},{w:'einen Kaffee.',r:'Oa'}],
      'Я бы хотел кофе. (вежливый заказ)'),
  ],
  exercises:[
    ex('Das ___ schön. (sein → Konj.II)','wäre','sein → wäre'),
    ex('Ich ___ gern helfen. (haben → Konj.II)','hätte','haben → hätte'),
    ex('___ du das machen? (können → Konj.II)','Könntest','du → könntest'),
  ]
};

CONTENT['konj_irrealis'] = {
  zone:'special', tag:'Modus', title:'Irrealis — Bedingungssatz',
  sub:'Условные предложения с Konjunktiv II',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Wenn + S + Konj.II..., (dann) würde + S + Inf. | hätte/wäre + Part.II (Vergangenheit)',
    text:`Нереальное условие: wenn+Konj.II в придаточном, würde+Inf. в главном.
<br>Нереальное прошлое: wenn+hätte/wäre+Part.II, hätte/wäre+Part.II.`,
    table:{head:['Тип','Nebensatz','Hauptsatz'],rows:[
      ['Gegenwart','Wenn ich Zeit hätte,','würde ich kommen.'],
      ['Gegenwart','Wenn er reicher wäre,','könnte er reisen.'],
      ['Vergangenheit','Wenn ich Zeit gehabt hätte,','wäre ich gekommen.'],
    ]}
  },
  examples:[
    sent('Wenn es nicht regnete, würden wir spazieren gehen.',
      [{w:'Wenn es',r:'S'},{w:'nicht regnete,',r:'V'},{w:'würden',r:'Aux'},{w:'wir',r:'S'},{w:'spazieren gehen.',r:'V'}],
      'Если бы не шёл дождь, мы бы пошли гулять.'),
  ],
  exercises:[
    ex('Wenn ich mehr Zeit ___, würde ich sport treiben. (haben→Konj.II)','hätte','hätte'),
    ex('Wenn er das gewusst ___, wäre er nicht gegangen. (haben→Konj.II Verg.)','hätte','Verg.: hätte gewusst'),
  ]
};

// ── IMPERATIV ─────────────────────────────────────────────────────
CONTENT['imperativ'] = {
  zone:'special', tag:'Modus', title:'Imperativ',
  sub:'Повелительное наклонение',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'du: Stamm(+e) | ihr: Stamm+t | Sie: Inf.+Sie',
    text:`<strong>du-Form</strong>: основа глагола (lern!). При основе на -d/-t/-ig → +e (arbeite!). Сильные с e→i сохраняют Ablaut (lies!, sprich!).
<br><strong>ihr-Form</strong>: как Präsens ihr (lernt!, arbeitet!).
<br><strong>Sie-Form</strong>: Infinitiv + Sie (Lernen Sie!). Всегда с Sie.`,
    table:{head:['Person','lernen','fahren','lesen','arbeiten','sein'],rows:[
      ['du','Lern(e)!','Fahr(e)!','Lies!','Arbeite!','Sei!'],
      ['ihr','Lernt!','Fahrt!','Lest!','Arbeitet!','Seid!'],
      ['Sie','Lernen Sie!','Fahren Sie!','Lesen Sie!','Arbeiten Sie!','Seien Sie!'],
    ]}
  },
  examples:[
    sent('Lern jeden Tag neue Wörter!',
      [{w:'Lern',r:'V'},{w:'jeden Tag',r:'Adv'},{w:'neue Wörter!',r:'Oa'}],
      'Учи каждый день новые слова! (du)'),
    sent('Fahren Sie bitte langsam!',
      [{w:'Fahren',r:'V'},{w:'Sie',r:'S'},{w:'bitte',r:'Adv'},{w:'langsam!',r:'Adj'}],
      'Пожалуйста, едьте медленно! (Sie)'),
    sent('Seid ruhig!',
      [{w:'Seid',r:'V'},{w:'ruhig!',r:'Adj'}],
      'Будьте тихими! (ihr)'),
  ],
  exercises:[
    ex('___ ! (du, lernen)','Lern','du-Form: основа'),
    ex('___ ! (ihr, lernen)','Lernt','ihr+t'),
    ex('___ Sie! (lernen)','Lernen','Inf.+Sie'),
    ex('___ ! (du, lesen)','Lies','e→i сохраняется'),
    ex('___ ! (du, arbeiten)','Arbeite','основа на -t → +e'),
    ex('___ Sie bitte! (kommen)','Kommen','Inf.+Sie'),
  ]
};

// ── Konjunktiv I ──────────────────────────────────────────────────
CONTENT['konj1'] = {
  zone:'special', tag:'Modus', title:'Konjunktiv I — Indirekte Rede',
  sub:'Косвенная речь',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Inf.Stamm + -e-Endungen (ich -e / du -est / er -e / wir -en / ihr -et / sie -en)',
    text:`Konjunktiv I используется для передачи чужих слов (<em>косвенная речь</em>).
<br>Если форма совпадает с Indikativ — используют Konj. II или würde+Inf.
<br><br>sein имеет особые формы: ich sei / du seist / er sei / wir seien.`,
    table:{head:['Person','lernen (Konj.I)','haben','sein'],rows:[
      ['ich','lerne','habe','sei'],
      ['du','lernest','habest','seist'],
      ['er/sie','lerne','habe','sei'],
      ['wir','lernen','haben','seien'],
      ['ihr','lernet','habet','seiet'],
      ['sie/Sie','lernen','haben','seien'],
    ]}
  },
  examples:[
    sent('Er sagt, er lerne Deutsch.',
      [{w:'Er',r:'S'},{w:'sagt,',r:'V'},{w:'er',r:'S'},{w:'lerne',r:'V'},{w:'Deutsch.',r:'Oa'}],
      'Он говорит, что учит немецкий.'),
    sent('Sie sagte, sie sei müde.',
      [{w:'Sie',r:'S'},{w:'sagte,',r:'V'},{w:'sie',r:'S'},{w:'sei',r:'V'},{w:'müde.',r:'Adj'}],
      'Она сказала, что усталая.'),
  ],
  exercises:[
    ex('Er sagt, er ___ Deutsch. (lernen → Konj.I)','lerne','Konj.I er: lerne'),
    ex('Sie sagt, sie ___ müde. (sein → Konj.I)','sei','sein Konj.I: sei'),
    ex('Er sagt, er ___ Zeit. (haben → Konj.I)','habe','haben Konj.I: habe'),
  ]
};

// ── FUTUR II → Aussage / Neg ──────────────────────────────────────
CONTENT['fut2_aussage'] = {
  zone:'future', tag:'Satztyp', title:'Futur II — Aussagesatz',
  sub:'Утвердительное предложение',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + werden(P2) + ... + Partizip II + haben/sein',
    text:'werden на P2, Partizip II + Hilfsverb (haben/sein) — в конце как двойная рамка (Satzklammer). Порядок: Part.II → haben/sein.',
    table:{head:['P1','P2 (werden)','Mittelfeld','Ende'],rows:[
      ['Ich','werde','das Buch bis morgen','gelesen haben.'],
      ['Er','wird','pünktlich','angekommen sein.'],
      ['Bis Freitag','werden','wir alles','erledigt haben.'],
    ]}
  },
  examples:[
    sent('Ich werde das bis morgen erledigt haben.',
      [{w:'Ich',r:'S'},{w:'werde',r:'Aux'},{w:'das',r:'Oa'},{w:'bis morgen',r:'Adv'},{w:'erledigt',r:'V'},{w:'haben.',r:'Aux'}],
      'Я к завтрашнему дню разберусь с этим.'),
    sent('Er wird bis dann angekommen sein.',
      [{w:'Er',r:'S'},{w:'wird',r:'Aux'},{w:'bis dann',r:'Adv'},{w:'angekommen',r:'V'},{w:'sein.',r:'Aux'}],
      'К тому времени он уже прибудет.'),
  ],
  exercises:[
    ex('Ich werde das erledigt ___. (haben/sein)','haben','erledigen → haben-Verb'),
    ex('Er wird angekommen ___. (haben/sein)','sein','ankommen → sein-Verb'),
    ex('Bis Freitag ___ wir alles gemacht haben. (werden/wird)','werden','wir → werden'),
  ]
};

CONTENT['fut2_neg'] = {
  zone:'future', tag:'Satztyp', title:'Futur II — Negation',
  sub:'Отрицание в Futur II',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + werden + ... + nicht + Part.II + haben/sein',
    text:'nicht стоит перед Partizip II. kein- используется перед существительным в Mittelfeld.',
    table:{head:['Тип','Пример'],rows:[
      ['nicht','Ich werde das nicht gemacht haben.'],
      ['kein','Er wird keine Fehler gemacht haben.'],
    ]}
  },
  examples:[
    sent('Sie wird das Buch nicht gelesen haben.',
      [{w:'Sie',r:'S'},{w:'wird',r:'Aux'},{w:'das Buch',r:'Oa'},{w:'nicht',r:'N'},{w:'gelesen',r:'V'},{w:'haben.',r:'Aux'}],
      'Она, должно быть, не читала книгу.'),
  ],
  exercises:[
    ex('Er wird das ___ gemacht haben. (nicht/kein)','nicht','глагол → nicht'),
    ex('Sie wird ___ Fehler gemacht haben. (keine/nicht)','keine','Fehler (Pl.) → keine'),
  ]
};

// ── PRÄTERITUM → Satztypen ────────────────────────────────────────
CONTENT['prat_aussage'] = {
  zone:'past', tag:'Satztyp', title:'Präteritum — Aussagesatz',
  sub:'Утвердительное в Präteritum',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + Verb-Prät.(P2) + ... | Modale: Modal-Prät. + ... + Inf.',
    text:'Глагол в Präteritum на позиции 2. При инверсии — любой элемент на P1, глагол P2. Модальные: Prät-форма на P2, инфинитив в конце.',
    table:{head:['P1','P2 (Prät.)','Rest'],rows:[
      ['Er','arbeitete','jeden Tag.'],
      ['Jeden Tag','arbeitete','er.'],
      ['Sie','fuhr','nach Berlin.'],
      ['Er','konnte','nicht schlafen.'],
      ['Als Kind','wohnte','sie in Wien.'],
    ]}
  },
  examples:[
    sent('Er arbeitete damals als Ingenieur.',
      [{w:'Er',r:'S'},{w:'arbeitete',r:'V'},{w:'damals',r:'Adv'},{w:'als Ingenieur.',r:'Adv'}],
      'В то время он работал инженером.'),
    sent('Als Kind wohnte sie in einem kleinen Dorf.',
      [{w:'Als Kind',r:'Adv'},{w:'wohnte',r:'V'},{w:'sie',r:'S'},{w:'in einem kleinen Dorf.',r:'Adv'}],
      'В детстве она жила в маленькой деревне.'),
    sent('Er wollte Arzt werden.',
      [{w:'Er',r:'S'},{w:'wollte',r:'V'},{w:'Arzt',r:'Oa'},{w:'werden.',r:'V'}],
      'Он хотел стать врачом.'),
  ],
  exercises:[
    ex('Er ___ viel. (arbeiten → Prät.)','arbeitete','schwach: +te'),
    ex('Sie ___ nach Hamburg. (fahren → Prät.)','fuhr','stark: fahr→fuhr'),
    ex('Ich ___ nicht schlafen. (können → Prät.)','konnte','können→konnte'),
    ex('Wir ___ in München. (wohnen → Prät.)','wohnten','schwach: +ten'),
  ]
};

CONTENT['prat_frage'] = {
  zone:'past', tag:'Satztyp', title:'Präteritum — Frage',
  sub:'Вопросы в Präteritum',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Verb-Prät.(P1) + S + ...? | W-Wort(P1) + Verb-Prät.(P2) + S + ...?',
    text:'Структура та же, что и в Präsens: глагол на P1 (Ja/Nein-Frage) или W-Wort + глагол-Prät. на P2 (W-Frage).',
    table:{head:['Тип','Пример','Перевод'],rows:[
      ['Ja/Nein','Arbeitete er viel?','Он много работал?'],
      ['Ja/Nein','War sie müde?','Она была усталой?'],
      ['W-Frage','Wo wohntest du früher?','Где ты жил раньше?'],
      ['W-Frage','Wann fuhr er ab?','Когда он уехал?'],
      ['Modal','Konnte er kommen?','Он мог прийти?'],
    ]}
  },
  examples:[
    sent('Wohntest du früher in Berlin?',
      [{w:'Wohntest',r:'V'},{w:'du',r:'S'},{w:'früher',r:'Adv'},{w:'in Berlin?',r:'Adv'}],
      'Ты раньше жил в Берлине?'),
    sent('Wo arbeitete er damals?',
      [{w:'Wo',r:'Adv'},{w:'arbeitete',r:'V'},{w:'er',r:'S'},{w:'damals?',r:'Adv'}],
      'Где он тогда работал?'),
  ],
  exercises:[
    ex('___ du in Berlin? (Wohntest/Wohnte/Wohnten)','Wohntest','du-Form: +test'),
    ex('Wo ___ er? (arbeitete/arbeite/arbeitest)','arbeitete','er → +te'),
    ex('___ sie (она) fahren? (Konnte/Konntest/Konnten)','Konnte','sie (она) → konnte'),
  ]
};

CONTENT['prat_neg'] = {
  zone:'past', tag:'Satztyp', title:'Präteritum — Negation',
  sub:'Отрицание в Präteritum',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + Verb-Prät. + ... + nicht | kein- + Nomen',
    text:'Те же правила, что в Präsens: nicht отрицает глагол (стоит в конце или перед отрицаемым элементом), kein- отрицает существительные.',
    table:{head:['Тип','Пример'],rows:[
      ['nicht (Verb)','Er arbeitete nicht.'],
      ['nicht (Adj.)','Er war nicht müde.'],
      ['nicht (Präp.)','Sie wohnte nicht in Berlin.'],
      ['kein (Nomen)','Er hatte keine Zeit.'],
      ['kein (Akk.m)','Ich sah keinen Mann.'],
    ]}
  },
  examples:[
    sent('Er konnte damals nicht schlafen.',
      [{w:'Er',r:'S'},{w:'konnte',r:'V'},{w:'damals',r:'Adv'},{w:'nicht',r:'N'},{w:'schlafen.',r:'V'}],
      'В то время он не мог спать.'),
    sent('Sie hatte keine Arbeit.',
      [{w:'Sie',r:'S'},{w:'hatte',r:'V'},{w:'keine',r:'N'},{w:'Arbeit.',r:'Oa'}],
      'У неё не было работы.'),
  ],
  exercises:[
    ex('Er schlief ___ gut. (nicht/kein)','nicht','Adverb/Verb → nicht'),
    ex('Sie hatte ___ Geld. (kein/nicht/keinen)','kein','Geld (n) → kein'),
    ex('Ich wohnte ___ in München. (nicht/kein)','nicht','Präp.-Gruppe → nicht'),
  ]
};

// ── PLUSQUAMPERFEKT → Satztypen ───────────────────────────────────
CONTENT['plq_aussage'] = {
  zone:'past', tag:'Satztyp', title:'Plusquamperf. — Aussagesatz',
  sub:'Утвердительное в Plusquamperfekt',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + hatte/war(P2) + ... + Part.II',
    text:'hatte/war на P2, Partizip II в конце. Часто в придаточных с <em>nachdem, bevor, als, weil</em>. В главном предложении — Präteritum.',
    table:{head:['Nebensatz (PqPf)','Hauptsatz (Prät.)'],rows:[
      ['Nachdem er gegessen hatte,','las er ein Buch.'],
      ['Bevor sie kam,','hatte er aufgeräumt.'],
      ['Als ich ankam,','war sie schon gegangen.'],
      ['Weil er trainiert hatte,','gewann er das Rennen.'],
    ]}
  },
  examples:[
    sent('Nachdem er das Buch gelesen hatte, schlief er ein.',
      [{w:'Nachdem er das Buch',r:'S'},{w:'gelesen hatte,',r:'V'},{w:'schlief',r:'V'},{w:'er',r:'S'},{w:'ein.',r:'V'}],
      'После того как он прочитал книгу, он заснул.'),
    sent('Als ich ankam, hatte er bereits gegessen.',
      [{w:'Als ich ankam,',r:'Adv'},{w:'hatte',r:'Aux'},{w:'er',r:'S'},{w:'bereits',r:'Adv'},{w:'gegessen.',r:'V'}],
      'Когда я пришёл, он уже поел.'),
    sent('Weil sie fleißig gelernt hatte, bestand sie die Prüfung.',
      [{w:'Weil sie fleißig',r:'S'},{w:'gelernt hatte,',r:'V'},{w:'bestand',r:'V'},{w:'sie',r:'S'},{w:'die Prüfung.',r:'Oa'}],
      'Потому что она усердно занималась, она сдала экзамен.'),
  ],
  exercises:[
    ex('Nachdem er ___ hatte, ging er schlafen. (essen → Part.II)','gegessen','essen → gegessen'),
    ex('Als ich ankam, ___ sie schon gegangen. (war/hatte)','war','gehen → sein → war'),
    ex('Weil wir ___ hatten, konnten wir gewinnen. (trainieren → Part.II)','trainiert','trainieren → trainiert'),
  ]
};

CONTENT['plq_neg'] = {
  zone:'past', tag:'Satztyp', title:'Plusquamperf. — Negation',
  sub:'Отрицание в Plusquamperfekt',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'hatte/war + ... + nicht + Part.II | kein im Mittelfeld',
    text:'nicht стоит непосредственно перед Partizip II. kein- отрицает существительное в Mittelfeld.',
    table:{head:['Тип','Пример'],rows:[
      ['nicht vor Part.II','Er hatte das nicht gewusst.'],
      ['kein im MF','Sie hatte kein Geld gehabt.'],
      ['sein + nicht','Er war nicht gegangen.'],
    ]}
  },
  examples:[
    sent('Er hatte das Problem nicht bemerkt.',
      [{w:'Er',r:'S'},{w:'hatte',r:'Aux'},{w:'das Problem',r:'Oa'},{w:'nicht',r:'N'},{w:'bemerkt.',r:'V'}],
      'Он не заметил проблемы.'),
    sent('Sie war noch nie in Deutschland gewesen.',
      [{w:'Sie',r:'S'},{w:'war',r:'Aux'},{w:'noch nie',r:'N'},{w:'in Deutschland',r:'Adv'},{w:'gewesen.',r:'V'}],
      'Она никогда не была в Германии.'),
  ],
  exercises:[
    ex('Er hatte das ___ gewusst. (nicht/kein)','nicht','глагол → nicht'),
    ex('Sie hatte ___ Zeit gehabt. (keine/nicht)','keine','Zeit (f) → keine'),
    ex('Er war ___ angekommen. (nicht/kein)','nicht','sein-Verb → nicht'),
  ]
};

// ── KONJUNKTIV II würde+Inf ───────────────────────────────────────
CONTENT['konj2_wurd'] = {
  zone:'special', tag:'Modus', title:'würde + Infinitiv',
  sub:'Описательная форма Konjunktiv II',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'würde (konj.) + ... + Infinitiv',
    text:`<strong>würde+Infinitiv</strong> — аналитическая замена Konjunktiv II для большинства глаголов (кроме haben/sein/Modalverben — у них своя форма).
<br><br>Используется: нереальные желания, вежливые просьбы, гипотетические ситуации.
<br><br>Спряжение würde: ich würde / du würdest / er würde / wir würden / ihr würdet / sie würden.`,
    table:{head:['Person','würde'],rows:[
      ['ich','würde'],['du','würdest'],['er/sie/es','würde'],
      ['wir','würden'],['ihr','würdet'],['sie/Sie','würden'],
    ]}
  },
  examples:[
    sent('Ich würde gerne nach Deutschland reisen.',
      [{w:'Ich',r:'S'},{w:'würde',r:'Aux'},{w:'gerne',r:'Adv'},{w:'nach Deutschland',r:'Adv'},{w:'reisen.',r:'V'}],
      'Я бы с удовольствием поехал в Германию.'),
    sent('Würdest du mir bitte helfen?',
      [{w:'Würdest',r:'Aux'},{w:'du',r:'S'},{w:'mir',r:'Od'},{w:'bitte',r:'Adv'},{w:'helfen?',r:'V'}],
      'Не помог бы ты мне? (вежливая просьба)'),
    sent('Was würdest du an meiner Stelle machen?',
      [{w:'Was',r:'Oa'},{w:'würdest',r:'Aux'},{w:'du',r:'S'},{w:'an meiner Stelle',r:'Adv'},{w:'machen?',r:'V'}],
      'Что бы ты сделал на моём месте?'),
  ],
  exercises:[
    ex('Ich ___ gern helfen. (würde/würdest)','würde','ich → würde'),
    ex('___ du das machen? (Würde/Würdest/Würden)','Würdest','du → würdest'),
    ex('Wir ___ das gerne kaufen.','würden','wir → würden'),
    ex('Was ___ Sie empfehlen? (würden/würde)','würden','Sie → würden'),
    ex('Er ___ lieber zu Hause bleiben.','würde','er → würde'),
  ]
};

// ── IMPERATIV → alle Formen ───────────────────────────────────────
CONTENT['imp_du'] = {
  zone:'special', tag:'Modus', title:'Imperativ — du-Form',
  sub:'Команда для одного человека (ты)',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Stamm (ohne -st) [+ e bei -d/-t/-ig/-m/-n]',
    text:`du-форма: берём основу глагола (как Präsens du, но без -st).
<br><strong>Особые случаи:</strong>
<br>• основа на <em>-d/-t/-ig/-m/-n</em> (если перед ней другая согласная) → +e: <em>arbeite!, rede!, öffne!</em>
<br>• сильные глаголы с <em>e→i/ie</em>: сохраняют Umlaut: <em>lesen→Lies!, sprechen→Sprich!, geben→Gib!</em>
<br>• sein → Sei! | haben → Hab(e)! | werden → Werde!`,
    table:{head:['Infinitiv','du Präsens','du Imperativ','Особенность'],rows:[
      ['lernen','du lernst','Lern(e)!','обычный'],
      ['arbeiten','du arbeitest','Arbeite!','основа на -t'],
      ['fahren','du fährst','Fahr(e)!','a→ä НЕ сохраняется!'],
      ['lesen','du liest','Lies!','e→ie сохраняется'],
      ['sprechen','du sprichst','Sprich!','e→i сохраняется'],
      ['geben','du gibst','Gib!','e→i сохраняется'],
      ['sein','du bist','Sei!','нерегулярный'],
    ]}
  },
  examples:[
    sent('Lern jeden Tag neue Vokabeln!',
      [{w:'Lern',r:'V'},{w:'jeden Tag',r:'Adv'},{w:'neue Vokabeln!',r:'Oa'}],
      'Учи каждый день новые слова!'),
    sent('Lies dieses Buch!',
      [{w:'Lies',r:'V'},{w:'dieses Buch!',r:'Oa'}],
      'Читай эту книгу! (e→ie сохраняется)'),
    sent('Sei bitte ruhig!',
      [{w:'Sei',r:'V'},{w:'bitte',r:'Adv'},{w:'ruhig!',r:'Adj'}],
      'Пожалуйста, будь тихим!'),
    sent('Arbeite fleißig!',
      [{w:'Arbeite',r:'V'},{w:'fleißig!',r:'Adj'}],
      'Работай усердно! (основа на -t → +e)'),
  ],
  exercises:[
    ex('___ ! (du, kommen)','Komm','основа: komm-'),
    ex('___ ! (du, lesen)','Lies','e→ie сохраняется'),
    ex('___ ! (du, schlafen)','Schlaf','a→ä НЕ сохраняется, schlaf-'),
    ex('___ ! (du, sprechen)','Sprich','e→i сохраняется'),
    ex('___ ! (du, arbeiten)','Arbeite','основа на -t → +e'),
    ex('___ ! (du, sein)','Sei','нерегулярный'),
    ex('___ ! (du, geben)','Gib','e→i сохраняется'),
  ]
};

CONTENT['imp_ihr'] = {
  zone:'special', tag:'Modus', title:'Imperativ — ihr-Form',
  sub:'Команда для группы (вы неформальное)',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'= Präsens ihr-Form (Stamm + -t)',
    text:`ihr-форма Imperativ идентична Präsens ihr-Form. Без изменений основы (никакого Umlaut).
<br><br>Ударение: произносится с восклицательной интонацией.
<br>sein → Seid! | haben → Habt! | werden → Werdet!`,
    table:{head:['Infinitiv','ihr Präsens','ihr Imperativ'],rows:[
      ['lernen','ihr lernt','Lernt!'],
      ['fahren','ihr fahrt','Fahrt!'],
      ['lesen','ihr lest','Lest!'],
      ['arbeiten','ihr arbeitet','Arbeitet!'],
      ['sein','ihr seid','Seid!'],
      ['haben','ihr habt','Habt!'],
    ]}
  },
  examples:[
    sent('Lernt bitte alle Vokabeln!',
      [{w:'Lernt',r:'V'},{w:'bitte',r:'Adv'},{w:'alle Vokabeln!',r:'Oa'}],
      'Пожалуйста, учите все слова! (ihr)'),
    sent('Seid ruhig!',
      [{w:'Seid',r:'V'},{w:'ruhig!',r:'Adj'}],
      'Будьте тихими!'),
    sent('Kommt her und schaut euch das an!',
      [{w:'Kommt',r:'V'},{w:'her',r:'Adv'},{w:'und',r:''},{w:'schaut',r:'V'},{w:'euch das',r:'Oa'},{w:'an!',r:'V'}],
      'Идите сюда и посмотрите на это!'),
  ],
  exercises:[
    ex('___ alle! (ihr, kommen)','Kommt','ihr: Stamm+t'),
    ex('___ bitte leise! (ihr, sein)','Seid','sein: Seid'),
    ex('___ das Buch! (ihr, lesen)','Lest','lesen: ihr lest'),
    ex('___ zusammen! (ihr, arbeiten)','Arbeitet','arbeiten: ihr arbeitet'),
  ]
};

CONTENT['imp_sie'] = {
  zone:'special', tag:'Modus', title:'Imperativ — Sie-Form',
  sub:'Команда вежливая (Вы)',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Infinitiv + Sie (всегда)',
    text:`Sie-форма: Infinitiv + местоимение <strong>Sie</strong>. Всегда.
<br>Обратите внимание: Sie ставится <em>после</em> глагола, в отличие от других форм.
<br>sein → Seien Sie! (особая форма!)`,
    table:{head:['Infinitiv','Sie-Imperativ'],rows:[
      ['lernen','Lernen Sie!'],
      ['kommen','Kommen Sie!'],
      ['lesen','Lesen Sie!'],
      ['sprechen','Sprechen Sie!'],
      ['sein','Seien Sie!'],
      ['haben','Haben Sie!'],
      ['fahren','Fahren Sie!'],
    ]}
  },
  examples:[
    sent('Sprechen Sie bitte langsamer!',
      [{w:'Sprechen',r:'V'},{w:'Sie',r:'S'},{w:'bitte',r:'Adv'},{w:'langsamer!',r:'Adj'}],
      'Пожалуйста, говорите помедленнее!'),
    sent('Seien Sie pünktlich!',
      [{w:'Seien',r:'V'},{w:'Sie',r:'S'},{w:'pünktlich!',r:'Adj'}],
      'Будьте пунктуальны! (sein → Seien)'),
    sent('Nehmen Sie bitte Platz!',
      [{w:'Nehmen',r:'V'},{w:'Sie',r:'S'},{w:'bitte',r:'Adv'},{w:'Platz!',r:'Oa'}],
      'Пожалуйста, присаживайтесь!'),
  ],
  exercises:[
    ex('___ bitte! (kommen, Sie)','Kommen Sie','Inf. + Sie'),
    ex('___ langsamer! (sprechen, Sie)','Sprechen Sie','Inf. + Sie'),
    ex('___ ruhig! (sein, Sie)','Seien Sie','sein → Seien Sie!'),
    ex('___ Platz! (nehmen, Sie)','Nehmen Sie','Inf. + Sie'),
  ]
};

CONTENT['imp_neg'] = {
  zone:'special', tag:'Satztyp', title:'Imperativ — Negation',
  sub:'Запрет — nicht / kein',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Imp. + nicht | kein- + Nomen',
    text:`Запрет строится из Imperativ + nicht или kein-.
<br>nicht стоит в конце или перед отрицаемым элементом.
<br>kein- заменяет существительное с неопределённым артиклем.
<br><br>Также часто используется: <em>Hör auf zu + Inf.!</em> (Перестань...), <em>Vergiss nicht, zu + Inf.</em>`,
    table:{head:['Форма','Позитив','Запрет'],rows:[
      ['du','Komm!','Komm nicht!'],
      ['du (kein)','Kauf ein Auto!','Kauf kein Auto!'],
      ['ihr','Kommt!','Kommt nicht!'],
      ['Sie','Kommen Sie!','Kommen Sie nicht!'],
      ['du','Rauche!','Rauch nicht!'],
    ]}
  },
  examples:[
    sent('Komm nicht zu spät!',
      [{w:'Komm',r:'V'},{w:'nicht',r:'N'},{w:'zu spät!',r:'Adv'}],
      'Не опаздывай!'),
    sent('Macht bitte keinen Lärm!',
      [{w:'Macht',r:'V'},{w:'bitte',r:'Adv'},{w:'keinen',r:'N'},{w:'Lärm!',r:'Oa'}],
      'Пожалуйста, не шумите! (Lärm m → keinen)'),
    sent('Vergessen Sie nicht, den Ausweis mitzubringen!',
      [{w:'Vergessen',r:'V'},{w:'Sie',r:'S'},{w:'nicht,',r:'N'},{w:'den Ausweis mitzubringen!',r:'V'}],
      'Не забудьте взять удостоверение!'),
  ],
  exercises:[
    ex('___ nicht! (du, rauchen → Imp.)','Rauch','du Imp: основа'),
    ex('___ keinen Lärm! (ihr, machen → Imp.)','Macht','ihr: Stamm+t'),
    ex('___ Sie nicht so laut! (sprechen → Sie-Imp.)','Sprechen','Inf.+Sie'),
    ex('___ keine Angst! (du, haben → Imp.)','Hab','haben → Hab'),
  ]
};

// ── PRÄSENS Aussagesatz Level 3 ───────────────────────────────────
CONTENT['pra_aus_subj'] = {
  zone:'present', tag:'Wortart', title:'Subjekt — Nominativ',
  sub:'Подлежащее — кто или что совершает действие',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'wer? / was? → Nominativ — всегда P1 или P3 (при инверсии)',
    text:`Subjekt отвечает на вопрос <strong>wer?</strong> (одуш.) или <strong>was?</strong> (неодуш.).
<br>Всегда в <strong>Nominativ</strong>. Артикль: der/die/das (без изменений в Nom.).
<br><br><strong>Местоимения Nominativ:</strong> ich / du / er / sie / es / wir / ihr / sie / Sie.
<br><br>Подлежащее определяет форму глагола (конгруэнция).`,
    table:{head:['Тип','Nom.m','Nom.f','Nom.n','Nom.Pl.'],rows:[
      ['best.Art.','der Mann','die Frau','das Kind','die Leute'],
      ['unbest.Art.','ein Mann','eine Frau','ein Kind','– Leute'],
      ['kein-','kein Mann','keine Frau','kein Kind','keine Leute'],
      ['Possessiv(mein)','mein Mann','meine Frau','mein Kind','meine Leute'],
    ]}
  },
  examples:[
    sent('Der alte Mann liest ein Buch.',
      [{w:'Der alte Mann',r:'S'},{w:'liest',r:'V'},{w:'ein Buch.',r:'Oa'}],
      'Старый мужчина читает книгу. (der=Nom.m)'),
    sent('Eine junge Frau kommt herein.',
      [{w:'Eine junge Frau',r:'S'},{w:'kommt',r:'V'},{w:'herein.',r:'Adv'}],
      'Молодая женщина входит. (eine=Nom.f)'),
    sent('Mein Kind schläft.',
      [{w:'Mein Kind',r:'S'},{w:'schläft.',r:'V'}],
      'Моё дитя спит. (mein=Nom.n)'),
  ],
  exercises:[
    ex('___ Mann kommt. (der/die/das)','Der','Mann — m → der'),
    ex('___ Frau arbeitet. (der/die/das)','Die','Frau — f → die'),
    ex('___ Kind spielt. (der/die/das)','Das','Kind — n → das'),
    ex('___ Leute warten. (der/die/das)','Die','Pl. → die'),
    ex('Mein___ Bruder kommt. (mein/meine/–)','Mein','Bruder — m, Nom.'),
  ]
};

CONTENT['pra_aus_verb'] = {
  zone:'present', tag:'Wortart', title:'Verb — Position 2',
  sub:'Глагол всегда на 2-й позиции',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'P1 (любой элемент) + Verb(P2) + остальное + [Satzklammer]',
    text:`<strong>V2-правило</strong> — фундаментальное правило немецкого языка.
<br>Финитный (изменяемый) глагол <em>всегда на 2-й позиции</em> в главном предложении.
<br><br>P1 может быть: Subjekt / Adverb / Objekt / Präp.-Phrase / Nebensatz.
<br><br><strong>Satzklammer (рамка):</strong> инфинитив, Partizip II, трennbare приставка — в конце.`,
    table:{head:['P1','P2 (Verb)','Mittelfeld','Satzende'],rows:[
      ['Ich','lerne','–','–'],
      ['Heute','lerne','ich','–'],
      ['Deutsch','lerne','ich','–'],
      ['Ich','lerne','gerne','–'],
      ['Ich','habe','gestern viel','gelernt.'],
      ['Ich','werde','morgen','lernen.'],
      ['Ich','mache','das Fenster','auf.'],
    ]}
  },
  examples:[
    sent('Heute lerne ich Deutsch.',
      [{w:'Heute',r:'Adv'},{w:'lerne',r:'V'},{w:'ich',r:'S'},{w:'Deutsch.',r:'Oa'}],
      'Сегодня я учу немецкий. (Adv. на P1)'),
    sent('Das Buch lese ich jeden Tag.',
      [{w:'Das Buch',r:'Oa'},{w:'lese',r:'V'},{w:'ich',r:'S'},{w:'jeden Tag.',r:'Adv'}],
      'Книгу я читаю каждый день. (Obj. на P1)'),
    sent('Ich mache das Fenster auf.',
      [{w:'Ich',r:'S'},{w:'mache',r:'V'},{w:'das Fenster',r:'Oa'},{w:'auf.',r:'V'}],
      'Я открываю окно. (Satzklammer: auf в конце)'),
  ],
  exercises:[
    ex('___ lerne ich. (Heute/Ich heute)','Heute','P1=Adv, Verb P2'),
    ex('Das Buch ___ ich jeden Tag. (lese/liest)','lese','ich → -e'),
    ex('Ich ___ das Fenster auf. (aufmachen → Präs.)','mache...auf','trennbar: mache P2, auf Ende'),
    ex('Ich ___ heute viel gearbeitet. (haben)','habe','Perf: habe P2, gearbeitet Ende'),
  ]
};

CONTENT['pra_aus_obj_a'] = {
  zone:'present', tag:'Wortart', title:'Akkusativ-Objekt',
  sub:'Прямое дополнение — кого? что?',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'wen? / was? → Akkusativ',
    text:`Прямое дополнение — то, на что непосредственно направлено действие.
<br><br><strong>Изменения артикля в Akkusativ:</strong>
<br>der → <strong>den</strong> (только m! остальные не меняются)
<br>die → die | das → das | Pl. die → die
<br>ein → einen (m), eine → eine (f), ein → ein (n)
<br><br><strong>Глаголы, требующие Akkusativ:</strong> sehen, hören, kaufen, essen, trinken, lesen, schreiben, lieben, kennen, finden, nehmen, brauchen, haben...`,
    table:{head:['Kasus','m','f','n','Pl.'],rows:[
      ['Nom.','der/ein','die/eine','das/ein','die/–'],
      ['Akk.','<b>den/einen</b>','die/eine','das/ein','die/–'],
    ]}
  },
  examples:[
    sent('Ich sehe den Mann.',
      [{w:'Ich',r:'S'},{w:'sehe',r:'V'},{w:'den Mann.',r:'Oa'}],
      'Я вижу мужчину. (der→den!)'),
    sent('Er kauft eine neue Jacke.',
      [{w:'Er',r:'S'},{w:'kauft',r:'V'},{w:'eine neue Jacke.',r:'Oa'}],
      'Он покупает новую куртку. (eine Nom=Akk у f)'),
    sent('Ich lese ein spannendes Buch.',
      [{w:'Ich',r:'S'},{w:'lese',r:'V'},{w:'ein spannendes Buch.',r:'Oa'}],
      'Я читаю увлекательную книгу. (ein Nom=Akk у n)'),
  ],
  exercises:[
    ex('Ich sehe ___ Mann. (den/die/das)','den','Akk.m: den'),
    ex('Er kauft ___ Buch. (den/die/das/ein)','das','Buch n, Akk.=das'),
    ex('Sie liebt ___ Kind. (das/den/die)','das','Kind n, Akk.=das'),
    ex('Ich brauche ein___ Stift. (einem/en/e)','en','Stift m, Akk.: einen'),
    ex('Kennst du ___ Frau? (die/der/den)','die','Frau f, Akk.=die'),
  ]
};

CONTENT['pra_aus_obj_d'] = {
  zone:'present', tag:'Wortart', title:'Dativ-Objekt',
  sub:'Косвенное дополнение — кому? чему?',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'wem? → Dativ',
    text:`Косвенное дополнение — кому предназначено действие.
<br><br><strong>Dativ-артикли:</strong>
<br>der → <strong>dem</strong> | die → <strong>der</strong> | das → <strong>dem</strong> | Pl. die → <strong>den</strong> (+n к сущ.)
<br>ein → einem | eine → einer | ein → einem
<br><br><strong>Глаголы с Dativ:</strong> geben, helfen, danken, gefallen, gehören, antworten, glauben, folgen, schreiben (an), zeigen, erklären...
<br><br><strong>Порядок:</strong> Dativ перед Akkusativ (при существительных).`,
    table:{head:['Kasus','m','f','n','Pl.'],rows:[
      ['Nom.','der','die','das','die'],
      ['Dat.','<b>dem</b>','<b>der</b>','<b>dem</b>','<b>den</b>(+n)'],
    ]}
  },
  examples:[
    sent('Ich helfe dem alten Mann.',
      [{w:'Ich',r:'S'},{w:'helfe',r:'V'},{w:'dem alten Mann.',r:'Od'}],
      'Я помогаю старому мужчине. (Dat.m=dem)'),
    sent('Er gibt der Lehrerin das Heft.',
      [{w:'Er',r:'S'},{w:'gibt',r:'V'},{w:'der Lehrerin',r:'Od'},{w:'das Heft.',r:'Oa'}],
      'Он даёт учительнице тетрадь. (Dat.f=der)'),
    sent('Das Buch gehört dem Kind.',
      [{w:'Das Buch',r:'S'},{w:'gehört',r:'V'},{w:'dem Kind.',r:'Od'}],
      'Книга принадлежит ребёнку. (Dat.n=dem)'),
  ],
  exercises:[
    ex('Ich helfe ___ Mann. (dem/den/der)','dem','Dat.m: dem'),
    ex('Er gibt ___ Frau das Buch. (die/der/dem)','der','Dat.f: der'),
    ex('Das Spielzeug gehört ___ Kind. (das/des/dem)','dem','Dat.n: dem'),
    ex('Ich danke mein___ Mutter. (em/er/en)','er','meine(r) Dat.f: meiner'),
    ex('Er schreibt ___ Freunden. (die/den/der)','den','Pl. Dat.: den (+n Freunden)'),
  ]
};

CONTENT['pra_aus_adv'] = {
  zone:'present', tag:'Wortart', title:'Adverbiale — TeKaMoLo',
  sub:'Обстоятельства и их порядок',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Te(mporal) → Ka(usal) → Mo(dal) → Lo(kal)',
    text:`Обстоятельства в Mittelfeld располагаются в порядке <strong>TeKaMoLo</strong>:
<br>① <strong>Te</strong>mporal — когда? (heute, morgen, jeden Tag, um 8 Uhr, seit 3 Jahren)
<br>② <strong>Ka</strong>usal — почему? (wegen des Wetters, aus Müdigkeit)
<br>③ <strong>Mo</strong>dal — как? (schnell, mit dem Bus, gerne, allein)
<br>④ <strong>Lo</strong>kal — где/куда? (in Berlin, nach Hause, hier)
<br><br>При нескольких обстоятельствах одного типа — более общее перед более конкретным.`,
    table:{head:['T (когда?)','K (почему?)','M (как?)','L (где/куда?)'],rows:[
      ['morgens','wegen der Arbeit','schnell','zur Schule'],
      ['jeden Tag','–','gerne','im Park'],
      ['um 8 Uhr','–','mit dem Zug','nach München'],
    ]}
  },
  examples:[
    sent('Er fährt jeden Morgen schnell mit dem Rad zur Arbeit.',
      [{w:'Er',r:'S'},{w:'fährt',r:'V'},{w:'jeden Morgen',r:'Adv'},{w:'schnell',r:'Adv'},{w:'mit dem Rad',r:'Adv'},{w:'zur Arbeit.',r:'Adv'}],
      'Он ездит каждое утро быстро на велосипеде на работу. (T→M→L)'),
    sent('Sie geht heute wegen der Kälte nicht nach draußen.',
      [{w:'Sie',r:'S'},{w:'geht',r:'V'},{w:'heute',r:'Adv'},{w:'wegen der Kälte',r:'Adv'},{w:'nicht',r:'N'},{w:'nach draußen.',r:'Adv'}],
      'Сегодня из-за холода она не выходит на улицу. (T→K→L)'),
  ],
  exercises:[
    ex('Правильный порядок: [in Berlin] [schnell] [morgens] → ?','morgens schnell in Berlin','T→M→L'),
    ex('Er fährt ___ (T: jeden Tag) ___ (M: mit dem Bus) ___ (L: zur Schule).','jeden Tag mit dem Bus zur Schule','T→M→L'),
    ex('Sie arbeitet ___ (T: jetzt) ___ (K: wegen des Projekts) ___ (M: intensiv).','jetzt wegen des Projekts intensiv','T→K→M'),
  ]
};

// ── FUTUR I → werden Konjugation ─────────────────────────────────
CONTENT['fut1_werden'] = {
  zone:'future', tag:'Wortart', title:'werden — Konjugation',
  sub:'Спряжение вспомогательного глагола werden',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'ich werde / du wirst / er wird / wir werden / ihr werdet / sie werden',
    text:`<strong>werden</strong> — многофункциональный глагол:
<br>① Вспомогательный для <em>Futur I</em> (werden + Inf.)
<br>② Вспомогательный для <em>Futur II</em> (werden + Part.II + haben/sein)
<br>③ Вспомогательный для <em>Passiv</em> (werden + Part.II)
<br>④ <em>Vollverb</em> — становиться: Er wird Arzt. (Он становится врачом.)
<br><br>Особые формы: du <strong>wirst</strong>, er <strong>wird</strong> (неправильные!).`,
    table:{head:['Person','werden','Futur I Beispiel'],rows:[
      ['ich','werde','Ich werde lernen.'],
      ['du','wirst','Du wirst lernen.'],
      ['er/sie/es','wird','Er wird lernen.'],
      ['wir','werden','Wir werden lernen.'],
      ['ihr','werdet','Ihr werdet lernen.'],
      ['sie/Sie','werden','Sie werden lernen.'],
    ]}
  },
  examples:[
    sent('Du wirst das schaffen!',
      [{w:'Du',r:'S'},{w:'wirst',r:'Aux'},{w:'das',r:'Oa'},{w:'schaffen!',r:'V'}],
      'Ты справишься!'),
    sent('Er wird Ingenieur werden.',
      [{w:'Er',r:'S'},{w:'wird',r:'Aux'},{w:'Ingenieur',r:'Oa'},{w:'werden.',r:'V'}],
      'Он станет инженером. (Vollverb: werden)'),
    sent('Ihr werdet das verstehen.',
      [{w:'Ihr',r:'S'},{w:'werdet',r:'Aux'},{w:'das',r:'Oa'},{w:'verstehen.',r:'V'}],
      'Вы это поймёте.'),
  ],
  exercises:[
    ex('du ___ (werden)','wirst','нерегулярно: wirst'),
    ex('er ___ (werden)','wird','нерегулярно: wird'),
    ex('wir ___ (werden)','werden','регулярно: werden'),
    ex('ihr ___ (werden)','werdet','ihr: werdet'),
    ex('ich ___ (werden)','werde','ich: werde'),
  ]
};

// ── VERB детали Level 3 ───────────────────────────────────────────
CONTENT['verb_schwach'] = {
  zone:'present', tag:'Wortart', title:'Schwache Verben',
  sub:'Слабые (правильные) глаголы',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Stamm + Endungen (регулярно во всех временах)',
    text:`Слабые глаголы не меняют корневую гласную. Präteritum: +te. Part.II: ge+Stamm+t.
<br><br>Особенности: если основа на <em>-d/-t/-m/-n (+ согласная)</em>, вставляется <em>-e-</em> перед окончанием: <em>arbeit→arbeitet, öffn→öffnet</em>.
<br><br>Глаголы на <em>-ieren</em>: Partizip II без ge-: <em>studieren→studiert, fotografieren→fotografiert</em>.`,
    table:{head:['Inf.','Präsens (er)','Präteritum (er)','Part.II'],rows:[
      ['lernen','lernt','lernte','gelernt'],
      ['kaufen','kauft','kaufte','gekauft'],
      ['wohnen','wohnt','wohnte','gewohnt'],
      ['arbeiten','arbeitet','arbeitete','gearbeitet'],
      ['öffnen','öffnet','öffnete','geöffnet'],
      ['studieren','studiert','studierte','studiert'],
      ['machen','macht','machte','gemacht'],
    ]}
  },
  examples:[
    sent('Er lernte gestern viel.',
      [{w:'Er',r:'S'},{w:'lernte',r:'V'},{w:'gestern',r:'Adv'},{w:'viel.',r:'Adv'}],
      'Он вчера много учился. (Prät.: lernte)'),
    sent('Sie hat ein Buch gekauft.',
      [{w:'Sie',r:'S'},{w:'hat',r:'Aux'},{w:'ein Buch',r:'Oa'},{w:'gekauft.',r:'V'}],
      'Она купила книгу. (Part.II: ge+kauf+t)'),
    sent('Er studiert Medizin.',
      [{w:'Er',r:'S'},{w:'studiert',r:'V'},{w:'Medizin.',r:'Oa'}],
      'Он изучает медицину. (-ieren: studiert)'),
  ],
  exercises:[
    ex('kaufen → Präteritum er','kaufte','kaufte'),
    ex('arbeiten → Präteritum er','arbeitete','основа на -t: arbeit+e+te'),
    ex('studieren → Part.II','studiert','-ieren: ohne ge-'),
    ex('wohnen → Part.II','gewohnt','ge+wohn+t'),
    ex('öffnen → Präsens ihr','öffnet','öffn+et (n+Konsonant: +e)'),
  ]
};

CONTENT['verb_stark'] = {
  zone:'present', tag:'Wortart', title:'Starke Verben',
  sub:'Сильные (неправильные) глаголы — Ablaut',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Ablaut: Präsens(e→ie/i, a→ä) | Prät.: новая основа | Part.II: ge+...+en',
    text:`Сильные глаголы меняют корневую гласную (Ablaut) в нескольких формах.
<br><br><strong>Ablaut-ряды (важнейшие):</strong>`,
    table:{head:['Infinitiv','Präs.2/3.Sg.','Präteritum','Part.II'],rows:[
      ['fahren','fährst/fährt','fuhr','gefahren'],
      ['tragen','trägst/trägt','trug','getragen'],
      ['laufen','läufst/läuft','lief','gelaufen'],
      ['lesen','liest/liest','las','gelesen'],
      ['sprechen','sprichst/spricht','sprach','gesprochen'],
      ['geben','gibst/gibt','gab','gegeben'],
      ['schreiben','–','schrieb','geschrieben'],
      ['gehen','–','ging','gegangen'],
      ['kommen','–','kam','gekommen'],
      ['sehen','siehst/sieht','sah','gesehen'],
      ['stehen','–','stand','gestanden'],
      ['treffen','triffst/trifft','traf','getroffen'],
    ]}
  },
  examples:[
    sent('Er spricht sehr gut Deutsch.',
      [{w:'Er',r:'S'},{w:'spricht',r:'V'},{w:'sehr gut',r:'Adv'},{w:'Deutsch.',r:'Oa'}],
      'Он очень хорошо говорит по-немецки. (e→i)'),
    sent('Sie las das Buch in einer Nacht.',
      [{w:'Sie',r:'S'},{w:'las',r:'V'},{w:'das Buch',r:'Oa'},{w:'in einer Nacht.',r:'Adv'}],
      'Она прочитала книгу за одну ночь. (Prät.: las)'),
  ],
  exercises:[
    ex('fahren → Präs. er','fährt','a→ä'),
    ex('lesen → Präs. du','liest','e→ie'),
    ex('sprechen → Prät. er','sprach','sprach'),
    ex('gehen → Part.II','gegangen','ge+gang+en'),
    ex('kommen → Prät. ich','kam','kam'),
    ex('sehen → Präs. er','sieht','e→ie'),
  ]
};

CONTENT['verb_modal'] = {
  zone:'present', tag:'Wortart', title:'Modalverben',
  sub:'Модальные глаголы — все формы',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Modal(P2) + ... + Infinitiv(Ende)',
    text:`Модальные глаголы выражают отношение к действию. В предложении: Modal на P2, инфинитив в конце.
<br><br><strong>Значения:</strong>
<br>• <em>können</em> — мочь, уметь (физическая/умственная способность)
<br>• <em>müssen</em> — должен (необходимость, обязанность)
<br>• <em>dürfen</em> — разрешено (разрешение/запрет)
<br>• <em>wollen</em> — хотеть (желание)
<br>• <em>sollen</em> — должен (чужое требование)
<br>• <em>mögen/möchten</em> — хотеть вежливо / любить`,
    table:{head:['','können','müssen','dürfen','wollen','sollen','möchten'],rows:[
      ['ich','kann','muss','darf','will','soll','möchte'],
      ['du','kannst','musst','darfst','willst','sollst','möchtest'],
      ['er/sie','kann','muss','darf','will','soll','möchte'],
      ['wir','können','müssen','dürfen','wollen','sollen','möchten'],
      ['ihr','könnt','müsst','dürft','wollt','sollt','möchtet'],
      ['sie/Sie','können','müssen','dürfen','wollen','sollen','möchten'],
    ]}
  },
  examples:[
    sent('Ich kann gut Deutsch sprechen.',
      [{w:'Ich',r:'S'},{w:'kann',r:'V'},{w:'gut',r:'Adv'},{w:'Deutsch',r:'Oa'},{w:'sprechen.',r:'V'}],
      'Я умею хорошо говорить по-немецки.'),
    sent('Du musst heute die Hausaufgaben machen.',
      [{w:'Du',r:'S'},{w:'musst',r:'V'},{w:'heute',r:'Adv'},{w:'die Hausaufgaben',r:'Oa'},{w:'machen.',r:'V'}],
      'Тебе нужно сегодня сделать домашнее задание.'),
    sent('Hier darf man nicht rauchen.',
      [{w:'Hier',r:'Adv'},{w:'darf',r:'V'},{w:'man',r:'S'},{w:'nicht',r:'N'},{w:'rauchen.',r:'V'}],
      'Здесь нельзя курить.'),
  ],
  exercises:[
    ex('Ich ___ (können) gut schwimmen.','kann','ich → kann'),
    ex('Er ___ (müssen) jetzt gehen.','muss','er → muss'),
    ex('Hier ___ (dürfen) man nicht rauchen.','darf','man → darf'),
    ex('Wir ___ (wollen) nach Berlin fahren.','wollen','wir → wollen'),
    ex('Du ___ (sollen) das nicht machen.','sollst','du → sollst'),
    ex('Ich ___ (möchten) einen Kaffee.','möchte','ich → möchte'),
  ]
};

CONTENT['verb_trenn'] = {
  zone:'present', tag:'Wortart', title:'Trennbare Verben',
  sub:'Отделяемые глаголы — Satzklammer',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Prefix(Ende) ... Verbstamm(P2) | Part.II: Präfix+ge+Stamm',
    text:`Отделяемые приставки: <em>an-, auf-, aus-, ein-, ab-, mit-, vor-, zu-, nach-, her-, hin-, zurück-</em> и др.
<br><br>В главном предложении: <strong>приставка уходит в конец</strong> (Satzklammer).
<br>В Partizip II: ge- вставляется между приставкой и основой: <em>aufmachen → aufgemacht</em>.
<br>В инфинитивных конструкциях: zu тоже вставляется: <em>aufzumachen</em>.
<br><br>Неотделяемые: be-, ver-, er-, ge-, ent-, emp-, miss- — всегда вместе с глаголом.`,
    table:{head:['Infinitiv','Präsens er','Präteritum er','Part.II','Infinitiv+zu'],rows:[
      ['aufmachen','macht auf','machte auf','aufgemacht','aufzumachen'],
      ['einkaufen','kauft ein','kaufte ein','eingekauft','einzukaufen'],
      ['anrufen','ruft an','rief an','angerufen','anzurufen'],
      ['aufstehen','steht auf','stand auf','aufgestanden','aufzustehen'],
      ['mitnehmen','nimmt mit','nahm mit','mitgenommen','mitzunehmen'],
      ['zurückkommen','kommt zurück','kam zurück','zurückgekommen','zurückzukommen'],
    ]}
  },
  examples:[
    sent('Er macht das Fenster auf.',
      [{w:'Er',r:'S'},{w:'macht',r:'V'},{w:'das Fenster',r:'Oa'},{w:'auf.',r:'V'}],
      'Он открывает окно. (auf = в конце)'),
    sent('Ich stehe jeden Morgen um 7 auf.',
      [{w:'Ich',r:'S'},{w:'stehe',r:'V'},{w:'jeden Morgen',r:'Adv'},{w:'um 7',r:'Adv'},{w:'auf.',r:'V'}],
      'Я встаю каждое утро в 7. (aufstehen)'),
    sent('Sie hat gestern eingekauft.',
      [{w:'Sie',r:'S'},{w:'hat',r:'Aux'},{w:'gestern',r:'Adv'},{w:'eingekauft.',r:'V'}],
      'Она вчера ходила за покупками. (Part.II: ein+ge+kauf+t)'),
  ],
  exercises:[
    ex('aufmachen → Präs. er','macht auf','Stamm P2, Präfix Ende'),
    ex('anrufen → Part.II','angerufen','an+ge+ruf+en'),
    ex('einkaufen → Part.II','eingekauft','ein+ge+kauf+t'),
    ex('aufstehen → Inf.+zu','aufzustehen','auf+zu+stehen'),
    ex('mitnehmen → Prät. er','nahm mit','stark: nehm→nahm, mit am Ende'),
  ]
};

CONTENT['verb_refl'] = {
  zone:'present', tag:'Wortart', title:'Reflexive Verben',
  sub:'Возвратные глаголы с sich',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'sich(Akk./Dat.) + Verb | Perfekt: immer haben',
    text:`Возвратные глаголы используют местоимение <strong>sich</strong> (Reflexivpronomen).
<br><br><strong>Reflexivpronomen Akkusativ:</strong>
<br>ich mich / du dich / er/sie/es sich / wir uns / ihr euch / sie/Sie sich
<br><br><strong>Reflexivpronomen Dativ</strong> (когда есть другой Akk.-объект):
<br>ich mir / du dir / er/sie sich / wir uns / ihr euch
<br><br>Perfekt: всегда с <strong>haben</strong>!`,
    table:{head:['Infinitiv','Bedeutung','Beispiel Präsens'],rows:[
      ['sich freuen','радоваться','Ich freue mich.'],
      ['sich fühlen','чувствовать себя','Er fühlt sich wohl.'],
      ['sich waschen','умываться','Ich wasche mich.'],
      ['sich anziehen','одеваться','Sie zieht sich an.'],
      ['sich erinnern (an)','помнить','Ich erinnere mich an dich.'],
      ['sich vorstellen','представляться','Er stellt sich vor.'],
      ['sich kaufen (Dat.)','покупать себе','Ich kaufe mir ein Buch.'],
    ]}
  },
  examples:[
    sent('Ich freue mich auf den Urlaub.',
      [{w:'Ich',r:'S'},{w:'freue',r:'V'},{w:'mich',r:'Oa'},{w:'auf den Urlaub.',r:'Adv'}],
      'Я радуюсь отпуску. (sich freuen auf)'),
    sent('Er hat sich das neue Handy gekauft.',
      [{w:'Er',r:'S'},{w:'hat',r:'Aux'},{w:'sich',r:'Od'},{w:'das neue Handy',r:'Oa'},{w:'gekauft.',r:'V'}],
      'Он купил себе новый телефон. (Dat. sich, Akk. Handy)'),
    sent('Sie zieht sich schnell an.',
      [{w:'Sie',r:'S'},{w:'zieht',r:'V'},{w:'sich',r:'Oa'},{w:'schnell',r:'Adv'},{w:'an.',r:'V'}],
      'Она быстро одевается. (trennbar + reflexiv)'),
  ],
  exercises:[
    ex('Ich freue ___ (ich, Akk.Refl.)','mich','ich → mich'),
    ex('Er fühlt ___ gut. (er, Akk.Refl.)','sich','er → sich'),
    ex('Wir freuen ___ auf das Fest.','uns','wir → uns'),
    ex('Ich kaufe ___ (Dat.Refl.) ein Buch.','mir','Dat: ich → mir'),
    ex('Er hat ___ (Perf.) gut gefühlt.','sich','sich + haben'),
  ]
};

// ── NOMEN детали Level 3 ─────────────────────────────────────────
CONTENT['nom_genus'] = {
  zone:'present', tag:'Wortart', title:'Genus — der/die/das',
  sub:'Определение рода существительного',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Typische Endungen als Hilfe — aber Ausnahmen beachten!',
    text:`Род (Genus) — одна из сложнейших тем. Некоторые суффиксы помогают определить род:
<br><br><strong>der</strong> (m): -er, -ling, -ig, -ismus, -or, -ant, дни/месяцы/времена года, стороны света.
<br><strong>die</strong> (f): -ung, -heit, -keit, -schaft, -tion, -tät, -ik, -ie, -enz, -anz, -ur, большинство на -e.
<br><strong>das</strong> (n): -chen, -lein, -ment, -nis, -tum, -um, -ing (заимств.), Infinitiv как сущ.`,
    table:{head:['der (m)','die (f)','das (n)'],rows:[
      ['der Lehrer','die Lehrerin','das Mädchen (-chen!)'],
      ['der Frühling (-ling)','die Zeitung (-ung)','das Dokument (-ment)'],
      ['der Januar (Monat)','die Freiheit (-heit)','das Laufen (Inf.)'],
      ['der Norden (Himmelsrichtung)','die Gesellschaft (-schaft)','das Zentrum (-um)'],
      ['der Optimismus (-ismus)','die Situation (-tion)','das Ergebnis (-nis)'],
    ]}
  },
  examples:[
    sent('Der Frühling ist meine Lieblingszeit.',
      [{w:'Der Frühling',r:'S'},{w:'ist',r:'V'},{w:'meine Lieblingszeit.',r:'Adj'}],
      'Весна — моё любимое время года. (Monat/Jahreszeit → der)'),
    sent('Die Freiheit ist sehr wichtig.',
      [{w:'Die Freiheit',r:'S'},{w:'ist',r:'V'},{w:'sehr wichtig.',r:'Adj'}],
      'Свобода очень важна. (-heit → die)'),
    sent('Das Mädchen spielt im Garten.',
      [{w:'Das Mädchen',r:'S'},{w:'spielt',r:'V'},{w:'im Garten.',r:'Adv'}],
      'Девочка играет в саду. (-chen → das!)'),
  ],
  exercises:[
    ex('___ Zeitung (der/die/das)','Die','-ung → die'),
    ex('___ Mädchen (der/die/das)','Das','-chen → das'),
    ex('___ Frühling (der/die/das)','Der','Jahreszeit → der'),
    ex('___ Freiheit (der/die/das)','Die','-heit → die'),
    ex('___ Dokument (der/die/das)','Das','-ment → das'),
    ex('___ Lehrerin (der/die/das)','Die','-in → die (Personen f.)'),
  ]
};

CONTENT['nom_plural'] = {
  zone:'present', tag:'Wortart', title:'Plural — Mehrzahl',
  sub:'Множественное число существительных',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'5 основных типов + Umlaut (запоминать!)',
    text:`Множественное число в немецком — нужно учить с каждым словом. 5 типов:
<br>① <strong>-e</strong> (часто m): der Tag→Tage, der Beruf→Berufe
<br>② <strong>-er</strong> (часто n, +Umlaut): das Kind→Kinder, das Haus→Häuser
<br>③ <strong>-(e)n</strong> (часто f): die Frau→Frauen, die Zeitung→Zeitungen
<br>④ <strong>-s</strong> (заимств.): das Auto→Autos, das Hotel→Hotels
<br>⑤ <strong>без окончания</strong> (±Umlaut): der Lehrer→Lehrer, der Vater→Väter`,
    table:{head:['Singular','Plural','Тип'],rows:[
      ['der Tag','die Tage','-e'],
      ['das Kind','die Kinder','-er'],
      ['das Haus','die Häuser','-er + Umlaut'],
      ['die Frau','die Frauen','-en'],
      ['die Zeitung','die Zeitungen','-en'],
      ['das Auto','die Autos','-s'],
      ['der Lehrer','die Lehrer','– (без окончания)'],
      ['der Vater','die Väter','– + Umlaut'],
      ['der Mann','die Männer','-er + Umlaut'],
    ]}
  },
  examples:[
    sent('Die Kinder spielen im Park.',
      [{w:'Die Kinder',r:'S'},{w:'spielen',r:'V'},{w:'im Park.',r:'Adv'}],
      'Дети играют в парке. (Kind → Kinder)'),
    sent('Die Frauen lesen Zeitungen.',
      [{w:'Die Frauen',r:'S'},{w:'lesen',r:'V'},{w:'Zeitungen.',r:'Oa'}],
      'Женщины читают газеты.'),
  ],
  exercises:[
    ex('Tag → Plural','Tage','-e'),
    ex('Kind → Plural','Kinder','-er'),
    ex('Haus → Plural','Häuser','-er + Umlaut'),
    ex('Frau → Plural','Frauen','-en'),
    ex('Auto → Plural','Autos','-s'),
    ex('Vater → Plural','Väter','– + Umlaut'),
  ]
};

CONTENT['nom_kasus'] = {
  zone:'present', tag:'Wortart', title:'4 Kasus — Überblick',
  sub:'Все 4 падежа — полная таблица',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Nom.(wer?) · Akk.(wen/was?) · Dat.(wem?) · Gen.(wessen?)',
    text:`<strong>Сводная таблица артиклей по падежам:</strong>`,
    table:{head:['Kasus','m (der)','f (die)','n (das)','Pl. (die)','Frage'],rows:[
      ['Nom.','der / ein','die / eine','das / ein','die / –','wer/was?'],
      ['Akk.','den / einen','die / eine','das / ein','die / –','wen/was?'],
      ['Dat.','dem / einem','der / einer','dem / einem','den / –','wem?'],
      ['Gen.','des / eines','der / einer','des / eines','der / –','wessen?'],
    ]}
  },
  examples:[
    sent('Der Mann (Nom.) gibt dem Kind (Dat.) das Buch (Akk.) des Lehrers (Gen.).',
      [{w:'Der Mann',r:'S'},{w:'gibt',r:'V'},{w:'dem Kind',r:'Od'},{w:'das Buch',r:'Oa'},{w:'des Lehrers.',r:'Adj'}],
      'Мужчина даёт ребёнку книгу учителя. (все 4 падежа)'),
    sent('Ich helfe dem alten Mann.',
      [{w:'Ich',r:'S'},{w:'helfe',r:'V'},{w:'dem alten Mann.',r:'Od'}],
      'Я помогаю старому мужчине. (Dat.)'),
  ],
  exercises:[
    ex('___ Mann (Nom.m)','Der','Nom.m: der'),
    ex('Ich sehe ___ Mann. (Akk.m)','den','Akk.m: den'),
    ex('Ich helfe ___ Mann. (Dat.m)','dem','Dat.m: dem'),
    ex('Das Buch ___ Mannes (Gen.m)','des','Gen.m: des'),
    ex('Ich sehe ___ Frau. (Akk.f)','die','Akk.f: die'),
    ex('Ich helfe ___ Frau. (Dat.f)','der','Dat.f: der'),
  ]
};

CONTENT['nom_gen'] = {
  zone:'present', tag:'Wortart', title:'Genitiv',
  sub:'Родительный падеж — принадлежность',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'wessen? → Gen. | m/n: +(e)s к Nomen | f/Pl.: без изменений',
    text:`Genitiv выражает принадлежность ("чей?") и используется после ряда предлогов.
<br><br><strong>Артикли Genitiv:</strong> des/eines (m/n) · der/einer (f) · der (Pl.)
<br><strong>Склонение Nomen:</strong> m и n добавляют -(e)s: <em>des Mannes, des Kindes</em>.
<br><br><strong>Предлоги с Genitiv:</strong> wegen, trotz, während, aufgrund, statt, innerhalb, außerhalb.
<br><br>В разговорной речи Genitiv часто заменяется на <em>von + Dativ</em>.`,
    table:{head:['','m','f','n','Pl.'],rows:[
      ['best.Art.','des Mann-es','der Frau','des Kind-es','der Leute'],
      ['unbest.Art.','eines Mann-es','einer Frau','eines Kind-es','– Leute'],
      ['Possessiv','meines Mannes','meiner Frau','meines Kindes','meiner Leute'],
    ]}
  },
  examples:[
    sent('Das Buch des Lehrers ist interessant.',
      [{w:'Das Buch',r:'S'},{w:'des Lehrers',r:'Adj'},{w:'ist',r:'V'},{w:'interessant.',r:'Adj'}],
      'Книга учителя интересная. (des Lehrers = Gen.m)'),
    sent('Wegen des schlechten Wetters bleiben wir zu Hause.',
      [{w:'Wegen des schlechten Wetters',r:'Adv'},{w:'bleiben',r:'V'},{w:'wir',r:'S'},{w:'zu Hause.',r:'Adv'}],
      'Из-за плохой погоды мы остаёмся дома. (wegen+Gen.)'),
    sent('Die Tasche meiner Mutter ist neu.',
      [{w:'Die Tasche',r:'S'},{w:'meiner Mutter',r:'Adj'},{w:'ist',r:'V'},{w:'neu.',r:'Adj'}],
      'Сумка моей мамы новая. (Gen.f)'),
  ],
  exercises:[
    ex('Das Buch ___ Lehrers (Gen.m, best.Art.)','des','Gen.m: des'),
    ex('Die Tasche ___ Frau (Gen.f, best.Art.)','der','Gen.f: der'),
    ex('___ schlechten Wetters (wegen + Gen.n)','des','Gen.n: des'),
    ex('Das Haus mein___ Vaters (Gen.m, Poss.)','es','meines Vaters'),
    ex('trotz ___ Regens (Gen.m, best.Art.)','des','trotz+Gen: des Regens'),
  ]
};

// ── PERFEKT Level 3 ───────────────────────────────────────────────
CONTENT['pf_haben_trans'] = {
  zone:'past', tag:'Struktur', title:'Transitive haben-Verben',
  sub:'Переходные глаголы — всегда haben',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'haben + Part.II (переходные = с Akk.-Objekt)',
    text:`Переходные глаголы принимают прямое дополнение (Akkusativ). Они всегда образуют Perfekt с <strong>haben</strong>.
<br><br>Список 50 важнейших переходных глаголов с haben:`,
    table:{head:['Infinitiv','Part.II','Bedeutung'],rows:[
      ['kaufen','gekauft','покупать'],
      ['sehen','gesehen','видеть'],
      ['hören','gehört','слышать'],
      ['lesen','gelesen','читать'],
      ['schreiben','geschrieben','писать'],
      ['essen','gegessen','есть'],
      ['trinken','getrunken','пить'],
      ['nehmen','genommen','брать'],
      ['geben','gegeben','давать'],
      ['finden','gefunden','находить'],
      ['kennen','gekannt','знать (человека)'],
      ['verstehen','verstanden','понимать'],
      ['lieben','geliebt','любить'],
      ['brauchen','gebraucht','нуждаться'],
    ]}
  },
  examples:[
    sent('Ich habe das Buch gelesen.',
      [{w:'Ich',r:'S'},{w:'habe',r:'Aux'},{w:'das Buch',r:'Oa'},{w:'gelesen.',r:'V'}],
      'Я прочитал книгу.'),
    sent('Er hat seinen Freund gesehen.',
      [{w:'Er',r:'S'},{w:'hat',r:'Aux'},{w:'seinen Freund',r:'Oa'},{w:'gesehen.',r:'V'}],
      'Он видел своего друга.'),
  ],
  exercises:[
    ex('kaufen → Part.II','gekauft','ge+kauf+t'),
    ex('verstehen → Part.II','verstanden','nicht-trennbar: ohne ge-'),
    ex('Ich habe das Buch ___ (lesen).','gelesen','ge+les+en'),
    ex('Er hat das Geld ___ (nehmen).','genommen','ge+nomm+en'),
  ]
};

CONTENT['pf_haben_refl'] = {
  zone:'past', tag:'Struktur', title:'Reflexive Verben im Perfekt',
  sub:'Возвратные глаголы — всегда haben',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'sich + haben + Part.II',
    text:'Все возвратные глаголы образуют Perfekt с haben, независимо от значения движения или состояния.',
    table:{head:['Infinitiv','Perfekt Beispiel'],rows:[
      ['sich freuen','Ich habe mich gefreut.'],
      ['sich fühlen','Er hat sich gut gefühlt.'],
      ['sich waschen','Sie hat sich gewaschen.'],
      ['sich anziehen','Ich habe mich angezogen.'],
      ['sich erinnern','Wir haben uns erinnert.'],
      ['sich vorstellen','Er hat sich vorgestellt.'],
    ]}
  },
  examples:[
    sent('Ich habe mich sehr gefreut.',
      [{w:'Ich',r:'S'},{w:'habe',r:'Aux'},{w:'mich',r:'Oa'},{w:'sehr',r:'Adv'},{w:'gefreut.',r:'V'}],
      'Я очень обрадовался.'),
    sent('Er hat sich das neue Auto gekauft.',
      [{w:'Er',r:'S'},{w:'hat',r:'Aux'},{w:'sich',r:'Od'},{w:'das neue Auto',r:'Oa'},{w:'gekauft.',r:'V'}],
      'Он купил себе новую машину.'),
  ],
  exercises:[
    ex('Ich ___ mich gefreut. (habe/bin)','habe','reflexiv → haben'),
    ex('Er ___ sich gewaschen. (hat/ist)','hat','reflexiv → haben'),
    ex('sich freuen → Part.II','gefreut','ge+freu+t'),
  ]
};

CONTENT['pf_haben_modal'] = {
  zone:'past', tag:'Struktur', title:'Modalverben im Perfekt',
  sub:'Модальные глаголы — Ersatzinfinitiv',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'haben + Infinitiv + Infinitiv (Ersatzinfinitiv!)',
    text:`Когда модальный глагол используется с инфинитивом смыслового глагола, Partizip II заменяется инфинитивом (Ersatzinfinitiv).
<br><br><em>Ich habe kommen <strong>müssen</strong></em>. (НЕ gemusst!)
<br><br>Без смыслового глагола — обычный Part.II: <em>Ich habe das <strong>gewollt</strong></em>.`,
    table:{head:['Modal','Part.II (ohne Vollverb)','Ersatzinfinitiv (mit Vollverb)'],rows:[
      ['können','gekonnt','... kommen können'],
      ['müssen','gemusst','... lernen müssen'],
      ['dürfen','gedurft','... gehen dürfen'],
      ['wollen','gewollt','... arbeiten wollen'],
      ['sollen','gesollt','... helfen sollen'],
    ]}
  },
  examples:[
    sent('Ich habe heute arbeiten müssen.',
      [{w:'Ich',r:'S'},{w:'habe',r:'Aux'},{w:'heute',r:'Adv'},{w:'arbeiten',r:'V'},{w:'müssen.',r:'V'}],
      'Мне сегодня нужно было работать. (Ersatzinfinitiv)'),
    sent('Er hat das nicht gewollt.',
      [{w:'Er',r:'S'},{w:'hat',r:'Aux'},{w:'das',r:'Oa'},{w:'nicht',r:'N'},{w:'gewollt.',r:'V'}],
      'Он этого не хотел. (Part.II ohne Vollverb)'),
  ],
  exercises:[
    ex('Ich habe kommen ___ (können → Ersatzinf.)','können','Ersatzinfinitiv!'),
    ex('Er hat das ___ (wollen → kein Vollverb → Part.II)','gewollt','gewollt'),
    ex('Wir haben früh aufstehen ___ (müssen → Ersatzinf.)','müssen','müssen'),
  ]
};

// ── PRÄTERITUM Level 3 ───────────────────────────────────────────
CONTENT['prat_aus_schwach'] = {
  zone:'past', tag:'Struktur', title:'Präteritum Schwach — Satz',
  sub:'Слабые глаголы в предложениях Präteritum',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + Stamm+te(P2) + ... | bei -d/-t: Stamm+ete',
    text:'Schwache Verben im Präteritum: Stamm + -te + Personalendung. Утвердительные, отрицательные и вопросительные предложения.',
    table:{head:['Person','arbeiten','wohnen','kaufen','lernen'],rows:[
      ['ich','arbeitete','wohnte','kaufte','lernte'],
      ['du','arbeitetest','wohntest','kauftest','lerntest'],
      ['er/sie/es','arbeitete','wohnte','kaufte','lernte'],
      ['wir','arbeiteten','wohnten','kauften','lernten'],
      ['ihr','arbeitetet','wohntet','kauftet','lerntet'],
      ['sie/Sie','arbeiteten','wohnten','kauften','lernten'],
    ]}
  },
  examples:[
    sent('Sie wohnte früher in Wien.',
      [{w:'Sie',r:'S'},{w:'wohnte',r:'V'},{w:'früher',r:'Adv'},{w:'in Wien.',r:'Adv'}],
      'Раньше она жила в Вене.'),
    sent('Arbeitete er damals viel?',
      [{w:'Arbeitete',r:'V'},{w:'er',r:'S'},{w:'damals',r:'Adv'},{w:'viel?',r:'Adv'}],
      'Работал ли он тогда много? (Frage)'),
    sent('Er kaufte kein Auto.',
      [{w:'Er',r:'S'},{w:'kaufte',r:'V'},{w:'kein',r:'N'},{w:'Auto.',r:'Oa'}],
      'Он не покупал машину. (Negation)'),
  ],
  exercises:[
    ex('Sie ___ in München. (wohnen → Prät.)','wohnte','wohn+te'),
    ex('Ich ___ gestern viel. (arbeiten → Prät.)','arbeitete','arbeit+e+te'),
    ex('___ er viel? (lernen → Prät., Frage)','Lernte','V1: lernte'),
    ex('Er ___ kein Auto. (kaufen → Prät.)','kaufte','kauf+te'),
  ]
};

CONTENT['prat_aus_stark'] = {
  zone:'past', tag:'Struktur', title:'Präteritum Stark — Satz',
  sub:'Сильные глаголы в предложениях Präteritum',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + Ablaut-Stamm(P2) + ... [ich/er без Endung]',
    text:'Сильные глаголы: новый Ablaut-Stamm. ich и er/sie/es без окончания. Вопрос: Ablaut-Stamm на P1.',
    table:{head:['Inf.','Prät.-Stamm','ich/er','du','wir/sie'],rows:[
      ['gehen','ging-','ging','gingst','gingen'],
      ['kommen','kam-','kam','kamst','kamen'],
      ['fahren','fuhr-','fuhr','fuhrst','fuhren'],
      ['sehen','sah-','sah','sahst','sahen'],
      ['schreiben','schrieb-','schrieb','schriebst','schrieben'],
      ['sprechen','sprach-','sprach','sprachst','sprachen'],
      ['geben','gab-','gab','gabst','gaben'],
      ['stehen','stand-','stand','standst','standen'],
    ]}
  },
  examples:[
    sent('Er ging jeden Abend spazieren.',
      [{w:'Er',r:'S'},{w:'ging',r:'V'},{w:'jeden Abend',r:'Adv'},{w:'spazieren.',r:'V'}],
      'Он каждый вечер ходил гулять.'),
    sent('Wohin fuhr er im Sommer?',
      [{w:'Wohin',r:'Adv'},{w:'fuhr',r:'V'},{w:'er',r:'S'},{w:'im Sommer?',r:'Adv'}],
      'Куда он ехал летом? (W-Frage)'),
    sent('Sie sprach kein Englisch.',
      [{w:'Sie',r:'S'},{w:'sprach',r:'V'},{w:'kein',r:'N'},{w:'Englisch.',r:'Oa'}],
      'Она не говорила по-английски.'),
  ],
  exercises:[
    ex('Er ___ nach Hause. (gehen → Prät.)','ging','gehen→ging'),
    ex('___ er nach Berlin? (fahren → Prät., Frage)','Fuhr','V1: fuhr'),
    ex('Sie ___ kein Englisch. (sprechen → Prät.)','sprach','sprechen→sprach'),
    ex('Wir ___ lange. (stehen → Prät.)','standen','steh→stand+en'),
  ]
};

CONTENT['prat_aus_modal'] = {
  zone:'past', tag:'Struktur', title:'Modalverben Präteritum — Satz',
  sub:'Модальные в составе предложений',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Modal-Prät.(P2) + ... + Infinitiv(Ende)',
    text:'Модальные в Präteritum: потеря умлаута + -te. Инфинитив смыслового глагола в конце.',
    table:{head:['Aussage','Frage','Negation'],rows:[
      ['Er konnte schlafen.','Konnte er schlafen?','Er konnte nicht schlafen.'],
      ['Ich musste arbeiten.','Musste ich arbeiten?','Ich musste nicht arbeiten.'],
      ['Sie wollte fahren.','Wollte sie fahren?','Sie wollte nicht fahren.'],
    ]}
  },
  examples:[
    sent('Er konnte nicht schlafen, weil er Stress hatte.',
      [{w:'Er',r:'S'},{w:'konnte',r:'V'},{w:'nicht',r:'N'},{w:'schlafen,',r:'V'},{w:'weil er Stress hatte.',r:'Adv'}],
      'Он не мог спать, потому что был под стрессом.'),
    sent('Musstest du früh aufstehen?',
      [{w:'Musstest',r:'V'},{w:'du',r:'S'},{w:'früh',r:'Adv'},{w:'aufstehen?',r:'V'}],
      'Тебе нужно было рано вставать?'),
  ],
  exercises:[
    ex('Er ___ nicht kommen. (können → Prät.)','konnte','können→konnte'),
    ex('___ du früh aufstehen? (müssen → Prät., Frage)','Musstest','du: musstest'),
    ex('Wir ___ nicht fahren. (dürfen → Prät., Neg.)','durften','dürfen→durften'),
  ]
};

CONTENT['prat_aus_inv'] = {
  zone:'past', tag:'Struktur', title:'Präteritum — Inversion',
  sub:'Инверсия в повествовательном тексте',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Adv./Zeit + Verb-Prät.(P2) + Subjekt + ...',
    text:'В нарративных текстах часто используется инверсия для создания разнообразия и акцента. Любой элемент кроме глагола может стоять на P1.',
    table:{head:['P1','P2 (Prät.)','Subjekt','Rest'],rows:[
      ['Plötzlich','erschien','er','in der Tür.'],
      ['Am nächsten Morgen','fuhr','sie','nach Hause.'],
      ['Ohne Abschied','verschwand','er','in der Nacht.'],
      ['Lange Zeit','arbeitete','er','als Lehrer.'],
    ]}
  },
  examples:[
    sent('Plötzlich erschien ein fremder Mann.',
      [{w:'Plötzlich',r:'Adv'},{w:'erschien',r:'V'},{w:'ein fremder Mann.',r:'S'}],
      'Вдруг появился незнакомый мужчина.'),
    sent('Am nächsten Morgen fuhr sie nach Hause.',
      [{w:'Am nächsten Morgen',r:'Adv'},{w:'fuhr',r:'V'},{w:'sie',r:'S'},{w:'nach Hause.',r:'Adv'}],
      'На следующее утро она уехала домой.'),
  ],
  exercises:[
    ex('___ kam er nach Hause. (Plötzlich/Er plötzlich)','Plötzlich','P1=Adv, V2'),
    ex('Am Morgen ___ sie auf. (aufstehen → Prät.)','stand','aufstehen→stand...auf, trennbar'),
    ex('Lange Zeit ___ er in Berlin. (leben → Prät.)','lebte','schwach: leb+te'),
  ]
};

// ── PERFEKT Level 3 Satz ─────────────────────────────────────────
CONTENT['pf_aus_haben'] = {
  zone:'past', tag:'Struktur', title:'Perfekt mit haben — Satz',
  sub:'Построение предложений с haben-Perfekt',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + habe/hat(P2) + [Obj.+Adv.] + Part.II(Ende)',
    text:'haben конъюгируется и стоит на P2. Part.II в конце (Satzklammer). Отрицание: nicht vor Part.II.',
    table:{head:['Satztyp','Struktur','Beispiel'],rows:[
      ['Aussage','S + hat + Obj. + Part.II','Er hat das Buch gelesen.'],
      ['Inversion','Adv. + hat + S + Part.II','Heute hat er gearbeitet.'],
      ['Frage Ja/Nein','Hat + S + ... + Part.II?','Hat er geschlafen?'],
      ['W-Frage','W + hat + S + ... + Part.II?','Was hat er gemacht?'],
      ['Negation','hat + ... + nicht + Part.II','Er hat nicht geschlafen.'],
    ]}
  },
  examples:[
    sent('Heute hat er den ganzen Tag gearbeitet.',
      [{w:'Heute',r:'Adv'},{w:'hat',r:'Aux'},{w:'er',r:'S'},{w:'den ganzen Tag',r:'Adv'},{w:'gearbeitet.',r:'V'}],
      'Сегодня он работал весь день. (инверсия)'),
    sent('Hat sie das Buch nicht gelesen?',
      [{w:'Hat',r:'Aux'},{w:'sie',r:'S'},{w:'das Buch',r:'Oa'},{w:'nicht',r:'N'},{w:'gelesen?',r:'V'}],
      'Разве она не читала книгу? (Frage + Neg.)'),
  ],
  exercises:[
    ex('Heute ___ er viel gelernt. (haben)','hat','er → hat'),
    ex('___ du das gemacht? (Frage)','Hast','Ja/Nein-Frage: Hast du...?'),
    ex('Er hat das ___ gelesen. (nicht/kein)','nicht','глагол → nicht'),
    ex('Was ___ du gestern gemacht?','hast','W-Frage: hast du'),
  ]
};

CONTENT['pf_aus_sein'] = {
  zone:'past', tag:'Struktur', title:'Perfekt mit sein — Satz',
  sub:'Построение предложений с sein-Perfekt',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'S + bin/ist(P2) + [Adv.] + Part.II(Ende)',
    text:'sein конъюгируется и стоит на P2. Глаголы bewegung/Zustandswechsel/bleiben/sein.',
    table:{head:['Satztyp','Struktur','Beispiel'],rows:[
      ['Aussage','S + ist + Adv. + Part.II','Er ist nach Berlin gefahren.'],
      ['Frage','Ist + S + ... + Part.II?','Ist sie schon gegangen?'],
      ['W-Frage','Wo + ist + S + Part.II?','Wohin bist du gefahren?'],
      ['Negation','ist + ... + nicht + Part.II','Er ist nicht gekommen.'],
    ]}
  },
  examples:[
    sent('Er ist gestern Abend spät nach Hause gekommen.',
      [{w:'Er',r:'S'},{w:'ist',r:'Aux'},{w:'gestern Abend',r:'Adv'},{w:'spät',r:'Adv'},{w:'nach Hause',r:'Adv'},{w:'gekommen.',r:'V'}],
      'Вчера вечером он пришёл домой поздно.'),
    sent('Wohin bist du gefahren?',
      [{w:'Wohin',r:'Adv'},{w:'bist',r:'Aux'},{w:'du',r:'S'},{w:'gefahren?',r:'V'}],
      'Куда ты ездил?'),
  ],
  exercises:[
    ex('Er ___ nach Berlin gefahren. (sein)','ist','er → ist'),
    ex('___ du schon gegangen? (Frage)','Bist','Bist du...?'),
    ex('Wohin ___ sie geflogen?','ist','sie (она) → ist'),
    ex('Er ___ nicht angekommen.','ist','sein-Verb + nicht'),
  ]
};

CONTENT['pf_aus_modal'] = {
  zone:'past', tag:'Struktur', title:'Modal + Perfekt im Satz',
  sub:'Модальные + инфинитив в Perfekt',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'habe/hat + Inf.(Vollverb) + Inf.(Modal) — двойной инфинитив в конце',
    text:'С модальным и смысловым глаголом: два инфинитива в конце (Doppelinfintiv). Порядок: Vollverb-Inf. → Modal-Inf.',
    table:{head:['Richtig','Falsch'],rows:[
      ['Ich habe kommen müssen.','✗ Ich habe gemusst kommen.'],
      ['Er hat arbeiten wollen.','✗ Er hat gewollt arbeiten.'],
      ['Wir haben fahren können.','✗ Wir haben gekonnt fahren.'],
    ]}
  },
  examples:[
    sent('Ich habe gestern lange arbeiten müssen.',
      [{w:'Ich',r:'S'},{w:'habe',r:'Aux'},{w:'gestern',r:'Adv'},{w:'lange',r:'Adv'},{w:'arbeiten',r:'V'},{w:'müssen.',r:'V'}],
      'Мне вчера долго нужно было работать.'),
    sent('Hat er kommen können?',
      [{w:'Hat',r:'Aux'},{w:'er',r:'S'},{w:'kommen',r:'V'},{w:'können?',r:'V'}],
      'Он смог прийти?'),
  ],
  exercises:[
    ex('Ich habe kommen ___ (müssen → Ersatzinf.)','müssen','Дoppelinfnitiv: kommen müssen'),
    ex('Er hat nicht schlafen ___ (können → Ersatzinf.)','können','können'),
    ex('___ sie fahren wollen? (Frage, haben)','Hat','Hat sie...wollen?'),
  ]
};

CONTENT['pf_aus_trenn'] = {
  zone:'past', tag:'Struktur', title:'Trennbare Verben im Perfekt',
  sub:'Отделяемые глаголы в Perfekt',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'haben/sein + Präfix+ge+Stamm+t/en (alles zusammen am Ende)',
    text:'В Partizip II отделяемая приставка остаётся на месте: ge- вставляется между приставкой и основой. В предложении весь Part.II уходит в конец.',
    table:{head:['Infinitiv','Part.II','Perfekt-Satz'],rows:[
      ['aufmachen','aufgemacht','Er hat die Tür aufgemacht.'],
      ['einkaufen','eingekauft','Ich habe eingekauft.'],
      ['anrufen','angerufen','Sie hat mich angerufen.'],
      ['aufstehen','aufgestanden','Ich bin aufgestanden.'],
      ['einschlafen','eingeschlafen','Das Kind ist eingeschlafen.'],
      ['zurückkommen','zurückgekommen','Er ist zurückgekommen.'],
    ]}
  },
  examples:[
    sent('Er hat das Fenster aufgemacht.',
      [{w:'Er',r:'S'},{w:'hat',r:'Aux'},{w:'das Fenster',r:'Oa'},{w:'aufgemacht.',r:'V'}],
      'Он открыл окно. (auf+ge+mach+t)'),
    sent('Das Kind ist schnell eingeschlafen.',
      [{w:'Das Kind',r:'S'},{w:'ist',r:'Aux'},{w:'schnell',r:'Adv'},{w:'eingeschlafen.',r:'V'}],
      'Ребёнок быстро заснул. (ein+ge+schlaf+en)'),
  ],
  exercises:[
    ex('aufmachen → Part.II','aufgemacht','auf+ge+mach+t'),
    ex('einschlafen → Part.II','eingeschlafen','ein+ge+schlaf+en'),
    ex('Er ___ das Fenster aufgemacht. (haben)','hat','transitiv → haben'),
    ex('Ich ___ aufgestanden. (sein)','bin','aufstehen → sein'),
    ex('zurückkommen → Part.II','zurückgekommen','zurück+ge+komm+en'),
  ]
};

// ── SATZBAU CONTENT ───────────────────────────────────────────────
CONTENT['satzbau'] = {
  zone:'syntax', tag:'Syntax', title:'Satzbau',
  sub:'Структура немецкого предложения',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'P1 + Verb(P2) + Subj? + Mittelfeld(TeKaMoLo) + [Satzklammer]',
    text:`<strong>Goldene Regeln:</strong><br>① V2-Prinzip: Verb immer P2<br>② Satzklammer: Aux/Modal P2 → Inf./Part.II Ende<br>③ TeKaMoLo: T→K→M→L im Mittelfeld<br>④ Verb-Letzt im Nebensatz<br>⑤ Pronomen vor Nomen`,
    table:{head:['Prinzip','Beispiel'],rows:[
      ['V2','Heute lerne ich Deutsch.'],['Satzklammer','Ich habe gestern viel gearbeitet.'],
      ['TeKaMoLo','Er fährt morgens aus Gewohnheit schnell nach Hause.'],
      ['Verb-Letzt','..., weil ich Deutsch lerne.'],['Pron vor Nomen','Er hat es dem Mann gegeben.'],
    ]}},
  examples:[sent('Trotzdem hat er gestern aus Müdigkeit langsam nach Hause gefahren.',
    [{w:'Trotzdem',r:'S'},{w:'hat',r:'V'},{w:'er',r:'S'},{w:'gestern',r:'Adv'},{w:'aus Müdigkeit',r:'Adv'},{w:'langsam',r:'Adv'},{w:'nach Hause',r:'Adv'},{w:'gefahren.',r:'V'}],
    'P1=Trotzdem→Inversion; T→K→M→L')],
  exercises:[ex('[Heute] ___ ich Deutsch. (lernen)','lerne','V2'),ex('..., weil er krank ___.','ist','Verb-Letzt'),ex('Er ___ es ___ gegeben. (ihm, haben, Perf.)','hat / ihm','Pron.Dat im MF')]
};
CONTENT['sb_v2'] = {
  zone:'syntax', tag:'Syntax', title:'V2 — Verb an 2. Stelle',
  sub:'Глагол всегда на второй позиции',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'P1(любой) + Verb(P2) + [Subj.] + ...',
    text:'Финитный глагол в HS всегда на P2 — независимо от P1.',
    table:{head:['P1','Verb','Rest'],rows:[
      ['Ich','lerne','Deutsch.'],['Deutsch','lerne','ich.'],
      ['Heute','lerne','ich Deutsch.'],['Obwohl er müde ist,','kommt','er trotzdem.'],
    ]}},
  examples:[sent('Obwohl es regnet, gehen wir spazieren.',
    [{w:'Obwohl es regnet,',r:'S'},{w:'gehen',r:'V'},{w:'wir',r:'S'},{w:'spazieren.',r:'Adv'}],
    'NS als P1 → Inversion')],
  exercises:[ex('Jeden Tag ___ ich Deutsch. (lernen)','lerne','Inversion'),
    ex('Obwohl er müde ist, ___ er weiter. (arbeiten)','arbeitet','NS P1'),
    ex('Am Morgen ___ sie auf. (aufstehen Prät.)','stand','Inversion+trennbar')]
};
CONTENT['sb_klammer'] = {
  zone:'syntax', tag:'Syntax', title:'Satzklammer',
  sub:'Рамочная конструкция',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Aux/Modal(P2) + Mittelfeld + Inf./Part.II/Präfix(Ende)',
    table:{head:['Тип','Links','Rechts'],rows:[
      ['Perfekt','hat','gelesen'],['Futur I','wird','lernen'],
      ['Modal','kann','kommen'],['Trennbar','macht...','auf'],
      ['Modal+Perf.','hat','arbeiten müssen'],
    ]}},
  examples:[sent('Er hat das Buch trotz Müdigkeit bis spät gelesen.',
    [{w:'Er',r:'S'},{w:'hat',r:'V'},{w:'das Buch',r:'Oa'},{w:'trotz Müdigkeit',r:'Adv'},{w:'bis spät',r:'Adv'},{w:'gelesen.',r:'V'}],
    'Langer Mittelfeld')],
  exercises:[ex('Er ___ gearbeitet. (haben, Perf.)','hat','hat P2'),
    ex('Ich ___ das Fenster ___. (aufmachen Präs.)','mache / auf','trennbar'),
    ex('Er ___ nicht kommen ___. (können, Perf. Ersatzinf.)','hat / können','hat...kommen können')]
};
CONTENT['sb_mittelfeld'] = {
  zone:'syntax', tag:'Syntax', title:'Mittelfeld',
  sub:'Порядок элементов в серединном поле',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'PRON-Akk. > PRON-Dat. > NOM-Dat. > NOM-Akk.',
    table:{head:['Ситуация','Richtig','Falsch'],rows:[
      ['2 Pron.','Er hat es ihr gegeben.','Er hat ihr es gegeben.'],
      ['Pron+Nomen','Er hat es dem Mann gegeben.','Er hat dem Mann es gegeben.'],
      ['2 Nomen','Er gibt dem Kind das Buch.','Er gibt das Buch dem Kind.'],
    ]}},
  examples:[sent('Sie hat es ihm gegeben.',
    [{w:'Sie',r:'S'},{w:'hat',r:'V'},{w:'es',r:'Oa'},{w:'ihm',r:'Od'},{w:'gegeben.',r:'V'}],
    'Akk.Pron(es) vor Dat.Pron(ihm)')],
  exercises:[ex('Richtige Reihenfolge: hat/er/dem Mann/es → ','Er hat es dem Mann gegeben.','Pron.Akk vor Nom.Dat'),
    ex('Ich habe ___ ___ gegeben. (ihr=Dat.Pron, das Buch=Akk.)','ihr das Buch','Dat.Pron+Akk.Nomen'),
    ex('Er hat ___ ___ gegeben. (ihm, es)','es ihm','Akk.Pron vor Dat.Pron')]
};
CONTENT['sb_tekamolo'] = {
  zone:'syntax', tag:'Syntax', title:'TeKaMoLo',
  sub:'Temporal → Kausal → Modal → Lokal',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'T(когда?) → K(почему?) → M(как?) → L(где/куда?)',
    table:{head:['T','K','M','L'],rows:[
      ['morgens','aus Gewohnheit','schnell','zur Arbeit'],
      ['gestern','–','mit dem Zug','nach München'],
    ]}},
  examples:[sent('Er fährt jeden Morgen wegen der Arbeit schnell nach Berlin.',
    [{w:'Er',r:'S'},{w:'fährt',r:'V'},{w:'jeden Morgen',r:'Adv'},{w:'wegen der Arbeit',r:'Adv'},{w:'schnell',r:'Adv'},{w:'nach Berlin.',r:'Adv'}],
    'T→K→M→L')],
  exercises:[ex('Правильный порядок: im Büro / täglich / konzentriert → ','täglich konzentriert im Büro','T→M→L'),
    ex('Er arbeitet ___ (T:gestern) ___ (M:fleißig) ___ (L:zu Hause).','gestern fleißig zu Hause','T→M→L')]
};
CONTENT['sb_inversion'] = {
  zone:'syntax', tag:'Syntax', title:'Inversion',
  sub:'Инверсия — любой элемент на P1',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Adv./Obj./NS(P1) + Verb(P2) + Subj. + ...',
    table:{head:['P1','Beispiel'],rows:[
      ['Adverb','Gestern habe ich gearbeitet.'],['Objekt','Das Buch habe ich gelesen.'],
      ['Nebensatz','Weil er krank war, blieb er.'],['Konjunktionaladv.','Deshalb bin ich gekommen.'],
    ]}},
  examples:[sent('Das Buch habe ich schon zweimal gelesen.',
    [{w:'Das Buch',r:'S'},{w:'habe',r:'V'},{w:'ich',r:'S'},{w:'schon zweimal',r:'Adv'},{w:'gelesen.',r:'V'}],
    'Топикализация Akk.-Obj.')],
  exercises:[ex('Поставь "Gestern" на P1: ___ habe ich gearbeitet.','Gestern','Inversion'),
    ex('Weil er müde war, ___ er früh ___.  (gehen, Perf.)','ist er / gegangen','NS P1→Inversion'),
    ex('Deshalb ___ ich nicht gekommen.','bin','Deshalb+Inversion')]
};
CONTENT['sb_fragesatz'] = {
  zone:'syntax', tag:'Syntax', title:'Fragesätze',
  sub:'Все типы вопросов',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Ja/Nein: V1+S? | W-Frage: W+V2+S? | Indirekt: ob/W+...+V-Letzt',
    table:{head:['W-Wort','Kasus','Beispiel'],rows:[
      ['wer','Nom.','Wer kommt?'],['wen','Akk.','Wen siehst du?'],
      ['wem','Dat.','Wem hilfst du?'],['wessen','Gen.','Wessen Auto ist das?'],
      ['warum/weshalb','Kausal','Warum lernst du?'],['welch-','Auswahl','Welches Buch?'],
    ]}},
  examples:[sent('Kannst du mir sagen, warum er nicht gekommen ist?',
    [{w:'Kannst du mir sagen,',r:'S'},{w:'warum',r:'V'},{w:'er',r:'S'},{w:'nicht',r:'N'},{w:'gekommen ist?',r:'V'}],
    'Ind.Frage → Verb-Letzt')],
  exercises:[ex('___ gibst du das Buch? (кому?)','Wem','Dat.→Wem'),
    ex('Ich weiß nicht, ___ er kommt.','ob','ob für Ja/Nein'),
    ex('Kannst du sagen, warum er nicht ___ ___? (kommen, Perf.)','gekommen ist','Verb-Letzt')]
};
CONTENT['sb_negation'] = {
  zone:'syntax', tag:'Syntax', title:'Negation',
  sub:'Отрицание — nicht, kein и другие',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'nicht (Verb/Adj/Adv/Präp) | kein- (Nomen) | nie/niemand/nichts',
    table:{head:['Mittel','Gegenteil','Beispiel'],rows:[
      ['nicht','ja','Er kommt nicht.'],['kein/keine','ein/eine','Ich habe keine Zeit.'],
      ['nie','immer','Er kommt nie.'],['niemand','jemand','Niemand war da.'],
      ['weder...noch','sowohl...als auch','weder Kaffee noch Tee'],
    ]}},
  examples:[sent('Er hat das Buch nicht gelesen, weil er keine Zeit hatte.',
    [{w:'Er',r:'S'},{w:'hat',r:'V'},{w:'das Buch',r:'Oa'},{w:'nicht',r:'N'},{w:'gelesen.',r:'V'}],
    'nicht + kein')],
  exercises:[ex('Ich habe das ___ gemacht. (nicht/kein)','nicht','Verb→nicht'),
    ex('Ich habe ___ Auto.','kein','Nomen→kein'),
    ex('Er wohnt ___ in Berlin.','nicht','Präp.-Gruppe→nicht'),
    ex('___ hat angerufen.','Niemand','niemand als Subj.')]
};
CONTENT['sb_valenz'] = {
  zone:'syntax', tag:'C1-Syntax', title:'Valenz & Rektion',
  sub:'Управление глаголов',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Verb → feste Kasus/Präp.',
    table:{head:['Verb+Präp.','Kasus','Beispiel'],rows:[
      ['helfen','+Dat.','Er hilft dem Mann.'],['warten auf','+Akk.','Ich warte auf dich.'],
      ['denken an','+Akk.','Ich denke an dich.'],['abhängen von','+Dat.','Es hängt davon ab.'],
      ['sich erinnern an','+Akk.','Ich erinnere mich daran.'],['bitten um','+Akk.','Ich bitte um Hilfe.'],
    ]}},
  examples:[sent('Er wartet seit einer Stunde auf seine Freundin.',
    [{w:'Er',r:'S'},{w:'wartet',r:'V'},{w:'seit einer Stunde',r:'Adv'},{w:'auf seine Freundin.',r:'Adv'}],
    'warten auf + Akk.')],
  exercises:[ex('warten ___ + Akk.','auf','auf'),ex('abhängen ___ + Dat.','von','von'),
    ex('Es hängt von ___ (du, Dat.) ab.','dir','von+Dat.: dir'),
    ex('Ich bitte ___ (du) ___ Hilfe.','dich um','bitten um+Akk.')]
};

// ── VERBLEHRE CONTENT ────────────────────────────────────────────
CONTENT['verblehre'] = {
  zone:'present', tag:'Verblehre', title:'Verblehre',
  sub:'Система немецких глаголов',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'schwach · stark · Modal · trennbar · untrennbar · reflexiv · Passiv',
    table:{head:['Тип','Merkmal','Inf.→Prät.→Part.II'],rows:[
      ['Schwach','регулярный','lernen→lernte→gelernt'],['Stark','Ablaut','fahren→fuhr→gefahren'],
      ['Trennbar','Präfix trennt','aufmachen→machte auf→aufgemacht'],
      ['Untrennbar','Präfix bleibt','besuchen→besuchte→besucht'],
    ]}},
  examples:[sent('Er hat das Fenster aufgemacht.',
    [{w:'Er',r:'S'},{w:'hat',r:'V'},{w:'das Fenster',r:'Oa'},{w:'aufgemacht.',r:'V'}],
    'trennbar: auf+ge+mach+t')],
  exercises:[ex('lernen → Part.II','gelernt','ge+lern+t'),ex('fahren → Prät.er','fuhr','Ablaut'),
    ex('aufmachen → Part.II','aufgemacht','auf+ge+mach+t'),ex('besuchen → Part.II','besucht','untrennbar: kein ge-')]
};
CONTENT['vl_schwach'] = {
  zone:'present', tag:'Verb', title:'Schwache Verben',
  sub:'Слабые (правильные) глаголы',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Prät.: Stamm+te | Part.II: ge+Stamm+t | -ieren: kein ge-',
    table:{head:['Inf.','Präs.er','Prät.er','Part.II'],rows:[
      ['lernen','lernt','lernte','gelernt'],['kaufen','kauft','kaufte','gekauft'],
      ['arbeiten','arbeitet','arbeitete','gearbeitet'],['studieren','studiert','studierte','studiert'],
    ]}},
  examples:[sent('Er hat gestern das Auto gekauft.',
    [{w:'Er',r:'S'},{w:'hat',r:'V'},{w:'gestern',r:'Adv'},{w:'das Auto',r:'Oa'},{w:'gekauft.',r:'V'}],
    'ge+kauf+t')],
  exercises:[ex('kaufen → Prät.er','kaufte','kauf+te'),ex('arbeiten → Prät.er','arbeitete','arbeit+e+te'),
    ex('studieren → Part.II','studiert','-ieren: kein ge-'),ex('machen → Part.II','gemacht','ge+mach+t')]
};
CONTENT['vl_stark'] = {
  zone:'present', tag:'Verb', title:'Starke Verben',
  sub:'Сильные глаголы — таблица Ablaut',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Präs.2/3Sg.: Ablaut | Prät.: Ablaut-Stamm | Part.II: ge+Ablaut+en',
    table:{head:['Inf.','Präs.er','Prät.er','Part.II'],rows:[
      ['fahren','fährt','fuhr','gefahren'],['gehen','geht','ging','gegangen'],
      ['kommen','kommt','kam','gekommen'],['sprechen','spricht','sprach','gesprochen'],
      ['lesen','liest','las','gelesen'],['schreiben','schreibt','schrieb','geschrieben'],
      ['sehen','sieht','sah','gesehen'],['geben','gibt','gab','gegeben'],
      ['nehmen','nimmt','nahm','genommen'],['finden','findet','fand','gefunden'],
      ['treffen','trifft','traf','getroffen'],['helfen','hilft','half','geholfen'],
    ]}},
  examples:[sent('Er sprach sehr gut Deutsch.',
    [{w:'Er',r:'S'},{w:'sprach',r:'V'},{w:'sehr gut',r:'Adv'},{w:'Deutsch.',r:'Oa'}],
    'e→i(e) Präs., Prät.: sprach')],
  exercises:[ex('fahren → Prät.er','fuhr','fuhr'),ex('gehen → Part.II','gegangen','gegangen'),
    ex('nehmen → Präs.er','nimmt','nimmt'),ex('helfen → Präs.er','hilft','e→i'),
    ex('finden → Part.II','gefunden','gefunden')]
};
CONTENT['vl_modal'] = {
  zone:'present', tag:'Verb', title:'Modalverben',
  sub:'Полная система модальных глаголов',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Modal(P2) + ... + Inf.(Ende) | ich/er gleich! | Prät.: kein Umlaut+te',
    table:{head:['','können','müssen','dürfen','wollen','sollen','möchten'],rows:[
      ['ich','kann','muss','darf','will','soll','möchte'],
      ['du','kannst','musst','darfst','willst','sollst','möchtest'],
      ['er','kann','muss','darf','will','soll','möchte'],
      ['Prät.er','konnte','musste','durfte','wollte','sollte','mochte'],
      ['Konj.II er','könnte','müsste','dürfte','wollte','sollte','möchte'],
    ]}},
  examples:[sent('Hier darf man nicht rauchen.',
    [{w:'Hier',r:'Adv'},{w:'darf',r:'V'},{w:'man',r:'S'},{w:'nicht',r:'N'},{w:'rauchen.',r:'V'}],
    'dürfen neg. = Verbot')],
  exercises:[ex('Ich ___ (können) gut schwimmen.','kann','ich→kann'),
    ex('können → Prät.er','konnte','konnte'),ex('dürfen → Konj.II er','dürfte','Umlaut: dürfte'),
    ex('möchten → Prät.er','mochte','mochte (nicht möchte!)')]
};
CONTENT['vl_trenn'] = {
  zone:'present', tag:'Verb', title:'Trennbare Verben',
  sub:'Отделяемые глаголы',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Präfix am Ende | Part.II: Präfix+ge+Stamm | Inf.+zu: Präfix+zu+Inf.',
    table:{head:['Inf.','Präs.er','Part.II','Inf.+zu'],rows:[
      ['aufmachen','macht auf','aufgemacht','aufzumachen'],
      ['einkaufen','kauft ein','eingekauft','einzukaufen'],
      ['anrufen','ruft an','angerufen','anzurufen'],
      ['aufstehen','steht auf','aufgestanden','aufzustehen'],
      ['zurückkommen','kommt zurück','zurückgekommen','zurückzukommen'],
    ]}},
  examples:[sent('Sie hat gestern eingekauft.',
    [{w:'Sie',r:'S'},{w:'hat',r:'V'},{w:'gestern',r:'Adv'},{w:'eingekauft.',r:'V'}],
    'ein+ge+kauf+t')],
  exercises:[ex('aufmachen → Part.II','aufgemacht','auf+ge+mach+t'),
    ex('anrufen → Part.II','angerufen','an+ge+ruf+en'),
    ex('einkaufen → Inf.+zu','einzukaufen','ein+zu+kaufen'),
    ex('mitnehmen → Prät.er','nahm mit','stark: nahm...mit')]
};
CONTENT['vl_refl'] = {
  zone:'present', tag:'Verb', title:'Reflexive Verben',
  sub:'Возвратные глаголы с sich',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'sich(Akk.) | mir/dir/sich(Dat.) wenn Akk.Obj. vorhanden | Perf.: immer haben',
    table:{head:['Inf.','ich','er'],rows:[
      ['sich freuen','freue mich','freut sich'],['sich fühlen','fühle mich','fühlt sich'],
      ['sich kaufen (Dat.)','kaufe mir','kauft sich'],
    ]}},
  examples:[sent('Ich habe mir das neue Buch gekauft.',
    [{w:'Ich',r:'S'},{w:'habe',r:'V'},{w:'mir',r:'Od'},{w:'das neue Buch',r:'Oa'},{w:'gekauft.',r:'V'}],
    'Dat.Refl.(mir) + Akk.Obj.')],
  exercises:[ex('Ich freue ___ (ich, Akk.)','mich','ich→mich'),
    ex('Er fühlt ___ gut.','sich','er→sich'),
    ex('Ich kaufe ___ (Dat.ich) ein Buch.','mir','Dat.Refl: mir')]
};
CONTENT['vl_untrenn'] = {
  zone:'present', tag:'Verb', title:'Untrennbare Verben',
  sub:'Неотделяемые приставки — kein ge-',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'be-/ver-/er-/ge-/ent-/emp-/miss-/zer- → kein ge- im Part.II',
    table:{head:['Inf.','Part.II','Bedeutung'],rows:[
      ['besuchen','besucht','посещать'],['verstehen','verstanden','понимать'],
      ['erklären','erklärt','объяснять'],['vergessen','vergessen','забывать'],
      ['bekommen','bekommen','получать'],['entscheiden','entschieden','решать'],
    ]}},
  examples:[sent('Er hat das Problem gut erklärt.',
    [{w:'Er',r:'S'},{w:'hat',r:'V'},{w:'das Problem',r:'Oa'},{w:'gut',r:'Adv'},{w:'erklärt.',r:'V'}],
    'er- untrennbar: kein ge-')],
  exercises:[ex('besuchen → Part.II','besucht','kein ge-'),
    ex('verstehen → Part.II','verstanden','kein ge-'),ex('vergessen → Prät.er','vergaß','stark+kein ge-')]
};
CONTENT['vl_passiv'] = {
  zone:'present', tag:'Passiv', title:'Passiv',
  sub:'Страдательный залог',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Vorgangspassiv: werden+Part.II | Zustandspassiv: sein+Part.II',
    table:{head:['Zeit','Vorgangspassiv'],rows:[
      ['Präsens','wird gemacht'],['Präteritum','wurde gemacht'],
      ['Perfekt','ist gemacht worden'],['Modal','muss gemacht werden'],
    ]}},
  examples:[sent('Das Haus wird gerade gebaut.',
    [{w:'Das Haus',r:'S'},{w:'wird',r:'V'},{w:'gerade',r:'Adv'},{w:'gebaut.',r:'V'}],
    'Vorgangspassiv Präsens')],
  exercises:[ex('Das Haus ___ gebaut. (Präsens)','wird','wird+Part.II'),
    ex('Das Haus ___ gebaut. (Prät.)','wurde','wurde+Part.II'),
    ex('Das Haus ___ gebaut ___. (Perfekt)','ist / worden','ist...worden!'),
    ex('Das muss gemacht ___. ','werden','Modal+Passiv: werden Ende')]
};
CONTENT['vl_praepobj'] = {
  zone:'present', tag:'Verb', title:'Präpositionalobjekte',
  sub:'Глагольное управление с предлогами',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Verb+feste Präp.+Kasus → Pronominaladverb: da(r)+Präp.',
    table:{head:['Verb+Präp.','Kasus','Pronominaladv.'],rows:[
      ['warten auf','Akk.','darauf'],['denken an','Akk.','daran'],
      ['sprechen über','Akk.','darüber'],['abhängen von','Dat.','davon'],
      ['sich kümmern um','Akk.','darum'],['hoffen auf','Akk.','darauf'],
    ]}},
  examples:[sent('Er denkt oft an seine Kindheit. Er denkt oft daran.',
    [{w:'an seine Kindheit',r:'Adv'},{w:'→ daran',r:'N'}],
    'Sache: an → daran')],
  exercises:[ex('Ich warte ___ (auf das Ergebnis)','darauf','auf+Sache=darauf'),
    ex('___ hängt das ab? (wovon?)','Wovon','von+Sache=wovon?'),
    ex('Ich kümmere mich ___ (um das Problem)','darum','um+Sache=darum')]
};
CONTENT['vm_bedeutung'] = {
  zone:'present', tag:'Modal', title:'Modalverben — Bedeutungen',
  sub:'Объективное и субъективное употребление',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Objektiv: Fähigkeit/Notw./Erlaubnis | Subjektiv: Vermutung/Gerücht',
    table:{head:['Modal','Objektiv','Subjektiv'],rows:[
      ['müssen','Er muss arbeiten.','Er muss krank sein. (должно быть)'],
      ['können','Er kann schwimmen.','Das kann stimmen. (возможно)'],
      ['sollen','Du sollst kommen.','Er soll reich sein. (говорят)'],
    ]}},
  examples:[sent('Er muss sehr müde sein.',
    [{w:'Er muss',r:'V'},{w:'sehr müde sein.',r:'Adj'}],
    'субъективное müssen')],
  exercises:[ex('"Er muss krank sein" — это?','субъективное предположение','subj.'),
    ex('"Er soll reich sein" — это?','Gerücht (говорят)','sollen subj.'),
    ex('Das ___ stimmen. (möglicherweise, können)','kann','kann=vielleicht')]
};
CONTENT['vm_praesens'] = {
  zone:'present', tag:'Modal', title:'Modalverben Präsens+Prät.',
  sub:'Спряжение модальных глаголов',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'ich/er gleich! | Sg.: ohne -e-Endung | Prät.: kein Umlaut+te',
    table:{head:['','können','müssen','dürfen','wollen','sollen'],rows:[
      ['ich','kann','muss','darf','will','soll'],
      ['er','kann','muss','darf','will','soll'],
      ['wir','können','müssen','dürfen','wollen','sollen'],
      ['Prät.er','konnte','musste','durfte','wollte','sollte'],
    ]}},
  examples:[],
  exercises:[ex('Er ___ (dürfen) das nicht.','darf','er→darf'),
    ex('dürfen → Prät.wir','durften','durften'),ex('wollen → Prät.er','wollte','wollte')]
};
CONTENT['vm_konjunktiv'] = {
  zone:'present', tag:'Modal', title:'Modalverben Konj.II',
  sub:'Модальные в сослагательном наклонении',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'könnte/müsste/dürfte (Umlaut) | wollte/sollte (kein Umlaut)',
    table:{head:['Modal','Konj.II','Bedeutung'],rows:[
      ['können','könnte','мог бы / возможно'],['müssen','müsste','должен был бы'],
      ['dürfen','dürfte','вероятно / мог бы'],
    ]}},
  examples:[sent('Das müsste eigentlich funktionieren.',
    [{w:'Das',r:'S'},{w:'müsste',r:'V'},{w:'funktionieren.',r:'V'}],
    'müsste = должно бы было')],
  exercises:[ex('Das ___ klappen. (können Konj.II)','könnte','könnte'),
    ex('müssen → Konj.II er','müsste','müsste')]
};
CONTENT['vm_subjektiv'] = {
  zone:'present', tag:'Modal', title:'Subjektive Modalität C1',
  sub:'Предположения о прошлом — Infinitiv II',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Modal + Inf.II(=Part.II+haben/sein) = Vermutung Vergangenheit',
    table:{head:['Aussage','Bedeutung'],rows:[
      ['Er muss krank gewesen sein.','Он, должно быть, был болен.'],
      ['Das kann gestimmt haben.','Это, возможно, было верным.'],
    ]}},
  examples:[sent('Er muss das schon gewusst haben.',
    [{w:'Er muss',r:'V'},{w:'das gewusst haben.',r:'V'}],
    'Inf.II: gewusst haben')],
  exercises:[ex('Er muss das ___ ___ . (wissen, Inf.II Verg.)','gewusst haben','Part.II+haben'),
    ex('Sie muss ___ ___ . (kommen, sein-Verb)','gekommen sein','Part.II+sein')]
};

// ── NOMENLEHRE CONTENT ────────────────────────────────────────────
CONTENT['nomenlehre'] = {
  zone:'special', tag:'Nomen', title:'Nomen + Adjektiv',
  sub:'Существительные и прилагательные',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Genus(3) · Kasus(4) · Plural(5) · Adj.Dekl.(3 Typen)',
    table:{head:['Thema','Kurzregel'],rows:[
      ['Genus','der/die/das — суффиксы'],['4 Kasus','Nom./Akk./Dat./Gen.'],
      ['Plural','5 типов: -e/-er/-en/-s/∅'],['Adj.schwach','после def.Art.: -e/sonst -en'],
      ['Adj.stark','без арт.: Adj. несёт сигнал'],
    ]}},
  examples:[sent('Ein alter Mann gibt dem kleinen Kind das rote Buch.',
    [{w:'Ein alter Mann',r:'S'},{w:'gibt',r:'V'},{w:'dem kleinen Kind',r:'Od'},{w:'das rote Buch.',r:'Oa'}],
    'Gem.+Schw.+Schw.')],
  exercises:[ex('ein jung___ Mann (Nom.m, gem.)','er','-er'),
    ex('der alt___ Frau (Dat.f, schwach)','en','-en')]
};
CONTENT['nl_genus'] = {
  zone:'special', tag:'Nomen', title:'Genus',
  sub:'Род существительного — суффиксы',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'der(-er/-ling/-ismus) | die(-ung/-heit/-keit/-schaft/-tion) | das(-chen/-lein/-ment/-um)',
    table:{head:['der (m)','die (f)','das (n)'],rows:[
      ['-er/-ling','-ung/-heit/-keit','-chen/-lein'],
      ['-ismus/-ant','-schaft/-tion/-tät','-ment/-um'],
      ['Wochentage/-Jahreszeiten','-ik/-ie/-enz','-Inf. als Subst.'],
    ]},text:'Ausnahmen: das Mädchen (-chen!), die Butter'},
  examples:[],
  exercises:[ex('___ Zeitung','Die','-ung→die'),ex('___ Mädchen','Das','-chen→das!'),
    ex('___ Freiheit','Die','-heit→die'),ex('___ Optimismus','Der','-ismus→der')]
};
CONTENT['nl_plural'] = {
  zone:'special', tag:'Nomen', title:'Plural',
  sub:'Множественное число — 5 типов',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'5 Typen: -e · -er · -(e)n · -s · ∅ (±Umlaut)',
    table:{head:['Тип','Beispiele'],rows:[
      ['-e','Tag→Tage, Stuhl→Stühle(+Umlaut)'],['-er','Kind→Kinder, Haus→Häuser'],
      ['-(e)n','Frau→Frauen, Zeitung→Zeitungen'],['-s','Auto→Autos'],['∅','Lehrer→Lehrer, Vater→Väter'],
    ]}},
  examples:[],
  exercises:[ex('Tag → Pl.','Tage','-e'),ex('Kind → Pl.','Kinder','-er'),
    ex('Frau → Pl.','Frauen','-en'),ex('Mutter → Pl.','Mütter','∅+Umlaut')]
};
CONTENT['nl_kasus4'] = {
  zone:'special', tag:'Nomen', title:'4 Kasus',
  sub:'Все 4 падежа — полная таблица',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Nom.(wer?) · Akk.(wen?) · Dat.(wem?) · Gen.(wessen?)',
    table:{head:['Kasus','m','f','n','Pl.'],rows:[
      ['Nom.','der/ein','die/eine','das/ein','die/–'],
      ['Akk.','den/einen','die/eine','das/ein','die/–'],
      ['Dat.','dem/einem','der/einer','dem/einem','den/–'],
      ['Gen.','des/eines','der/einer','des/eines','der/–'],
    ]}},
  examples:[],
  exercises:[ex('Ich sehe ___ Mann (Akk.m)','den','den'),
    ex('Ich helfe ___ Frau (Dat.f)','der','der'),ex('Das Auto ___ Mannes (Gen.m)','des','des')]
};
CONTENT['nl_adj_dekl'] = {
  zone:'special', tag:'Adjektiv', title:'Adjektivdeklination',
  sub:'3 Typen — schwach / gemischt / stark',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Schwach(def.): Nom.Sg.-e, sonst -en | Gem.(indef.): wo kein Signal→stark | Stark(kein Art.)',
    table:{head:['Kasus','Schwach m','Gemischt m','Stark m'],rows:[
      ['Nom.','-e (der alte)','-er (ein alter)','alter'],
      ['Akk.','-en (den alten)','-en (einen alten)','alten'],
      ['Dat.','-en','-en','altem'],['Gen.','-en','-en','alten'],
    ]}},
  examples:[sent('Der alte Mann trifft einen alten Freund.',
    [{w:'Der alte Mann',r:'S'},{w:'trifft',r:'V'},{w:'einen alten Freund.',r:'Oa'}],
    'Schwach Nom.m(-e) | Gemischt Akk.m(-en)')],
  exercises:[ex('der alt___ Mann (Nom.m, schwach)','e','-e'),
    ex('ein alt___ Mann (Nom.m, gem.)','er','-er'),ex('mit dem alt___ Mann (Dat.m, schwach)','en','-en'),
    ex('ein klein___ Kind (Nom.n, gem.)','es','-es'),ex('gut___ Wein (Nom.m, stark, kein Art.)','er','-er')]
};
CONTENT['adj_schwach'] = {
  zone:'special', tag:'Adjektiv', title:'Schwache Deklination',
  sub:'После определённого артикля',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Nom.Sg.: -e | alle anderen: -en',
    table:{head:['','m','f','n','Pl.'],rows:[
      ['Nom.','-e','-e','-e','-en'],['Akk.','-en','-e','-e','-en'],
      ['Dat.','-en','-en','-en','-en'],['Gen.','-en','-en','-en','-en'],
    ]},text:'Nach: der/die/das, dieser, welcher, jeder, mancher.'},
  examples:[],
  exercises:[ex('der jung___ Mann (Nom.m)','e','-e'),ex('die jung___ Frau (Akk.f)','e','-e'),
    ex('dem alt___ Kind (Dat.n)','en','-en'),ex('die klein___ Kinder (Nom.Pl.)','en','-en Pl.')]
};
CONTENT['adj_stark'] = {
  zone:'special', tag:'Adjektiv', title:'Starke Deklination',
  sub:'Без артикля — прилагательное несёт падежный сигнал',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Endung = was der Artikel tragen würde',
    table:{head:['','m','f','n','Pl.'],rows:[
      ['Nom.','-er','-e','-es','-e'],['Akk.','-en','-e','-es','-e'],
      ['Dat.','-em','-er','-em','-en'],['Gen.','-en','-er','-en','-er'],
    ]},text:'Nach: kein Artikel, Zahlen, einige/viele/manche/solche.'},
  examples:[sent('Ich trinke gerne starken Kaffee.',
    [{w:'Ich',r:'S'},{w:'trinke gerne',r:'V'},{w:'starken Kaffee.',r:'Oa'}],
    'Stark Akk.m: -en')],
  exercises:[ex('frisch___ Brot (Nom.n, stark)','es','-es'),
    ex('mit gut___ Wein (Dat.m, stark)','em','-em'),
    ex('mehrere gut___ Bücher (Nom.Pl., stark)','e','-e')]
};
CONTENT['adj_gemischt'] = {
  zone:'special', tag:'Adjektiv', title:'Gemischte Deklination',
  sub:'После неопределённого артикля',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Wo kein Kasussignal im Art. → Adj. übernimmt es (stark)',
    table:{head:['Kasus','m','f','n'],rows:[
      ['Nom.','-er (ein alter)!','-e (eine alte)','-es (ein altes)!'],
      ['Akk.','-en','-e','-es!'],['Dat.','-en','-en','-en'],
    ]},text:'Nach: ein/kein/mein/dein...'},
  examples:[sent('Ein junger Mann und ein kaltes Bier.',
    [{w:'Ein junger Mann',r:'S'},{w:'und ein kaltes Bier.',r:'Oa'}],
    'Nom.m(-er) | Nom.n(-es)')],
  exercises:[ex('ein jung___ Mann (Nom.m, gem.)','er','-er'),
    ex('ein kalt___ Bier (Nom.n, gem.)','es','-es'),
    ex('meinen alt___ Vater (Akk.m)','en','-en')]
};
CONTENT['adj_praedik'] = {
  zone:'special', tag:'Adjektiv', title:'Prädikatives Adjektiv',
  sub:'Сказуемостное — без окончания',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'sein/werden/bleiben + Adj. → keine Endung!',
    table:{head:['Verb','Beispiel'],rows:[
      ['sein','Der Mann ist alt.'],['werden','Er wird müde.'],
      ['bleiben','Sie bleibt ruhig.'],['finden','Ich finde das schön.'],
    ]}},
  examples:[],
  exercises:[ex('Der Mann ist ___. (alt, prädikativ)','alt','keine Endung'),
    ex('Er wird ___. (müde)','müde','keine Endung'),ex('Ich finde das ___. (schön)','schön','keine Endung')]
};
CONTENT['nl_adj_komp'] = {
  zone:'special', tag:'Adjektiv', title:'Komparation',
  sub:'Степени сравнения',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Positiv | Komp.: +er (Umlaut!) | Superlativ: am -sten / der -ste',
    table:{head:['Positiv','Komparativ','Superlativ'],rows:[
      ['alt','älter','am ältesten'],['gut','besser','am besten'],
      ['viel','mehr','am meisten'],['gern','lieber','am liebsten'],
    ]}},
  examples:[sent('Je mehr er lernt, desto besser wird er.',
    [{w:'Je mehr er lernt,',r:'S'},{w:'desto besser wird er.',r:'V'}],
    'je...desto')],
  exercises:[ex('alt → Komparativ','älter','Umlaut'),ex('gut → Superlativ','am besten','unreg.'),
    ex('Er ist ___ ich. (groß, Komp.+als)','größer als','Komp.+als'),
    ex('Je mehr er übt, ___ besser...','desto','je...desto')]
};
CONTENT['nl_pronomen'] = {
  zone:'special', tag:'Pronomen', title:'Pronomen',
  sub:'Личные и возвратные местоимения',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Personalpronomen: Nom./Akk./Dat.',
    table:{head:['Person','Nom.','Akk.','Dat.'],rows:[
      ['ich','ich','mich','mir'],['du','du','dich','dir'],
      ['er','er','ihn','ihm'],['sie(f)','sie','sie','ihr'],
      ['es','es','es','ihm'],['wir','wir','uns','uns'],
      ['ihr','ihr','euch','euch'],['sie/Sie','sie','sie','ihnen/Ihnen'],
    ]}},
  examples:[sent('Ich gebe es ihr.',
    [{w:'Ich',r:'S'},{w:'gebe',r:'V'},{w:'es',r:'Oa'},{w:'ihr.',r:'Od'}],
    'Akk.(es) vor Dat.(ihr)')],
  exercises:[ex('Ich gebe ___ (er, Dat.) das Buch.','ihm','Dat.m: ihm'),
    ex('Er liebt ___ (sie Sg., Akk.f).','sie','Akk.f: sie'),
    ex('Ich gebe ___ ___ (er-Dat., es-Akk.).','es ihm','Akk.Pron vor Dat.Pron')]
};
CONTENT['nl_praep'] = {
  zone:'special', tag:'Präpositionen', title:'Präpositionen',
  sub:'Предлоги — управление падежами',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Akk.: durch/für/gegen/ohne/um | Dat.: aus/bei/mit/nach/seit/von/zu | Gen.: wegen/trotz/während',
    table:{head:['Kasus','Präpositionen'],rows:[
      ['Akk.','durch, für, gegen, ohne, um, bis'],
      ['Dat.','aus, bei, mit, nach, seit, von, zu, gegenüber'],
      ['Gen.(C1)','wegen, trotz, während, aufgrund, statt, innerhalb, außerhalb'],
      ['Wechsel Wo?→Dat.','an, auf, in, über, unter, vor, hinter, neben, zwischen'],
    ]}},
  examples:[sent('Das Buch liegt auf dem Tisch. Er legt das Buch auf den Tisch.',
    [{w:'auf dem Tisch',r:'Adv'},{w:'→ auf den Tisch',r:'Adv'}],
    'Wo?→Dat. | Wohin?→Akk.')],
  exercises:[ex('Das Buch liegt auf ___ Tisch.','dem','Wo?→Dat.'),
    ex('Er legt das Buch auf ___ Tisch.','den','Wohin?→Akk.'),
    ex('___ schlechten Wetters blieb er.','Wegen','wegen+Gen.')]
};
CONTENT['nl_nominalis'] = {
  zone:'special', tag:'C1-Stil', title:'Nominalisierung',
  sub:'Номинализация — C1 стиль',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Verb→das Inf. | Adj.→das Schöne | Suffix: -ung/-heit/-keit',
    table:{head:['Verb/Adj.','Nominalisierung'],rows:[
      ['lernen','das Lernen'],['beschreiben','die Beschreibung'],
      ['entscheiden','die Entscheidung'],['schön','das Schöne'],
    ]}},
  examples:[sent('Aufgrund der steigenden Kosten beschloss die Firma zu sparen.',
    [{w:'Aufgrund der steigenden Kosten',r:'Adv'},{w:'beschloss',r:'V'},{w:'die Firma',r:'S'},{w:'zu sparen.',r:'V'}],
    'Nominalisierung statt: weil die Kosten steigen')],
  exercises:[ex('beschreiben → Nominalisierung','die Beschreibung','-ung'),
    ex('entscheiden → Nominalisierung','die Entscheidung','-ung'),
    ex('weil er krank war → aufgrund...','aufgrund seiner Krankheit','aufgrund+Gen.')]
};
CONTENT['pr_akk_dat'] = {
  zone:'special', tag:'Präp.', title:'Akk.- und Dat.-Präpositionen',
  sub:'Предлоги с Akkusativ и Dativ',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Akk.: durch/für/gegen/ohne/um/bis | Dat.: aus/bei/mit/nach/seit/von/zu',
    table:{head:['Präp.','Kasus','Bedeutung'],rows:[
      ['durch','Akk.','сквозь'],['für','Akk.','для'],['ohne','Akk.','без'],
      ['mit','Dat.','с/на транспорте'],['seit','Dat.','с (до сих пор)'],
      ['nach','Dat.','после; в(город)'],['zu','Dat.','к/в'],
    ]}},
  examples:[sent('Er fährt mit dem Bus zur Schule.',
    [{w:'Er fährt',r:'V'},{w:'mit dem Bus',r:'Adv'},{w:'zur Schule.',r:'Adv'}],
    'mit+Dat. | zu+Dat.')],
  exercises:[ex('Das ist ___ dich. (für)','für','für+Akk.'),
    ex('Ich fahre ___ dem Rad.','mit','mit+Dat.'),ex('Ich gehe ___ Arzt. (zu+dem)','zum','zu+dem=zum')]
};
CONTENT['pr_wechsel'] = {
  zone:'special', tag:'Präp.', title:'Wechselpräpositionen',
  sub:'Wo?(Dat.) vs. Wohin?(Akk.)',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'an/auf/hinter/in/neben/über/unter/vor/zwischen | Wo?→Dat. | Wohin?→Akk.',
    table:{head:['Zustand(Wo?→Dat.)','Bewegung(Wohin?→Akk.)'],rows:[
      ['auf dem Stuhl sitzen','auf den Stuhl setzen'],['im Zimmer sein','ins Zimmer gehen'],
      ['an der Wand hängen','an die Wand hängen'],
    ]}},
  examples:[],
  exercises:[ex('Das Buch liegt auf ___ Tisch. (dem/den)','dem','Wo?→Dat.'),
    ex('Er legt das Buch auf ___ Tisch.','den','Wohin?→Akk.'),
    ex('Das Bild hängt an ___ Wand. (der/die, f)','der','Wo?→Dat.f')]
};
CONTENT['pr_gen_praep'] = {
  zone:'special', tag:'Präp.', title:'Genitiv-Präpositionen',
  sub:'Предлоги с родительным падежом — C1',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'wegen/trotz/während/aufgrund/statt/innerhalb/außerhalb/angesichts + Gen.',
    table:{head:['Präp.','Bedeutung','Beispiel'],rows:[
      ['wegen','из-за','wegen des Wetters'],['trotz','несмотря','trotz des Regens'],
      ['während','во время','während der Stunde'],['aufgrund','ввиду','aufgrund seiner Leistung'],
      ['angesichts','учитывая','angesichts der Krise'],
    ]}},
  examples:[],
  exercises:[ex('___ schlechten Wetters. (из-за)','Wegen','wegen+Gen.'),
    ex('___ seiner Krankheit kam er. (несмотря на)','Trotz','trotz+Gen.'),
    ex('___ der Ferien reiste er. (во время)','Während','während+Gen.')]
};
CONTENT['pr_temporal'] = {
  zone:'special', tag:'Präp.', title:'Temporale Präpositionen',
  sub:'Предлоги для времени',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'um(Uhr) · am(Tag/Tageszeit) · im(Monat/Saison) · in(durch, Zukunft) · vor(назад) · seit(andauernd)',
    table:{head:['Präp.','Wann?','Beispiel'],rows:[
      ['um','часы','um 8 Uhr'],['am','день нед./части сут.','am Montag / am Abend'],
      ['im','месяц/сезон','im Januar / im Sommer'],['in','через (буд.)','in einer Stunde'],
      ['vor','назад','vor drei Jahren'],['seit','с (до сих пор)','seit drei Jahren'],
    ]}},
  examples:[],
  exercises:[ex('___ Montag habe ich frei.','Am','Wochentag: am'),
    ex('Er kommt ___ zwei Stunden.','in','in=через'),
    ex('Ich lerne Deutsch ___ drei Jahren.','seit','seit (andauernd)')]
};

// ── NEBENSATZ CONTENT ─────────────────────────────────────────────
CONTENT['nebensatz'] = {
  zone:'nebensatz', tag:'Nebensatz', title:'Nebensätze',
  sub:'Придаточные предложения — все типы',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Konnektor + ... + Verb(Ende) | Komma obligatorisch',
    table:{head:['Тип','Konnektor','Bedeutung'],rows:[
      ['Kausal','weil, da','потому что'],['Konzessiv','obwohl','хотя'],
      ['Konditional','wenn, falls','если'],['Temporal','als/wenn/während/nachdem','когда/пока'],
      ['Final','damit, um...zu','чтобы'],['Konsekutiv','sodass','так что'],
      ['Relativ','der/die/das','который'],['Komplement','dass, ob','что, ли'],
    ]}},
  examples:[sent('Obwohl er sehr müde war, arbeitete er weiter.',
    [{w:'Obwohl er sehr müde war,',r:'S'},{w:'arbeitete',r:'V'},{w:'er',r:'S'},{w:'weiter.',r:'Adv'}],
    'NS als P1 → Inversion im HS')],
  exercises:[ex('Er kommt nicht, ___ er krank ist.','weil','weil=потому что'),
    ex('___ er müde war, arbeitete er weiter.','Obwohl','obwohl=хотя')]
};
CONTENT['ns_dass'] = {
  zone:'nebensatz', tag:'Komplement', title:'dass-Satz',
  sub:'Дополнительное придаточное',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'HS + dass + S + ... + Verb(Ende)',
    text:'dass-Satz nach: sagen, denken, glauben, wissen, fühlen, finden, hoffen...',
    table:{head:['Hauptsatz','dass-Satz'],rows:[
      ['Ich glaube,','dass er morgen kommt.'],
      ['Es ist wichtig,','dass du pünktlich bist.'],
    ]}},
  examples:[sent('Ich glaube, dass er morgen kommen wird.',
    [{w:'Ich glaube,',r:'S'},{w:'dass',r:'V'},{w:'er',r:'S'},{w:'morgen kommen wird.',r:'V'}],
    'dass+Verb-Letzt')],
  exercises:[ex('Ich denke, ___ er recht hat.','dass','dass-Satz'),
    ex('Es ist wichtig, ___ du pünktlich ___. (sein)','dass / bist','Verb-Letzt'),
    ex('Er sagt, ___ er morgen ___ ___. (kommen, Futur)','dass / kommen wird','wird Ende')]
};
CONTENT['ns_weil'] = {
  zone:'nebensatz', tag:'Kausalsatz', title:'weil / da / denn',
  sub:'Причинные конструкции',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'weil/da: NS(V-Ende) | denn: HS(V2) | deshalb/daher: HS+Inv.',
    table:{head:['Mittel','Тип','Beispiel'],rows:[
      ['weil','NS','Er bleibt, weil er krank ist.'],
      ['da','NS (известное)','Da er krank ist, bleibt er.'],
      ['denn','HS (kein Inv.)','Er bleibt, denn er ist krank.'],
      ['deshalb','HS+Inv.','Er ist krank. Deshalb bleibt er.'],
    ]}},
  examples:[sent('Er kann nicht kommen, weil er einen wichtigen Termin hat.',
    [{w:'Er kann nicht kommen,',r:'S'},{w:'weil',r:'V'},{w:'er einen wichtigen Termin hat.',r:'V'}],
    'weil→V-Letzt')],
  exercises:[ex('Er bleibt, ___ er krank ___. (weil)','weil / ist','V-Letzt!'),
    ex('Er ist krank. ___ kommt er nicht.','Deshalb','Deshalb+Inversion'),
    ex('Er ist krank. ___ er ist krank. (ohne Inversion!)','denn','denn+V2')]
};
CONTENT['ns_wenn_als'] = {
  zone:'nebensatz', tag:'Temporal', title:'wenn / als',
  sub:'Когда — разграничение',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'als: однократно прошл. | wenn: повторно или наст./буд.',
    table:{head:['Konj.','Wann?','Beispiel'],rows:[
      ['als','однократно прошл.','Als ich 10 war, zogen wir um.'],
      ['wenn','повторно прошл.','Wenn ich müde war, schlief ich.'],
      ['wenn','настоящее/будущее','Wenn er Zeit hat, liest er.'],
    ]}},
  examples:[sent('Als ich das erste Mal Deutsch hörte, verstand ich kein Wort.',
    [{w:'Als ich das erste Mal Deutsch hörte,',r:'S'},{w:'verstand',r:'V'},{w:'ich kein Wort.',r:'Oa'}],
    'als = einmalig')],
  exercises:[ex('___ ich ein Kind war, spielte ich viel.','Als','einmalig→als'),
    ex('___ ich müde bin, gehe ich schlafen.','Wenn','Gewohnheit→wenn'),
    ex('___ er früher schlief, war er ausgeruhter.','Wenn','wiederholt→Wenn')]
};
CONTENT['ns_ob'] = {
  zone:'nebensatz', tag:'Komplement', title:'ob-Satz',
  sub:'Косвенный общий вопрос',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'HS + ob + S + ... + Verb(Ende)',
    text:'Прямой: Kommt er? → Косвенный: Ich weiß nicht, ob er kommt.'},
  examples:[sent('Ich weiß nicht, ob er morgen kommen wird.',
    [{w:'Ich weiß nicht,',r:'S'},{w:'ob er morgen kommen wird.',r:'V'}],
    'ob NS')],
  exercises:[ex('Ich frage mich, ___ er kommt.','ob','ob=ли'),
    ex('Ich frage, ___ er bestanden ___ ___. (Perf.)','ob / bestanden hat','Verb-Letzt: bestanden hat')]
};
CONTENT['ns_relativ'] = {
  zone:'nebensatz', tag:'Relativsatz', title:'Relativsatz',
  sub:'Относительные придаточные',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Genus=Bezugswort, Kasus=Funktion im NS | Dat.Pl.: denen | Gen.: dessen/deren',
    table:{head:['Kasus','m','f','n','Pl.'],rows:[
      ['Nom.','der','die','das','die'],['Akk.','den','die','das','die'],
      ['Dat.','dem','der','dem','denen'],['Gen.','dessen','deren','dessen','deren'],
    ]}},
  examples:[sent('Der Lehrer, dessen Unterricht mir gefällt, heißt Müller.',
    [{w:'Der Lehrer,',r:'S'},{w:'dessen Unterricht mir gefällt,',r:'NS'},{w:'heißt Müller.',r:'V'}],
    'Gen.m: dessen')],
  exercises:[ex('Der Mann, ___ ich gesehen habe. (Akk.m)','den','den'),
    ex('Die Frau, ___ ich helfe. (Dat.f)','der','der'),
    ex('Das Kind, ___ Spielzeug verloren ist. (Gen.n)','dessen','dessen'),
    ex('Die Kinder, ___ ich geholfen habe. (Dat.Pl.)','denen','denen')]
};
CONTENT['ns_infinitiv'] = {
  zone:'nebensatz', tag:'Infinitivsatz', title:'Infinitivsätze',
  sub:'um/ohne/statt...zu + Infinitiv',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'um...zu (цель, gleicher Subj.) | ohne...zu | statt...zu | trennbar: auf+zu+machen',
    table:{head:['NS','→ Infinitivsatz'],rows:[
      ['damit er lernt','um zu lernen'],['ohne dass er schläft','ohne zu schlafen'],
      ['statt dass er hilft','statt zu helfen'],
    ]}},
  examples:[sent('Er lernt Deutsch, um in Deutschland arbeiten zu können.',
    [{w:'Er lernt Deutsch,',r:'S'},{w:'um in Deutschland arbeiten zu können.',r:'V'}],
    'um+zu+Modal')],
  exercises:[ex('Er lernt, ___ die Prüfung ___ bestehen.','um / zu','um...zu'),
    ex('aufmachen → Inf.+zu','aufzumachen','auf+zu+machen'),
    ex('statt → gleicher oder verschiedener Subj.?','gleicher Subj.','gleich wie um...zu')]
};
CONTENT['ns_konzessiv'] = {
  zone:'nebensatz', tag:'Konzessiv', title:'obwohl / trotzdem / trotz',
  sub:'Уступительные конструкции',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'obwohl+NS(V-Ende) | trotzdem/dennoch+HS+Inv. | trotz+Gen.',
    table:{head:['Mittel','Beispiel'],rows:[
      ['obwohl (NS)','Er kam, obwohl er krank war.'],
      ['trotzdem (HS+Inv.)','Er war krank. Trotzdem kam er.'],
      ['trotz + Gen.','Trotz der Krankheit kam er.'],
    ]}},
  examples:[sent('Obwohl er die ganze Nacht gearbeitet hatte, war er nicht müde.',
    [{w:'Obwohl er die ganze Nacht gearbeitet hatte,',r:'S'},{w:'war er nicht müde.',r:'V'}],
    'obwohl+Plusquamp.')],
  exercises:[ex('Er kam, ___ er krank war.','obwohl','obwohl'),
    ex('Er war krank. ___ kam er. (Inversion)','Trotzdem','Trotzdem+Inv.'),
    ex('___ seiner Krankheit kam er. (Gen.)','Trotz','trotz+Gen.')]
};
CONTENT['ns_temporal'] = {
  zone:'nebensatz', tag:'Temporal', title:'Temporalsätze',
  sub:'Все временны́е союзы',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'als/wenn/während/nachdem/bevor/bis/seitdem/sobald/solange + V-Ende',
    table:{head:['Konnektor','Verhältnis'],rows:[
      ['als','однократно прошл.'],['wenn','повторно/наст./буд.'],
      ['nachdem','NS предшествует → Plusquamp.'],['bevor','HS предшествует'],
      ['während','одновременно'],['seitdem','с момента'],
    ]}},
  examples:[sent('Nachdem er das Studium abgeschlossen hatte, begann er zu arbeiten.',
    [{w:'Nachdem er abgeschlossen hatte,',r:'S'},{w:'begann er zu arbeiten.',r:'V'}],
    'nachdem+Plusquamp.')],
  exercises:[ex('___ er ankam, war sie weg. (однократно)','Als','als'),
    ex('___ er gelesen hatte, sah er den Film. (nachdem)','Nachdem','nachdem+Plusquamp.'),
    ex('Sie wartete, ___ er zurückkam.','bis','bis=пока не')]
};
CONTENT['ns_konditional'] = {
  zone:'nebensatz', tag:'Konditional', title:'wenn / falls / sofern',
  sub:'Условные придаточные',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Real: wenn+Präs. | Irreal Geg.: Konj.II | Irreal Verg.: Konj.II+Part.II',
    table:{head:['Тип','Bedingung','Folge'],rows:[
      ['Real','Wenn er kommt,','helfe ich.'],
      ['Irreal Geg.','Wenn er käme,','würde ich helfen.'],
      ['Irreal Verg.','Wenn er gekommen wäre,','hätte ich geholfen.'],
    ]}},
  examples:[sent('Wenn er Zeit gehabt hätte, wäre er gekommen.',
    [{w:'Wenn er Zeit gehabt hätte,',r:'S'},{w:'wäre er gekommen.',r:'V'}],
    'Irrealis Vergangenheit')],
  exercises:[ex('___ es regnet, bleiben wir.','Wenn','real→wenn'),
    ex('___ er Zeit ___, würde er kommen. (Irreal)','Wenn / hätte','Konj.II'),
    ex('"ohne wenn": Hätte er Zeit, ___ er kommen.','würde','würde+Inf.')]
};
CONTENT['ns_kausal'] = {
  zone:'nebensatz', tag:'Kausal', title:'Kausalsatz',
  sub:'Причинные конструкции',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'weil/da(NS) | denn(HS,kein Inv.) | deshalb(HS+Inv.) | aufgrund+Gen.(C1)',
    table:{head:['Mittel','Тип'],rows:[
      ['weil','NS (V-Letzt)'],['da','NS (vorn, bekannt)'],
      ['denn','HS (V2, kein Inv.)'],['deshalb/daher','HS+Inv.'],
    ]}},
  examples:[],
  exercises:[ex('Er bleibt, ___ er krank ist.','weil','weil NS'),
    ex('___ Noten verlor er das Stipendium. (aufgrund+Gen.)','Aufgrund schlechter','aufgrund+Gen.')]
};
CONTENT['ns_konsekutiv'] = {
  zone:'nebensatz', tag:'Konsekutiv', title:'sodass / so...dass',
  sub:'Следственные придаточные',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'sodass+NS | so+Adj.+dass+NS | damit=цель ≠ следствие',
    table:{head:['Konj.','Bedeutung'],rows:[
      ['sodass','следствие'],['so...dass','степень+следствие'],['damit','цель (не следствие)'],
    ]}},
  examples:[sent('Er hat so viel gelernt, dass er problemlos bestand.',
    [{w:'Er hat so viel gelernt,',r:'S'},{w:'dass er problemlos bestand.',r:'V'}],
    'so viel...dass')],
  exercises:[ex('Er war ___ müde, ___ er einschlief.','so / dass','so+Adj...dass'),
    ex('"damit" vs "sodass": Unterschied?','damit=Ziel, sodass=Folge','wichtig!')]
};
CONTENT['ns_final'] = {
  zone:'nebensatz', tag:'Final', title:'damit / um...zu',
  sub:'Целевые придаточные',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'damit+NS (разные субъекты) | um...zu+Inf. (gleicher Subj.)',
    table:{head:['Mittel','Субъекты','Beispiel'],rows:[
      ['damit','любые','Er erklärt, damit sie versteht.'],
      ['um...zu','одинаковые','Er lernt, um zu bestehen.'],
    ]}},
  examples:[sent('Er spart, um sich ein Auto kaufen zu können.',
    [{w:'Er spart,',r:'S'},{w:'um sich ein Auto kaufen zu können.',r:'V'}],
    'um+zu+Modal')],
  exercises:[ex('Er lernt, ___ die Prüfung ___ bestehen.','um / zu','um...zu'),
    ex('Der Lehrer wiederholt, ___ alle es ___. (damit+verstehen)','damit / verstehen','damit NS')]
};

// ── C1 CONTENT ────────────────────────────────────────────────────
CONTENT['c1strukt'] = {
  zone:'c1color', tag:'C1', title:'C1-Strukturen',
  sub:'Конструкции уровня C1',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Partizipialkonstr. · Erw.Adj.Attr. · FVG · Doppelkonj. · Passiv-Ersatz · Konj.I/II',
    table:{head:['Struktur','C1','Einfach'],rows:[
      ['Partizipialattr.','der von allen geliebte Mann','der Mann, der geliebt wird'],
      ['FVG','zur Lösung bringen','lösen'],['Doppelkonj.','sowohl...als auch','und'],
      ['Passiv-Ersatz','lässt sich lösen','kann gelöst werden'],
      ['Nominalisierung','aufgrund seiner Erkrankung','weil er krank war'],
    ]}},
  examples:[sent('Das von der Regierung verabschiedete Gesetz trat in Kraft.',
    [{w:'Das',r:'S'},{w:'von der Regierung verabschiedete',r:'Adj'},{w:'Gesetz',r:'S'},{w:'trat in Kraft.',r:'V'}],
    'Erweitertes Partizipialattribut (Part.II)')],
  exercises:[ex('"lösen" als FVG?','zur Lösung bringen','FVG'),
    ex('"Das lässt sich nicht ändern" = ?','Das kann nicht geändert werden.','Passiv-Ersatz')]
};
CONTENT['c1_partizip'] = {
  zone:'c1color', tag:'C1', title:'Partizipialkonstruktion',
  sub:'Причастные обороты вместо придаточных',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Part.I (Inf.+-d, gleichzeitig/aktiv) | Part.II (passiv/abgeschl.) als Attribut',
    table:{head:['NS (устно)','→ Partizipialattr.'],rows:[
      ['der Mann, der singt','der singende Mann'],
      ['das Buch, das geschrieben wurde','das geschriebene Buch'],
      ['der Mann, der von allen geliebt wird','der von allen geliebte Mann'],
    ]}},
  examples:[sent('Der von allen respektierte Wissenschaftler hielt einen Vortrag.',
    [{w:'Der von allen respektierte',r:'Adj'},{w:'Wissenschaftler',r:'S'},{w:'hielt einen Vortrag.',r:'V'}],
    'Part.II als erweitertes Attribut')],
  exercises:[ex('der Mann, der singt → Attr.','der singende Mann','Part.I: -d'),
    ex('das Buch, das gelesen wurde → Attr.','das gelesene Buch','Part.II'),
    ex('die Studentin, die fleißig lernt → Attr.','die fleißig lernende Studentin','Part.I erw.')]
};
CONTENT['c1_erw_adj'] = {
  zone:'c1color', tag:'C1', title:'Erweiterte Adjektivattribute',
  sub:'Распространённое определение — письменный стиль',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'[Artikel] + [Erweiterung] + [dekl.Part./Adj.] + [Nomen]',
    table:{head:['NS (устно)','Erw.Adj.Attr. (письм.)'],rows:[
      ['das Gesetz, das gestern verabschiedet wurde','das gestern verabschiedete Gesetz'],
      ['die Kosten, die gestiegen sind','die gestiegenen Kosten'],
      ['ein Problem, das noch nicht gelöst ist','ein noch nicht gelöstes Problem'],
    ]}},
  examples:[sent('Die in den letzten Jahren stark gestiegenen Energiepreise belasten die Haushalte.',
    [{w:'Die',r:'S'},{w:'in den letzten Jahren stark gestiegenen',r:'Adj'},{w:'Energiepreise',r:'S'},{w:'belasten die Haushalte.',r:'V'}],
    'Erweitertes Attr. mit Präp.+Adj.')],
  exercises:[ex('das Projekt, das von der EU finanziert wurde → Attr.','das von der EU finanzierte Projekt','Part.II'),
    ex('Wo steht das erweiterte Adj.?','zwischen Artikel und Nomen','Grundregel')]
};
CONTENT['c1_fvg'] = {
  zone:'c1color', tag:'C1', title:'Funktionsverbgefüge',
  sub:'Глагольно-именные словосочетания',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'semantisch leeres Verb + Nomen in fester Verbindung',
    table:{head:['FVG','Einfaches Verb'],rows:[
      ['zur Sprache bringen','erwähnen'],['in Gang setzen','starten'],
      ['Kritik üben','kritisieren'],['Hilfe leisten','helfen'],
      ['eine Entscheidung treffen','entscheiden'],['in Betracht ziehen','berücksichtigen'],
      ['zum Ausdruck bringen','ausdrücken'],['in Frage stellen','bezweifeln'],
    ]}},
  examples:[sent('Der Minister brachte das Thema erneut zur Sprache.',
    [{w:'Der Minister',r:'S'},{w:'brachte',r:'V'},{w:'das Thema zur Sprache.',r:'Adv'}],
    'FVG: zur Sprache bringen = erwähnen')],
  exercises:[ex('"eine Entscheidung treffen" = ?','entscheiden','FVG'),
    ex('"Kritik üben" = ?','kritisieren','FVG'),
    ex('Er erwähnte das. → FVG:','Er brachte das zur Sprache.','FVG')]
};
CONTENT['c1_doppelkonj'] = {
  zone:'c1color', tag:'C1', title:'Doppelkonjunktionen',
  sub:'Двойные союзы',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'sowohl...als auch | weder...noch | nicht nur...sondern auch | zwar...aber | entweder...oder',
    table:{head:['Doppelkonj.','Bedeutung','Beispiel'],rows:[
      ['sowohl...als auch','и...и','sowohl Englisch als auch Französisch'],
      ['weder...noch','ни...ни','weder Zeit noch Geld'],
      ['nicht nur...sondern auch','не только...но и','nicht nur klug, sondern auch fleißig'],
      ['zwar...aber','хотя...но','zwar müde, aber arbeitet weiter'],
      ['entweder...oder','или...или','entweder heute oder morgen'],
    ]}},
  examples:[sent('Sowohl die Qualität als auch der Preis sind entscheidend.',
    [{w:'Sowohl die Qualität als auch der Preis',r:'S'},{w:'sind',r:'V'},{w:'entscheidend.',r:'Adj'}],
    'sowohl...als auch → Plural!')],
  exercises:[ex('Er spricht ___ Deutsch ___ Englisch. (и...и)','sowohl / als auch','sowohl...als auch'),
    ex('Sie hat ___ Zeit ___ Geld. (ни...ни)','weder / noch','weder...noch'),
    ex('Er ist ___ müde, ___ er weiterarbeitet.','zwar / aber','zwar...aber')]
};
CONTENT['c1_passiv_adv'] = {
  zone:'c1color', tag:'C1-Passiv', title:'Passiv-Alternativen',
  sub:'Замены пассива — C1',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'lassen+sich+Inf. | sein+zu+Inf. | -bar/-lich Adj. | man+Aktiv',
    table:{head:['Passiv','Alternative'],rows:[
      ['kann gelöst werden','lässt sich lösen'],['muss erledigt werden','ist zu erledigen'],
      ['kann gesehen werden','ist sichtbar / ist zu sehen'],
    ]}},
  examples:[sent('Das lässt sich nicht so einfach lösen.',
    [{w:'Das',r:'S'},{w:'lässt sich nicht so einfach lösen.',r:'V'}],
    'sich lassen = kann...werden')],
  exercises:[ex('Das Problem kann gelöst werden. → lassen+sich:','Das Problem lässt sich lösen.','lassen+sich'),
    ex('Das muss gemacht werden. → sein+zu:','Das ist zu machen.','sein+zu+Inf.')]
};
CONTENT['c1_konj2'] = {
  zone:'c1color', tag:'Konj.II', title:'Konjunktiv II',
  sub:'Полная система сослагательного наклонения',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'hätte/wäre/könnte... | würde+Inf. | Verg.: hätte/wäre+Part.II',
    table:{head:['','hätte','wäre','könnte','würde'],rows:[
      ['ich','hätte','wäre','könnte','würde'],
      ['er/sie','hätte','wäre','könnte','würde'],
      ['wir','hätten','wären','könnten','würden'],
    ]}},
  examples:[sent('Wenn ich mehr Zeit hätte, würde ich mehr reisen.',
    [{w:'Wenn ich mehr Zeit hätte,',r:'S'},{w:'würde ich mehr reisen.',r:'V'}],
    'Irrealis Gegenwart')],
  exercises:[ex('sein → Konj.II ich','wäre','wäre'),ex('haben → Konj.II wir','hätten','hätten'),
    ex('Wenn ich Geld ___, würde ich reisen.','hätte','hätte')]
};
CONTENT['k2_formen'] = {
  zone:'c1color', tag:'Konj.II', title:'Konjunktiv II Formen',
  sub:'Образование всех форм',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Stark: Prät.Stamm+Umlaut+e | Schwach: würde+Inf.',
    table:{head:['Inf.','Konj.II er'],rows:[
      ['haben','hätte'],['sein','wäre'],['werden','würde'],
      ['können','könnte'],['müssen','müsste'],['dürfen','dürfte'],
      ['lernen','würde lernen (=Prät.!)'],
    ]}},
  examples:[sent('Das wäre eine gute Idee.',
    [{w:'Das wäre eine gute Idee.',r:'V'}],
    'sein→wäre')],
  exercises:[ex('sein → Konj.II ich','wäre','wäre'),ex('haben → Konj.II wir','hätten','hätten'),
    ex('lernen → Konj.II ich (schwach)','würde lernen','schwach → würde+Inf.')]
};
CONTENT['k2_irrealis'] = {
  zone:'c1color', tag:'Konj.II', title:'Irrealis',
  sub:'Нереальные условия — Gegenwart и Vergangenheit',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Geg.: Konj.II | Verg.: hätte/wäre+Part.II | ohne wenn: V1',
    table:{head:['Zeit','Bedingung (NS)','Folge (HS)'],rows:[
      ['Gegenwart','Wenn er Zeit hätte,','würde er kommen.'],
      ['Vergangenheit','Wenn er gekommen wäre,','hätten wir geholfen.'],
      ['ohne wenn(Geg.)','Hätte er Zeit,','würde er kommen.'],
    ]}},
  examples:[sent('Wenn er das gewusst hätte, wäre alles anders gelaufen.',
    [{w:'Wenn er das gewusst hätte,',r:'S'},{w:'wäre alles anders gelaufen.',r:'V'}],
    'Irrealis Vergangenheit')],
  exercises:[ex('Wenn ich Zeit ___, würde ich kommen.','hätte','hätte'),
    ex('Wenn er früher ___ ___, hätten wir gewonnen. (kommen)','gekommen wäre','Part.II+wäre'),
    ex('"ohne wenn": Wenn sie fleißiger wäre, ... →','Wäre sie fleißiger, würde sie bestehen.','V1')]
};
CONTENT['k2_hoeflich'] = {
  zone:'c1color', tag:'Konj.II', title:'Höflichkeit — Konj.II',
  sub:'Вежливые просьбы и вопросы',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Könnten/Würden/Hätten Sie...? | Ich möchte/hätte gern...',
    table:{head:['Indikativ','Konjunktiv II'],rows:[
      ['Können Sie helfen?','Könnten Sie helfen?'],['Darf ich fragen?','Dürfte ich fragen?'],
      ['Ich will einen Kaffee.','Ich möchte/hätte gern einen Kaffee.'],
    ]}},
  examples:[],
  exercises:[ex('Können Sie helfen? → Konj.II','Könnten Sie helfen?','könnten'),
    ex('Ich will einen Kaffee. → вежливо','Ich hätte gern einen Kaffee.','hätte gern'),
    ex('___ Sie das bitte machen?','Würden','würden Sie')]
};
CONTENT['k2_vergangen'] = {
  zone:'c1color', tag:'Konj.II', title:'Konj.II Vergangenheit',
  sub:'Нереальное прошлое',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'hätte/wäre + Part.II | haben-V → hätte | sein-V → wäre',
    table:{head:['Person','haben-Verb','sein-Verb'],rows:[
      ['ich','hätte gelernt','wäre gekommen'],['er','hätte gelernt','wäre gekommen'],
    ]}},
  examples:[sent('Sie wäre gerne mitgekommen, aber sie hatte keine Zeit.',
    [{w:'Sie wäre gerne mitgekommen,',r:'S'},{w:'aber sie hatte keine Zeit.',r:'V'}],
    'wäre+Part.II')],
  exercises:[ex('Ich ___ das getan. (haben→Konj.II Verg.)','hätte getan','hätte+Part.II'),
    ex('Er ___ früher ___. (kommen→Konj.II Verg.)','wäre / gekommen','wäre+Part.II')]
};
CONTENT['c1_konj1'] = {
  zone:'c1color', tag:'Konj.I', title:'Konjunktiv I',
  sub:'Косвенная речь — indirekte Rede',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Inf.Stamm+-e-Endungen | sein: sei | Konj.I=Ind.→Konj.II verwenden',
    table:{head:['Person','lernen','haben','sein'],rows:[
      ['ich','lerne','habe','sei'],['du','lernest','habest','seist'],
      ['er/sie','lerne','habe','sei'],['wir','lernen*','haben*','seien'],
    ]},text:'*wir lernen = Ind.! → würde+Inf. oder Konj.II verwenden'},
  examples:[sent('Die Ministerin erklärte, die Regierung habe keine Fehler gemacht.',
    [{w:'Die Ministerin erklärte,',r:'S'},{w:'die Regierung habe keine Fehler gemacht.',r:'V'}],
    'Konj.I Perfekt: habe+Part.II')],
  exercises:[ex('Er sagt, er ___ Deutsch. (lernen→Konj.I er)','lerne','lerne'),
    ex('Sie sagt, sie ___ müde. (sein)','sei','sei'),
    ex('Wann Konj.II statt Konj.I?','wenn Konj.I = Indikativ','z.B. wir lernen')]
};
CONTENT['c1_modalsubj'] = {
  zone:'c1color', tag:'C1-Modal', title:'Subjektive Modalität',
  sub:'Предположения с модальными глаголами',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Modal+Inf./Inf.II → Sprechermeinung',
    table:{head:['Modal','Subj. Bedeutung','Beispiel'],rows:[
      ['müssen','должно быть','Er muss krank sein.'],
      ['können','возможно','Das kann stimmen.'],
      ['sollen','говорят, что','Er soll reich sein.'],
      ['dürfen(Konj.II)','вероятно','Das dürfte schwer sein.'],
    ]}},
  examples:[sent('Er muss das schon gewusst haben.',
    [{w:'Er muss',r:'V'},{w:'das gewusst haben.',r:'V'}],
    'Inf.II: gewusst haben = Vergangenheit')],
  exercises:[ex('"Er muss krank sein" bedeutet:','Er ist wahrscheinlich krank.','subj.müssen'),
    ex('Er muss das ___ ___ (wissen, Verg.)','gewusst haben','Inf.II'),
    ex('Sie muss ___ ___ (kommen, sein-V, Verg.)','gekommen sein','Inf.II+sein')]
};
CONTENT['c1_stil'] = {
  zone:'c1color', tag:'C1-Stil', title:'Stilmittel & Register',
  sub:'Стилистика немецкого языка',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Umgangsspr. ↔ Neutral ↔ Formal/Wissenschaftlich',
    table:{head:['Umgangsspr.','→ Formal (C1)'],rows:[
      ['Ich habe das gelöst.','Das Problem wurde gelöst.'],
      ['weil er krank war','aufgrund seiner Erkrankung'],
      ['Er kritisiert das.','Er übt Kritik daran.'],
      ['Er sagte, dass...','Er sagte, er habe... (Konj.I)'],
    ]},text:'C1 formal: Passiv · Nominalisierung · FVG · Erw.Adj.Attr. · Gen.-Präp. · Konj.I'},
  examples:[sent('Aufgrund der anhaltenden Unsicherheit sehen sich viele Unternehmen gezwungen, zu handeln.',
    [{w:'Aufgrund der anhaltenden Unsicherheit',r:'Adv'},{w:'sehen sich viele Unternehmen gezwungen,',r:'V'},{w:'zu handeln.',r:'V'}],
    'Formeller C1-Stil')],
  exercises:[ex('weil er krank war → aufgrund...','aufgrund seiner Erkrankung','aufgrund+Gen.'),
    ex('Er hat gelöst. → Passiv','Das Problem wurde gelöst.','Passiv'),
    ex('C1-Merkmale nennen:','Passiv, Nominalisierung, FVG, Konj.I, Erw.Adj.Attr.','C1')]
};
CONTENT['pas_vorgang'] = {
  zone:'present', tag:'Passiv', title:'Vorgangspassiv',
  sub:'werden + Partizip II',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'werden(konj.)+Part.II | von+Dat.(Agens) | durch+Akk.(Mittel)',
    table:{head:['Zeit','Bildung','Beispiel'],rows:[
      ['Präsens','wird+Part.II','wird gebaut'],['Präteritum','wurde+Part.II','wurde gebaut'],
      ['Perfekt','ist+Part.II+worden','ist gebaut worden'],
      ['Modal','muss+Part.II+werden','muss gebaut werden'],
    ]}},
  examples:[sent('Das neue Gesetz wurde vom Parlament verabschiedet.',
    [{w:'Das neue Gesetz',r:'S'},{w:'wurde',r:'V'},{w:'vom Parlament',r:'Adv'},{w:'verabschiedet.',r:'V'}],
    'Prät.Passiv + von+Dat.')],
  exercises:[ex('Das Haus ___ renoviert. (Präsens)','wird','wird'),
    ex('Der Brief ___ geschrieben. (Prät.)','wurde','wurde'),
    ex('Das Paket ___ geliefert ___. (Perfekt)','ist / worden','ist...worden!')]
};
CONTENT['pas_modal'] = {
  zone:'present', tag:'Passiv', title:'Passiv + Modalverben',
  sub:'Страдательный залог с модальными',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Modal(P2) + ... + Part.II + werden(Ende)',
    table:{head:['Modal','Beispiel'],rows:[
      ['müssen','muss gemacht werden'],['können','kann gemacht werden'],
      ['sollen (Prät.)','sollte gemacht werden'],
    ]}},
  examples:[sent('Die Aufgaben müssen bis morgen abgegeben werden.',
    [{w:'Die Aufgaben',r:'S'},{w:'müssen',r:'V'},{w:'bis morgen abgegeben werden.',r:'V'}],
    'müssen+Passiv')],
  exercises:[ex('Das muss gemacht ___.','werden','Modal+Passiv: werden Ende'),
    ex('Die Aufgabe ___ bis Freitag gemacht werden. (sollen, Prät.)','sollte','Prät.: sollte')]
};
CONTENT['pas_zeiten'] = {
  zone:'present', tag:'Passiv', title:'Passiv — alle Zeiten',
  sub:'Пассив во всех временах',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Perfekt Passiv: ist+Part.II+worden (NICHT geworden!)',
    table:{head:['Zeit','Bildung'],rows:[
      ['Präsens','wird+Part.II'],['Präteritum','wurde+Part.II'],
      ['Perfekt','ist+Part.II+worden'],['Plusquamp.','war+Part.II+worden'],
      ['Futur I','wird+Part.II+werden'],
    ]}},
  examples:[sent('Das Haus ist letztes Jahr renoviert worden.',
    [{w:'Das Haus',r:'S'},{w:'ist',r:'V'},{w:'letztes Jahr',r:'Adv'},{w:'renoviert worden.',r:'V'}],
    'worden nicht geworden!')],
  exercises:[ex('Das Buch ___ gelesen. (Präsens)','wird','wird'),
    ex('Das Buch ___ gelesen ___. (Perfekt)','ist / worden','ist...worden'),
    ex('worden oder geworden?','worden!','Perfekt Passiv')]
};
CONTENT['rel_nom_akk'] = {
  zone:'nebensatz', tag:'Relativsatz', title:'Relativsatz Nom./Akk.',
  sub:'Nominativ und Akkusativ',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Nom.: der/die/das/die | Akk.: den/die/das/die',
    table:{head:['','m','f','n','Pl.'],rows:[
      ['Nom.','der','die','das','die'],['Akk.','den','die','das','die'],
    ]}},
  examples:[],
  exercises:[ex('Der Mann, ___ hier arbeitet. (Nom.m)','der','Nom.m: der'),
    ex('Das Buch, ___ ich lese. (Akk.n)','das','Akk.n: das'),
    ex('Der Mann, ___ ich kenne. (Akk.m)','den','Akk.m: den')]
};
CONTENT['rel_dat_gen'] = {
  zone:'nebensatz', tag:'Relativsatz', title:'Relativsatz Dat./Gen.',
  sub:'Dativ und Genitiv',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Dat.: dem/der/dem/denen | Gen.: dessen/deren/dessen/deren',
    table:{head:['','m','f','n','Pl.'],rows:[
      ['Dat.','dem','der','dem','denen'],['Gen.','dessen','deren','dessen','deren'],
    ]}},
  examples:[sent('Das Kind, dessen Spielzeug verloren ist, weint.',
    [{w:'Das Kind,',r:'S'},{w:'dessen Spielzeug verloren ist,',r:'NS'},{w:'weint.',r:'V'}],
    'Gen.n: dessen')],
  exercises:[ex('Die Frau, ___ ich helfe. (Dat.f)','der','Dat.f: der'),
    ex('Das Kind, ___ Spielzeug verloren ist. (Gen.n)','dessen','Gen.n: dessen'),
    ex('Die Kinder, ___ ich geholfen habe. (Dat.Pl.)','denen','Dat.Pl.: denen')]
};
CONTENT['rel_praep'] = {
  zone:'nebensatz', tag:'Relativsatz', title:'Relativsatz mit Präp.',
  sub:'С предлогом',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'Präp.+Rel.Pron.(Kasus) | Sache: wo(r)+Präp.',
    table:{head:['Person/Sache','Beispiel'],rows:[
      ['Person m','der Mann, mit dem ich arbeite'],
      ['Sache','das Thema, worüber wir sprechen'],
    ]}},
  examples:[sent('Der Kollege, mit dem ich arbeite, kommt aus Wien.',
    [{w:'Der Kollege,',r:'S'},{w:'mit dem ich arbeite,',r:'NS'},{w:'kommt aus Wien.',r:'V'}],
    'mit+Dat.m: dem')],
  exercises:[ex('Der Mann, mit ___ sie spricht. (Dat.m)','dem','mit+Dat: dem'),
    ex('Das Thema, ___ wir gesprochen haben. (worüber)','worüber','Sache: wo+r+über')]
};
CONTENT['rel_wo'] = {
  zone:'nebensatz', tag:'Relativsatz', title:'wo / was als Rel.Pron.',
  sub:'Особые относительные местоимения',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{formula:'wo = Ort | was nach: alles/nichts/etwas/das | wo(r)+Präp. für Sachen',
    table:{head:['Pronomen','Gebrauch'],rows:[
      ['wo','место: die Stadt, wo ich lebe'],
      ['was','nach alles/nichts: alles, was er sagte'],
      ['worüber','über+Sache: das Thema, worüber wir reden'],
    ]}},
  examples:[],
  exercises:[ex('Die Stadt, ___ ich wohne.','wo','wo=Ort'),
    ex('Alles, ___ er sagte, stimmte.','was','was nach alles'),
    ex('Das Thema, ___ wir uns gestritten haben.','worüber','Sache: worüber')]
};

// ── REMAINING NEW CONTENT ─────────────────────────────────────────

CONTENT['pas_zustand'] = {
  zone:'present', tag:'Passiv', title:'Zustandspassiv',
  sub:'sein + Partizip II — результат/состояние',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'sein(konj.) + Part.II | kein Agens möglich',
    text:`<strong>Zustandspassiv</strong> описывает <em>состояние</em>, ставшее результатом действия.<br><br>
Сравните: <em>Das Fenster wird geöffnet</em> (процесс) vs <em>Das Fenster ist geöffnet</em> (состояние).<br>
Kein Agens (von+Dat.) möglich, da der Zustand bereits eingetreten ist.`,
    table:{head:['Zeit','sein','Beispiel'],rows:[
      ['Präsens','ist','Die Tür ist geschlossen.'],
      ['Präteritum','war','Die Tür war geschlossen.'],
      ['Perfekt','ist...gewesen','Die Tür ist geschlossen gewesen.'],
    ]}
  },
  examples:[
    sent('Die Aufgabe ist bereits erledigt.',
      [{w:'Die Aufgabe',r:'S'},{w:'ist',r:'V'},{w:'bereits',r:'Adv'},{w:'erledigt.',r:'V'}],
      'Zustandspassiv Präsens'),
    sent('Als wir ankamen, war alles vorbereitet.',
      [{w:'Als wir ankamen,',r:'Adv'},{w:'war',r:'V'},{w:'alles',r:'S'},{w:'vorbereitet.',r:'V'}],
      'Zustandspassiv Präteritum'),
  ],
  exercises:[
    ex('Die Tür ___ geschlossen. (sein, Präsens)','ist','ist geschlossen'),
    ex('Das Paket ___ schon geliefert. (sein, Prät.)','war','war geliefert'),
    ex('"Das Haus wird gebaut" — Vorgangs- oder Zustandspassiv?','Vorgangspassiv','werden=Vorgang'),
    ex('"Das Haus ist fertig." — Vorgangs- oder Zustandspassiv?','Zustandspassiv','sein=Zustand'),
  ]
};

CONTENT['pas_modal'] = {
  zone:'present', tag:'Passiv', title:'Passiv + Modalverben',
  sub:'Модальные глаголы + страдательный залог',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Modal(P2) + ... + Part.II + werden(Ende)',
    text:'Modalverb wird konjugiert, <em>werden</em> steht als Infinitiv am Ende.',
    table:{head:['Modal','Passiv Präsens','Passiv Prät.'],rows:[
      ['müssen','muss gemacht werden','musste gemacht werden'],
      ['können','kann gemacht werden','konnte gemacht werden'],
      ['sollen','soll gemacht werden','sollte gemacht werden'],
      ['dürfen','darf gemacht werden','durfte gemacht werden'],
    ]}
  },
  examples:[
    sent('Die Hausaufgaben müssen bis morgen abgegeben werden.',
      [{w:'Die Hausaufgaben',r:'S'},{w:'müssen',r:'V'},{w:'bis morgen',r:'Adv'},{w:'abgegeben werden.',r:'V'}],
      'müssen + Passiv'),
    sent('Das lässt sich nicht so einfach lösen.',
      [{w:'Das',r:'S'},{w:'lässt sich',r:'V'},{w:'nicht so einfach',r:'Adv'},{w:'lösen.',r:'V'}],
      'Passiv-Ersatz: sich lassen'),
  ],
  exercises:[
    ex('Das muss gemacht ___. (werden)','werden','Modal+Passiv: werden Ende'),
    ex('Die Aufgabe ___ bis Freitag abgegeben werden. (sollen, Prät.)','sollte','Prät.: sollte'),
    ex('Man kann das Problem lösen. → Passiv-Ersatz: Das Problem ___ ___ lösen.','lässt sich','lassen+sich'),
    ex('Das Fenster muss geöffnet ___. (werden)','werden','werden am Ende'),
  ]
};

CONTENT['pas_zeiten'] = {
  zone:'present', tag:'Passiv', title:'Passiv — alle Zeiten',
  sub:'Пассив во всех временах',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Vorgangspassiv: werden(konj.) + Part.II in allen Zeiten',
    table:{head:['Zeit','Bildung','Beispiel'],rows:[
      ['Präsens','wird+Part.II','Das Buch wird gelesen.'],
      ['Präteritum','wurde+Part.II','Das Buch wurde gelesen.'],
      ['Perfekt','ist+Part.II+worden','Das Buch ist gelesen worden.'],
      ['Plusquamp.','war+Part.II+worden','Das Buch war gelesen worden.'],
      ['Futur I','wird+Part.II+werden','Das Buch wird gelesen werden.'],
      ['Modal Prät.','musste+Part.II+werden','Das Buch musste gelesen werden.'],
    ]},
    text:'Perfekt Passiv: <em>worden</em> (nicht "geworden"!) — häufiger Fehler!'
  },
  examples:[
    sent('Das Haus ist letztes Jahr renoviert worden.',
      [{w:'Das Haus',r:'S'},{w:'ist',r:'V'},{w:'letztes Jahr',r:'Adv'},{w:'renoviert worden.',r:'V'}],
      'Perfekt Passiv: worden nicht geworden!'),
  ],
  exercises:[
    ex('Das Buch ___ gelesen. (Präsens Passiv)','wird','wird+Part.II'),
    ex('Das Buch ___ gelesen. (Präteritum Passiv)','wurde','wurde+Part.II'),
    ex('Das Buch ___ gelesen ___. (Perfekt Passiv)','ist / worden','ist...worden'),
    ex('Perfekt Passiv: "worden" oder "geworden"?','worden','worden! (nicht geworden)'),
  ]
};

// ── RELATIVSATZ LEVEL 3 ──────────────────────────────────────────
CONTENT['rel_nom_akk'] = {
  zone:'nebensatz', tag:'Relativsatz', title:'Relativsatz Nom./Akk.',
  sub:'Relativpronomen im Nominativ und Akkusativ',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Nom.: der/die/das/die | Akk.: den/die/das/die',
    table:{head:['Kasus','m','f','n','Pl.'],rows:[
      ['Nom.','der','die','das','die'],
      ['Akk.','den','die','das','die'],
    ]},
    text:'Genus = Bezugswort. Kasus = Funktion im NS. Nom. = Subj. im NS. Akk. = direktes Obj. im NS.'
  },
  examples:[
    sent('Der Mann, der hier arbeitet, ist mein Kollege.',
      [{w:'der Mann,',r:'S'},{w:'der hier arbeitet,',r:'NS'},{w:'ist mein Kollege.',r:'V'}],
      'Nom.m: der (Subj. im NS)'),
    sent('Das Buch, das ich lese, ist sehr gut.',
      [{w:'Das Buch,',r:'S'},{w:'das ich lese,',r:'NS'},{w:'ist sehr gut.',r:'V'}],
      'Akk.n: das (Obj. im NS)'),
  ],
  exercises:[
    ex('Die Frau, ___ hier wohnt, ist nett. (Nom.f)','die','Nom.f: die'),
    ex('Das Kind, ___ ich sehe, lacht. (Akk.n)','das','Akk.n: das'),
    ex('Der Mann, ___ ich kenne, ist Arzt. (Akk.m)','den','Akk.m: den'),
    ex('Die Kinder, ___ spielen, sind laut. (Nom.Pl.)','die','Nom.Pl: die'),
  ]
};

CONTENT['rel_dat_gen'] = {
  zone:'nebensatz', tag:'Relativsatz', title:'Relativsatz Dat./Gen.',
  sub:'Relativpronomen im Dativ und Genitiv',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Dat.: dem/der/dem/denen | Gen.: dessen/deren/dessen/deren',
    table:{head:['Kasus','m','f','n','Pl.'],rows:[
      ['Dat.','dem','der','dem','denen'],
      ['Gen.','dessen','deren','dessen','deren'],
    ]},
    text:'Dat. = indirektes Obj. Gen. = Besitz (чей?). Pl.Dat.: denen (nicht "den"!).'
  },
  examples:[
    sent('Die Frau, der ich helfe, ist krank.',
      [{w:'Die Frau,',r:'S'},{w:'der ich helfe,',r:'NS'},{w:'ist krank.',r:'V'}],
      'Dat.f: der'),
    sent('Der Lehrer, dessen Unterricht mir gefällt, heißt Müller.',
      [{w:'Der Lehrer,',r:'S'},{w:'dessen Unterricht mir gefällt,',r:'NS'},{w:'heißt Müller.',r:'V'}],
      'Gen.m: dessen'),
    sent('Die Kinder, denen ich geholfen habe, sind glücklich.',
      [{w:'Die Kinder,',r:'S'},{w:'denen ich geholfen habe,',r:'NS'},{w:'sind glücklich.',r:'V'}],
      'Dat.Pl.: denen'),
  ],
  exercises:[
    ex('Die Frau, ___ ich helfe. (Dat.f)','der','Dat.f: der'),
    ex('Das Kind, ___ Spielzeug verloren ist. (Gen.n)','dessen','Gen.n: dessen'),
    ex('Die Studenten, ___ ich geholfen habe. (Dat.Pl.)','denen','Dat.Pl.: denen'),
    ex('Der Mann, ___ Auto gestohlen wurde. (Gen.m)','dessen','Gen.m: dessen'),
  ]
};

CONTENT['rel_praep'] = {
  zone:'nebensatz', tag:'Relativsatz', title:'Relativsatz mit Präposition',
  sub:'Относительное с предлогом',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'Präp. + Relativpronomen(entspr. Kasus) | für Sachen: wo(r)+Präp.',
    text:'Wenn der NS-Verb eine Präposition verlangt, steht sie vor dem Relativpronomen.<br><br>Für Sachen: Pronominalrelativadverb: <em>worüber, womit, woran, worauf, wovon...</em>',
    table:{head:['Bezugswort','Präp.+Kasus','Beispiel'],rows:[
      ['Person m','mit+Dat.','der Mann, mit dem ich arbeite'],
      ['Person f','für+Akk.','die Frau, für die ich arbeite'],
      ['Sache','worüber','das Thema, worüber wir sprechen'],
      ['Sache','wofür','die Arbeit, wofür er bekannt ist'],
    ]}
  },
  examples:[
    sent('Der Kollege, mit dem ich arbeite, kommt aus Wien.',
      [{w:'Der Kollege,',r:'S'},{w:'mit dem ich arbeite,',r:'NS'},{w:'kommt aus Wien.',r:'V'}],
      'mit+Dat.m: dem'),
    sent('Das Thema, worüber wir gesprochen haben, ist wichtig.',
      [{w:'Das Thema,',r:'S'},{w:'worüber wir gesprochen haben,',r:'NS'},{w:'ist wichtig.',r:'V'}],
      'Sache: wo+r+über'),
  ],
  exercises:[
    ex('Der Mann, mit ___ sie spricht. (Dat.m)','dem','mit+Dat.m: dem'),
    ex('Die Frau, für ___ er arbeitet. (Akk.f)','die','für+Akk.f: die'),
    ex('Das Problem, ___ wir gesprochen haben. (worüber)','worüber','Sache: wo+r+über'),
    ex('Der Freund, bei ___ er wohnt. (Dat.m)','dem','bei+Dat.m: dem'),
  ]
};

CONTENT['rel_wo'] = {
  zone:'nebensatz', tag:'Relativsatz', title:'wo / worüber / was als Relativpronomen',
  sub:'Особые относительные местоимения',
  tabs:['Правило','Примеры','Упражнения'],
  rule:{
    formula:'wo = Ort | Sachen: wo(r)+Präp. | was nach: alles/nichts/etwas/das',
    table:{head:['Relativpronomen','Gebrauch','Beispiel'],rows:[
      ['wo','место','die Stadt, wo ich geboren bin'],
      ['worüber','über+Sache','das Thema, worüber wir reden'],
      ['wofür','für+Sache','der Grund, wofür er kämpft'],
      ['was','nach alles/nichts/etwas','alles, was er sagte'],
      ['was','nach Superlativ','das Beste, was mir passiert ist'],
    ]},text:''
  },
  examples:[
    sent('Berlin, wo ich geboren bin, ist meine Heimat.',
      [{w:'Berlin,',r:'S'},{w:'wo ich geboren bin,',r:'NS'},{w:'ist meine Heimat.',r:'V'}],
      'wo = Ort'),
    sent('Alles, was er sagte, war richtig.',
      [{w:'Alles,',r:'S'},{w:'was er sagte,',r:'NS'},{w:'war richtig.',r:'V'}],
      'was nach alles'),
  ],
  exercises:[
    ex('Die Stadt, ___ ich wohne. (Ort)','wo','wo=Ort'),
    ex('Alles, ___ er sagte, stimmte.','was','was nach alles'),
    ex('Das Thema, ___ wir uns gestritten haben. (worüber)','worüber','Sache: worüber'),
    ex('Das Beste, ___ je passiert ist.','was','was nach Superlativ'),
  ]
};

// ═══════════════════════════════════════════════════════════════════
// LEVEL MAPPING
// ═══════════════════════════════════════════════════════════════════
const LEVEL_META = {
  a1:{ label:'A1', color:'#3ad9a0', desc:'Начальный',
       topics:['prasens','imperativ','nomenlehre'] },
  a2:{ label:'A2', color:'#22c478', desc:'Элементарный',
       topics:['prasens','perfekt','futur1','verblehre','nomenlehre'] },
  b1:{ label:'B1', color:'#3a8fd9', desc:'Средний',
       topics:['perfekt','prateritum','futur1','konjunktiv','nebensatz','satzbau','verblehre','nomenlehre'] },
  b2:{ label:'B2', color:'#a060e0', desc:'Выше среднего',
       topics:['prateritum','plusquamp','konjunktiv','satzbau','nebensatz','nomenlehre','imperativ','verblehre'] },
  c1:{ label:'C1', color:'#ff4080', desc:'Продвинутый',
       topics:['c1strukt','nebensatz','satzbau','konjunktiv','plusquamp','verblehre','nomenlehre'] },
};

// ═══════════════════════════════════════════════════════════════════
// CANVAS
// ═══════════════════════════════════════════════════════════════════
const canvas = document.getElementById('wc');
const ctx    = canvas.getContext('2d');
const wSide  = document.getElementById('wSide');
const slider = document.getElementById('szSlider');
const szVal  = document.getElementById('szVal');

let SZ = 360; // wheel pixel size (canvas square)
let R, Ri, CX, CY; // outer radius, inner radius, center x/y

function applySize(sz) {
  SZ = sz;
  R   = Math.floor(sz / 2) - 4;   // outer radius
  Ri  = Math.round(R * 0.20);      // inner (hub) radius
  CX  = CY = Math.floor(sz / 2);   // dead center — FULL CIRCLE
  canvas.width  = sz;
  canvas.height = sz;
  canvas.style.width  = sz + 'px';
  canvas.style.height = sz + 'px';
  wSide.style.width = (sz + 36) + 'px';
  szVal.textContent = sz;
  // update slider gradient
  const pct = Math.round((sz - +slider.min) / (+slider.max - +slider.min) * 100);
  slider.style.setProperty('--pct', pct + '%');
}

slider.addEventListener('input', () => {
  applySize(+slider.value);
  drawWheel();
});

// ═══════════════════════════════════════════════════════════════════
// STATE
// ═══════════════════════════════════════════════════════════════════
let state = {
  level:'root', path:[], selected:null, hover:null,
  score:{ok:0, bad:0},
  exIdx:0, answered:false, exResults:[], activeTab:0,
  exMode:'free', exLevel:'B1', exViewIdx:0,
  freeLevel:'B1', freeTask:null, freeResult:null,
  freeHistory:[], freeLoading:false,
  freeStreaks:{}, freeStats:{ok:0,warn:0,bad:0}, taskNum:0,
};

// ═══════════════════════════════════════════════════════════════════
// SEGMENTS
// ═══════════════════════════════════════════════════════════════════
function getSegs() {
  // ROOT: 5 level slices
  if (state.level === 'root') {
    const lvs = ['a1','a2','b1','b2','c1'];
    return lvs.map((id, i, arr) => {
      const m = LEVEL_META[id];
      return { id, label:m.label, sub:m.desc, color:m.color, isLevel:true,
        sa: Math.PI*2 * i/arr.length - Math.PI/2,
        ea: Math.PI*2 * (i+1)/arr.length - Math.PI/2 };
    });
  }

  // LEVEL: topics for this level
  if (LEVEL_META[state.level]) {
    const m = LEVEL_META[state.level];
    return m.topics.map((id, i, arr) => {
      const r = ROOT_SEGS.find(s => s.id === id);
      if (!r) return null;
      return { id, label:r.label, sub:r.sub,
        color: tintColor(m.color, i, arr.length), zone:r.zone,
        sa: Math.PI*2 * i/arr.length - Math.PI/2,
        ea: Math.PI*2 * (i+1)/arr.length - Math.PI/2 };
    }).filter(Boolean);
  }

  // CHILDREN of a topic
  const ch = CHILDREN[state.level];
  if (!ch || !ch.length) return [];
  const par = findRoot(state.level);
  const base = par ? par.color : '#888';
  return ch.map((s, i, arr) => ({
    ...s,
    color: tintColor(base, i, arr.length),
    zone:  par ? par.zone : 'present',
    sa: Math.PI*2 * i/arr.length - Math.PI/2,
    ea: Math.PI*2 * (i+1)/arr.length - Math.PI/2,
  }));
}

function findRoot(id) {
  const direct = ROOT_SEGS.find(r => r.id === id);
  if (direct) return direct;
  for (const r of ROOT_SEGS) {
    if ((CHILDREN[r.id]||[]).some(c => c.id === id)) return r;
    for (const c of (CHILDREN[r.id]||[])) {
      if ((CHILDREN[c.id]||[]).some(cc => cc.id === id)) return c;
    }
  }
  return null;
}

function tintColor(hex, i, n) {
  if (n <= 1) return hex;
  const t = 0.45 + 0.55 * (i / (n-1));
  const r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16);
  const h2 = v => Math.max(14,Math.min(255,Math.round(v*t))).toString(16).padStart(2,'0');
  return `#${h2(r)}${h2(g)}${h2(b)}`;
}

// ═══════════════════════════════════════════════════════════════════
// DRAW
// ═══════════════════════════════════════════════════════════════════
function drawWheel() {
  ctx.clearRect(0, 0, SZ, SZ);

  // subtle rings
  const step = Math.round((R - Ri) / 3);
  for (let r = Ri + step; r < R; r += step) {
    ctx.beginPath(); ctx.arc(CX, CY, r, 0, Math.PI*2);
    ctx.strokeStyle = 'rgba(255,255,255,.03)'; ctx.lineWidth=1; ctx.stroke();
  }

  const segs = getSegs();
  const gap  = segs.length > 10 ? 0.006 : 0.011;

  segs.forEach(s => {
    const hov = s.id === state.hover;
    const sel = s.id === state.selected;
    const mid = (s.sa + s.ea) / 2;
    const ro  = R - 3;

    // fill sector
    ctx.save();
    ctx.beginPath();
    ctx.moveTo(CX, CY);
    ctx.arc(CX, CY, ro, s.sa+gap, s.ea-gap);
    ctx.closePath();
    const grd = ctx.createRadialGradient(CX,CY,Ri, CX,CY,ro);
    grd.addColorStop(0, s.color + (sel?'28':hov?'1a':'0a'));
    grd.addColorStop(1, s.color + (sel?'55':hov?'38':'1e'));
    ctx.fillStyle = grd; ctx.fill();
    ctx.strokeStyle = sel ? s.color : hov ? s.color+'bb' : s.color+'44';
    ctx.lineWidth   = sel ? 2.5 : 1.5;
    ctx.stroke();
    ctx.restore();

    // label
    const tr = (Ri + ro) * 0.54;
    const tx = CX + tr*Math.cos(mid);
    const ty = CY + tr*Math.sin(mid);
    ctx.save();
    ctx.translate(tx, ty);
    // rotate so text always reads outward and upright
    let rot = mid + Math.PI/2;
    if (mid > Math.PI/2 && mid < Math.PI*3/2) rot += Math.PI;
    ctx.rotate(rot);
    ctx.textAlign='center'; ctx.textBaseline='middle';

    // auto font size based on arc chord at midradius
    const chord  = 2 * tr * Math.sin((s.ea - s.sa) / 2);
    const fLabel = Math.max(7, Math.min(13, Math.floor(chord / Math.max(s.label.length, 2) * 0.85)));
    const fSub   = Math.max(6, fLabel - 3);

    ctx.font      = `700 ${fLabel}px 'DM Mono'`;
    ctx.fillStyle = sel||hov ? '#fff' : s.color + 'ee';
    ctx.fillText(s.label, 0, fSub > 6 ? -fLabel*0.55 : 0);

    if (fSub >= 6 && s.sub) {
      const maxC = Math.floor(chord / (fSub * 0.62));
      const sub  = s.sub.length > maxC ? s.sub.slice(0, maxC-1)+'…' : s.sub;
      ctx.font      = `${fSub}px 'DM Mono'`;
      ctx.fillStyle = sel ? '#fffb' : 'rgba(255,255,255,.35)';
      ctx.fillText(sub, 0, fLabel*0.6);
    }

    // expand indicator
    if (CHILDREN[s.id] || LEVEL_META[s.id]) {
      ctx.font      = `${fLabel}px DM Mono`;
      ctx.fillStyle = s.color + '77';
      ctx.fillText('▾', 0, fLabel * 1.5);
    }
    ctx.restore();
  });

  // hub
  ctx.beginPath(); ctx.arc(CX, CY, Ri, 0, Math.PI*2);
  ctx.fillStyle   = 'rgba(7,7,15,.93)'; ctx.fill();
  ctx.strokeStyle = 'rgba(255,255,255,.10)'; ctx.lineWidth=1.5; ctx.stroke();

  // hub label
  const top  = state.path.length ? state.path[state.path.length-1].label : '';
  const lines = top ? [top.slice(0,8)] : ['Deutsch','Rad'];
  const hf    = Math.max(7, Math.min(11, Math.round(Ri * 0.3)));
  ctx.save();
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.font      = `500 ${hf}px DM Mono`;
  ctx.fillStyle = 'rgba(255,255,255,.25)';
  lines.forEach((ln,i,a) => ctx.fillText(ln, CX, CY + (i-(a.length-1)/2)*(hf+3)));
  ctx.restore();
}

// ═══════════════════════════════════════════════════════════════════
// HIT TEST
// ═══════════════════════════════════════════════════════════════════
function hitTest(mx, my) {
  const dx=mx-CX, dy=my-CY, d=Math.hypot(dx,dy);
  if (d < Ri || d > R-3) return null;
  let a = Math.atan2(dy, dx);
  const segs = getSegs();
  for (const s of segs) {
    // normalise a to [sa, ea]
    let sa=s.sa, ea=s.ea, aa=a;
    while (aa < sa-0.0001) aa += Math.PI*2;
    while (aa > sa+Math.PI*2+0.0001) aa -= Math.PI*2;
    if (aa >= sa && aa <= ea) return s;
  }
  return null;
}

// ═══════════════════════════════════════════════════════════════════
// EVENTS
// ═══════════════════════════════════════════════════════════════════
canvas.addEventListener('mousemove', e => {
  const r=canvas.getBoundingClientRect();
  const s=hitTest(e.clientX-r.left, e.clientY-r.top);
  const nid=s?s.id:null;
  if (nid!==state.hover){state.hover=nid; drawWheel();}
  canvas.style.cursor = s?'pointer':'default';
});
canvas.addEventListener('mouseleave', ()=>{state.hover=null; drawWheel();});
canvas.addEventListener('click', e => {
  const r=canvas.getBoundingClientRect();
  const s=hitTest(e.clientX-r.left, e.clientY-r.top);
  if (s) clickSeg(s);
});
canvas.addEventListener('touchend', e => {
  e.preventDefault();
  const t=e.changedTouches[0], r=canvas.getBoundingClientRect();
  const s=hitTest(t.clientX-r.left, t.clientY-r.top);
  if (s) clickSeg(s);
},{passive:false});

function clickSeg(s) {
  state.selected = s.id;
  if (CHILDREN[s.id] || LEVEL_META[s.id]) {
    state.path.push({id:s.id, label:s.label, prevLevel:state.level});
    state.level    = s.id;
    state.selected = null;
  }
  renderContent(s.id);
  updateBreadcrumb();
  highlightBadge(state.path.find(p=>LEVEL_META[p.id])?.id||null);
  drawWheel();
}

document.querySelectorAll('.lvb').forEach(btn => {
  btn.addEventListener('click', () => {
    const lv=btn.dataset.lv, m=LEVEL_META[lv];
    state.path=[{id:lv,label:m.label,prevLevel:'root'}];
    state.level=lv; state.selected=null;
    updateBreadcrumb(); highlightBadge(lv);
    document.getElementById('ipTag').textContent   = m.label+' — '+m.desc;
    document.getElementById('ipTitle').textContent = 'Выберите раздел';
    document.getElementById('ipTitle').style.color = m.color;
    document.getElementById('ipSub').textContent   = m.topics.length+' разделов';
    document.getElementById('ipBody').innerHTML    =
      `<div class="ph"><div class="ph-ico" style="color:${m.color};opacity:.25">◎</div>
       <p>Нажмите на нужный раздел в колесе</p></div>`;
    drawWheel();
  });
});

document.getElementById('btnBack').addEventListener('click', goBack);
function goBack(){
  if (!state.path.length) return;
  const prev=state.path.pop();
  state.level=prev.prevLevel; state.selected=prev.id;
  updateBreadcrumb();
  highlightBadge(state.path.find(p=>LEVEL_META[p.id])?.id||null);
  drawWheel(); renderContent(prev.id);
}

function updateBreadcrumb(){
  const bc=document.getElementById('bc'), back=document.getElementById('btnBack');
  if (!state.path.length){bc.innerHTML='';back.style.display='none';return;}
  back.style.display='';
  let h=`<span class="bc-item" onclick="resetWheel()">⊙</span>`;
  state.path.forEach((p,i)=>h+=`<span class="bc-sep">›</span><span class="bc-item" onclick="navTo(${i})">${p.label}</span>`);
  bc.innerHTML=h;
}
function highlightBadge(lv){
  document.querySelectorAll('.lvb').forEach(b=>b.classList.toggle('on',b.dataset.lv===lv));
}
window.resetWheel=function(){
  state.level='root';state.path=[];state.selected=null;
  document.getElementById('btnBack').style.display='none';
  document.getElementById('bc').innerHTML='';
  highlightBadge(null); drawWheel(); showPlaceholder();
};
window.navTo=function(i){
  const p=state.path[i];
  state.path=state.path.slice(0,i+1); state.level=p.id; state.selected=null;
  updateBreadcrumb(); drawWheel();
};

// ── INIT ─────────────────────────────────────────────────────────
applySize(+slider.value);
drawWheel();

// ═══════════════════════════════════════════════════════════════════
// CONTENT RENDERING
// ═══════════════════════════════════════════════════════════════════
function showPlaceholder(){
  document.getElementById('ipTag').textContent  ='Выберите уровень';
  document.getElementById('ipTitle').textContent='Deutsch Rad C1';
  document.getElementById('ipTitle').style.color='';
  document.getElementById('ipSub').textContent  ='Колесо немецкой грамматики A1 → C1';
  document.getElementById('ipBody').innerHTML=`<div class="ph">
    <div class="ph-ico">⊙</div>
    <p>Нажмите уровень — колесо покажет разделы.<br>
    Каждый раздел раскрывается глубже.<br>
    Правило · таблица · AI-примеры · упражнения</p>
    <div class="ph-lv-row">
      <span class="ph-lv" style="--lc:var(--ca1)">A1 — Начальный</span>
      <span class="ph-lv" style="--lc:var(--ca2)">A2 — Элементарный</span>
      <span class="ph-lv" style="--lc:var(--cb1)">B1 — Средний</span>
      <span class="ph-lv" style="--lc:var(--cb2)">B2 — Выше среднего</span>
      <span class="ph-lv" style="--lc:var(--cc1)">C1 — Продвинутый</span>
    </div></div>`;
}
function gzc(z){return{past:'var(--past)',present:'var(--present)',future:'var(--future)',
  special:'var(--special)',syntax:'var(--syntax)',nebensatz:'var(--nebensatz)',
  c1color:'var(--cc1)'}[z]||'var(--gold)';}

function renderContent(id){
  if (LEVEL_META[id]) return;
  const c=CONTENT[id]; if (!c) return;
  state.activeTab=0;state.exIdx=0;state.answered=false;state.exResults=[];
  state.exMode='free';state.exLoading=false;state.freeLoading=false;
  state.freeTask=null;state.freeResult=null;state.freeHistory=[];state.selected=id;
  document.getElementById('ipTag').textContent  =c.tag;
  document.getElementById('ipTitle').textContent=c.title;
  document.getElementById('ipTitle').style.color=gzc(c.zone);
  document.getElementById('ipSub').textContent  =c.sub;
  let html='<div>';
  html+=`<div class="tabs">${(c.tabs||['Правило']).map((t,i)=>
    `<div class="tab${i===0?' active':''}" data-tab="${i}">${t}</div>`).join('')}</div>`;
  (c.tabs||['Правило']).forEach((t,i)=>{
    html+=`<div class="tab-content${i===0?' active':''}" id="tc-${i}">`;
    if(t==='Правило')html+=renderRuleTab(c);
    else if(t==='Примеры')html+=renderExamplesTab(c);
    else if(t==='Упражнения')html+=renderExerciseTab(c,0);
    html+='</div>';
  });
  html+='</div>';
  document.getElementById('ipBody').innerHTML=html;
  document.querySelectorAll('.tab').forEach(tab=>{
    tab.addEventListener('click',()=>{
      const idx=+tab.dataset.tab;
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('tc-'+idx).classList.add('active');
      state.activeTab=idx;
      const nm=c.tabs[idx];
      if(nm==='Упражнения'){
        document.getElementById('tc-'+idx).innerHTML=renderExerciseTab(c,state.exIdx);
        bindExEvents(c);
        if(state.exMode==='free'&&!state.freeTask&&!state.freeLoading)
          generateTask(c,state.freeLevel||'B1');
      }else if(nm==='Примеры'){
        document.getElementById('tc-'+idx).innerHTML=renderExamplesTab(c);
        bindExamplesEvents(c);
        if(!exCache[id]?.[state.exLevel||'B1']?.length&&!state.exLoading)
          generateExamples(c,state.exLevel||'B1',false);
      }
    });
  });
  bindExEvents(c); bindExamplesEvents(c);
}

function renderRuleTab(c){
  const r=c.rule;
  if(!r)return'<p style="color:var(--dim);font-size:.7rem">Нет данных.</p>';
  let h=`<div class="card ${c.zone||'present'}">
    <h4>Формула</h4><div class="formula">${r.formula.replace(/\n/g,'<br>')}</div>
    ${r.text?`<div class="rule-text">${r.text}</div>`:''}
  </div>`;
  if(r.table)h+=`<div class="card gold"><h4>Таблица</h4><table class="gram-table">
    <thead><tr>${r.table.head.map(h=>`<th>${h}</th>`).join('')}</tr></thead>
    <tbody>${r.table.rows.map(row=>`<tr>${row.map((cell,i)=>
      `<td class="${i===0?'hl':'de'}">${cell}</td>`).join('')}</tr>`).join('')}
    </tbody></table></div>`;
  const exs=(c.examples||[]).filter(e=>e&&e.de);
  if(exs.length){
    h+=`<div class="card ${c.zone||'present'}"><h4>Примеры</h4>`;
    h+=exs.map(ex=>{
      const chips=(ex.parts||[]).map(p=>
        `<div class="analysis-chip"><span class="w">${p.w}</span><span class="r">${p.r}</span></div>`).join('');
      return`<div class="sent-block">
        <div class="sent-de">${ex.de}</div><div class="sent-ru">${ex.ru||''}</div>
        ${ex.note?`<div class="sent-note">§ ${ex.note}</div>`:''}
        ${chips?`<div class="analysis-row">${chips}</div>`:''}
      </div>`;
    }).join('');
    h+='</div>';
  }
  return h;
}
// ═══════════════════════════════════════════════════════════════════
// LEVELS & CACHE
// ═══════════════════════════════════════════════════════════════════

const LEVELS = ['A1','A2','B1','B2','C1'];
const LEVEL_COLORS = {
  A1:'#3ad9a0', A2:'#22b87a', B1:'#3a8fd9', B2:'#c97ae0', C1:'#ff6090'
};
const LEVEL_DESC = {
  A1:'Базовый — простая лексика, S+V+O',
  A2:'Простые предложения, артикли, падежи',
  B1:'Средний — придаточные, сложные глаголы',
  B2:'Сложные многоуровневые конструкции',
  C1:'Академический — Partizipialattr., FVG, Konj.I'
};

// exCache[sectionId][level] = [{de, ru, note, parts:[{w,r}]}]
const exCache = {};

// ─── inject styles once ───────────────────────────────────────────
(function(){
  if (document.getElementById('ex-styles')) return;
  const s = document.createElement('style');
  s.id = 'ex-styles';
  s.textContent = `
/* ══ ПРИМЕРЫ ══════════════════════════════════════════════════════ */
.exT { padding: 2px 0 6px; }

.lv-bar { display:flex; gap:5px; flex-wrap:wrap; margin-bottom:10px; }
.lv-btn2 {
  position:relative; padding:4px 11px; border-radius:20px;
  border:1.5px solid var(--lvc,#666); background:transparent;
  color:var(--lvc,#aaa); cursor:pointer; font-family:inherit;
  font-size:0.62rem; font-weight:700; letter-spacing:.04em;
  transition:all .18s;
}
.lv-btn2:hover { background:color-mix(in srgb,var(--lvc) 18%,transparent); }
.lv-btn2.on { background:var(--lvc); color:#0a0a14; }
.lv-cnt {
  position:absolute; top:-5px; right:-4px;
  background:var(--lvc); color:#0a0a14;
  border-radius:8px; min-width:14px; height:14px;
  font-size:.48rem; line-height:14px; text-align:center; padding:0 3px;
}
.lv-desc {
  font-size:.6rem; color:var(--dim2); margin-bottom:10px;
  padding-left:8px; border-left:2px solid var(--lvb,#444); line-height:1.5;
}
.ex-collected { font-size:.5rem; color:var(--dim); margin-bottom:8px; }

/* card */
.ex-card2 {
  background:var(--s2); border-radius:10px; padding:14px 14px 10px;
  border:1px solid var(--border); margin-bottom:8px; position:relative;
  animation:fadeUp .2s ease;
}
.ex-card2.z-past    { border-color:#d94f3a33; }
.ex-card2.z-present { border-color:#3ad9a033; }
.ex-card2.z-future  { border-color:#3a8fd933; }
.ex-card2.z-special { border-color:#c97ae033; }
.ex-card2.z-syntax  { border-color:#e07a4033; }
.ex-card2.z-nebensatz{ border-color:#4ae0c033; }
.ex-card2.z-c1color { border-color:#ff609033; }

.ex-lv-pip {
  position:absolute; top:10px; right:10px;
  padding:2px 7px; border-radius:9px; font-size:.5rem;
  font-weight:700; color:#0a0a14;
}
.ex-num { font-size:.5rem; color:var(--dim); margin-bottom:6px; }
.ex-de  { font-family:'EB Garamond',serif; font-size:1.05rem;
  line-height:1.5; color:#eef; margin-bottom:5px; }
.ex-ru  { font-size:.7rem; color:var(--dim2); margin-bottom:4px; }
.ex-note{ font-size:.58rem; color:var(--gold); background:#fff06;
  padding:2px 7px; border-radius:4px; display:inline-block; margin-top:2px; }

/* breakdown toggle */
.ex-bd-toggle {
  margin-top:8px; border:none; background:none; padding:0;
  color:var(--dim); font-family:inherit; font-size:.58rem;
  cursor:pointer; transition:color .15s;
}
.ex-bd-toggle:hover { color:var(--dim2); }
.ex-bd-panel { display:none; flex-wrap:wrap; gap:4px; margin-top:7px; }
.ex-bd-panel.open { display:flex; }
.ex-chip {
  display:flex; flex-direction:column; align-items:center;
  background:#fff09; border-radius:5px; padding:3px 7px; gap:1px;
}
.ex-chip span:first-child { font-size:.72rem; color:#dde0f0; }
.ex-chip span:last-child  { font-size:.44rem; color:var(--gold); text-transform:uppercase; }

/* nav */
.ex-nav {
  display:flex; align-items:center; gap:8px; margin-bottom:8px;
}
.ex-nav-btn2 {
  flex:0 0 auto; padding:5px 13px;
  background:var(--s3); border:1px solid var(--border);
  border-radius:7px; color:var(--dim2); cursor:pointer;
  font-family:inherit; font-size:.62rem; transition:all .14s;
}
.ex-nav-btn2:hover:not(:disabled) { color:#fff; border-color:#fff4; }
.ex-nav-btn2:disabled { opacity:.3; cursor:default; }
.ex-pg-dots { flex:1; display:flex; justify-content:center; gap:4px; flex-wrap:wrap; }
.ex-pg-dot {
  width:7px; height:7px; border-radius:50%;
  background:var(--s3); border:1px solid var(--border); transition:all .2s;
}
.ex-pg-dot.cur {
  background:var(--lvc,#3a8fd9); border-color:var(--lvc,#3a8fd9);
  width:18px; border-radius:4px;
}

/* more/gen buttons */
.ex-gen-btn {
  display:flex; align-items:center; gap:8px; width:100%;
  padding:10px 14px; background:transparent;
  border:1.5px dashed var(--border); border-radius:8px;
  color:var(--dim2); cursor:pointer; font-family:inherit;
  font-size:.65rem; transition:all .18s; margin-top:2px;
}
.ex-gen-btn:hover { border-color:#fff5; color:#fff; background:#fff04; }
.ex-gen-btn.primary { border-color:var(--lvc,#3a8fd9); color:var(--lvc,#3a8fd9); }
.ex-gen-pulse {
  width:8px; height:8px; border-radius:50%;
  background:var(--lvc,#3a8fd9); animation:pulse2 1.4s infinite;
}
@keyframes pulse2 {
  0%,100%{opacity:1;transform:scale(1)}
  50%{opacity:.5;transform:scale(1.3)}
}

/* loading */
.ex-loading {
  display:flex; flex-direction:column; align-items:center;
  gap:10px; padding:30px 10px; color:var(--dim2); font-size:.65rem;
  text-align:center; line-height:1.6;
}
.ex-spinner {
  width:28px; height:28px; border-radius:50%;
  border:2px solid var(--border); border-top-color:var(--lvc,#3a8fd9);
  animation:spin2 .75s linear infinite; flex:0 0 auto;
}
@keyframes spin2 { to { transform:rotate(360deg); } }

.ex-empty { padding:24px; text-align:center; }
.ex-empty-ico { font-size:2rem; opacity:.12; margin-bottom:8px; }
.ex-empty-txt { font-size:.65rem; color:var(--dim2); }
.ex-builtin-lbl {
  font-size:.5rem; color:var(--dim); letter-spacing:.08em;
  text-transform:uppercase; margin-bottom:8px;
}

/* ══ УПРАЖНЕНИЯ ════════════════════════════════════════════════════ */
.ewW { padding:2px 0 6px; }

.ew-tabs {
  display:flex; gap:5px; margin-bottom:12px;
}
.ew-tab {
  flex:1; padding:7px 4px; background:var(--s2);
  border:1.5px solid var(--border); border-radius:8px;
  color:var(--dim2); cursor:pointer; font-family:inherit;
  font-size:.62rem; font-weight:600; text-align:center;
  transition:all .18s;
}
.ew-tab:hover { border-color:#fff3; color:#fff; }
.ew-tab.on { background:var(--s3); border-color:#fff3; color:#fff; }

/* fill-in */
.ew-fi { }
.ew-prog { display:flex; gap:4px; flex-wrap:wrap; margin-bottom:10px; }
.ew-prog-dot {
  width:8px; height:8px; border-radius:50%;
  background:var(--s3); border:1px solid var(--border); transition:all .2s;
}
.ew-prog-dot.ok  { background:#3ad9a0; border-color:#3ad9a0; }
.ew-prog-dot.bad { background:#d94f3a; border-color:#d94f3a; }
.ew-prog-dot.cur { background:var(--gold); border-color:var(--gold); width:18px; border-radius:4px; }
.ew-q {
  font-family:'EB Garamond',serif; font-size:.9rem; line-height:1.6;
  color:#eef; margin-bottom:11px;
}
.ew-blank { color:var(--gold); border-bottom:1.5px solid var(--gold); padding:0 4px; }
.ew-input {
  width:100%; padding:9px 12px; background:var(--s1);
  border:1.5px solid var(--border); border-radius:7px;
  color:var(--text); font-family:inherit; font-size:.82rem;
  margin-bottom:8px; transition:border-color .18s;
}
.ew-input:focus { outline:none; border-color:#fff4; }
.ew-input.ok  { border-color:#3ad9a0; background:#3ad9a010; }
.ew-input.bad { border-color:#d94f3a; background:#d94f3a10; }
.ew-btns-row { display:flex; gap:6px; margin-bottom:8px; }
.ew-btn-chk {
  flex:2; padding:8px; background:var(--s3);
  border:1.5px solid #fff2; border-radius:7px;
  color:#fff; cursor:pointer; font-family:inherit;
  font-size:.65rem; font-weight:600; transition:all .15s;
}
.ew-btn-chk:hover { border-color:#fff5; }
.ew-btn-nxt {
  flex:1; padding:8px; background:transparent;
  border:1.5px solid var(--border); border-radius:7px;
  color:var(--dim2); cursor:pointer; font-family:inherit;
  font-size:.65rem; transition:all .15s;
}
.ew-btn-nxt:hover { color:#fff; border-color:#fff3; }
.ew-fb {
  font-size:.68rem; line-height:1.6; padding:8px 10px;
  border-radius:6px; min-height:0; margin-bottom:0;
}
.ew-fb.ok  { background:#3ad9a014; border:1px solid #3ad9a040; color:#3ad9a0; }
.ew-fb.bad { background:#d94f3a14; border:1px solid #d94f3a40; color:#ff8070; }

/* free writing */
.ew-fw { }
.ew-lv-row { display:flex; gap:5px; flex-wrap:wrap; margin-bottom:10px; }
.ew-lv-btn {
  padding:4px 11px; border-radius:20px; border:1.5px solid var(--lvc,#666);
  background:transparent; color:var(--lvc,#aaa); cursor:pointer;
  font-family:inherit; font-size:.62rem; font-weight:700; transition:all .18s;
}
.ew-lv-btn:hover { background:color-mix(in srgb,var(--lvc) 18%,transparent); }
.ew-lv-btn.on { background:var(--lvc); color:#0a0a14; }

/* task card */
.ew-task {
  border-radius:10px; padding:13px 13px 10px;
  border-left:3px solid var(--lvc,#3a8fd9);
  background:var(--s2); margin-bottom:10px;
}
.ew-task-meta {
  display:flex; align-items:center; gap:6px; flex-wrap:wrap; margin-bottom:6px;
}
.ew-task-lv {
  padding:2px 7px; border-radius:9px; font-size:.5rem;
  font-weight:700; color:#0a0a14; background:var(--lvc,#3a8fd9);
}
.ew-task-type {
  font-size:.52rem; color:var(--dim2);
  text-transform:uppercase; letter-spacing:.05em;
}
.ew-task-num { font-size:.5rem; color:var(--dim); margin-left:auto; }
.ew-task-instr {
  font-family:'EB Garamond',serif; font-size:.88rem;
  line-height:1.5; color:#eef; margin-bottom:7px;
}
.ew-task-hint {
  font-size:.62rem; color:var(--gold); padding:4px 8px;
  background:#fff06; border-radius:5px; margin-bottom:6px;
}
.ew-task-words { display:flex; flex-wrap:wrap; gap:4px; margin-top:3px; }
.ew-word {
  padding:3px 9px; background:#fff09; border:1px solid var(--border);
  border-radius:12px; color:var(--dim2); cursor:pointer;
  font-size:.62rem; font-family:'EB Garamond',serif;
  transition:all .14s; user-select:none;
}
.ew-word:hover { background:#fff14; color:#fff; }

/* textarea */
.ew-ta-wrap { position:relative; margin-bottom:7px; }
.ew-ta {
  width:100%; padding:10px 36px 10px 12px;
  background:var(--s1); border:1.5px solid var(--border);
  border-radius:8px; color:var(--text);
  font-family:'EB Garamond',serif; font-size:.95rem;
  resize:none; line-height:1.5; transition:border-color .18s;
}
.ew-ta:focus { outline:none; border-color:#fff4; }
.ew-ta-cnt {
  position:absolute; bottom:8px; right:10px;
  font-size:.5rem; color:var(--dim); pointer-events:none;
}
.ew-fw-btns { display:flex; gap:6px; margin-bottom:10px; }
.ew-submit {
  flex:3; padding:9px; background:var(--s3);
  border:1.5px solid #fff2; border-radius:7px;
  color:#fff; cursor:pointer; font-family:inherit;
  font-size:.65rem; font-weight:600; transition:all .15s;
}
.ew-submit:hover { border-color:#fff5; }
.ew-skip {
  flex:1; padding:9px; background:transparent;
  border:1.5px solid var(--border); border-radius:7px;
  color:var(--dim2); cursor:pointer; font-family:inherit;
  font-size:.65rem; transition:all .15s;
}
.ew-skip:hover { color:#fff; border-color:#fff3; }

/* result */
.ew-result {
  border-radius:10px; padding:12px; margin-bottom:10px;
  border:1px solid; animation:fadeUp .2s;
}
.ew-result.ok   { background:#3ad9a010; border-color:#3ad9a040; }
.ew-result.warn { background:#e0c46a10; border-color:#e0c46a40; }
.ew-result.bad  { background:#d94f3a10; border-color:#d94f3a40; }
.ew-res-hdr { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
.ew-res-ico { font-size:1.1rem; line-height:1; }
.ew-result.ok   .ew-res-ico { color:#3ad9a0; }
.ew-result.warn .ew-res-ico { color:#e0c46a; }
.ew-result.bad  .ew-res-ico { color:#d94f3a; }
.ew-res-lbl { font-size:.7rem; font-weight:600; color:#eef; }
.ew-sent-out {
  font-family:'EB Garamond',serif; font-size:.92rem;
  line-height:1.5; color:#eef; margin-bottom:8px;
}
.ew-err-word { color:#ff8070; border-bottom:1.5px dashed #d94f3a; cursor:help; }
.ew-corrected { margin-bottom:8px; }
.ew-corrected-lbl {
  font-size:.5rem; color:var(--dim); text-transform:uppercase;
  letter-spacing:.06em; margin-bottom:3px;
}
.ew-corrected-txt {
  font-family:'EB Garamond',serif; font-size:.88rem;
  color:#3ad9a0; line-height:1.5;
}
.ew-feedback { font-size:.67rem; color:var(--dim2); line-height:1.6; margin-bottom:8px; }
.ew-errors { margin-bottom:8px; }
.ew-err-row {
  display:flex; gap:6px; align-items:flex-start; margin-bottom:5px;
}
.ew-err-tag {
  flex:0 0 auto; font-size:.5rem; padding:1px 5px;
  background:#d94f3a30; color:#ff8070;
  border-radius:4px; font-weight:700; margin-top:2px;
}
.ew-err-txt { font-size:.65rem; color:var(--dim2); line-height:1.5; }
.ew-err-wrong { color:#ff8070; text-decoration:line-through; }
.ew-err-right { color:#3ad9a0; }
.ew-parts-row { display:flex; flex-wrap:wrap; gap:4px; margin-top:6px; }
.ew-part {
  display:flex; flex-direction:column; align-items:center; gap:1px;
  background:#fff08; border-radius:5px; padding:3px 7px;
}
.ew-part span:first-child { font-size:.7rem; color:#dde0f0; }
.ew-part span:last-child  { font-size:.44rem; color:var(--gold); text-transform:uppercase; }
.ew-tip {
  font-size:.62rem; color:var(--gold); padding:5px 8px;
  background:#e0c46a08; border-radius:5px; margin-top:6px;
}

/* stats */
.ew-stats { display:flex; gap:5px; margin-bottom:10px; }
.ew-stat {
  flex:1; text-align:center; background:var(--s2);
  border-radius:8px; padding:7px 2px; border:1px solid var(--border);
}
.ew-stat-val { font-size:1.1rem; font-family:'EB Garamond',serif; }
.ew-stat-val.g { color:#3ad9a0; }
.ew-stat-val.y { color:#e0c46a; }
.ew-stat-val.r { color:#d94f3a; }
.ew-stat-lbl { font-size:.45rem; color:var(--dim); text-transform:uppercase; letter-spacing:.05em; }

/* history */
.ew-hist { margin-top:6px; }
.ew-hist-hdr { display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; }
.ew-hist-ttl { font-size:.52rem; color:var(--dim); text-transform:uppercase; letter-spacing:.05em; }
.ew-hist-clr {
  background:none; border:none; color:var(--dim); cursor:pointer;
  font-size:.52rem; font-family:inherit; padding:2px 5px;
}
.ew-hist-clr:hover { color:#fff; }
.ew-hist-item {
  padding:6px 8px; border-radius:6px; margin-bottom:4px;
  background:var(--s2); border-left:2.5px solid;
}
.ew-hist-item.ok   { border-color:#3ad9a0; }
.ew-hist-item.warn { border-color:#e0c46a; }
.ew-hist-item.bad  { border-color:#d94f3a; }
.ew-hist-sent { font-size:.72rem; font-family:'EB Garamond',serif; color:#dde0f0; margin-bottom:2px; }
.ew-hist-fb   { font-size:.6rem; color:var(--dim2); }

/* ai spinner inline */
.ai-sp { display:flex; align-items:center; gap:10px; padding:14px 4px; color:var(--dim2); font-size:.65rem; }
.ai-sp-ring {
  width:18px; height:18px; border-radius:50%;
  border:2px solid var(--border); border-top-color:#3a8fd9;
  flex:0 0 auto; animation:spin2 .75s linear infinite;
}

/* empty state for exercises */
.ew-empty {
  padding:24px; text-align:center; color:var(--dim2); font-size:.65rem;
}
.ew-empty-ico { font-size:2rem; opacity:.12; margin-bottom:8px; }
`;
  document.head.appendChild(s);
})();

// ═══════════════════════════════════════════════════════════════════
// ВКЛАДКА «ПРИМЕРЫ»
// ═══════════════════════════════════════════════════════════════════

function renderExamplesTab(c) {
  const id   = state.selected;
  const cur  = state.exLevel || 'B1';
  const cache= exCache[id] || {};
  const list = cache[cur] || [];
  const vi   = Math.max(0, Math.min(list.length - 1, state.exViewIdx || 0));

  const lvBtns = LEVELS.map(lv => {
    const n = (exCache[id]?.[lv]||[]).length;
    const on = lv === cur;
    return `<button class="lv-btn2${on?' on':''}" data-lv="${lv}"
      style="--lvc:${LEVEL_COLORS[lv]}">
      ${lv}${n ? `<span class="lv-cnt">${n}</span>` : ''}
    </button>`;
  }).join('');

  const total = Object.values(exCache[id]||{}).reduce((s,a)=>s+(a||[]).length,0);

  let body = '';
  if (state.exLoading) {
    body = `<div class="ex-loading">
      <div class="ex-spinner" style="border-top-color:${LEVEL_COLORS[cur]}"></div>
      Генерирую примеры уровня <b style="color:${LEVEL_COLORS[cur]}">${cur}</b><br>
      <span style="font-size:.6rem;opacity:.7">«${c.title}»…</span>
    </div>`;
  } else if (list.length) {
    const ex   = list[vi];
    const chips = (ex.parts||[]).map(p =>
      `<div class="ex-chip"><span>${p.w||''}</span><span>${p.r||''}</span></div>`
    ).join('');
    const bdId = 'exBd_' + id + '_' + cur + '_' + vi;
    const dots = list.map((_,i) =>
      `<div class="ex-pg-dot${i===vi?' cur':''}" style="${i===vi?'--lvc:'+LEVEL_COLORS[cur]:''}"></div>`
    ).join('');

    body = `
    <div class="ex-card2 z-${c.zone||'present'}">
      <div class="ex-lv-pip" style="background:${LEVEL_COLORS[cur]}">${cur}</div>
      <div class="ex-num">${vi+1} / ${list.length}</div>
      <div class="ex-de">${ex.de||''}</div>
      <div class="ex-ru">${ex.ru||''}</div>
      ${ex.note ? `<div class="ex-note">§ ${ex.note}</div>` : ''}
      ${chips ? `
      <button class="ex-bd-toggle" onclick="toggleBd('${bdId}',this)">▾ разбор</button>
      <div class="ex-bd-panel" id="${bdId}">${chips}</div>` : ''}
    </div>
    <div class="ex-nav">
      <button class="ex-nav-btn2" id="exPrev" ${vi===0?'disabled':''}>← Назад</button>
      <div class="ex-pg-dots">${dots}</div>
      <button class="ex-nav-btn2" id="exNext" ${vi===list.length-1?'disabled':''}>Вперёд →</button>
    </div>
    <button class="ex-gen-btn" id="btnMore" style="--lvc:${LEVEL_COLORS[cur]}">
      <span class="ex-gen-pulse" style="background:${LEVEL_COLORS[cur]}"></span>
      Ещё 5 примеров уровня ${cur}
    </button>`;
  } else {
    // Built-in examples while not yet loaded
    const builtin = (c.examples||[]).filter(e=>e&&e.de);
    const bi = state._bi || 0;
    if (builtin.length) {
      const ex = builtin[bi] || builtin[0];
      const chips = (ex.parts||[]).map(p =>
        `<div class="ex-chip"><span>${p.w}</span><span>${p.r}</span></div>`
      ).join('');
      const bdId = 'exBd_bi_' + id + '_' + bi;
      const dots = builtin.map((_,i)=>
        `<div class="ex-pg-dot${i===bi?' cur':''}"></div>`).join('');
      body = `
      <div class="ex-builtin-lbl">Встроенные — выберите уровень выше для AI-примеров</div>
      <div class="ex-card2 z-${c.zone||'present'}">
        <div class="ex-num">${bi+1} / ${builtin.length}</div>
        <div class="ex-de" id="bi-de">${ex.de}</div>
        <div class="ex-ru" id="bi-ru">${ex.ru||''}</div>
        ${ex.note?`<div class="ex-note" id="bi-note">§ ${ex.note}</div>`:'<div id="bi-note"></div>'}
        ${chips?`<button class="ex-bd-toggle" onclick="toggleBd('${bdId}',this)">▾ разбор</button>
        <div class="ex-bd-panel" id="${bdId}">${chips}</div>`:''}
      </div>
      <div class="ex-nav">
        <button class="ex-nav-btn2" id="biPrev" ${builtin.length<=1||bi===0?'disabled':''}>← Назад</button>
        <div class="ex-pg-dots" id="biDots">${dots}</div>
        <button class="ex-nav-btn2" id="biNext" ${builtin.length<=1||bi===builtin.length-1?'disabled':''}>Вперёд →</button>
      </div>`;
    } else {
      body = `<div class="ex-empty"><div class="ex-empty-ico">§</div>
        <div class="ex-empty-txt">${LEVEL_DESC[cur]}</div></div>`;
    }
    body += `<button class="ex-gen-btn primary" id="btnGen" style="--lvc:${LEVEL_COLORS[cur]}">
      <span class="ex-gen-pulse" style="background:${LEVEL_COLORS[cur]}"></span>
      ✦ Сгенерировать 5 примеров уровня ${cur}
    </button>`;
  }

  return `<div class="exT">
    <div class="lv-bar">${lvBtns}</div>
    <div class="lv-desc" style="--lvb:${LEVEL_COLORS[cur]}">${LEVEL_DESC[cur]}</div>
    ${total ? `<div class="ex-collected">✦ Собрано AI-примеров: ${total}</div>` : ''}
    <div id="exBody">${body}</div>
  </div>`;
}

window.toggleBd = function(id, btn) {
  const el = document.getElementById(id);
  if (!el) return;
  el.classList.toggle('open');
  btn.textContent = el.classList.contains('open') ? '▴ разбор' : '▾ разбор';
};

function bindExamplesEvents(c) {
  // Level buttons
  document.querySelectorAll('.lv-btn2').forEach(btn => {
    btn.addEventListener('click', () => {
      state.exLevel = btn.dataset.lv;
      state.exViewIdx = 0;
      if (!(exCache[state.selected]?.[btn.dataset.lv]?.length) && !state.exLoading) {
        generateExamples(c, btn.dataset.lv, false);
      } else {
        refreshExamplesTab(c);
      }
    });
  });

  // AI navigation
  const btnPrev = document.getElementById('exPrev');
  const btnNext = document.getElementById('exNext');
  const list = exCache[state.selected]?.[state.exLevel||'B1'] || [];
  if (btnPrev) btnPrev.addEventListener('click', () => {
    state.exViewIdx = Math.max(0, (state.exViewIdx||0) - 1);
    refreshExamplesTab(c);
  });
  if (btnNext) btnNext.addEventListener('click', () => {
    state.exViewIdx = Math.min(list.length - 1, (state.exViewIdx||0) + 1);
    refreshExamplesTab(c);
  });

  // Generate buttons
  document.getElementById('btnGen')?.addEventListener('click', () =>
    generateExamples(c, state.exLevel||'B1', false));
  document.getElementById('btnMore')?.addEventListener('click', () =>
    generateExamples(c, state.exLevel||'B1', true));

  // Built-in navigation
  const builtins = (c.examples||[]).filter(e=>e&&e.de);
  const biPrev = document.getElementById('biPrev');
  const biNext = document.getElementById('biNext');
  if (biPrev || biNext) {
    const navBi = dir => {
      const bi = Math.max(0, Math.min(builtins.length-1, (state._bi||0)+dir));
      state._bi = bi;
      const ex = builtins[bi];
      const de = document.getElementById('bi-de');
      const ru = document.getElementById('bi-ru');
      const note = document.getElementById('bi-note');
      const dots = document.getElementById('biDots');
      if (de)   de.textContent   = ex.de;
      if (ru)   ru.textContent   = ex.ru||'';
      if (note) note.innerHTML   = ex.note ? `§ ${ex.note}` : '';
      if (dots) dots.innerHTML   = builtins.map((_,i)=>
        `<div class="ex-pg-dot${i===bi?' cur':''}"></div>`).join('');
      if (biPrev) biPrev.disabled = bi === 0;
      if (biNext) biNext.disabled = bi === builtins.length-1;
    };
    biPrev?.addEventListener('click', ()=>navBi(-1));
    biNext?.addEventListener('click', ()=>navBi(1));
  }
}

function refreshExamplesTab(c) {
  const idx = (c.tabs||[]).indexOf('Примеры');
  if (idx < 0) return;
  const tc = document.getElementById('tc-'+idx);
  if (!tc) return;
  tc.innerHTML = renderExamplesTab(c);
  bindExamplesEvents(c);
}

async function generateExamples(c, level, append) {
  const id = state.selected;
  if (!exCache[id]) exCache[id] = {};
  state.exLoading = true;
  refreshExamplesTab(c);

  const existing = (exCache[id][level]||[]).map(e=>e.de).join(' | ');
  const avoid    = existing ? `Не повторяй: «${existing.slice(0,500)}»` : '';

  const sys  = 'Ты учитель немецкого. Отвечай ТОЛЬКО JSON-массивом — без markdown, без пояснений.';
  const user = `5 примеров для темы «${c.title}» (${c.sub}).
Уровень: ${level} — ${LEVEL_DESC[level]}.
Грамматика: ${c.rule?.formula||c.title}.
${avoid}

Каждый пример ОБЯЗАН демонстрировать именно эту грамматику. Разнообразная тематика.

[{"de":"…","ru":"…","note":"грамматический комментарий","parts":[{"w":"слово","r":"S/V/Oa/Od/Adv/Adj/N/NS"}]}]`;

  try {
    const raw    = await callClaude(sys, user, 1500);
    const clean  = raw.replace(/```json|```/g,'').trim();
    const parsed = JSON.parse(clean);
    if (append) {
      exCache[id][level] = [...(exCache[id][level]||[]), ...parsed];
      state.exViewIdx = exCache[id][level].length - parsed.length;
    } else {
      exCache[id][level] = parsed;
      state.exViewIdx = 0;
    }
  } catch(e) {
    exCache[id][level] = exCache[id][level] || [{
      de:'Fehler beim Laden.', ru:'Ошибка загрузки.', note:'Проверьте соединение', parts:[]
    }];
  }
  state.exLoading = false;
  refreshExamplesTab(c);
}

// ═══════════════════════════════════════════════════════════════════
// ВКЛАДКА «УПРАЖНЕНИЯ»
// ═══════════════════════════════════════════════════════════════════

function renderExerciseTab(c, idx) {
  const mode = state.exMode || 'free';
  const tabBar = `<div class="ew-tabs">
    <button class="ew-tab${mode==='fill'?' on':''}" data-mode="fill">📝 Заполнить пробел</button>
    <button class="ew-tab${mode==='free'?' on':''}" data-mode="free">✍ Писать с нуля</button>
  </div>`;
  return `<div class="ewW">${tabBar}${mode==='free'
    ? renderFreePanel(c)
    : renderFillPanel(c,idx)}
  </div>`;
}

// ── Fill-in panel ──────────────────────────────────────────────────
function renderFillPanel(c, idx) {
  if (!(c.exercises||[]).length)
    return `<div class="ew-empty"><div class="ew-empty-ico">§</div>Нет упражнений заполнения.</div>`;

  const exs  = c.exercises;
  const e    = exs[idx];
  const dots = exs.map((_,i) => {
    const cl = i < state.exResults.length
      ? (state.exResults[i] ? 'ok' : 'bad')
      : (i === idx ? 'cur' : '');
    return `<div class="ew-prog-dot ${cl}"></div>`;
  }).join('');

  return `<div class="ew-fi">
    <div style="font-size:.5rem;color:var(--dim);text-transform:uppercase;letter-spacing:.07em;margin-bottom:6px">
      Упражнение ${idx+1} / ${exs.length}
    </div>
    <div class="ew-prog">${dots}</div>
    <div class="ew-q">${e.q.replace(/___/g,'<span class="ew-blank">___</span>')}</div>
    <input id="ewInp" class="ew-input" type="text" placeholder="Ваш ответ…" autocomplete="off" spellcheck="false"/>
    <div class="ew-btns-row">
      <button class="ew-btn-chk" id="ewChk">Проверить</button>
      <button class="ew-btn-nxt" id="ewNxt">Далее →</button>
    </div>
    <div class="ew-fb" id="ewFb"></div>
  </div>`;
}

// ── Free writing panel ─────────────────────────────────────────────
function renderFreePanel(c) {
  const lv      = state.freeLevel || 'B1';
  const streaks = state.freeStreaks || {};
  const hist    = state.freeHistory || [];

  const lvRow = LEVELS.map(l => {
    const s = streaks[l]||0;
    const badge = s>=3 ? ` 🔥${s}` : s>=1 ? ` ✓${s}` : '';
    return `<button class="ew-lv-btn${l===lv?' on':''}" data-lv="${l}"
      style="--lvc:${LEVEL_COLORS[l]}">${l}${badge}</button>`;
  }).join('');

  // Task block
  let task = '';
  if (state.freeLoading) {
    task = `<div class="ai-sp"><div class="ai-sp-ring"></div>${state.freeLoadMsg||'Создаю задание…'}</div>`;
  } else if (state.freeTask) {
    const t  = state.freeTask;
    const ws = (t.words||[]).map(w =>
      `<span class="ew-word" onclick="insertW(${JSON.stringify(w)})">📌 ${w}</span>`
    ).join('');
    task = `<div class="ew-task" style="--lvc:${LEVEL_COLORS[t.level||lv]}">
      <div class="ew-task-meta">
        <span class="ew-task-lv">${t.level||lv}</span>
        <span class="ew-task-type">${t.taskType||'Составить'}</span>
        ${state.taskNum ? `<span class="ew-task-num">№${state.taskNum}</span>` : ''}
      </div>
      <div class="ew-task-instr">${t.instruction||''}</div>
      ${t.hint ? `<div class="ew-task-hint">💡 ${t.hint}</div>` : ''}
      ${ws ? `<div class="ew-task-words">${ws}</div>` : ''}
    </div>`;
  } else {
    task = `<div class="ew-empty"><div class="ew-empty-ico">✎</div>
      Выберите уровень — AI создаст задание по теме «${c.title}»</div>`;
  }

  // Result
  const result = (!state.freeLoading && state.freeResult)
    ? renderResult(state.freeResult) : '';

  // Stats
  const ok = (state.freeStats||{}).ok||0;
  const wn = (state.freeStats||{}).warn||0;
  const ba = (state.freeStats||{}).bad||0;
  const tot= ok+wn+ba;
  const stats = tot ? `<div class="ew-stats">
    <div class="ew-stat"><div class="ew-stat-val g">${ok}</div><div class="ew-stat-lbl">Отлично</div></div>
    <div class="ew-stat"><div class="ew-stat-val y">${wn}</div><div class="ew-stat-lbl">Почти</div></div>
    <div class="ew-stat"><div class="ew-stat-val r">${ba}</div><div class="ew-stat-lbl">Ошибки</div></div>
    <div class="ew-stat"><div class="ew-stat-val">${tot}</div><div class="ew-stat-lbl">Всего</div></div>
  </div>` : '';

  // History
  const histHtml = hist.length ? `<div class="ew-hist">
    <div class="ew-hist-hdr">
      <span class="ew-hist-ttl">История (${hist.length})</span>
      <button class="ew-hist-clr" id="ewHistClr">очистить</button>
    </div>
    ${hist.slice(-5).reverse().map(h=>`
    <div class="ew-hist-item ${h.sc}">
      <div class="ew-hist-sent">${h.sent}</div>
      <div class="ew-hist-fb">${h.fb}</div>
    </div>`).join('')}
  </div>` : '';

  const hasTask = state.freeTask && !state.freeLoading;

  return `<div class="ew-fw">
    <div class="ew-lv-row">${lvRow}</div>
    ${task}
    ${result}
    ${hasTask ? `
    <div class="ew-ta-wrap">
      <textarea id="ewTa" class="ew-ta" rows="3"
        placeholder="Напишите немецкое предложение…" spellcheck="false"></textarea>
      <span class="ew-ta-cnt" id="ewCnt">0</span>
    </div>
    <div class="ew-fw-btns">
      <button class="ew-submit" id="ewSub">✓ Проверить</button>
      <button class="ew-skip"   id="ewSkip">↻ Другое</button>
    </div>` : ''}
    ${stats}
    ${histHtml}
  </div>`;
}

function renderResult(r) {
  const sc     = r.score==='perfect'?'ok':r.score==='good'?'warn':'bad';
  const ico    = {perfect:'✓', good:'≈', errors:'✗'}[r.score]||'?';
  const lbl    = {perfect:'Отлично!', good:'Почти правильно', errors:'Есть ошибки'}[r.score]||r.score;

  // annotate errors in sentence
  let sentHtml = r.sentence||'';
  (r.annotations||[]).forEach(ann => {
    if (ann.wrong && sentHtml.includes(ann.wrong)) {
      sentHtml = sentHtml.replace(ann.wrong,
        `<span class="ew-err-word" title="${(ann.explain||'').replace(/"/g,"'")}">${ann.wrong}</span>`);
    }
  });

  const errs = (r.errors||[]).map(e => {
    if (typeof e === 'string')
      return `<div class="ew-err-row"><span class="ew-err-tag">!</span><span class="ew-err-txt">${e}</span></div>`;
    return `<div class="ew-err-row">
      <span class="ew-err-tag">${e.type||'!'}</span>
      <span class="ew-err-txt">
        ${e.wrong ? `<span class="ew-err-wrong">${e.wrong}</span> → <span class="ew-err-right">${e.correct||''}</span><br>` : ''}
        ${e.explain||''}
      </span>
    </div>`;
  }).join('');

  const parts = (r.parts||[]).length ? `
    <div style="font-size:.5rem;color:var(--dim);text-transform:uppercase;letter-spacing:.05em;margin:6px 0 4px">Разбор:</div>
    <div class="ew-parts-row">${(r.parts||[]).map(p=>
      `<div class="ew-part"><span>${p.w}</span><span>${p.r}</span></div>`).join('')}</div>` : '';

  return `<div class="ew-result ${sc}">
    <div class="ew-res-hdr">
      <span class="ew-res-ico">${ico}</span>
      <span class="ew-res-lbl">${lbl}</span>
    </div>
    <div class="ew-sent-out">${sentHtml}</div>
    ${r.corrected && r.corrected !== r.sentence ? `<div class="ew-corrected">
      <div class="ew-corrected-lbl">Правильный вариант</div>
      <div class="ew-corrected-txt">${r.corrected}</div>
    </div>` : ''}
    ${r.feedback ? `<div class="ew-feedback">${r.feedback}</div>` : ''}
    ${errs ? `<div class="ew-errors">${errs}</div>` : ''}
    ${parts}
    ${r.tip ? `<div class="ew-tip">💡 ${r.tip}</div>` : ''}
  </div>`;
}

// ── Event binding ──────────────────────────────────────────────────
function bindExEvents(c) {
  // Tab switcher
  document.querySelectorAll('.ew-tab').forEach(btn => {
    btn.addEventListener('click', () => {
      state.exMode = btn.dataset.mode;
      state.freeResult = null;
      const ti = (c.tabs||[]).indexOf('Упражнения');
      const tc = document.getElementById('tc-'+ti);
      if (tc) { tc.innerHTML = renderExerciseTab(c, state.exIdx); bindExEvents(c); }
    });
  });
  if ((state.exMode||'free') === 'free') bindFreeEvents(c);
  else bindFillEvents(c);
}

function bindFillEvents(c) {
  const inp  = document.getElementById('ewInp');
  const chk  = document.getElementById('ewChk');
  const nxt  = document.getElementById('ewNxt');
  if (!inp||!chk||!nxt) return;
  inp.focus();
  inp.addEventListener('keydown', e => { if (e.key==='Enter') chk.click(); });
  chk.addEventListener('click', () => {
    if (state.answered) return;
    state.answered = true;
    const val = inp.value.trim();
    const e   = c.exercises[state.exIdx];
    const ok  = val.toLowerCase() === e.a.toLowerCase();
    inp.classList.add(ok ? 'ok' : 'bad');
    ok ? state.score.ok++ : state.score.bad++;
    state.exResults[state.exIdx] = ok;
    updateScoreUI();
    const fb = document.getElementById('ewFb');
    if (fb) {
      fb.className = 'ew-fb ' + (ok?'ok':'bad');
      fb.innerHTML = ok
        ? `✓ Верно!${e.h ? ` <em>${e.h}</em>` : ''}`
        : `✗ Ответ: <strong>${e.a}</strong>${e.h ? ' — '+e.h : ''}`;
    }
    // refresh progress dots in-place
    const pd = document.querySelector('.ew-prog');
    if (pd) pd.innerHTML = c.exercises.map((_,i) => {
      const cl = i<state.exResults.length?(state.exResults[i]?'ok':'bad'):(i===state.exIdx?'cur':'');
      return `<div class="ew-prog-dot ${cl}"></div>`;
    }).join('');
  });
  nxt.addEventListener('click', () => {
    if (!state.answered && inp.value.trim()) { chk.click(); return; }
    state.exIdx = (state.exIdx+1) % c.exercises.length;
    if (state.exIdx===0) state.exResults=[];
    state.answered = false;
    const ti = (c.tabs||[]).indexOf('Упражнения');
    const tc = document.getElementById('tc-'+ti);
    if (tc) { tc.innerHTML = renderExerciseTab(c, state.exIdx); bindExEvents(c); }
  });
}

function bindFreeEvents(c) {
  // Level selection
  document.querySelectorAll('.ew-lv-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      state.freeLevel = btn.dataset.lv;
      state.freeResult = null;
      generateTask(c, btn.dataset.lv);
    });
  });

  const ta   = document.getElementById('ewTa');
  const sub  = document.getElementById('ewSub');
  const skip = document.getElementById('ewSkip');
  const clr  = document.getElementById('ewHistClr');

  ta?.addEventListener('input', () => {
    const cc = document.getElementById('ewCnt');
    if (cc) cc.textContent = ta.value.length;
  });
  ta?.addEventListener('keydown', e => {
    if (e.key==='Enter' && !e.shiftKey) { e.preventDefault(); sub?.click(); }
  });
  if (ta) ta.focus();

  sub?.addEventListener('click',  () => checkWriting(c));
  skip?.addEventListener('click', () => {
    state.freeResult = null;
    generateTask(c, state.freeLevel||'B1');
  });
  clr?.addEventListener('click', () => {
    state.freeHistory=[]; state.freeResult=null;
    refreshFreeTab(c);
  });
}

window.insertW = function(w) {
  const ta = document.getElementById('ewTa');
  if (!ta) return;
  const p = ta.selectionStart || ta.value.length;
  const before = ta.value.slice(0, p);
  ta.value = before + (before.length && !before.endsWith(' ') ? ' ' : '') + w + ' ' + ta.value.slice(p);
  ta.focus();
  const cc = document.getElementById('ewCnt');
  if (cc) cc.textContent = ta.value.length;
};
// legacy alias
window.insertWord = window.insertFreeWord = window.insertW;

// ── AI: generate task ─────────────────────────────────────────────
const TASK_TYPES = ['Составить','Перевести с русского','Продолжить фразу','Описать ситуацию','Трансформировать'];

async function generateTask(c, level) {
  state.freeLoading = true;
  state.freeLoadMsg = `Создаю задание ${level} по теме «${c.title}»…`;
  state.freeTask    = null;
  state.freeResult  = null;
  if (!state.taskNum) state.taskNum = 0;
  state.taskNum++;
  refreshFreeTab(c);

  const ttype = TASK_TYPES[(state.taskNum-1) % TASK_TYPES.length];
  const sys   = 'Ты учитель немецкого. Отвечай ТОЛЬКО JSON без markdown.';
  const user  = `Создай задание для написания немецкого предложения.
Тема: «${c.title}» — ${c.sub}
Уровень: ${level} — ${LEVEL_DESC[level]}
Грамматика: ${c.rule?.formula||c.title}
Тип: ${ttype}

Задание ОБЯЗАТЕЛЬНО требует применения именно этой грамматики.
Разнообразная тематика (работа / путешествия / учёба / природа / город).

JSON:
{
  "instruction": "Задание на русском",
  "taskType": "${ttype}",
  "hint": "Грамматическая подсказка (1 строка)",
  "level": "${level}",
  "words": ["до","5","ключевых","слов"]
}`;

  try {
    const raw   = await callClaude(sys, user, 500);
    const clean = raw.replace(/```json|```/g,'').trim();
    state.freeTask = JSON.parse(clean);
    state.freeTask.level = level;
  } catch(e) {
    state.freeTask = {
      instruction:`Составьте предложение, используя «${c.title}».`,
      taskType:'Составить', hint:c.rule?.formula||'', level, words:[]
    };
  }
  state.freeLoading = false;
  refreshFreeTab(c);
}

// ── AI: check writing ─────────────────────────────────────────────
async function checkWriting(c) {
  const ta = document.getElementById('ewTa');
  if (!ta) return;
  const sent = ta.value.trim();
  if (!sent) { ta.focus(); return; }

  state.freeLoading = true;
  state.freeLoadMsg = 'Анализирую предложение…';
  state.freeResult  = null;
  refreshFreeTab(c);

  const task = state.freeTask;
  const sys  = 'Ты опытный учитель немецкого. Отвечай ТОЛЬКО JSON.';
  const user = `Проверь немецкое предложение студента.
Тема: «${c.title}» — ${c.sub}
Грамматика: ${c.rule?.formula||c.title}
${task ? `Задание: ${task.instruction}` : ''}

Предложение: «${sent.replace(/"/g,"'")}»

Проверяй: грамматику, орфографию, порядок слов, применение целевой структуры.
Объясняй ошибки на русском. Будь точным и конкретным.

JSON:
{
  "score": "perfect|good|errors",
  "sentence": ${JSON.stringify(sent)},
  "corrected": "исправленный вариант",
  "feedback": "короткий отзыв на русском (1-2 предложения)",
  "errors": [{"type":"Падеж/Порядок/Глагол/Артикль","wrong":"неверное","correct":"правильное","explain":"почему"}],
  "annotations": [{"wrong":"слово из предложения","explain":"объяснение"}],
  "parts": [{"w":"слово","r":"S/V/Oa/Od/Adv/Adj/N/NS"}],
  "tip": "совет по улучшению"
}`;

  try {
    const raw    = await callClaude(sys, user, 1000);
    const clean  = raw.replace(/```json|```/g,'').trim();
    const result = JSON.parse(clean);
    result.sentence = sent;

    const sc = result.score==='perfect'?'ok':result.score==='good'?'warn':'bad';
    if (!state.freeHistory) state.freeHistory=[];
    state.freeHistory.push({
      sent,
      sc,
      fb: result.errors?.length
        ? `<s style="opacity:.6">${sent}</s> → <em style="color:#3ad9a0">${result.corrected||sent}</em>`
        : (result.feedback||''),
    });
    if (!state.freeStats) state.freeStats={ok:0,warn:0,bad:0};
    state.freeStats[sc]++;
    if (!state.freeStreaks) state.freeStreaks={};
    const lv = task?.level||state.freeLevel||'B1';
    if (sc==='ok') { state.freeStreaks[lv]=(state.freeStreaks[lv]||0)+1; state.score.ok++; }
    else if (sc==='warn') { state.score.ok++; }
    else { state.freeStreaks[lv]=0; state.score.bad++; }
    updateScoreUI();

    state.freeResult  = result;
    state.freeLoading = false;
    refreshFreeTab(c);

    if (sc==='ok'||sc==='warn') setTimeout(()=>generateTask(c,lv), 2200);
  } catch(e) {
    state.freeLoading = false;
    state.freeResult  = {score:'errors',sentence:sent,feedback:'Ошибка проверки. Попробуйте снова.',errors:[],parts:[],corrected:''};
    refreshFreeTab(c);
  }
}

function refreshFreeTab(c) {
  const ti = (c.tabs||[]).indexOf('Упражнения');
  const tc = document.getElementById('tc-'+ti);
  if (!tc) return;
  tc.innerHTML = renderExerciseTab(c, state.exIdx);
  bindExEvents(c);
}

function refreshDots(c) { /* kept for compatibility */ }

function updateScoreUI() {
  const ok  = document.getElementById('sc-ok');
  const bad = document.getElementById('sc-bad');
  if (ok)  ok.textContent  = state.score.ok;
  if (bad) bad.textContent = state.score.bad;
}

// ═══════════════════════════════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════════════════════════════
drawWheel();
</script>
</body>
</html>

  
