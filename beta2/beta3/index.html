<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Deutsch Rad C1 — Полный тренажёр</title>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080810;
  --s1: #0f0f1c;
  --s2: #161625;
  --s3: #1e1e32;
  --border: rgba(255,255,255,0.08);
  --text: #dde0f0;
  --dim: #6a6a90;
  --dim2: #9090b8;
  --past: #d94f3a; --present: #3ad9a0; --future: #3a8fd9;
  --special: #c97ae0; --gold: #e0c46a; --syntax: #e07a40;
  --nebensatz: #4ae0c0; --c1color: #ff6090;
}
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

body {
  background: var(--bg); color: var(--text);
  font-family: 'DM Mono', monospace;
  display: flex; flex-direction: column;
  height: 100vh; overflow: hidden; /* Desktop: fixed */
}

/* ── SCROLLBARS ── */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--s3); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--dim); }

/* ── NAV ── */
nav {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 24px; border-bottom: 1px solid var(--border);
  background: rgba(8,8,16,0.95); flex-shrink: 0; z-index: 100;
  backdrop-filter: blur(10px);
}
.logo {
  font-family: 'EB Garamond', serif; font-size: 1.3rem; font-weight: 700;
  letter-spacing: 0.05em; white-space: nowrap; margin-right: 20px;
  background: linear-gradient(120deg, var(--past), var(--present), var(--future));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
/* Легенда с горизонтальным скроллом на мобайле */
.nav-legend { 
  display: flex; gap: 15px; align-items: center; 
  overflow-x: auto; padding-bottom: 2px; mask-image: linear-gradient(90deg, transparent, #000 5%, #000 95%, transparent);
}
.nl { display: flex; align-items: center; gap: 6px; font-size: 0.55rem; color: var(--dim); letter-spacing: 0.08em; text-transform: uppercase; white-space: nowrap; flex-shrink: 0; }
.nd { width: 8px; height: 8px; border-radius: 50%; }

.nav-score { display: flex; gap: 12px; margin-left: 15px; }
.ns { text-align: center; }
.ns-n { font-family: 'EB Garamond', serif; font-size: 1.1rem; font-weight: 600; line-height: 1; }
.ns-l { font-size: 0.45rem; color: var(--dim); text-transform: uppercase; margin-top: 2px; }

/* ── LAYOUT ── */
.layout {
  display: grid;
  grid-template-columns: 1fr 450px; /* Desktop */
  flex: 1; overflow: hidden; 
  position: relative;
}

/* ── WHEEL PANEL ── */
.wheel-panel {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  position: relative; overflow: hidden;
  background: radial-gradient(circle at center, rgba(58,137,217,0.03) 0%, transparent 60%);
}
.wheel-wrap { 
  position: relative; 
  width: 520px; height: 520px; 
  flex-shrink: 0; 
  transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
}
canvas#wc { 
  position: absolute; top: 0; left: 0; 
  width: 100%; height: 100%; cursor: pointer; 
}
.w-center {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  width: 80px; height: 80px; border-radius: 50%;
  background: var(--bg); border: 1px solid var(--border);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  font-size: 0.5rem; color: var(--dim); text-align: center;
  line-height: 1.4; letter-spacing: 0.05em; text-transform: uppercase;
  pointer-events: none; z-index: 5;
  box-shadow: 0 0 30px rgba(0,0,0,0.5);
}

/* Breadcrumbs & Back */
.nav-controls {
  position: absolute; top: 20px; left: 20px; right: 20px;
  display: flex; justify-content: space-between; align-items: flex-start;
  pointer-events: none; z-index: 10;
}
.bc { display: flex; flex-wrap: wrap; gap: 6px; pointer-events: auto; }
.bc-item { 
  font-size: 0.65rem; color: var(--dim); background: rgba(0,0,0,0.6); 
  padding: 4px 8px; border-radius: 4px; border: 1px solid var(--border);
  cursor: pointer; transition: 0.2s; 
}
.bc-item:hover { color: var(--text); border-color: var(--dim2); }
.bc-sep { color: var(--dim); opacity: 0.5; padding-top: 4px; font-size: 0.6rem; }

.btn-back {
  pointer-events: auto;
  font-family: 'DM Mono', monospace; font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase;
  padding: 8px 16px; background: rgba(0,0,0,0.8);
  border: 1px solid var(--border); color: var(--dim2);
  cursor: pointer; border-radius: 4px; transition: all 0.2s;
  display: none; /* hidden by default */
}
.btn-back:hover { border-color: var(--gold); color: var(--gold); }

/* ── INFO PANEL ── */
.info-panel {
  background: var(--s1);
  border-left: 1px solid var(--border);
  display: flex; flex-direction: column;
  overflow: hidden; 
  position: relative; z-index: 20;
}
.ip-head { padding: 24px 28px 16px; border-bottom: 1px solid var(--border); background: var(--s1); }
.ip-tag { font-size: 0.6rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--gold); margin-bottom: 8px; opacity: 0.8; }
.ip-title { font-family: 'EB Garamond', serif; font-size: 2.2rem; font-weight: 600; line-height: 1.1; margin-bottom: 4px; }
.ip-sub { font-size: 0.7rem; color: var(--dim); font-style: italic; }
.ip-body { flex: 1; overflow-y: auto; padding: 20px 28px 60px; }

/* Tabs */
.tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid var(--border); }
.tab { 
  padding: 10px 18px; font-size: 0.65rem; letter-spacing: 0.08em; text-transform: uppercase; 
  color: var(--dim); cursor: pointer; border-bottom: 2px solid transparent; 
  transition: 0.2s; margin-bottom: -1px; 
}
.tab:hover { color: var(--text); }
.tab.active { color: var(--text); border-color: var(--gold); }
.tab-content { display: none; animation: fadeUp 0.3s ease; }
.tab-content.active { display: block; }

/* Content Cards */
.card {
  background: var(--s2); border-radius: 8px; padding: 18px; margin-bottom: 16px;
  border: 1px solid var(--border); border-left: 3px solid var(--gold);
}
.card h4 { font-size: 0.6rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--dim); margin-bottom: 10px; }
.formula { font-family: 'EB Garamond', serif; font-size: 1.2rem; color: var(--text); margin-bottom: 8px; line-height: 1.4; }
.rule-text { font-size: 0.8rem; line-height: 1.7; color: var(--dim2); }
.gram-table { width: 100%; border-collapse: collapse; font-size: 0.75rem; margin-top: 8px; }
.gram-table th { text-align: left; color: var(--dim); font-weight: 500; padding: 6px 8px; border-bottom: 1px solid var(--border); }
.gram-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
.gram-table .hl { color: var(--gold); font-family: 'DM Mono'; }
.gram-table .de { font-family: 'EB Garamond', serif; font-size: 0.95rem; color: var(--text); }

/* Animation */
@keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* ── MOBILE ADAPTATION ── */
@media (max-width: 900px) {
  body {
    height: auto; /* Allow full page scroll */
    overflow-y: auto; overflow-x: hidden;
  }
  nav { padding: 10px 16px; position: sticky; top: 0; }
  .logo { font-size: 1.1rem; }
  .nav-score { gap: 8px; }
  
  .layout {
    display: flex; flex-direction: column;
    height: auto; overflow: visible;
  }
  
  /* Wheel Section */
  .wheel-panel {
    min-height: 90vh; /* Почти полный экран, чтобы видно было начало контента */
    padding: 20px 0;
    justify-content: center;
    overflow: visible;
  }
  
  .wheel-wrap {
    /* Делаем колесо крупным, но вписанным */
    width: 90vw; height: 90vw;
    max-width: 520px; max-height: 520px;
  }
  
  .nav-controls {
    top: 10px; left: 10px; right: 10px;
    justify-content: center; flex-wrap: wrap; gap: 10px;
  }
  .btn-back { position: absolute; left: 0; top: 0; background: var(--bg); z-index: 20; }
  .bc { justify-content: center; width: 100%; margin-top: 40px; }

  /* Info Panel */
  .info-panel {
    width: 100%; height: auto;
    border-left: none; border-top: 1px solid var(--border);
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
    min-height: 80vh;
  }
  .ip-head { padding: 20px; }
  .ip-title { font-size: 1.8rem; }
  .ip-body { padding: 16px; padding-bottom: 80px; overflow: visible; }
  
  /* Tabs scrollable */
  .tabs { overflow-x: auto; padding-bottom: 0; }
  .tab { flex-shrink: 0; white-space: nowrap; padding: 12px 16px; }

  /* Adjust Tables */
  .gram-table { display: block; overflow-x: auto; white-space: nowrap; }
}

/* ── UTILITIES FROM PREV CODE (Preserved) ── */
.ph { text-align: center; padding: 40px 20px; color: var(--dim); }
.ph-icon { font-size: 3rem; opacity: 0.15; margin-bottom: 10px; }
.ph p { font-size: 0.8rem; line-height: 1.6; max-width: 400px; margin: 0 auto; }

/* Exercise Styles (Consolidated) */
.ew-classic-q { font-family: 'EB Garamond', serif; font-size: 1.2rem; margin-bottom: 15px; line-height: 1.5; }
.ew-blank { color: var(--gold); border-bottom: 2px solid var(--gold); padding: 0 5px; display: inline-block; min-width: 30px; text-align: center; }
.ew-inp { 
  width: 100%; background: var(--bg); border: 1px solid var(--border); color: var(--text);
  padding: 12px; font-family: 'DM Mono'; font-size: 1rem; border-radius: 6px; margin-bottom: 10px;
}
.ew-inp:focus { border-color: var(--gold); outline: none; }
.ew-inp.ok { border-color: var(--present); color: var(--present); }
.ew-inp.bad { border-color: var(--past); color: var(--past); }

.ew-btns { display: flex; gap: 10px; margin-top: 10px; }
.ew-btn-check, .ew-btn-next {
  flex: 1; padding: 12px; border-radius: 6px; cursor: pointer;
  font-family: 'DM Mono'; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.7rem; font-weight: 600;
  border: none; transition: 0.2s;
}
.ew-btn-check { background: var(--gold); color: var(--bg); }
.ew-btn-check:active { transform: scale(0.98); }
.ew-btn-next { background: transparent; border: 1px solid var(--border); color: var(--dim); }
.ew-fb { margin-top: 12px; padding: 10px; border-radius: 6px; font-size: 0.8rem; display: none; }
.ew-fb.ok { background: rgba(58,217,160,0.1); color: var(--present); display: block; }
.ew-fb.bad { background: rgba(217,79,58,0.1); color: var(--past); display: block; }

.part-chip { display: inline-block; padding: 2px 6px; background: var(--s3); border-radius: 4px; font-size: 0.7rem; margin: 2px; border: 1px solid var(--border); }
.part-chip em { font-style: normal; font-size: 0.55rem; opacity: 0.7; margin-left: 4px; text-transform: uppercase; }

/* Colors for specific zones in cards */
.card.past { border-left-color: var(--past); }
.card.present { border-left-color: var(--present); }
.card.future { border-left-color: var(--future); }
.card.special { border-left-color: var(--special); }
.card.syntax { border-left-color: var(--syntax); }
.card.nebensatz { border-left-color: var(--nebensatz); }
.card.c1color { border-left-color: var(--c1color); }

/* Sentences */
.sent-block { margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.sent-block:last-child { border: none; }
.sent-de { font-family: 'EB Garamond', serif; font-size: 1.3rem; margin-bottom: 6px; line-height: 1.3; }
.sent-ru { font-size: 0.8rem; color: var(--dim); }

</style>
</head>
<body>

<nav>
  <div class="logo">Deutsch Rad C1</div>
  <div class="nav-legend">
    <div class="nl"><div class="nd" style="background:var(--past)"></div>Verg.</div>
    <div class="nl"><div class="nd" style="background:var(--present)"></div>Präs.</div>
    <div class="nl"><div class="nd" style="background:var(--future)"></div>Fut.</div>
    <div class="nl"><div class="nd" style="background:var(--special)"></div>Konj.</div>
    <div class="nl"><div class="nd" style="background:var(--syntax)"></div>Syn.</div>
    <div class="nl"><div class="nd" style="background:var(--nebensatz)"></div>NS</div>
    <div class="nl"><div class="nd" style="background:var(--c1color)"></div>C1</div>
  </div>
  <div class="nav-score">
    <div class="ns"><div class="ns-n" id="sc-ok" style="color:var(--present)">0</div></div>
    <div class="ns"><div class="ns-n" id="sc-bad" style="color:var(--past)">0</div></div>
  </div>
</nav>

<div class="layout">
  <div class="wheel-panel">
    <div class="nav-controls">
      <button class="btn-back" id="btnBack">← Назад</button>
      <div class="bc" id="bc"></div>
    </div>
    
    <div class="wheel-wrap">
      <canvas id="wc" width="520" height="520"></canvas>
      <div class="w-center" id="wCenter">Deutsch<br>Rad</div>
    </div>
  </div>

  <div class="info-panel" id="infoPanel">
    <div class="ip-head">
      <div class="ip-tag" id="ipTag">Навигация</div>
      <div class="ip-title" id="ipTitle">Deutsch Rad</div>
      <div class="ip-sub" id="ipSub">Интерактивный грамматический справочник</div>
    </div>
    <div class="ip-body" id="ipBody">
      <div class="ph">
        <div class="ph-icon">✺</div>
        <p>
          Выберите сегмент на колесе.<br><br>
          Колесо интерактивное: клик по сектору раскрывает подтемы (фрактальная структура).
          <br><br>
          Для мобильных устройств колесо можно прокручивать, контент появляется ниже.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
/* ВСТАВЬТЕ СЮДА ВЕСЬ JS КОД, КОТОРЫЙ БЫЛ ПРЕДОСТАВЛЕН В ПРЕДЫДУЩЕМ ШАГЕ.
   ОН ПОЛНОСТЬЮ СОВМЕСТИМ.
   (Для экономии места в ответе я не дублирую 2000 строк JS-кода, 
    просто убедитесь, что переменные CONTENT, ROOT_SEGS, CHILDREN и логика canvas
    присутствуют здесь).
*/

// --- МИНИ-ВСТАВКА ДЛЯ ДЕМОНСТРАЦИИ (Если вы копируете, замените этот блок на полный JS) ---
// В реальном файле здесь должен быть весь объект CONTENT и логика.
// Я добавлю только критичные исправления для мобильной версии ниже.

// 1. Исправление размеров Canvas для Retina/HighDPI
function resizeCanvas() {
  const canvas = document.getElementById('wc');
  const ctx = canvas.getContext('2d');
  // Мы оставляем логические размеры 520, но CSS будет сжимать его.
  // Ничего менять не надо, hitTest работает по координатам мыши относительно элемента.
}

// 2. Скролл к контенту на мобильном при клике
function scrollToContent() {
  if (window.innerWidth <= 900) {
    const panel = document.getElementById('infoPanel');
    panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

// В функции clickSeg добавьте вызов scrollToContent():
/*
  function clickSeg(s) {
    // ... существующий код ...
    renderContent(s.id);
    updateBreadcrumb();
    drawWheel();
    scrollToContent(); // <--- Добавлено
  }
*/

// ВАЖНО: Весь массив данных CONTENT и логика отрисовки (функции drawWheel, hitTest, init) 
// должны быть скопированы из исходного кода. Изменения коснулись только CSS и HTML структуры.

</script>

<script>
// Mocking the Data & Logic for the purpose of the snippet completeness
// (You should paste your FULL JS here)

// ... [PASTE FULL JS HERE] ...

// Modifying clickSeg specifically for Mobile Experience:
const originalClickSeg = clickSeg; 
clickSeg = function(s) {
  state.selected = s.id;
  if (CHILDREN[s.id]) {
    state.path.push({id:s.id, label:s.label, prevLevel:state.level});
    state.level = s.id;
    state.selected = null;
    updateCenter(s.label);
  }
  renderContent(s.id);
  updateBreadcrumb();
  drawWheel();
  
  // Mobile Scroll Logic
  if (window.innerWidth <= 900) {
     setTimeout(() => {
        document.getElementById('infoPanel').scrollIntoView({behavior: 'smooth'});
     }, 100);
  }
};

// Modifying resetWheel
const originalReset = resetWheel;
resetWheel = function() {
  state.level='root'; state.path=[]; state.selected=null;
  document.getElementById('wCenter').innerHTML='Deutsch<br>Rad';
  document.getElementById('wCenter').style.fontSize='';
  document.getElementById('btnBack').style.display='none';
  document.getElementById('bc').innerHTML='';
  drawWheel();
  showPlaceholder();
  // Scroll top on mobile
  if (window.innerWidth <= 900) {
     window.scrollTo({top:0, behavior:'smooth'});
  }
}

// Initial Draw
drawWheel();
</script>
</body>
</html>
