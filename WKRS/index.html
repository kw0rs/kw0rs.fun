<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Академия Кворса | Главная</title>

  <!-- Open Graph -->
  <meta property="og:title" content="Академия имени Вильяма Кворса" />
  <meta property="og:description" content="Блин, а прикольный сайтик так-то." />
  <meta property="og:image" content="https://kw0rs.fun/icon/williamkw0rs.jpg" />
  <meta property="og:url" content="https://kw0rs.fun" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Академия Кворса" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Академия имени Вильяма Кворса" />
  <meta name="twitter:description" content="Блин, а прикольный сайтик так-то." />
  <meta name="twitter:image" content="https://kw0rs.fun/icon/williamkw0rs.jpg" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icon/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icon/favicon-16x16.png" />
  <link rel="apple-touch-icon" href="/icon/apple-touch-icon.png" />
  <link rel="manifest" href="/icon/site.webmanifest" />
  <link rel="shortcut icon" href="/icon/favicon.ico" />

  <!-- Tailwind & Alpine.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <script>
    if (location.hostname === 'www.kw0rs.fun') {
      window.location.href = 'https://kw0rs.fun' + location.pathname;
    }
  </script>
  <style>
    .modal-bg { background-color: rgba(0, 0, 0, 0.8); }
    body { background-color: #1c1c1c; }
    .full-img { width: 100%; height: auto; object-fit: contain; }
    .card-img { width: 100%; aspect-ratio: 2/3; object-fit: cover; object-position: center; }
    @media (max-width: 768px) {
      .modal-content { max-height: 80vh; overflow-y: auto; }
    }
  </style>
</head>
<body class="text-white font-sans" x-data="mediaApp()" x-init="loadItems()">
<!-- Весь HTML-контент остаётся без изменений -->
<script>
function mediaApp() {
  return {
    search: '',
    categoryFilter: '',
    sortKey: 'rating-desc',
    modalItem: null,
    items: [],
    loading: true,
    error: null,
    minRating: null,
    minYear: null,
    maxYear: null,

    async loadItems() {
      this.loading = true;
      this.error = null;
      const urls = ['anime_data.json', 'movies_data.json', 'games_data.json', 'books_data.json', 'cartoons_data.json'];
      let allItems = [];
      try {
        for (const url of urls) {
          const res = await fetch(url);
          if (!res.ok) throw new Error(`Ошибка загрузки ${url}`);
          const data = await res.json();
          if (!Array.isArray(data)) throw new Error(`Ожидался массив в ${url}`);
          allItems = allItems.concat(data);
        }
        this.items = allItems.map(i => {
          const r = parseFloat(i.rating);
          return {
            title: i.title || 'Без названия',
            type: i.type || 'Неизвестно',
            year: i.year || 'Н/Д',
            rating: !isNaN(r) ? r : null,
            genres: Array.isArray(i.genres) ? i.genres : [],
            description: i.description || 'Описание отсутствует',
            review: i.review || '',
            image: i.image || null
          };
        });
      } catch (e) {
        this.error = `Не удалось загрузить данные: ${e.message}`;
        this.items = [];
      } finally {
        this.loading = false;
      }
    },

    openModal(item) { this.modalItem = {...item}; },
    handleImageError(e, item) { item.image = null; },

    pickRandomItem() {
      let availableItems = this.filteredItems;
      if (availableItems.length === 0) {
        this.error = 'Нет элементов, соответствующих фильтрам';
        setTimeout(() => this.error = null, 3000);
        return;
      }
      const randomIndex = Math.floor(Math.random() * availableItems.length);
      this.openModal(availableItems[randomIndex]);
    },

    getRatingText(item) {
      return (item.rating != null) ? item.rating : '?';
    },
    getRatingClass(item) {
      if (item.rating == null) return 'text-gray-400';
      if (item.rating >= 10) return 'text-purple-500 [text-shadow:0_0_8px_rgba(168,85,247,0.8),0_0_16px_rgba(168,85,247,0.6)]';
      if (item.rating >= 7) return 'text-green-400';
      if (item.rating >= 4) return 'text-yellow-400';
      return 'text-red-500';
    },

    get filteredItems() {
      return this.items
        .filter(i => !this.search || i.title.toLowerCase().includes(this.search.toLowerCase()))
        .filter(i => !this.categoryFilter || i.type === this.categoryFilter)
        .filter(i => this.minRating == null || (i.rating != null && i.rating >= this.minRating))
        .filter(i => this.minYear == null || (i.year !== 'Н/Д' && parseInt(i.year) >= this.minYear))
        .filter(i => this.maxYear == null || (i.year !== 'Н/Д' && parseInt(i.year) <= this.maxYear));
    },

    get filteredAndSortedItems() {
      return [...this.filteredItems].sort((a, b) => {
        const ra = (a.rating == null) ? -1 : a.rating;
        const rb = (b.rating == null) ? -1 : b.rating;
        switch (this.sortKey) {
          case 'rating-asc':   return ra - rb;
          case 'rating-desc':  return rb - ra;
          case 'year-asc':     return (parseInt(a.year)||0) - (parseInt(b.year)||0);
          case 'year-desc':    return (parseInt(b.year)||0) - (parseInt(a.year)||0);
          case 'title':        return a.title.localeCompare(b.title);
          default:             return 0;
        }
      });
    }
  }
}
</script>
</body>
</html>
