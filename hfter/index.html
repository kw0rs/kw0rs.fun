<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Custom QR Code Generator</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#10b981;--muted:#9aa4b2}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,var(--bg),#071022);color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:28px}
    .app{width:960px;max-width:96vw;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:start}
    .panel{background:transparent;padding:12px}
    h1{margin:6px 0 12px;font-size:18px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:8px}
    input[type=text], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px}
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:8px}
    .col{flex:1}
    .small{font-size:13px;color:var(--muted)}
    .preview-card{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.02));border-radius:10px;padding:14px;display:flex;flex-direction:column;align-items:center;gap:12px}
    .qr-wrap{width:360px;height:360px;display:flex;align-items:center;justify-content:center;background:transparent;border-radius:8px}
    img.qr{width:100%;height:100%;object-fit:contain;background:transparent}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{background:var(--accent);border:none;padding:10px 12px;border-radius:8px;color:#031018;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .foot{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-top:8px}
    .muted{color:var(--muted);font-size:13px}
    .field{margin-bottom:12px}
    .inline{display:flex;gap:8px;align-items:center}
    input[type=color]{width:44px;height:36px;padding:0;border:none;background:transparent}
    input[type=range]{width:160px}
    @media (max-width:880px){.grid{grid-template-columns:1fr;}.qr-wrap{width:280px;height:280px}}
  </style>
</head>
<body>
  <main class="app" role="main">
    <div class="grid">
      <section class="panel">
        <h1>Custom QR Code Generator</h1>
        <div class="field">
          <label for="text">Текст или URL</label>
          <textarea id="text" placeholder="https://example.com или любой текст">https://example.com</textarea>
        </div>

        <div class="row">
          <div class="col field">
            <label for="fg">Цвет (передний план)</label>
            <div class="inline"><input id="fg" type="color" value="#0a0a0a"><span class="small muted">#0a0a0a</span></div>
          </div>
          <div class="col field">
            <label for="bg">Фон</label>
            <div class="inline"><input id="bg" type="color" value="#ffffff"><span class="small muted">#ffffff</span></div>
          </div>
        </div>

        <div class="row">
          <div class="col field">
            <label for="size">Размер (px)</label>
            <div class="inline"><input id="size" type="range" min="128" max="1024" value="360"><span class="small muted" id="sizeVal">360</span></div>
          </div>
          <div class="col field">
            <label for="ecc">Уровень защиты (ECC)</label>
            <select id="ecc"><option value="L">L (7%)</option><option value="M">M (15%)</option><option value="Q">Q (25%)</option><option value="H" selected>H (30%)</option></select>
          </div>
        </div>

        <div class="controls">
          <button id="generate">Сгенерировать</button>
          <button id="download" class="ghost">Скачать PNG</button>
          <button id="copy" class="ghost">Копировать URL</button>
        </div>

        <div class="foot">
          <div class="muted">Простое, минимальное. Большой предпросмотр справа.</div>
          <div class="muted">Offline: требует подключение к интернету (генератор через QR API)</div>
        </div>
      </section>

      <aside class="panel">
        <div class="preview-card">
          <div class="muted small">Preview</div>
          <div class="qr-wrap">
            <img id="qrImg" class="qr" alt="QR preview">
          </div>
          <div style="width:100%;display:flex;justify-content:space-between;align-items:center;gap:8px">
            <div class="small muted">PNG будет скачан с теми же цветами и размером.</div>
            <div style="display:flex;gap:8px">
              <button id="refresh" class="ghost">Обновить</button>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // Простой SPA: собираем параметры и подставляем в публичный API QR кодов.
    // API: https://api.qrserver.com/v1/create-qr-code/ — бесплатный, простая интеграция.

    const $ = id => document.getElementById(id);
    const text = $('text');
    const fg = $('fg');
    const bg = $('bg');
    const size = $('size');
    const sizeVal = $('sizeVal');
    const ecc = $('ecc');
    const generate = $('generate');
    const download = $('download');
    const copy = $('copy');
    const qrImg = $('qrImg');
    const refresh = $('refresh');

    function encodeParam(s){ return encodeURIComponent(s); }

    function buildQRUrl(){
      const data = text.value.trim() || '';
      const pixels = parseInt(size.value,10) || 360;
      const color = fg.value.replace('#','');
      const bgcolor = bg.value.replace('#','');
      const level = ecc.value;
      // api supports color and bgcolor as hex (without #)
      const params = new URLSearchParams({data, size: pixels+'x'+pixels, color, bgcolor, ecc: level});
      return 'https://api.qrserver.com/v1/create-qr-code/?' + params.toString();
    }

    function updatePreview(){
      const url = buildQRUrl();
      qrImg.src = url + '&.cachebuster=' + Date.now();
    }

    function downloadPNG(){
      const url = buildQRUrl();
      // fetch blob and trigger download
      fetch(url).then(r=>{ if(!r.ok) throw new Error('network'); return r.blob() }).then(blob=>{
        const a = document.createElement('a');
        const u = URL.createObjectURL(blob);
        a.href = u;
        const safeName = (text.value.trim().slice(0,40) || 'qr') .replace(/[^a-z0-9\-_.]/ig,'_');
        a.download = safeName + '.png';
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(()=>URL.revokeObjectURL(u), 3000);
      }).catch(err=>{ alert('Не удалось скачать PNG. Проверь подключение.'); console.error(err) });
    }

    // events
    size.addEventListener('input', ()=>{ sizeVal.textContent = size.value; updatePreview(); });
    fg.addEventListener('input', ()=> updatePreview());
    bg.addEventListener('input', ()=> updatePreview());
    ecc.addEventListener('change', ()=> updatePreview());
    text.addEventListener('input', ()=> updatePreview());

    generate.addEventListener('click', ()=> updatePreview());
    refresh.addEventListener('click', ()=> updatePreview());
    download.addEventListener('click', ()=> downloadPNG());

    copy.addEventListener('click', async ()=>{
      const url = buildQRUrl();
      try{
        await navigator.clipboard.writeText(url);
        copy.textContent = 'Ссылка скопирована';
        setTimeout(()=> copy.textContent = 'Копировать URL', 1200);
      }catch(e){
        alert('Не удалось скопировать. Скопируй вручную: ' + url);
      }
    });

    // initial
    updatePreview();
  </script>
</body>
</html>
