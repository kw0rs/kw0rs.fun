```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>–ê–∫–∞–¥–µ–º–∏—è –ö–≤–æ—Ä—Å–∞ | –û—Ü–µ–Ω–∫–∏</title>

  <!-- Open Graph -->
  <meta property="og:title" content="–ê–∫–∞–¥–µ–º–∏—è –∏–º–µ–Ω–∏ –í–∏–ª—å—è–º–∞ –ö–≤–æ—Ä—Å–∞" />
  <meta property="og:description" content="–û—Ü–µ–Ω–∫–∏, —Ä–µ—Ü–µ–Ω–∑–∏–∏, –±–∞–∑–∞." />
  <meta property="og:image" content="https://kw0rs.uno/icon/williamkw0rs.jpg" />
  <meta property="og:url" content="https://kw0rs.uno" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="–ê–∫–∞–¥–µ–º–∏—è –ö–≤–æ—Ä—Å–∞" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icon/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icon/favicon-16x16.png" />
  <link rel="apple-touch-icon" href="/icon/apple-touch-icon.png" />
  <link rel="manifest" href="/icon/site.webmanifest" />
  <link rel="shortcut icon" href="/icon/favicon.ico" />

  <!-- Tailwind & Alpine -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- –ü–µ—Ä–µ–≥–æ–Ω–∫–∞ www ‚Üí –±–µ–∑ www -->
  <script>
    if (location.hostname === 'www.kw0rs.uno') {
      window.location.href = 'https://kw0rs.uno' + location.pathname;
    }
  </script>

  <style>
    :root{
      --wk-red:#e5343a;
      --bg:#0b0d12;
      --panel:#111624;
      --panel2:#0f1420;
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --muted2:rgba(255,255,255,.42);
    }

    body{
      background:
        radial-gradient(900px 600px at 20% 20%, rgba(229,52,58,.12), transparent 60%),
        radial-gradient(900px 600px at 80% 80%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, var(--bg), #070910);
      color:var(--text);
    }

    .wk-card{
      background: linear-gradient(180deg, rgba(17,22,36,.92), rgba(12,16,28,.92));
      border:1px solid var(--stroke);
      border-radius:18px;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      overflow:hidden;
    }
    .wk-card:hover{
      transform: translateY(-4px);
      border-color: rgba(229,52,58,.35);
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
    }

    /* –ö–ù–û–ü–ö–ò: –±–µ–∑ –ø—Ä—ã–∂–∫–æ–≤ */
    .wk-btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      border-radius:14px;
      padding:.7rem 1rem;
      transition: background .18s ease, border-color .18s ease, opacity .18s ease;
      user-select:none;
    }
    .wk-btn:hover{
      background: rgba(255,255,255,.06);
    }
    .wk-btn:disabled{
      opacity:.45;
      cursor:not-allowed;
    }
    .wk-btn-primary{
      border-color: rgba(229,52,58,.55);
      background: rgba(229,52,58,.12);
    }
    .wk-btn-primary:hover{
      background: rgba(229,52,58,.18);
      border-color: rgba(229,52,58,.75);
    }

    /* –ò–ù–ü–£–¢–´ / –°–ï–õ–ï–ö–¢–´: –∫–æ–Ω—Ç—Ä–∞—Å—Ç + –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ option */
    .wk-input{
      width:100%;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      padding:.9rem 1rem;
      outline:none;
    }
    .wk-input::placeholder{
      color: rgba(255,255,255,.45);
    }
    .wk-input:focus{
      border-color: rgba(229,52,58,.75);
      box-shadow: 0 0 0 3px rgba(229,52,58,.14);
      background: rgba(255,255,255,.075);
    }
    select.wk-input{
      appearance:none;
      background-image:
        linear-gradient(45deg, transparent 50%, rgba(255,255,255,.55) 50%),
        linear-gradient(135deg, rgba(255,255,255,.55) 50%, transparent 50%);
      background-position:
        calc(100% - 18px) 55%,
        calc(100% - 12px) 55%;
      background-size: 6px 6px, 6px 6px;
      background-repeat:no-repeat;
      padding-right:2.2rem;
    }
    select.wk-input option{
      background: #0f1420;
      color: rgba(255,255,255,.92);
    }

    .wk-chip{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius:999px;
      padding:.25rem .55rem;
      font-size:.78rem;
      color:var(--muted);
      white-space:nowrap;
    }

    .wk-modal-bg{
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(8px);
    }

    .wk-scroll::-webkit-scrollbar{ width:10px; }
    .wk-scroll::-webkit-scrollbar-track{ background: rgba(255,255,255,.04); border-radius:8px; }
    .wk-scroll::-webkit-scrollbar-thumb{
      background: rgba(229,52,58,.35);
      border-radius:8px;
      border:2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }

    /* clamp –±–µ–∑ tailwind-plugin */
    .clamp-2{
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* range */
    input[type="range"]{ accent-color: var(--wk-red); }
  </style>
</head>

<body x-data="mediaApp()" x-init="init(); loadItems()">
  <div class="max-w-7xl mx-auto px-5 py-8">
    <!-- header -->
    <header class="flex flex-col md:flex-row md:items-end md:justify-between gap-6 mb-8">
      <div>
        <div class="inline-flex items-center gap-3">
          <span class="w-3 h-3 rounded-full" style="background:var(--wk-red)"></span>
          <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">–ê–∫–∞–¥–µ–º–∏—è –ö–≤–æ—Ä—Å–∞ ‚Äî –û—Ü–µ–Ω–∫–∏</h1>
        </div>
        <p class="mt-2 text-sm sm:text-base" style="color:rgba(255,255,255,.65)">
          –î–∞–Ω–Ω—ã–µ –∂–∏–≤—É—Ç –≤ Google Sheets. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç.
        </p>
      </div>

      <div class="flex gap-3">
        <a href="https://kw0rs.uno/" class="wk-btn inline-flex items-center gap-2">
          <span>‚Üê</span><span>–í –º–µ–Ω—é</span>
        </a>
        <button class="wk-btn wk-btn-primary inline-flex items-center gap-2" @click="pickRandomItem()">
          <span>üé≤</span><span>–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç</span>
        </button>
      </div>
    </header>

    <!-- filters -->
    <section class="wk-card p-5 mb-8">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
        <div class="lg:col-span-5">
          <input class="wk-input" type="text" x-model="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é‚Ä¶" autocomplete="off" />
        </div>

        <div class="lg:col-span-3">
          <select class="wk-input" x-model="categoryFilter" aria-label="–ö–∞—Ç–µ–≥–æ—Ä–∏—è">
            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            <option value="movie">–§–∏–ª—å–º—ã</option>
            <option value="show">–°–µ—Ä–∏–∞–ª—ã</option>
            <option value="anime">–ê–Ω–∏–º–µ</option>
            <option value="game">–ò–≥—Ä—ã</option>
            <option value="book">–ß—Ç–∏–≤–æ</option>
            <option value="cartoon">–ú—É–ª—å—Ç–∏–∫–∏</option>
            <option value="comics">–ö–æ–º–∏–∫—Å—ã</option>
          </select>
        </div>

        <div class="lg:col-span-4">
          <select class="wk-input" x-model="sortKey" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞">
            <option value="rating-desc">–†–µ–π—Ç–∏–Ω–≥: –≤—ã—Å–æ–∫–∏–µ ‚Üí –Ω–∏–∑–∫–∏–µ</option>
            <option value="rating-asc">–†–µ–π—Ç–∏–Ω–≥: –Ω–∏–∑–∫–∏–µ ‚Üí –≤—ã—Å–æ–∫–∏–µ</option>
            <option value="year-desc">–ì–æ–¥: –Ω–æ–≤–µ–µ</option>
            <option value="year-asc">–ì–æ–¥: —Å—Ç–∞—Ä–µ–µ</option>
            <option value="title">–ù–∞–∑–≤–∞–Ω–∏–µ: A-Z</option>
          </select>
        </div>

        <div class="lg:col-span-4">
          <label class="text-sm" style="color:rgba(255,255,255,.70)">
            –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥: <span class="font-semibold" x-text="minRating.toFixed(1)"></span>
          </label>
          <input class="w-full mt-2" type="range" x-model.number="minRating" min="0" max="10" step="0.1" />
        </div>

        <div class="lg:col-span-4">
          <label class="text-sm" style="color:rgba(255,255,255,.70)">
            –ì–æ–¥ –æ—Ç: <span class="font-semibold" x-text="minYear"></span>
          </label>
          <input class="w-full mt-2" type="range" x-model.number="minYear" min="1900" max="2030" step="1" />
        </div>

        <div class="lg:col-span-4">
          <label class="text-sm" style="color:rgba(255,255,255,.70)">
            –ì–æ–¥ –¥–æ: <span class="font-semibold" x-text="maxYear"></span>
          </label>
          <input class="w-full mt-2" type="range" x-model.number="maxYear" min="1900" max="2030" step="1" />
        </div>

        <div class="lg:col-span-12 flex flex-wrap items-center justify-between gap-3 pt-2">
          <button class="wk-btn" @click="clearFilters()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
          <div class="text-sm" style="color:rgba(255,255,255,.70)" x-show="!loading && !error">
            –ù–∞–π–¥–µ–Ω–æ: <span class="font-semibold" x-text="filteredItems.length"></span>
            –∏–∑ <span class="font-semibold" x-text="items.length"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- states -->
    <div x-show="loading" class="py-16 text-center">
      <div class="inline-flex items-center gap-3 px-4 py-2 rounded-xl" style="border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04)">
        <span class="animate-pulse">‚è≥</span>
        <span style="color:rgba(255,255,255,.75)">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets‚Ä¶</span>
      </div>
    </div>

    <div x-show="error" class="py-10">
      <div class="wk-card p-5" style="border-color: rgba(229,52,58,.45)">
        <div class="flex flex-col gap-2">
          <div class="text-lg font-bold" style="color:var(--wk-red)">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
          <div class="text-sm" style="color:rgba(255,255,255,.80)" x-text="error"></div>
          <div class="flex gap-3 mt-3">
            <button class="wk-btn wk-btn-primary" @click="loadItems()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
          </div>
          <div class="text-xs mt-3" style="color:rgba(255,255,255,.55)">
            –ü—Ä–æ–≤–µ—Ä—å: —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ ‚ÄúAnyone with the link can view‚Äù.
          </div>
        </div>
      </div>
    </div>

    <!-- grid -->
    <main x-show="!loading && !error" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <template x-for="item in filteredAndSortedItems" :key="item._key">
        <article class="wk-card cursor-pointer"
                 tabindex="0"
                 role="button"
                 @click="openModal(item)"
                 @keydown.enter="openModal(item)"
                 @keydown.space.prevent="openModal(item)">
          <div class="aspect-[2/3] bg-black/20 overflow-hidden">
            <template x-if="item.image">
              <img class="w-full h-full object-cover"
                   :alt="`–ü–æ—Å—Ç–µ—Ä ${item.title}`"
                   :data-src="item.image"
                   loading="lazy"
                   @error="handleImageError($event, item)" />
            </template>
            <template x-if="!item.image">
              <div class="w-full h-full flex items-center justify-center text-sm" style="color:rgba(255,255,255,.50)">
                üñºÔ∏è –Ω–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏
              </div>
            </template>
          </div>

          <div class="p-4 flex flex-col gap-2">
            <div class="flex items-start justify-between gap-3">
              <h2 class="font-bold leading-snug clamp-2" x-text="item.title"></h2>
              <div class="shrink-0 text-sm font-bold" :class="getRatingClass(item)">
                ‚≠ê <span x-text="getRatingText(item)"></span>
              </div>
            </div>

            <div class="text-xs flex flex-wrap gap-2" style="color:rgba(255,255,255,.70)">
              <span class="wk-chip" x-text="item.typeDisplay"></span>
              <span class="wk-chip" x-text="item.yearDisplay"></span>
              <span class="wk-chip" x-show="item.genres.length" x-text="item.genres.slice(0,2).join(' ‚Ä¢ ')"></span>
              <span class="wk-chip" x-show="item.genres.length > 2" x-text="`+${item.genres.length - 2}`"></span>
            </div>

            <!-- –û–ü–ò–°–ê–ù–ò–ï –í –ö–ê–†–¢–û–ß–ö–ï -->
            <div class="text-xs mt-1 clamp-2" style="color:rgba(255,255,255,.65)" x-show="item.description">
              <span x-text="item.description"></span>
            </div>
          </div>
        </article>
      </template>
    </main>

    <div x-show="!loading && !error && filteredAndSortedItems.length === 0" class="py-16 text-center">
      <div class="text-2xl font-extrabold mb-2">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
      <div class="text-sm mb-4" style="color:rgba(255,255,255,.70)">–ü–æ–º–µ–Ω—è–π —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–æ–∏—Å–∫.</div>
      <button class="wk-btn wk-btn-primary" @click="clearFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
  </div>

  <!-- modal -->
  <div x-show="modalItem"
       class="fixed inset-0 z-50 flex items-center justify-center wk-modal-bg"
       @click.self="closeModal()"
       @keydown.escape.window="closeModal()"
       x-transition.opacity>
    <div class="wk-card w-[95%] max-w-6xl max-h-[90vh] overflow-hidden" @click.stop>
      <div class="grid grid-cols-1 lg:grid-cols-2">
        <!-- poster -->
        <div class="bg-black/25 flex items-center justify-center p-4">
          <template x-if="modalItem?.image">
            <img :src="modalItem.image"
                 class="max-h-[78vh] w-auto object-contain rounded-2xl"
                 :alt="`–ü–æ—Å—Ç–µ—Ä ${modalItem.title}`"
                 @error="modalItem.image = null" />
          </template>
          <template x-if="modalItem && !modalItem.image">
            <div class="text-sm" style="color:rgba(255,255,255,.55)">üñºÔ∏è –Ω–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏</div>
          </template>
        </div>

        <!-- content -->
        <div class="p-6 flex flex-col gap-4">
          <div>
            <h2 class="text-2xl sm:text-3xl font-extrabold leading-tight" x-text="modalItem?.title"></h2>
            <div class="mt-2 flex flex-wrap gap-2">
              <span class="wk-chip" x-text="modalItem?.typeDisplay"></span>
              <span class="wk-chip" x-text="modalItem?.yearDisplay"></span>
              <span class="wk-chip" :class="getRatingClass(modalItem)">
                ‚≠ê <span x-text="getRatingText(modalItem)"></span>/10
              </span>
            </div>

            <div class="mt-3 flex flex-wrap gap-2" x-show="modalItem?.genres?.length">
              <template x-for="g in modalItem.genres" :key="g">
                <span class="wk-chip" x-text="g"></span>
              </template>
            </div>
          </div>

          <!-- tabs -->
          <div class="flex gap-2" x-show="hasAnyContent">
            <button class="wk-btn"
                    :class="showReview ? 'wk-btn-primary' : ''"
                    @click="showReview = true"
                    :disabled="!modalItem?.review">
              –†–µ—Ü–µ–Ω–∑–∏—è
            </button>
            <button class="wk-btn"
                    :class="(!showReview) ? 'wk-btn-primary' : ''"
                    @click="showReview = false"
                    :disabled="!modalItem?.description">
              –û–ø–∏—Å–∞–Ω–∏–µ
            </button>
          </div>

          <!-- text -->
          <div class="wk-scroll rounded-2xl p-4 flex-1 overflow-auto"
               style="border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.04)"
               x-show="hasAnyContent">
            <!-- –†–ï–¶–ï–ù–ó–ò–Ø -->
            <div x-show="showReview">
              <div class="text-sm font-bold mb-2" style="color:rgba(229,52,58,.95)">üìù –†–µ—Ü–µ–Ω–∑–∏—è</div>
              <div class="text-sm leading-relaxed whitespace-pre-wrap" style="color:rgba(255,255,255,.82)" x-text="modalItem?.review || '‚Äî'"></div>
            </div>
            <!-- –û–ü–ò–°–ê–ù–ò–ï -->
            <div x-show="!showReview">
              <div class="text-sm font-bold mb-2" style="color:rgba(255,255,255,.82)">üìÑ –û–ø–∏—Å–∞–Ω–∏–µ</div>
              <div class="text-sm leading-relaxed whitespace-pre-wrap" style="color:rgba(255,255,255,.82)" x-text="modalItem?.description || '‚Äî'"></div>
            </div>
          </div>

          <div x-show="!hasAnyContent" class="text-sm" style="color:rgba(255,255,255,.65)">
            –¢—É—Ç –ø—É—Å—Ç–æ: –Ω–∏ —Ä–µ—Ü–µ–Ω–∑–∏–∏, –Ω–∏ –æ–ø–∏—Å–∞–Ω–∏—è.
          </div>

          <!-- actions -->
          <div class="flex gap-3 pt-3">
            <button class="wk-btn flex-1" @click="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button class="wk-btn wk-btn-primary" @click="pickRandomItem()">üé≤ –ï—â—ë</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function mediaApp() {
      return {
        // ==== CONFIG ====
        SHEET_ID: '108822Zn_50UNHrdA1WgnsQAf8nroCI2QZh4RlrIhhR0',

        // ==== STATE ====
        search: '',
        categoryFilter: '',
        sortKey: 'rating-desc',
        modalItem: null,
        items: [],
        loading: true,
        error: null,

        minRating: 0,
        minYear: 1900,
        maxYear: 2030,

        imageObserver: null,
        showReview: true,

        // ==== UI ====
        getTypeDisplay(typeValue) {
          const map = {
            movie: '–§–∏–ª—å–º',
            show: '–°–µ—Ä–∏–∞–ª',
            anime: '–ê–Ω–∏–º–µ',
            game: '–ò–≥—Ä–∞',
            book: '–ö–Ω–∏–≥–∞',
            cartoon: '–ú—É–ª—å—Ç',
            comics: '–ö–æ–º–∏–∫—Å'
          };
          return map[typeValue] || (typeValue || '‚Äî');
        },

        getRatingText(item) {
          if (item?.rating == null || Number.isNaN(item.rating)) return '?';
          return Number(item.rating).toFixed(1);
        },

        getRatingClass(item) {
          const r = item?.rating;
          if (r == null || Number.isNaN(r)) return 'text-white/60';
          if (r >= 9.5) return 'text-purple-300';
          if (r >= 7.0) return 'text-emerald-300';
          if (r >= 4.0) return 'text-amber-300';
          return 'text-rose-300';
        },

        // ==== CSV PARSER (quotes + commas + newlines) ====
        parseCSV(text) {
          const rows = [];
          let row = [];
          let cur = '';
          let i = 0;
          let inQuotes = false;

          while (i < text.length) {
            const c = text[i];

            if (c === '"') {
              if (inQuotes && text[i + 1] === '"') {
                cur += '"';
                i += 2;
                continue;
              }
              inQuotes = !inQuotes;
              i += 1;
              continue;
            }

            if (!inQuotes && c === ',') {
              row.push(cur);
              cur = '';
              i += 1;
              continue;
            }

            if (!inQuotes && (c === '\n' || c === '\r')) {
              if (c === '\r' && text[i + 1] === '\n') i += 2;
              else i += 1;

              row.push(cur);
              cur = '';
              if (row.length > 1 || (row.length === 1 && row[0].trim() !== '')) rows.push(row);
              row = [];
              continue;
            }

            cur += c;
            i += 1;
          }

          row.push(cur);
          if (row.length > 1 || (row.length === 1 && row[0].trim() !== '')) rows.push(row);

          if (rows.length && rows[0].length) rows[0][0] = rows[0][0].replace(/^\uFEFF/, '');
          return rows;
        },

        // ==== SHEETS URL (–±–µ–∑ sheet=, —á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –∏–º–µ–Ω–∏ –≤–∫–ª–∞–¥–∫–∏) ====
        getSheetCsvUrl() {
          return `https://docs.google.com/spreadsheets/d/${this.SHEET_ID}/gviz/tq?tqx=out:csv`;
        },

        normalizeGenres(raw) {
          if (!raw) return [];
          let s = String(raw).trim();
          if (!s) return [];

          if (s.includes('|')) return s.split('|').map(x => x.trim()).filter(Boolean);

          // —É–±–∏—Ä–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –∫–∞–≤—ã—á–∫–∏ –∏ –≥—Ä—è–∑—å –≤–∏–¥–∞: "a", "b"
          s = s.replace(/^\s*"+|"+\s*$/g, '');
          s = s.replace(/"\s*,\s*"/g, ',');
          s = s.replace(/"\s*$/g,'').replace(/^\s*"/g,'');

          return s.split(',')
            .map(x => x.replace(/^"+|"+$/g,'').trim())
            .filter(Boolean);
        },

        // ==== LOAD ====
        async loadItems() {
          this.loading = true;
          this.error = null;

          try {
            const url = this.getSheetCsvUrl();
            const resp = await fetch(url, { cache: 'no-store' });
            if (!resp.ok) throw new Error(`HTTP ${resp.status}: –Ω–µ —Å–º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å CSV. –ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ.`);

            const csvText = await resp.text();
            const table = this.parseCSV(csvText);

            if (!table.length || table.length < 2) {
              throw new Error('CSV –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –Ω–∏–∂–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞.');
            }

            const headers = table[0].map(h => (h || '').trim());

            // —É–º–Ω—ã–π –ø–æ–∏—Å–∫ –∫–æ–ª–æ–Ω–æ–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –Ω–∞–∑–≤–∞–Ω–∏–π
            const findCol = (...names) => {
              for (const n of names) {
                const i = headers.indexOf(n);
                if (i !== -1) return i;
              }
              return -1;
            };

            const idxTimestamp = findCol('–ü–æ–∑–Ω–∞—á–∫–∞ —á–∞—Å—É', 'Timestamp', 'timestamp', '–í—Ä–µ–º—è');
            const idxTitle     = findCol('–ù–∞–∑–≤–∞–Ω–∏–µ', 'Title', 'title');
            const idxType      = findCol('–¢–∏–ø', 'Type', 'type');
            const idxRating    = findCol('–û—Ü–µ–Ω–∫–∞', 'Rating', 'rating');
            const idxGenres    = findCol('–ñ–∞–Ω—Ä—ã', 'Genres', 'genres');
            const idxDesc      = findCol('–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–π—Ç–ª–∞', '–û–ø–∏—Å–∞–Ω–∏–µ', 'Description', 'description');
            const idxReview    = findCol('–†–µ—Ü–µ–Ω–∑–∏—è', 'Review', 'review');
            const idxImage     = findCol('–ö–∞—Ä—Ç–∏–Ω–∫–∞(—Å—Å—ã–ª–∫–∞)', '–ö–∞—Ä—Ç–∏–Ω–∫–∞', '–ü–æ—Å—Ç–µ—Ä', 'Image', 'image');
            const idxYear      = findCol('–ì–æ–¥', 'Year', 'year');

            if (idxTitle === -1 || idxType === -1) {
              throw new Error(
                '–ù–µ –≤–∏–∂—É –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏. –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º: "–ù–∞–∑–≤–∞–Ω–∏–µ" –∏ "–¢–∏–ø". (–û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)'
              );
            }

            const rows = table.slice(1);

            const all = rows
              .map((r, i) => {
                const title = (r[idxTitle] ?? '').trim();
                if (!title) return null;

                const type = (r[idxType] ?? '').trim();

                const ratingRaw = (idxRating !== -1) ? (r[idxRating] ?? '').trim() : '';
                const ratingNum = parseFloat(String(ratingRaw).replace(',', '.'));
                const rating = Number.isFinite(ratingNum) ? ratingNum : null;

                const genresRaw = (idxGenres !== -1) ? (r[idxGenres] ?? '') : '';
                const genres = this.normalizeGenres(genresRaw);

                const description = (idxDesc !== -1) ? String(r[idxDesc] ?? '') : '';
                const review = (idxReview !== -1) ? String(r[idxReview] ?? '') : '';
                const image = (idxImage !== -1) ? String(r[idxImage] ?? '').trim() : '';

                const yearRaw = (idxYear !== -1) ? String(r[idxYear] ?? '').trim() : '';
                const yearNum = parseInt(yearRaw, 10);
                const year = Number.isFinite(yearNum) ? yearNum : null;

                const createdAt = (idxTimestamp !== -1) ? String(r[idxTimestamp] ?? '').trim() : '';

                return {
                  title,
                  type,
                  typeDisplay: this.getTypeDisplay(type),
                  year,
                  yearDisplay: (year != null) ? String(year) : '‚Äî',
                  rating,
                  genres,
                  description: description.trim(),
                  review: review.trim(),
                  image: image || null,
                  createdAt,
                  _key: `${title}-${createdAt || i}`
                };
              })
              .filter(Boolean);

            if (!all.length) throw new Error('–î–∞–Ω–Ω—ã–µ –Ω–µ —Ä–∞—Å–ø–∞—Ä—Å–∏–ª–∏—Å—å. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å—Ç—Ä–æ–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.');

            this.items = all;

            this.$nextTick(() => this.initLazyLoading());
          } catch (e) {
            console.error(e);
            this.items = [];
            this.error = e?.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.';
          } finally {
            this.loading = false;
          }
        },

        // ==== lazy images ====
        initLazyLoading() {
          if (this.imageObserver) this.imageObserver.disconnect();

          this.imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (!entry.isIntersecting) return;
              const img = entry.target;
              const src = img.getAttribute('data-src');
              if (src) {
                img.src = src;
                img.removeAttribute('data-src');
              }
              this.imageObserver.unobserve(img);
            });
          }, { rootMargin: '200px 0px', threshold: 0.01 });

          document.querySelectorAll('img[data-src]').forEach(img => this.imageObserver.observe(img));
        },

        handleImageError(e, item) {
          item.image = null;
          try { e.target.remove(); } catch {}
        },

        // ==== modal ====
        openModal(item) {
          this.modalItem = { ...item };

          // –µ—Å–ª–∏ –Ω–µ—Ç review ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ (–µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å)
          this.showReview = !!item.review;
          if (!item.review && item.description) this.showReview = false;

          document.body.style.overflow = 'hidden';
        },

        closeModal() {
          this.modalItem = null;
          document.body.style.overflow = '';
        },

        // ==== actions ====
        pickRandomItem() {
          const pool = this.filteredItems;
          if (!pool.length) return;
          const idx = Math.floor(Math.random() * pool.length);
          this.openModal(pool[idx]);
        },

        clearFilters() {
          this.search = '';
          this.categoryFilter = '';
          this.sortKey = 'rating-desc';
          this.minRating = 0;
          this.minYear = 1900;
          this.maxYear = 2030;
        },

        // ==== computed ====
        get hasAnyContent() {
          return this.modalItem && (this.modalItem.review || this.modalItem.description);
        },

        get filteredItems() {
          const q = (this.search || '').trim().toLowerCase();

          return this.items
            .filter(it => !q || (it.title || '').toLowerCase().includes(q))
            .filter(it => !this.categoryFilter || it.type === this.categoryFilter)
            .filter(it => (this.minRating <= 0) || (it.rating != null && it.rating >= this.minRating))
            // –µ—Å–ª–∏ –≥–æ–¥–∞ –Ω–µ—Ç ‚Äî –Ω–µ —Ä–µ–∂–µ–º
            .filter(it => {
              if (it.year == null) return true;
              if (this.minYear !== 1900 && it.year < this.minYear) return false;
              if (this.maxYear !== 2030 && it.year > this.maxYear) return false;
              return true;
            });
        },

        get filteredAndSortedItems() {
          const arr = [...this.filteredItems].sort((a, b) => {
            const ra = (a.rating == null ? -1 : a.rating);
            const rb = (b.rating == null ? -1 : b.rating);

            switch (this.sortKey) {
              case 'rating-asc':  return ra - rb;
              case 'rating-desc': return rb - ra;

              case 'year-asc': {
                const ya = (a.year == null ? 9999 : a.year);
                const yb = (b.year == null ? 9999 : b.year);
                return ya - yb;
              }
              case 'year-desc': {
                const ya = (a.year == null ? -1 : a.year);
                const yb = (b.year == null ? -1 : b.year);
                return yb - ya;
              }

              case 'title':
                return (a.title || '').localeCompare((b.title || ''), 'ru');

              default:
                return 0;
            }
          });

          this.$nextTick(() => this.initLazyLoading());
          return arr;
        },

        init() {}
      };
    }
  </script>
</body>
</html>
```
