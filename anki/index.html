<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>KW0RS Cards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #080c10;
      --surface: #0f1520;
      --border: rgba(255,255,255,.07);
      --green: #6ee7b7;
      --blue: #7dd3fc;
      --amber: #fbbf24;
      --red: #f87171;
      --text: #e2e8f0;
      --muted: #64748b;
      --card-bg: rgba(255,255,255,.04);
      --glow-green: rgba(110,231,183,.15);
      --glow-blue: rgba(125,211,252,.15);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      min-height: 100vh;
      min-height: 100dvh;
      overflow-x: hidden;
    }

    /* â”€â”€ BG noise + gradient â”€â”€ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 60% 40% at 20% 0%, rgba(110,231,183,.08) 0%, transparent 60%),
        radial-gradient(ellipse 50% 50% at 80% 100%, rgba(125,211,252,.07) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SCREENS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .screen {
      display: none;
      position: relative;
      z-index: 1;
    }
    .screen.active { display: flex; }

    /* â”€â”€ HOME â”€â”€ */
    #home {
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      min-height: 100dvh;
      padding: 2rem 1.5rem;
      gap: 2rem;
    }

    .logo {
      font-family: 'Syne', sans-serif;
      font-size: clamp(2.8rem, 10vw, 5rem);
      font-weight: 800;
      letter-spacing: -.03em;
      background: linear-gradient(135deg, var(--green), var(--blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
    }

    .tagline {
      color: var(--muted);
      font-size: .95rem;
      letter-spacing: .04em;
      text-transform: uppercase;
      margin-top: -.5rem;
    }

    .mode-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: .75rem;
      width: 100%;
      max-width: 380px;
    }

    .mode-btn {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.25rem 1rem;
      cursor: pointer;
      transition: all .25s;
      text-align: center;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
    }
    .mode-btn:hover {
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,.07);
      transform: translateY(-2px);
    }
    .mode-btn .icon { font-size: 1.8rem; display: block; margin-bottom: .4rem; }
    .mode-btn .label { font-size: .9rem; font-weight: 600; }
    .mode-btn .sublabel { font-size: .72rem; color: var(--muted); margin-top: .15rem; }
    .mode-btn.full { grid-column: span 2; }

    .stats-bar {
      display: flex;
      gap: 1.5rem;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: .9rem 1.5rem;
      width: 100%;
      max-width: 380px;
    }
    .stat { text-align: center; flex: 1; }
    .stat .val { font-family: 'Syne', sans-serif; font-size: 1.4rem; font-weight: 700; color: var(--green); }
    .stat .key { font-size: .7rem; color: var(--muted); text-transform: uppercase; letter-spacing: .05em; margin-top: .1rem; }

    /* â”€â”€ LOADING â”€â”€ */
    #loading {
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      min-height: 100dvh;
      gap: 1.5rem;
      padding: 2rem;
    }
    .load-title { font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 700; }
    .progress-wrap {
      width: min(80vw, 300px);
      height: 6px;
      background: rgba(255,255,255,.08);
      border-radius: 6px;
      overflow: hidden;
    }
    #bar {
      height: 100%;
      background: linear-gradient(90deg, var(--green), var(--blue));
      width: 0%;
      transition: width .3s ease-out;
      border-radius: 6px;
    }
    #ptext { font-size: .85rem; color: var(--muted); }

    /* â”€â”€ FLASHCARD SCREEN â”€â”€ */
    #flashcard {
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      min-height: 100dvh;
      padding: 1rem 1rem 1.5rem;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      max-width: 420px;
      padding: .5rem 0 1rem;
    }
    .back-btn {
      background: none;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-size: 1.3rem;
      padding: .4rem;
      transition: color .2s;
    }
    .back-btn:hover { color: var(--text); }
    .mode-label {
      font-family: 'Syne', sans-serif;
      font-size: .8rem;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--green);
      background: var(--glow-green);
      border: 1px solid rgba(110,231,183,.2);
      border-radius: 20px;
      padding: .3rem .8rem;
    }
    .top-right { display: flex; gap: .5rem; align-items: center; }

    /* progress ring */
    .ring-wrap { position: relative; width: 36px; height: 36px; }
    .ring-wrap svg { transform: rotate(-90deg); }
    .ring-bg { fill: none; stroke: rgba(255,255,255,.08); stroke-width: 3; }
    .ring-fill { fill: none; stroke: var(--green); stroke-width: 3; stroke-linecap: round; transition: stroke-dashoffset .5s; }
    .ring-text {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      font-size: .55rem;
      font-weight: 700;
      color: var(--green);
    }

    /* card */
    #card {
      width: 92vw;
      max-width: 400px;
      height: min(60vh, 460px);
      position: relative;
      perspective: 1200px;
      cursor: pointer;
      margin-bottom: 1.2rem;
    }
    .inner {
      position: absolute;
      top: 0; right: 0; bottom: 0; left: 0;
      transform-style: preserve-3d;
      transition: transform .55s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    .flipped .inner { transform: rotateY(180deg); }
    #card.hide-back .back { opacity: 0; pointer-events: none; }

    .face {
      position: absolute;
      top: 0; right: 0; bottom: 0; left: 0;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      border-radius: 24px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      box-shadow: 0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    }
    @supports not (backdrop-filter: blur(1px)) {
      .face { background: rgba(15,21,32,.95); }
    }
    .face-label {
      font-size: .65rem;
      font-weight: 600;
      letter-spacing: .12em;
      text-transform: uppercase;
      margin-bottom: 1rem;
      padding: .25rem .7rem;
      border-radius: 20px;
    }
    .front .face-label { color: var(--green); background: var(--glow-green); border: 1px solid rgba(110,231,183,.2); }
    .back .face-label { color: var(--blue); background: var(--glow-blue); border: 1px solid rgba(125,211,252,.2); }

    .card-word {
      font-family: 'Syne', sans-serif;
      font-size: clamp(1.7rem, 6vw, 2.4rem);
      font-weight: 700;
      text-align: center;
      line-height: 1.25;
      word-break: break-word;
    }
    .front .card-word { color: var(--green); }
    .back .card-word { color: var(--blue); }
    .back { transform: rotateY(180deg); }

    .flip-hint {
      font-size: .72rem;
      color: var(--muted);
      margin-top: 1.2rem;
      opacity: .6;
    }

    /* action buttons */
    .action-row {
      display: flex;
      gap: .75rem;
      width: 100%;
      max-width: 400px;
      margin-bottom: .75rem;
    }
    .action-row.center { justify-content: center; }

    .btn {
      flex: 1;
      padding: .9rem 1rem;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-family: 'DM Sans', sans-serif;
      font-size: .9rem;
      font-weight: 600;
      transition: all .2s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 4px 12px rgba(0,0,0,.2);
    }
    .btn:hover { transform: translateY(-2px) scale(1.03); }
    .btn:active { transform: scale(.96); }
    .btn:disabled { opacity: .4; cursor: not-allowed; transform: none !important; }

    .btn-green { background: var(--green); color: #061a10; }
    .btn-blue { background: var(--blue); color: #051525; }
    .btn-ghost { background: rgba(255,255,255,.07); color: var(--text); border: 1px solid var(--border); }
    .btn-red { background: var(--red); color: #1a0505; }
    .btn-amber { background: var(--amber); color: #1a1005; }
    .btn-icon { flex: 0 0 auto; width: 48px; height: 48px; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; border-radius: 50px; }

    #status {
      font-size: .78rem;
      color: var(--muted);
      text-align: center;
    }

    /* â”€â”€ QUIZ SCREEN â”€â”€ */
    #quiz {
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      min-height: 100dvh;
      padding: 1rem 1rem 1.5rem;
    }

    .quiz-question {
      width: 100%;
      max-width: 400px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 1.8rem;
      text-align: center;
      margin-bottom: 1rem;
    }
    .quiz-q-label {
      font-size: .65rem;
      font-weight: 600;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--amber);
      margin-bottom: .75rem;
    }
    .quiz-word {
      font-family: 'Syne', sans-serif;
      font-size: clamp(1.5rem, 5vw, 2rem);
      font-weight: 700;
      color: var(--text);
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: .6rem;
      width: 100%;
      max-width: 400px;
    }
    .quiz-opt {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1rem 1.2rem;
      cursor: pointer;
      font-family: 'DM Sans', sans-serif;
      font-size: .95rem;
      font-weight: 500;
      color: var(--text);
      text-align: left;
      transition: all .2s;
      position: relative;
    }
    .quiz-opt:hover:not(:disabled) {
      border-color: rgba(255,255,255,.2);
      background: rgba(255,255,255,.07);
    }
    .quiz-opt.correct {
      background: rgba(110,231,183,.12);
      border-color: var(--green);
      color: var(--green);
    }
    .quiz-opt.wrong {
      background: rgba(248,113,113,.12);
      border-color: var(--red);
      color: var(--red);
    }
    .quiz-opt:disabled { cursor: default; }

    .quiz-feedback {
      font-size: .85rem;
      min-height: 1.2rem;
      text-align: center;
      margin: .5rem 0;
      font-weight: 600;
      transition: opacity .3s;
    }
    .quiz-feedback.good { color: var(--green); }
    .quiz-feedback.bad { color: var(--red); }

    /* score pill */
    .score-pill {
      display: flex;
      gap: 1rem;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: .6rem 1.2rem;
      font-size: .8rem;
      font-weight: 600;
      margin-bottom: .5rem;
    }
    .score-pill span { color: var(--muted); }
    .score-pill .good-s { color: var(--green); }
    .score-pill .bad-s { color: var(--red); }

    /* â”€â”€ STATS SCREEN â”€â”€ */
    #stats-screen {
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      min-height: 100dvh;
      padding: 1.5rem 1rem 2rem;
      gap: 1rem;
    }
    .stats-title {
      font-family: 'Syne', sans-serif;
      font-size: 1.5rem;
      font-weight: 800;
      width: 100%;
      max-width: 400px;
    }
    .stat-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.2rem 1.5rem;
      width: 100%;
      max-width: 400px;
    }
    .stat-card h3 {
      font-size: .7rem;
      font-weight: 600;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: .75rem;
    }
    .big-num {
      font-family: 'Syne', sans-serif;
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--green);
    }
    .stat-row { display: flex; justify-content: space-between; align-items: center; padding: .4rem 0; border-bottom: 1px solid var(--border); }
    .stat-row:last-child { border-bottom: none; }
    .stat-row .sr-label { font-size: .85rem; color: var(--muted); }
    .stat-row .sr-val { font-weight: 600; font-size: .9rem; }

    /* session result bar */
    .result-bar-wrap { height: 8px; background: rgba(255,255,255,.06); border-radius: 8px; overflow: hidden; margin-top: .75rem; }
    .result-bar { height: 100%; border-radius: 8px; background: linear-gradient(90deg, var(--green), var(--blue)); transition: width 1s ease-out; }

    /* â”€â”€ TOAST â”€â”€ */
    #toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: rgba(15,21,32,.97);
      border: 1px solid var(--border);
      border-radius: 50px;
      padding: .65rem 1.3rem;
      font-size: .85rem;
      font-weight: 600;
      transition: transform .35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity .35s;
      opacity: 0;
      z-index: 100;
      white-space: nowrap;
    }
    #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    /* animations */
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .slide-up { animation: slideUp .4s ease-out; }

    @keyframes pop {
      0%   { transform: scale(.8); opacity: 0; }
      60%  { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    .pop { animation: pop .4s ease-out; }

    .finished-emoji { font-size: 4rem; animation: pop .6s ease-out; display: block; text-align: center; }

    @media (max-width: 380px) {
      .action-row { gap: .5rem; }
      .btn { padding: .8rem .7rem; font-size: .82rem; }
    }
  </style>
</head>
<body>

  <!-- â•â•â• LOADING â•â•â• -->
  <div id="loading" class="screen active">
    <div class="load-title">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ ĞºĞ¾Ğ»Ğ¾Ğ´Ñƒâ€¦</div>
    <div class="progress-wrap"><div id="bar"></div></div>
    <div id="ptext">0%</div>
  </div>

  <!-- â•â•â• HOME â•â•â• -->
  <div id="home" class="screen">
    <div>
      <div class="logo">KWORS</div>
      <div class="tagline">ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ Â· Cards Â· Karten</div>
    </div>

    <div id="home-stats" class="stats-bar">
      <div class="stat"><div class="val" id="s-total">0</div><div class="key">Ğ¡Ğ»Ğ¾Ğ²</div></div>
      <div class="stat"><div class="val" id="s-learned" style="color:var(--blue)">0</div><div class="key">Ğ’Ñ‹ÑƒÑ‡ĞµĞ½Ğ¾</div></div>
      <div class="stat"><div class="val" id="s-streak" style="color:var(--amber)">0</div><div class="key">Ğ¡ĞµÑ€Ğ¸Ñ âœ“</div></div>
    </div>

    <div class="mode-grid">
      <button class="mode-btn" onclick="startFlash('ru-de')">
        <span class="icon">ğŸƒ</span>
        <span class="label">Ru â†’ De</span>
        <span class="sublabel">ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸</span>
      </button>
      <button class="mode-btn" onclick="startFlash('de-ru')">
        <span class="icon">ğŸ”„</span>
        <span class="label">De â†’ Ru</span>
        <span class="sublabel">ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸</span>
      </button>
      <button class="mode-btn" onclick="startQuiz('ru-de')">
        <span class="icon">ğŸ¯</span>
        <span class="label">Ğ¢ĞµÑÑ‚ Ruâ†’De</span>
        <span class="sublabel">4 Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°</span>
      </button>
      <button class="mode-btn" onclick="startQuiz('de-ru')">
        <span class="icon">âš¡</span>
        <span class="label">Ğ¢ĞµÑÑ‚ Deâ†’Ru</span>
        <span class="sublabel">4 Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°</span>
      </button>
      <button class="mode-btn full" onclick="showStats()">
        <span class="icon">ğŸ“Š</span>
        <span class="label">Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</span>
        <span class="sublabel">ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ</span>
      </button>
    </div>
  </div>

  <!-- â•â•â• FLASHCARD â•â•â• -->
  <div id="flashcard" class="screen">
    <div class="top-bar">
      <button class="back-btn" onclick="goHome()">â† ĞĞ°Ğ·Ğ°Ğ´</button>
      <div class="mode-label" id="fc-mode-label">Ru â†’ De</div>
      <div class="top-right">
        <div class="ring-wrap">
          <svg width="36" height="36" viewBox="0 0 36 36">
            <circle class="ring-bg" cx="18" cy="18" r="15"/>
            <circle class="ring-fill" id="ring" cx="18" cy="18" r="15"
              stroke-dasharray="94.2" stroke-dashoffset="94.2"/>
          </svg>
          <div class="ring-text" id="ring-text">0%</div>
        </div>
      </div>
    </div>

    <div id="card">
      <div class="inner">
        <div class="face front">
          <div class="face-label">Ğ¡Ğ»Ğ¾Ğ²Ğ¾</div>
          <div class="card-word" id="fc-front">â€¦</div>
          <div class="flip-hint">ĞĞ°Ğ¶Ğ¼Ğ¸ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°</div>
        </div>
        <div class="face back">
          <div class="face-label">ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´</div>
          <div class="card-word" id="fc-back">â€¦</div>
        </div>
      </div>
    </div>

    <div class="action-row" style="justify-content:center; gap:.6rem">
      <button class="btn btn-red btn-icon" id="btn-hard" title="Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ â€” Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ·Ğ¶Ğµ" onclick="markCard('hard')">ğŸ˜“</button>
      <button class="btn btn-green" id="btn-next" onclick="nextFlash()">Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ â†’</button>
      <button class="btn btn-green btn-icon" id="btn-easy" title="Ğ—Ğ½Ğ°Ñ!" onclick="markCard('easy')">âœ“</button>
    </div>

    <div id="fc-status" class="action-row" style="justify-content:center">
      <div id="status" style="font-size:.78rem;color:var(--muted);text-align:center"></div>
    </div>
  </div>

  <!-- â•â•â• QUIZ â•â•â• -->
  <div id="quiz" class="screen">
    <div class="top-bar">
      <button class="back-btn" onclick="goHome()">â† ĞĞ°Ğ·Ğ°Ğ´</button>
      <div class="mode-label" id="qz-mode-label">Ğ¢ĞµÑÑ‚</div>
      <div class="score-pill">
        <span>âœ“ <b class="good-s" id="qz-correct">0</b></span>
        <span>âœ— <b class="bad-s" id="qz-wrong">0</b></span>
      </div>
    </div>

    <div class="quiz-question slide-up" id="qz-q">
      <div class="quiz-q-label">ĞŸĞµÑ€ĞµĞ²ĞµĞ´Ğ¸ ÑĞ»Ğ¾Ğ²Ğ¾</div>
      <div class="quiz-word" id="qz-word">â€¦</div>
    </div>

    <div class="quiz-feedback" id="qz-fb"></div>

    <div class="quiz-options" id="qz-opts"></div>

    <div style="flex:1"></div>
    <div class="action-row" style="justify-content:center;margin-top:1rem">
      <button class="btn btn-ghost" style="max-width:200px" id="qz-next" onclick="nextQuiz()" disabled>Ğ”Ğ°Ğ»ĞµĞµ â†’</button>
    </div>
  </div>

  <!-- â•â•â• STATS SCREEN â•â•â• -->
  <div id="stats-screen" class="screen">
    <div class="top-bar" style="width:100%;max-width:400px;margin:0 auto">
      <button class="back-btn" onclick="goHome()">â† ĞĞ°Ğ·Ğ°Ğ´</button>
      <div class="mode-label">Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</div>
      <div></div>
    </div>
    <div class="stats-title">ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ</div>
    <div class="stat-card">
      <h3>Ğ’ÑĞµĞ³Ğ¾ ÑĞµÑÑĞ¸Ğ¹</h3>
      <div class="big-num" id="st-sessions">0</div>
    </div>
    <div class="stat-card">
      <h3>ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸</h3>
      <div class="stat-row"><span class="sr-label">Ğ’ÑĞµĞ³Ğ¾ ÑĞ»Ğ¾Ğ²</span><span class="sr-val" id="st-total">0</span></div>
      <div class="stat-row"><span class="sr-label">Ğ’Ñ‹ÑƒÑ‡ĞµĞ½Ğ¾</span><span class="sr-val" style="color:var(--green)" id="st-learned">0</span></div>
      <div class="stat-row"><span class="sr-label">Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ñ…</span><span class="sr-val" style="color:var(--red)" id="st-hard">0</span></div>
      <div class="result-bar-wrap"><div class="result-bar" id="st-bar" style="width:0%"></div></div>
    </div>
    <div class="stat-card">
      <h3>Ğ¢ĞµÑÑ‚</h3>
      <div class="stat-row"><span class="sr-label">ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²</span><span class="sr-val" style="color:var(--green)" id="st-qcorrect">0</span></div>
      <div class="stat-row"><span class="sr-label">ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ…</span><span class="sr-val" style="color:var(--red)" id="st-qwrong">0</span></div>
      <div class="stat-row"><span class="sr-label">Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ</span><span class="sr-val" id="st-acc">â€”</span></div>
    </div>
    <button class="btn btn-ghost" style="max-width:200px;margin-top:.5rem" onclick="resetStats()">Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ</button>
  </div>

  <!-- TOAST -->
  <div id="toast"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONFIG & STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const SHEET_ID = '1-ZE-5MEjbv95xm2RmGdkJfKZ7UXPaUDpwAMykUf793I';
    const CSV_URL  = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`;
    const CACHE_KEY = 'kw0rs_cache_v3';
    const STATS_KEY = 'kw0rs_stats_v3';
    const CACHE_TTL = 5 * 60 * 1000;

    let raw = [];       // [{ru, de}]
    let deck = [];      // [{f, b}] shuffled for current session
    let ptr  = 0;
    let flashDir = 'ru-de';
    let isAnimating = false;

    // Persistent stats
    let stats = loadStats();

    function loadStats() {
      try {
        const s = localStorage.getItem(STATS_KEY);
        if (s) return JSON.parse(s);
      } catch(e) {}
      return { sessions:0, learned:{}, hard:{}, qCorrect:0, qWrong:0, streak:0 };
    }
    function saveStats() {
      try { localStorage.setItem(STATS_KEY, JSON.stringify(stats)); } catch(e) {}
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SCREEN MANAGER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function show(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function goHome() {
      updateHomeStats();
      show('home');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LOAD
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function setProgress(p, txt) {
      document.getElementById('bar').style.width = Math.min(100, Math.max(0,p)) + '%';
      document.getElementById('ptext').textContent = txt || Math.round(p) + '%';
    }

    async function load() {
      show('loading');
      try {
        const cached = localStorage.getItem(CACHE_KEY);
        if (cached) {
          const {data, ts} = JSON.parse(cached);
          if (Date.now() - ts < CACHE_TTL && Array.isArray(data) && data.length > 0) {
            raw = data;
            setProgress(100, 'Ğ˜Ğ· ĞºÑÑˆĞ° âœ“');
            await sleep(300);
            onLoaded();
            return;
          }
        }
      } catch(e) { localStorage.removeItem(CACHE_KEY); }

      setProgress(10, 'Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ñ CSVâ€¦');
      try {
        const res = await fetch(CSV_URL);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const text = await res.text();
        setProgress(40, 'ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñâ€¦');
        Papa.parse(text, {
          header: true,
          skipEmptyLines: true,
          complete: result => {
            raw = result.data.filter(x => x.Ru && x.De).map(x => ({ru: x.Ru.trim(), de: x.De.trim()}));
            if (!raw.length) { setProgress(0, 'âŒ ĞŸÑƒÑÑ‚Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ'); return; }
            try { localStorage.setItem(CACHE_KEY, JSON.stringify({data:raw, ts:Date.now()})); } catch(e) {}
            setProgress(100, `${raw.length} ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº âœ“`);
            setTimeout(onLoaded, 400);
          },
          error: err => { setProgress(0, 'âŒ ' + err.message); }
        });
      } catch(e) {
        setProgress(0, 'âŒ ' + e.message);
        document.getElementById('ptext').style.color = '#f87171';
      }
    }

    function onLoaded() {
      updateHomeStats();
      show('home');
    }

    function updateHomeStats() {
      document.getElementById('s-total').textContent   = raw.length;
      document.getElementById('s-learned').textContent = Object.keys(stats.learned).length;
      document.getElementById('s-streak').textContent  = stats.streak;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FLASHCARD MODE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function startFlash(dir) {
      flashDir = dir;
      stats.sessions++;
      saveStats();

      const shuffled = shuffle([...raw]);
      // put hard cards first
      const hardIds = Object.keys(stats.hard);
      shuffled.sort((a,b) => {
        const aHard = hardIds.includes(a.ru) ? -1 : 1;
        const bHard = hardIds.includes(b.ru) ? -1 : 1;
        return aHard - bHard;
      });

      deck = shuffled.map(c => dir === 'ru-de' ? {f:c.ru, b:c.de, id:c.ru} : {f:c.de, b:c.ru, id:c.ru});
      ptr = 0;
      isAnimating = false;

      document.getElementById('fc-mode-label').textContent = dir === 'ru-de' ? 'Ru â†’ De' : 'De â†’ Ru';
      show('flashcard');
      showFlashCard();
    }

    function showFlashCard() {
      const card = document.getElementById('card');
      card.classList.remove('flipped');
      card.classList.add('hide-back');

      updateRing();

      if (ptr >= deck.length) {
        document.getElementById('fc-front').textContent = 'ğŸ‰';
        document.getElementById('fc-back').textContent  = 'ĞœĞ¾Ğ»Ğ¾Ğ´ĞµÑ†!';
        document.getElementById('status').textContent   = 'ĞšĞ¾Ğ»Ğ¾Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ°!';
        document.getElementById('btn-next').disabled = true;
        card.classList.remove('hide-back');
        return;
      }

      document.getElementById('fc-front').textContent = deck[ptr].f;
      document.getElementById('fc-back').textContent  = deck[ptr].b;

      const current = ptr + 1;
      document.getElementById('status').textContent =
        `${current} / ${deck.length}  â€¢  Ğ’Ñ‹ÑƒÑ‡ĞµĞ½Ğ¾: ${Object.keys(stats.learned).length}`;

      document.getElementById('btn-next').disabled = false;
      setTimeout(() => card.classList.remove('hide-back'), 700);
    }

    function updateRing() {
      const pct = deck.length ? ptr / deck.length : 0;
      const circ = 94.2;
      document.getElementById('ring').style.strokeDashoffset = circ - pct * circ;
      document.getElementById('ring-text').textContent = Math.round(pct*100) + '%';
    }

    function nextFlash() {
      if (isAnimating || ptr >= deck.length) return;
      animateCardOut(() => {
        ptr++;
        showFlashCard();
      });
    }

    function markCard(type) {
      if (ptr >= deck.length) return;
      const id = deck[ptr].id;
      if (type === 'easy') {
        stats.learned[id] = (stats.learned[id] || 0) + 1;
        delete stats.hard[id];
        stats.streak = (stats.streak || 0) + 1;
        toast('âœ“ ĞœĞ¾Ğ»Ğ¾Ğ´ĞµÑ†! Ğ—Ğ½Ğ°ĞµÑˆÑŒ ÑÑ‚Ğ¾ ÑĞ»Ğ¾Ğ²Ğ¾', 'var(--green)');
      } else {
        stats.hard[id] = (stats.hard[id] || 0) + 1;
        stats.streak = 0;
        toast('âŸ³ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€', 'var(--red)');
      }
      saveStats();
      document.getElementById('s-streak').textContent = stats.streak;
      nextFlash();
    }

    function animateCardOut(cb) {
      isAnimating = true;
      const card = document.getElementById('card');
      const rot = (Math.random() - .5) * 35;
      card.style.transition = 'transform .7s cubic-bezier(0.34, 1.56, 0.64, 1), opacity .7s';
      card.style.transform  = `translateY(-110vh) rotate(${rot}deg) scale(.85)`;
      card.style.opacity    = '0';

      setTimeout(() => {
        cb();
        card.style.transition = 'none';
        card.style.transform  = 'translateY(30px) scale(.92)';
        card.style.opacity    = '0';
        setTimeout(() => {
          card.style.transition = 'transform .7s cubic-bezier(0.34, 1.56, 0.64, 1), opacity .7s';
          card.style.transform  = '';
          card.style.opacity    = '';
          setTimeout(() => { isAnimating = false; }, 700);
        }, 20);
      }, 700);
    }

    // card flip on click
    document.getElementById('card').addEventListener('click', () => {
      if (!isAnimating && ptr < deck.length) {
        document.getElementById('card').classList.toggle('flipped');
      }
    });

    // swipe on card
    let tX = 0, tY = 0, tT = 0;
    document.getElementById('card').addEventListener('touchstart', e => {
      tX = e.touches[0].clientX; tY = e.touches[0].clientY; tT = Date.now();
    }, {passive:true});
    document.getElementById('card').addEventListener('touchend', e => {
      const dx = e.changedTouches[0].clientX - tX;
      const dy = e.changedTouches[0].clientY - tY;
      if (Math.abs(dx) > 80 && Math.abs(dy) < 60 && Date.now()-tT < 350) nextFlash();
    }, {passive:true});

    // keyboard
    document.addEventListener('keydown', e => {
      const s = document.querySelector('.screen.active')?.id;
      if (s === 'flashcard') {
        if (e.key === ' ' || e.key === 'ArrowRight') { e.preventDefault(); nextFlash(); }
        if (e.key === 'ArrowUp' || e.key === 'e') markCard('easy');
        if (e.key === 'ArrowDown' || e.key === 'h') markCard('hard');
        if (e.key === 'ArrowLeft' || e.key === 'f')
          document.getElementById('card').classList.toggle('flipped');
      }
      if (s === 'quiz' && e.key === 'Enter') nextQuiz();
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // QUIZ MODE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let quizDir = 'ru-de';
    let quizPool = [];
    let quizPtr  = 0;
    let quizCorrect = 0;
    let quizWrong   = 0;
    let quizAnswered = false;

    function startQuiz(dir) {
      quizDir     = dir;
      quizPool    = shuffle([...raw]);
      quizPtr     = 0;
      quizCorrect = 0;
      quizWrong   = 0;
      quizAnswered = false;
      stats.sessions++;
      saveStats();

      document.getElementById('qz-mode-label').textContent = dir === 'ru-de' ? 'Ğ¢ĞµÑÑ‚ Ruâ†’De' : 'Ğ¢ĞµÑÑ‚ Deâ†’Ru';
      document.getElementById('qz-correct').textContent = 0;
      document.getElementById('qz-wrong').textContent   = 0;
      show('quiz');
      showQuizQ();
    }

    function showQuizQ() {
      if (quizPtr >= quizPool.length) {
        // finished
        const total = quizCorrect + quizWrong;
        const acc   = total ? Math.round(quizCorrect/total*100) : 0;
        document.getElementById('qz-word').textContent = `${quizCorrect}/${total} â€” ${acc}% Ğ²ĞµÑ€Ğ½Ğ¾`;
        document.getElementById('qz-opts').innerHTML   = `<div style="text-align:center;font-size:3rem;margin:1rem">ğŸ‰</div>`;
        document.getElementById('qz-fb').textContent   = '';
        document.getElementById('qz-next').disabled    = true;
        document.getElementById('qz-next').textContent = 'â† Ğ”Ğ¾Ğ¼Ğ¾Ğ¹';
        document.getElementById('qz-next').disabled    = false;
        document.getElementById('qz-next').onclick     = goHome;
        return;
      }

      quizAnswered = false;
      const item = quizPool[quizPtr];
      const question = quizDir === 'ru-de' ? item.ru : item.de;
      const answer   = quizDir === 'ru-de' ? item.de : item.ru;

      // pick 3 wrong options
      const pool = raw.filter(x => x !== item);
      const wrongs = shuffle(pool).slice(0, 3).map(x => quizDir === 'ru-de' ? x.de : x.ru);
      const options = shuffle([answer, ...wrongs]);

      document.getElementById('qz-word').textContent = question;
      document.getElementById('qz-fb').textContent   = '';
      document.getElementById('qz-fb').className     = 'quiz-feedback';
      document.getElementById('qz-next').disabled    = true;
      document.getElementById('qz-next').textContent = 'Ğ”Ğ°Ğ»ĞµĞµ â†’';
      document.getElementById('qz-next').onclick     = nextQuiz;

      const optsEl = document.getElementById('qz-opts');
      optsEl.innerHTML = '';
      options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'quiz-opt';
        btn.textContent = opt;
        btn.onclick = () => chooseQuiz(btn, opt, answer, item.ru);
        optsEl.appendChild(btn);
      });
    }

    function chooseQuiz(btn, chosen, correct, id) {
      if (quizAnswered) return;
      quizAnswered = true;

      const opts = document.querySelectorAll('.quiz-opt');
      opts.forEach(b => { b.disabled = true; });

      if (chosen === correct) {
        btn.classList.add('correct');
        quizCorrect++;
        stats.qCorrect++;
        stats.learned[id] = (stats.learned[id] || 0) + 1;
        stats.streak = (stats.streak || 0) + 1;
        document.getElementById('qz-fb').textContent = 'âœ“ Ğ’ĞµÑ€Ğ½Ğ¾!';
        document.getElementById('qz-fb').className   = 'quiz-feedback good';
      } else {
        btn.classList.add('wrong');
        quizWrong++;
        stats.qWrong++;
        stats.hard[id] = (stats.hard[id] || 0) + 1;
        stats.streak = 0;
        document.getElementById('qz-fb').textContent = 'âœ— ĞĞµĞ²ĞµÑ€Ğ½Ğ¾. ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾: ' + correct;
        document.getElementById('qz-fb').className   = 'quiz-feedback bad';
        // highlight correct
        opts.forEach(b => { if (b.textContent === correct) b.classList.add('correct'); });
      }
      saveStats();

      document.getElementById('qz-correct').textContent = quizCorrect;
      document.getElementById('qz-wrong').textContent   = quizWrong;
      document.getElementById('qz-next').disabled = false;
    }

    function nextQuiz() {
      if (!quizAnswered && quizPtr < quizPool.length) return;
      quizPtr++;
      showQuizQ();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATS SCREEN
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showStats() {
      const learned = Object.keys(stats.learned).length;
      const hard    = Object.keys(stats.hard).length;
      const total   = raw.length;
      const qTotal  = stats.qCorrect + stats.qWrong;
      const acc     = qTotal ? Math.round(stats.qCorrect / qTotal * 100) : 0;

      document.getElementById('st-sessions').textContent = stats.sessions;
      document.getElementById('st-total').textContent    = total;
      document.getElementById('st-learned').textContent  = learned;
      document.getElementById('st-hard').textContent     = hard;
      document.getElementById('st-qcorrect').textContent = stats.qCorrect;
      document.getElementById('st-qwrong').textContent   = stats.qWrong;
      document.getElementById('st-acc').textContent      = qTotal ? acc + '%' : 'â€”';

      setTimeout(() => {
        document.getElementById('st-bar').style.width = (total ? learned/total*100 : 0) + '%';
      }, 100);

      show('stats-screen');
    }

    function resetStats() {
      if (!confirm('Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ²ÑÑ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ?')) return;
      stats = { sessions:0, learned:{}, hard:{}, qCorrect:0, qWrong:0, streak:0 };
      saveStats();
      showStats();
      toast('Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½Ğ°', 'var(--muted)');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HELPERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function shuffle(arr) {
      for (let i = arr.length-1; i > 0; i--) {
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }

    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    let toastTimer;
    function toast(msg, color) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.borderColor = color || 'var(--border)';
      t.style.color = color || 'var(--text)';
      t.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => t.classList.remove('show'), 2200);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // START
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    load();
  </script>
</body>
</html>
